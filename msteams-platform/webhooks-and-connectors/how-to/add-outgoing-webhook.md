---
title: Добавить пользовательские боты, Microsoft Teams с исходящими webhooks
description: описывает, как добавить исходящий webhook
ms.topic: conceptual
ms.author: lajanuar
localization_priority: Normal
keywords: команды вкладки исходящих webhook действия сообщение проверить webhook
ms.openlocfilehash: a5a0cdfc9080ac4567f438b6fb6fd0671df8c19f
ms.sourcegitcommit: 51e4a1464ea58c254ad6bd0317aca03ebf6bf1f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "52566532"
---
# <a name="add-custom-bots-to-teams-with-outgoing-webhooks"></a>Добавить пользовательские боты, Teams с исходящими webhooks

## <a name="outgoing-webhooks-in-teams"></a>Исходящие веб-хуки в Teams

Webhooks являются выдающимся способом для Teams для интеграции с внешними приложениями. Webhook по существу POST запрос, отправленный на ОБРАТНЫй вызов URL. Исходящие webhooks позволяют пользователям отправлять сообщения на ваш веб-сервис, не вдаваясь в полный процесс создания ботов [через Microsoft Bot Framework.](https://dev.botframework.com/)

Исходящие webhook отправляет данные Teams любой выбранной службы, способной принять полезную нагрузку JSON. После добавления исходящих webhooks в команду, он выступает в качестве бота и ищет сообщения в каналах, используя **\@ упоминание**. Он отправляет уведомления внешним веб-сервисам и отвечает богатыми сообщениями, которые включают карты и изображения.

## <a name="outgoing-webhook-key-features"></a>Исходящие ключевые функции webhook

| Возможность | Описание |
| ------- | ----------- |
| Масштабная конфигурация| Webhooks имеют область охвата на уровне команды. Вы должны пройти через процесс настройки для каждой команды, где вы хотите добавить исходящие webhook. |
| Реактивные сообщения| Пользователи должны @mention для webhook для получения сообщений. В настоящее время пользователи могут отправить сообщение только исходящим webhook в общедоступных каналах, а не в личном или частном объеме. |
|Стандартный обмен данными HTTP|Ответы отображаются в той же цепочке, что и исходное сообщение запроса, и могут включать в себя любой контент сообщений бот-фреймворка, например, богатый текст, изображения, карты и смайлики. Хотя исходящие webhooks могут использовать карты, они не могут использовать любые действия карты, за исключением `openURL` .|
| Teams Поддержка метода API|Исходящие webhook отправляет HTTP POST в веб-службу и обрабатывать ответ обратно. Они не могут получить доступ к другим API, таким как получение реестра или списка каналов в команде.|

## <a name="creating-actionable-messages"></a>Создание сообщений с действиями

Карты разъема включают три видимые кнопки на карте. Каждая кнопка определяется в `potentialAction` свойстве сообщения с помощью `ActionCard` действий. Каждый `ActionCard` из них содержит тип ввода; текстовое поле, сборщик дат или список с несколько вариантов. Каждое `ActionCard` действие имеет связанное действие, например. `HttpPOST`

Карточки соединителей поддерживают действия трех типов:

| Действие | Описание |
| ------- | ----------- |
| `ActionCard` |Представляет один или несколько типов входных данных и связанных с ними действий.|
| `HttpPOST` | Отправляет запрос POST на URL-адрес. |
| `OpenUri` |  Открывает URI в отдельном браузере или приложении, дополнительно нацеленном на различные ИРИС на основе операционных систем.|

Действие `ActionCard` поддерживает три типа входных данных:

| Тип ввода | Описание |
| ------- | ----------- |
| `TextInput` | Однолинейное или многолинейное текстовое поле с дополнительным ограничением длины. |
| `DateInput` | Селектор даты с дополнительным селектором времени. |
| `MultichoiceInput` | Указанный список вариантов, предлагающих либо один выбор, либо несколько вариантов.|

`MultichoiceInput` поддерживает `style` свойство, химитное отображением полностью расширенного списка. Значение по умолчанию `style` зависит от `isMultiSelect` значения.

| `isMultiSelect` ценность  | `style` значение по умолчанию  |
| --- | --- |
| `false` или не задано | Стиль по умолчанию `compact`|
| `true` | Стиль по умолчанию `expanded` |

> [!NOTE]
> * Введите `"isMultiSelect": true` оба `"style": true` и , если вы хотите, чтобы список мульти-выбор, который будет отображаться в компактном стиле.
> * Выбор свойства `compact` в `style` Teams же, как выбор свойства в `normal` Microsoft `style` Outlook.
> * Webhooks поддерживает только Office 365 сообщения обратно карты и адаптивные карты.

Для получения всех других подробностей о действиях разъемной карты **[см.](/outlook/actionable-messages/card-reference#actions)**

## <a name="adding-outgoing-webhooks-to-your-app"></a>Добавление исходящих webhooks в приложение

**Сценарий:** Push изменить статус уведомления на Teams сервера базы данных канала в ваше приложение.  
**Пример**: У вас есть приложение для бизнеса, которое отслеживает все операции CRUD, сделанные для записей сотрудников Teams пользователей hr канала через Office 365 аренду.

### <a name="1-create-a-url-on-your-apps-server-to-accept-and-process-a-post-request-with-a-json-payload"></a>1. Создайте URL-адрес на сервере приложения для принятия и обработки запроса POST с полезной нагрузкой JSON

Служба получает сообщения в стандартной схеме обмена сообщениями бота Azure. Разъем платформы бота — это служба RESTful, которая позволяет вашему сервису обрабатывать обмен отформатированными сообщениями JSON через протоколы HTTPS, как это [описано в API службы Azure Bot.](/bot-framework/rest-api/bot-framework-rest-connector-api-reference) Кроме того, вы можете следить за Microsoft Bot Framework SDK для обработки и анализа сообщений. Смотрите также [о службе Azure Bot](/azure/bot-service/bot-service-overview-introduction).


Исходящие вебхуки имеют `team` масштабы до уровня и видны всем членам команды. Так же, как бот, пользователи **\@ должны упомянуть** имя исходящих webhook вызвать его в канале.

### <a name="2-create-a-method-to-verify-the-outgoing-webhook-hmac-token"></a>2. Создайте метод проверки исходящего токена webhook HMAC

#### <a name="hmac-signature-for-testing-with-code-example"></a>Подпись HMAC для тестирования с примером кода

Используя пример входящих сообщений и идентификаторов: "contoso" ПодписанияKeyDictionary из "contoso", "vqF0En"0ucuRTM/01o2GuhMH3hKKk/N2bOmlM31zaA" .

В авторизации заголовка запроса используйте значение "HMAC 03TCao0i55H1eVKUus'tz'RjtvYTs'mO41mPL-R1e1U".

Чтобы убедиться, что ваша служба получает звонки только от Teams клиентов, Teams предоставляет код HMAC в заголовке `hmac` HTTP. Всегда включал код в протокол проверки подлинности.

Ваш код всегда должен проверять подпись HMAC, включенную в запрос:

* Создать токен HMAC из тела запроса сообщения. Есть стандартные библиотеки, чтобы сделать это на большинстве платформ (см. [Crypto](https://nodejs.org/api/crypto.html#crypto_crypto) для Node.js или [Teams Webhook Образец](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) для C \# ). Microsoft Teams использует стандартную криптографию SHA256 HMAC. Вам нужно преобразовать тело в массив тотализатора в UTF8.
* Вычислите хэш из массива карт безопасности, **предоставленного Teams при** регистрации уходящего webhook в Teams клиента». Смотрите [Создать исходящий webhook](#create-an-outgoing-webhook).
* Преобразование хэша в строку с помощью кодирования UTF-8.
* Сравните значение строки генерируемого хэша со значением, представленным в запросе HTTP.

### <a name="3-create-a-method-to-send-a-success-or-failure-response"></a>3. Создать метод для отправки ответа на успех или неудачу

Ответы от исходящих webhooks отображаются в той же цепочке ответов, что и исходное сообщение. Когда пользователь выполняет запрос, Microsoft Teams выдает синхронный запрос HTTP в службу, и ваш код получает пять секунд, чтобы ответить на сообщение до того, как время подключения выйдет и прекратится.

### <a name="example-response"></a>Пример отклика

```json
{
    "type": "message",
    "text": "This is a reply!"
}
```

## <a name="create-an-outgoing-webhook"></a>Создание исходящего веб-перехватчика

1. Выберите соответствующую команду и **выберите команду Manage** из (&#8226;&#8226;&#8226;) выпадают из меню.
1. Выберите **вкладку** Apps из навигационного бара.
1. Из нижнего правого угла окна выберите **Создать исходящий webhook**.
1. В полученном всплывающем окне завершаются необходимые поля:

>* **Имя**: Название webhook и @mention крана
>* **URL-адрес обратного** вызова : конечная точка HTTPS, которая принимает полезные нагрузки JSON и получает запросы POST от Teams
>* **Описание**: Подробная строка, которая появляется в карточке профиля и панели мониторинга приложений командного уровня
>* **Профиль Фото**: Дополнительный значок приложения для вашего webhook
>* Выберите **кнопку** «Создать» из нижнего правого угла всплывающего окна, а исходящий webhook добавляется к каналам текущей команды.
>* Следующее окно диалога отображает маркер безопасности Кода проверки подлинности [сообщений на основе хэша (HMAC),](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) который используется для проверки подлинности звонков между Teams и назначенной внешней службой.
>* Исходящий webhook доступен для пользователей команды, только если URL действителен, а маркеры проверки подлинности сервера и клиента равны, например, рукопожатие HMAC.

## <a name="code-sample"></a>Пример кода
|**Название образца** | **Описание** | **.NET** | **Node.js** |
|----------------|------------------|--------|----------------|
| Исходящие веб-перехватчики | Образцы для создания **пользовательских ботов,** которые будут использоваться Microsoft Teams.| [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/outgoing-webhook/csharp) | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/outgoing-webhook/nodejs)|

