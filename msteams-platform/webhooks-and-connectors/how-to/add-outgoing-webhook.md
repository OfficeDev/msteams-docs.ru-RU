---
title: Добавление пользовательских ботов в Microsoft Teams с помощью исходяющих веб-hooks
description: описывает, как добавить исходяющий веб-hook
ms.topic: conceptual
ms.author: lajanuar
keywords: Teams вкладок исходя сообщений с действиями веб-хостинга для проверки веб-hook
ms.openlocfilehash: 20d30be7a35b33b94dc4a856439c51d5d0cc441c
ms.sourcegitcommit: f74b74d5bed1df193e59f46121ada443fb57277b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "50093255"
---
# <a name="add-custom-bots-to-teams-with-outgoing-webhooks"></a>Добавление пользовательских ботов в Teams с помощью исходяющих веб-hooks

## <a name="what-are-outgoing-webhooks-in-teams"></a>Что такое исходяющие веб-hooks в Teams?

Веб-hooks — это объединяющий способ интеграции Teams с внешними приложениями. Веб-hook — это, по сути, запрос POST, отправленный на URL-адрес для вызова. Исходяющие веб-hooks позволяют пользователям отправлять сообщения в веб-службу без полного процесса создания ботов с помощью [Microsoft Bot Framework.](https://dev.botframework.com/)

Исходяющий веб-браузер отправляет данные из Teams любой выбранной службе, способной принимать полезное количество данных JSON. После добавления исходяющих веб-hooks в команду он действует как бот и ищет сообщения в каналах, используя **\@ упоминание.** Она отправляет уведомления внешним веб-службам и отвечает на них с помощью сообщений, в том числе карточек и изображений.

## <a name="outgoing-webhook-key-features"></a>Ключевые функции исходяющих веб-функций веб-хостинга

| Возможность | Описание |
| ------- | ----------- |
| Конфигурация с областью действия| Область действия веб-hooks на уровне группы. Необходимо пройти процедуру настройки для каждой команды, в которую нужно добавить исходяющий веб-проект. |
| Реактивное обмен сообщениями| Пользователи должны использовать @mention для получения сообщений веб-пользователем. В настоящее время пользователи могут отправлять сообщения только исходяшему веб-hook в общедоступных каналах, но не в пределах личных или частных областей. |
|Стандартный обмен сообщениями HTTP|Ответы отображаются в той же цепочке, что и исходное сообщение запроса, и могут включать любое содержимое сообщения на базе бота, например, текст, изображения, карточки и эмодзи. Несмотря на то что исходяющие веб-hooks могут использовать карточки, они не могут использовать какие-либо действия с карточками, кроме `openURL` .|
| Поддержка методов API Teams|Исходяющий веб-браузер отправляет HTTP POST веб-службе и обрабатывает ответ обратно. Они не могут получить доступ к другим API, таким как извлечение списка или списка каналов в команде.|

## <a name="creating-actionable-messages"></a>Создание сообщений с действиями

Карточки соединители включают три видимых кнопки на карточке. Каждая кнопка определяется в `potentialAction` свойстве сообщения с помощью `ActionCard` действий. Каждый из них содержит тип ввода, текстовое поле, выбор даты или список с `ActionCard` несколькими вариантами выбора. Каждое `ActionCard` действие имеет связанное действие, `HttpPOST` например.

Карточки соединителей поддерживают действия трех типов:

| Действие | Описание |
| ------- | ----------- |
| `ActionCard` |Представляет один или несколько типов ввода и связанных действий.|
| `HttpPOST` | Отправляет запрос POST на URL-адрес. |
| `OpenUri` |  Открывает URI в отдельном браузере или приложении, при желании он ориентирован на различные URI на основе операционных систем.|

Действие `ActionCard` поддерживает три типа входных данных:

| Тип ввода | Описание |
| ------- | ----------- |
| `TextInput` | Однострочная или многострочная текстовая поля с необязательным ограничением длины. |
| `DateInput` | Выбор даты с необязательным селектором времени. |
| `MultichoiceInput` | Указанный список вариантов, предлагающий один или несколько вариантов выбора.|

`MultichoiceInput` поддерживает `style` свойство, которое управляет отображением полного списка. Значение по умолчанию `style` зависит от `isMultiSelect` значения.

| `isMultiSelect` value  | `style` значение по умолчанию  |
| --- | --- |
| `false` или не задано | Стиль по умолчанию: `compact`|
| `true` | Стиль по умолчанию: `expanded` |

> [!NOTE]
> * Введите и то, и другое, если вы хотите, чтобы список с несколькими выборами отображался `"isMultiSelect": true` `"style": true` в компактном стиле.
> * Выбор свойства в Teams такой же, как и выбор свойства `compact` `style` в Microsoft `normal` `style` Outlook.
> * Веб-пользователи поддерживают только карточки "Назад" и адаптивные карточки сообщений Office 365.

Все остальные сведения о действиях **[](/outlook/actionable-messages/card-reference#actions)** с карточками соединители см. в справке по карточкам сообщений с действиями.

## <a name="adding-outgoing-webhooks-to-your-app"></a>Добавление исходяющих веб-функций в приложение

**Сценарий:** push-уведомления об изменениях на сервере базы данных каналов Teams в ваше приложение.  
**Пример:** у вас есть бизнес-приложение, которое отслеживает все операции CRUD, сделанные с записями сотрудников пользователями отдела кадров канала Teams в области аренды Office 365.

### <a name="1-create-a-url-on-your-apps-server-to-accept-and-process-a-post-request-with-a-json-payload"></a>1. Создайте URL-адрес на сервере приложения, чтобы принять и обработать запрос POST с помощью полезной нагрузки JSON

Ваша служба получает сообщения в стандартной схеме сообщений службы ботов Azure. Соединитель платформы ботов — это служба RESTful, которая позволяет службе обрабатывать обмен сообщениями в формате JSON по протоколам HTTPS, как описано в API службы ботов [Azure.](/bot-framework/rest-api/bot-framework-rest-connector-api-reference) Кроме того, вы можете использовать [Microsoft Bot Framework SDK] для обработки и обработки сообщений. См. также [о службе ботов Azure.](/azure/bot-service/bot-service-overview-introduction)


Исходяющие веб-hooks имеют область действия на уровне и видны `team` всем участникам команды. Как и бот, пользователям **\@** необходимо упомянуть имя исходя из веб-пользователя, чтобы вызвать его в канале.

### <a name="2-create-a-method-to-verify-the-outgoing-webhook-hmac-token"></a>2. Создайте метод для проверки маркера HMAC исходярия веб-ook

#### <a name="hmac-signature-for-testing-with-code-example"></a>Подпись HMAC для тестирования с помощью примера кода

Пример входящие сообщения и ид: "contoso" из SigningKeyDictionary {"contoso", "vqF0En+Z0ucuRTM/01o2GuhMH3hKKk/N2bOmlM31zaA=" }.

Используйте значение HMAC 03TCao0i55H1eVKUusZOTZRjtvYTs+mO41mPL+R1e1U=" в авторизации загона запроса.

Чтобы убедиться, что служба получает звонки только от реальных клиентов Teams, Teams предоставляет код HMAC в `hmac` http-заговорке. Код всегда включается в протокол проверки подлинности.

Код всегда должен проверять подпись HMAC, включенную в запрос:

* Создание маркера HMAC из тела запроса сообщения. На большинстве платформ это можно сделать в стандартных библиотеках (см. "Crypto [for](https://nodejs.org/api/crypto.html#crypto_crypto) Node.js or see [Teams Webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C"). \# Microsoft Teams использует стандартное шифрование HMAC SHA256. В UTF8 необходимо преобразовать тело в массив byte.
* Вычислите hash из массива byte маркера безопасности, предоставленного **Teams** при регистрации исходяшего веб-hook в клиенте Teams]. См. [статью "Создание исходяного веб-хостинга".](#create-an-outgoing-webhook)
* Преобразуем hash в строку с помощью кодификации UTF-8.
* Сравните строку значения сгенерированного hash со значением, предоставленным в HTTP-запросе.

### <a name="3-create-a-method-to-send-a-success-or-failure-response"></a>3. Создайте метод для отправки ответа об успешном или неудаче

Ответы от исходяющих веб-пользователей отображаются в той же цепочке ответов, что и исходное сообщение. Когда пользователь выполняет запрос, Microsoft Teams выполняет синхронный HTTP-запрос для вашей службы, и ваш код получает пять секунд на ответ на сообщение до того, как соединение будет прервано.

### <a name="example-response"></a>Пример отклика

```json
{
    "type": "message",
    "text": "This is a reply!"
}
```

## <a name="create-an-outgoing-webhook"></a>Создание исходящего веб-перехватчика

1. Выберите соответствующую команду и выберите команду **"Управление"** в &#8226;&#8226;&#8226; меню (&#8226;&#8226;&#8226;).
1. Выберите **вкладку "Приложения"** на панели навигации.
1. В правом нижнем углу окна выберите **"Создать исходяющий веб-hook".**
1. В итоговом всплывающее окно заполняют необходимые поля:

>* **Имя** — заголовок веб-@mention коснитесь.
>* **URL-адрес для повторного** вызова — конечная точка HTTPS, которая принимает полезное сообщение JSON и получает запросы POST от Teams.
>* **Описание** — подробная строка, которая появляется в карточке профиля и панели мониторинга приложения на уровне группы.
>* **Изображение профиля —** необязательный значок приложения для веб-пользователя.
>* Выберите **кнопку "Создать"** в правом нижнем углу всплывающее окно, и исходяющий веб-hook будет добавлен в каналы текущей команды.
>* В следующем диалоговом окне отображается маркер безопасности на основе хэш-кода проверки подлинности [сообщений (HMAC),](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) который используется для проверки подлинности вызовов между Teams и назначенной внешней службой.
>* Исходяющий веб-пользователь доступен пользователям команды, только если URL-адрес действителен, а маркеры проверки подлинности сервера и клиента равны, например, для HMAC.

## <a name="code-samples"></a>Примеры кода

На GitHub можно просмотреть примеры кода исходяющих веб-пользователей:

### <a name="nodejs"></a>Node.js

[OfficeDev/msteams-samples-outgoing-webhook-nodejs](https://github.com/OfficeDev/msteams-samples-outgoing-webhook-nodejs)

### <a name="c"></a>C\#

[OfficeDev/microsoft-teams-sample-outgoing-webhook](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook)
