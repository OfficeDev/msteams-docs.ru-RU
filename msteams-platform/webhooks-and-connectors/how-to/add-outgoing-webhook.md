---
title: Добавление настраиваемых боты в Microsoft Teams с исходящими веб-перехватчиками
author: laujan
description: Добавление исходящего веб-перехватчика
keywords: исходящий веб-перехватчик для вкладок Teams *
ms.topic: conceptual
ms.author: lajanuar
ms.openlocfilehash: 04fc86fc3df7601235cb7f6bb7e53da59777f49f
ms.sourcegitcommit: e8dfcb167274e996395b77d65999991a18f2051a
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/15/2020
ms.locfileid: "47819062"
---
# <a name="add-custom-bots-to-microsoft-teams-with-outgoing-webhooks"></a>Добавление настраиваемых боты в Microsoft Teams с исходящими веб-перехватчиками

## <a name="what-are-outgoing-webhooks-in-teams"></a>Что такое исходящие веб-перехватчики в Teams?

Веб-перехватчики — это отличный способ интеграции Teams с внешними приложениями. Веб-перехватчик по сути является запросом POST, отправленным на URL-адрес обратного вызова. Исходящие веб-перехватчики в Teams обеспечивают простой способ, позволяющий пользователям отправлять сообщения в веб-службу, не пробегая полного процесса создания боты с помощью [Microsoft Bot Framework](https://dev.botframework.com/). Исходящие веб-перехватчики помещать данные из Teams в любую выбранную службу, способную принимать полезные данные JSON. После добавления исходящего веб-перехватчика в команду он действует как Bot, прослушивает каналы для сообщений с помощью ** \@ упоминаний**, отправляет уведомления внешним веб-службам и отвечает на сообщения с богатыми сообщениями, которые могут включать карты и изображения.

## <a name="outgoing-webhook-key-features"></a>Функции исходящих ключей веб-перехватчиков

| Возможность | Описание |
| ------- | ----------- |
| Конфигурация с заданной областью| Область действия веб-перехватчиков на уровне группы. Для каждой команды, к которой вы хотите добавить исходящий веб-перехватчик, необходимо пройти процедуру установки. |
| Реактивный обмен сообщениями| Для приема сообщений для веб-перехватчиков пользователям необходимо использовать @mention. В настоящее время пользователи могут только сообщения исходящих веб-перехватчиков в общедоступных каналах, а не в личной или личной области. |
|Стандартный обмен сообщениями HTTP|Ответы будут отображаться в той же цепочке, что и исходное сообщение с запросом, и могут содержать любой контент сообщения ленты (форматированный текст, изображения, карточки и эмодзи). **Note**: Несмотря на то, что исходящие веб-перехватчики могут использовать карты, они не могут использовать действия с карточками, кроме `openURL` .|
| Поддержка методов API Teams|В Teams исходящие веб-перехватчики отправляют сообщение HTTP в веб-службу и обрабатывают ответ обратно. Они не могут получать доступ к другим API, например получать список или список каналов в команде.|

## <a name="adding-outgoing-webhook-processing-to-your-app"></a>Добавление обработки исходящих веб-перехватчиков в приложение

**Сценарий**: отправка уведомлений о состоянии изменений на сервер базы данных канала Teams в приложение.  
**Пример**: у вас есть бизнес-приложение, отслеживающее все операции CRUD, внесенные в записи о сотрудниках, пользователями канала Teams в рамках клиента Office 365.

### <a name="1-create-a-url-on-your-apps-server-to-accept-and-process-a-post-request-with-a-json-payload"></a>1. Создайте URL-адрес на сервере приложения, чтобы принимать и обрабатывать запрос POST с помощью полезных данных JSON.

Ваша служба будет получать сообщения в стандартную схему обмена сообщениями службы Bot в Azure. Соединитель Bot Framework — это служба RESTFUL, которая позволяет службе обрабатывать обмен сообщениями в формате JSON через протоколы HTTPS, как описано в API- [интерфейсе службы Azure Bot](/bot-framework/rest-api/bot-framework-rest-connector-api-reference). Кроме того, вы можете использовать [Microsoft Bot Framework SDK] для обработки и анализа сообщений. *Дополнительные*  [сведения о службе Azure Bot](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).

Исходящие веб-перехватчики ограничены `team` уровнем и видимы всем участникам команды. Как и в Bot, пользователям необходимо ** \@ упомянуть** имя исходящего веб-перехватчика, чтобы вызвать его в канале.

### <a name="2-create-a-method-to-verify-the-outgoing-webhook-hmac-token"></a>2. Создайте метод для проверки маркера HMAC исходящего веб-перехватчика.

Чтобы гарантировать, что служба получает вызовы только от фактических клиентов Teams, Teams предоставляет код HMAC в `hmac` заголовке HTTP, который всегда должен включаться в протокол проверки подлинности.

Код должен всегда проверять подпись HMAC, включенную в запрос:

* *Создание* маркера HMAC из текста запроса сообщения. Для выполнения этой задачи на большинстве платформ используются стандартные библиотеки (*Дополнительные* сведения: [криптография](https://nodejs.org/api/crypto.html#crypto_crypto) для  *Node.js и* [Пример веб-перехватчика Teams](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) для C \# ). Microsoft Teams использует стандартную криптографию HMAC. Необходимо преобразовать текст в массив байтов в кодировке UTF8.
* *Вычислить* хэш из байтового массива маркера безопасности **, предоставляемого Teams,** при регистрации исходящего веб-перехватчика в клиенте Teams]. Ниже *приведено* [Создание исходящего веб-перехватчика](#create-an-outgoing-webhook).
* *Преобразуйте* хэш в строку, используя кодировку UTF-8.
* *Сравните* строковое значение созданного хэша со значением, указанным в HTTP-запросе.

### <a name="3-create-a-method-to-send-a-success-or-failure-response"></a>3. Создание метода для отправки ответа об успехе или неудаче

Ответы из исходящего веб-перехватчика будут отображаться в той же цепочке ответов, что и исходное сообщение. Когда пользователь выполняет запрос, Microsoft Teams отправляет службе синхронный HTTP-запрос, и код будет иметь 5 секунд на ответ на сообщение до истечения времени ожидания подключения и завершения.

### <a name="example-response"></a>Пример отклика

```json
{
    "type": "message",
    "text": "This is a reply!"
}
```

## <a name="create-an-outgoing-webhook"></a>Создание исходящего веб-перехватчика

1. Выберите нужную команду и выберите пункт **Управление группой** в раскрывающемся меню (&#8226;&#8226;&#8226;).
1. Перейдите на вкладку **приложения** на панели навигации.
1. В правом нижнем углу окна выберите **создать исходящий веб-перехватчик**.
1. В появившемся всплывающем окне заполните обязательные поля:

>* **Name** — заголовок веб-перехватчика и @mention касание.
>* **URL-адрес обратного вызова** — конечная точка HTTPS, принимающая полезные данные JSON и принимающая запросы POST от Teams.
>* **Description** — подробная строка, которая будет отображаться в карточке профиля и на панели мониторинга приложения уровня группы.
>* **Изображение профиля** (необязательно) значок приложения для веб-перехватчика.
>* Нажмите кнопку **создать** в правом нижнем углу всплывающего окна, и исходящий веб-перехватчик будет добавлен в каналы текущей группы.
>* В следующем диалоговом окне отображается маркер безопасности [кода HMAC](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) , который будет использоваться для проверки подлинности вызовов между Teams и назначенной внешней службой.
>* Если URL-адрес является допустимым, а маркеры проверки подлинности сервера и клиента равны (то есть подтверждение HMAC), исходящий веб-перехватчик будет доступен пользователям группы.

## <a name="code-samples"></a>Примеры кода

Вы можете просматривать примеры кода исходящих веб-перехватчиков на сайте GitHub:

### <a name="nodejs"></a>Node.js

[OfficeDev/мстеамс-Samples-исходящий-веб-перехватчик — NodeJS](https://github.com/OfficeDev/msteams-samples-outgoing-webhook-nodejs)

### <a name="c"></a>Диска\#

[OfficeDev/Microsoft-Teams-Sample-исходящий-веб-перехватчик](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook)
