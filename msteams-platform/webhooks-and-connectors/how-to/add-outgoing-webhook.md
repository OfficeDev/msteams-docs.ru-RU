---
title: Добавление настраиваемых боты в Microsoft Teams с исходящими веб-перехватчиками
author: laujan
description: ''
keywords: исходящий веб-перехватчик для вкладок Teams *
ms.topic: conceptual
ms.author: laujan
ms.openlocfilehash: 4881dc8768c7c51947f6a80a55affe78c28874d3
ms.sourcegitcommit: 3ba5a5a7d9d9d906abc3ee1df9c2177de0cfd767
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2020
ms.locfileid: "45103000"
---
# <a name="add-custom-bots-to-microsoft-teams-with-outgoing-webhooks"></a><span data-ttu-id="3f0d0-103">Добавление настраиваемых боты в Microsoft Teams с исходящими веб-перехватчиками</span><span class="sxs-lookup"><span data-stu-id="3f0d0-103">Add custom bots to Microsoft Teams with outgoing webhooks</span></span>

## <a name="what-are-outgoing-webhooks-in-teams"></a><span data-ttu-id="3f0d0-104">Что такое исходящие веб-перехватчики в Teams?</span><span class="sxs-lookup"><span data-stu-id="3f0d0-104">What are outgoing webhooks in Teams?</span></span>

<span data-ttu-id="3f0d0-105">Веб-перехватчики — это отличный способ интеграции Teams с внешними приложениями.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-105">Webhooks are a great way for Teams to integrate with external apps.</span></span> <span data-ttu-id="3f0d0-106">Веб-перехватчик по сути является запросом POST, отправленным на URL-адрес обратного вызова.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-106">A webhook is essentially a POST request sent to a callback URL.</span></span> <span data-ttu-id="3f0d0-107">Исходящие веб-перехватчики в Teams обеспечивают простой способ, позволяющий пользователям отправлять сообщения в веб-службу, не пробегая полного процесса создания боты с помощью [Microsoft Bot Framework](https://dev.botframework.com/).</span><span class="sxs-lookup"><span data-stu-id="3f0d0-107">In Teams, outgoing webhooks provide a simple way to allow users to send messages to your web service without having to go through the full process of creating bots via the [Microsoft Bot Framework](https://dev.botframework.com/).</span></span> <span data-ttu-id="3f0d0-108">Исходящие веб-перехватчики помещать данные из Teams в любую выбранную службу, способную принимать полезные данные JSON.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-108">Outgoing webhooks post data from Teams to any chosen service capable of accepting a JSON payload.</span></span> <span data-ttu-id="3f0d0-109">После добавления исходящего веб-перехватчика в команду он действует как Bot, прослушивает каналы для сообщений с помощью \*\* \@ упоминаний\*\*, отправляет уведомления внешним веб-службам и отвечает на сообщения с богатыми сообщениями, которые могут включать карты и изображения.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-109">Once an outgoing webhook is added to a team, it acts like bot, listening in channels for messages using **\@mention**, sending notifications to external web services, and responding with rich messages that can include cards and images.</span></span>

## <a name="outgoing-webhook-key-features"></a><span data-ttu-id="3f0d0-110">Функции исходящих ключей веб-перехватчиков</span><span class="sxs-lookup"><span data-stu-id="3f0d0-110">Outgoing webhook key features</span></span>

| <span data-ttu-id="3f0d0-111">Возможность</span><span class="sxs-lookup"><span data-stu-id="3f0d0-111">Feature</span></span> | <span data-ttu-id="3f0d0-112">Описание</span><span class="sxs-lookup"><span data-stu-id="3f0d0-112">Description</span></span> |
| ------- | ----------- |
| <span data-ttu-id="3f0d0-113">Конфигурация с заданной областью</span><span class="sxs-lookup"><span data-stu-id="3f0d0-113">Scoped Configuration</span></span>| <span data-ttu-id="3f0d0-114">Область действия веб-перехватчиков на уровне группы.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-114">Webhooks are scoped at the team level.</span></span> <span data-ttu-id="3f0d0-115">Для каждой команды, к которой вы хотите добавить исходящий веб-перехватчик, необходимо пройти процедуру установки.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-115">You’ll need to go through the setup process for each team you want to add your outgoing webhook to.</span></span> |
| <span data-ttu-id="3f0d0-116">Реактивный обмен сообщениями</span><span class="sxs-lookup"><span data-stu-id="3f0d0-116">Reactive Messaging</span></span>| <span data-ttu-id="3f0d0-117">Для приема сообщений для веб-перехватчиков пользователям необходимо использовать @mention.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-117">Users must use @mention for the webhook to receive messages.</span></span> <span data-ttu-id="3f0d0-118">В настоящее время пользователи могут только сообщения исходящих веб-перехватчиков в общедоступных каналах, а не в личной или личной области.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-118">Currently users can only message an outgoing webhook in public channels and not within the personal or private scope</span></span> |
|<span data-ttu-id="3f0d0-119">Стандартный обмен сообщениями HTTP</span><span class="sxs-lookup"><span data-stu-id="3f0d0-119">Standard HTTP message exchange</span></span>|<span data-ttu-id="3f0d0-120">Ответы будут отображаться в той же цепочке, что и исходное сообщение с запросом, и могут содержать любой контент сообщения ленты (форматированный текст, изображения, карточки и эмодзи).</span><span class="sxs-lookup"><span data-stu-id="3f0d0-120">Responses will appear in the same chain as the original request message and can include any Bot Framework message content (rich text, images, cards, and emojis).</span></span> <span data-ttu-id="3f0d0-121">**Note**: Несмотря на то, что исходящие веб-перехватчики могут использовать карты, они не могут использовать действия с карточками, кроме `openURL` .</span><span class="sxs-lookup"><span data-stu-id="3f0d0-121">**Note**: Although outgoing webhooks can use cards, they cannot use any card actions except for `openURL`.</span></span>|
| <span data-ttu-id="3f0d0-122">Поддержка методов API Teams</span><span class="sxs-lookup"><span data-stu-id="3f0d0-122">Teams API method support</span></span>|<span data-ttu-id="3f0d0-123">В Teams исходящие веб-перехватчики отправляют сообщение HTTP в веб-службу и обрабатывают ответ обратно.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-123">In Teams, outgoing webhooks send an HTTP POST to a web service and process a response back.</span></span> <span data-ttu-id="3f0d0-124">Они не могут получать доступ к другим API, например получать список или список каналов в команде.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-124">They cannot access any other APIs like retrieve the roster or list of channels in a team.</span></span>|

## <a name="adding-outgoing-webhook-processing-to-your-app"></a><span data-ttu-id="3f0d0-125">Добавление обработки исходящих веб-перехватчиков в приложение</span><span class="sxs-lookup"><span data-stu-id="3f0d0-125">Adding outgoing webhook processing to your app</span></span>

<span data-ttu-id="3f0d0-126">**Сценарий**: отправка уведомлений о состоянии изменений на сервер базы данных канала Teams в приложение.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-126">**Scenario**: Push change status notifications on a Teams channel database server to your app.</span></span>  
<span data-ttu-id="3f0d0-127">**Пример**: у вас есть бизнес-приложение, отслеживающее все операции CRUD, внесенные в записи о сотрудниках, пользователями канала Teams в рамках клиента Office 365.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-127">**Example**: You have a line-of-business app that tracks all CRUD operations made to employee records by Teams channel HR users across an Office 365 tenancy.</span></span>

### <a name="1-create-a-url-on-your-apps-server-to-accept-and-process-a-post-request-with-a-json-payload"></a><span data-ttu-id="3f0d0-128">1. Создайте URL-адрес на сервере приложения, чтобы принимать и обрабатывать запрос POST с помощью полезных данных JSON.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-128">1. Create a URL on your app's server to accept and process a POST request with a JSON payload</span></span>

<span data-ttu-id="3f0d0-129">Ваша служба будет получать сообщения в стандартную схему обмена сообщениями службы Bot в Azure.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-129">Your service will receive messages in the standard Azure bot service messaging schema.</span></span> <span data-ttu-id="3f0d0-130">Соединитель Bot Framework — это служба RESTFUL, которая позволяет службе обрабатывать обмен сообщениями в формате JSON через протоколы HTTPS, как описано в API- [интерфейсе службы Azure Bot](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span><span class="sxs-lookup"><span data-stu-id="3f0d0-130">The Bot Framework connector is a RESTful service that enables your service to process the interchange of JSON formatted messages via HTTPS protocols as documented in the [Azure Bot Service API](/bot-framework/rest-api/bot-framework-rest-connector-api-reference).</span></span> <span data-ttu-id="3f0d0-131">Кроме того, вы можете использовать [Microsoft Bot Framework SDK] для обработки и анализа сообщений.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-131">Alternatively, you can follow the [Microsoft Bot Framework SDK] to process and parse messages.</span></span> <span data-ttu-id="3f0d0-132">*Дополнительные*  [сведения о службе Azure Bot](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span><span class="sxs-lookup"><span data-stu-id="3f0d0-132">*See also*  [About Azure Bot Service](/azure/bot-service/bot-service-overview-introduction?view=azure-bot-service-4.0).</span></span>

<span data-ttu-id="3f0d0-133">Исходящие веб-перехватчики ограничены `team` уровнем и видимы всем участникам команды.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-133">Outgoing webhooks are scoped to the `team` level and are visible to all members of the team.</span></span> <span data-ttu-id="3f0d0-134">Как и в Bot, пользователям необходимо \*\* \@ упомянуть\*\* имя исходящего веб-перехватчика, чтобы вызвать его в канале.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-134">Just like a bot, users are required to **\@mention** the name of the outgoing webhook to invoke it in the channel.</span></span>

### <a name="2-create-a-method-to-verify-the-outgoing-webhook-hmac-token"></a><span data-ttu-id="3f0d0-135">2. Создайте метод для проверки маркера HMAC исходящего веб-перехватчика.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-135">2. Create a method to verify the outgoing webhook HMAC token</span></span>

<span data-ttu-id="3f0d0-136">Чтобы гарантировать, что служба получает вызовы только от фактических клиентов Teams, Teams предоставляет код HMAC в `hmac` заголовке HTTP, который всегда должен включаться в протокол проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-136">To ensure that your service is receiving calls only from actual Teams clients, Teams provides an HMAC Code in the HTTP `hmac` header that should always be  included in your authentication protocol.</span></span>

<span data-ttu-id="3f0d0-137">Код должен всегда проверять подпись HMAC, включенную в запрос:</span><span class="sxs-lookup"><span data-stu-id="3f0d0-137">Your code should always validate the HMAC signature included in the request:</span></span>

* <span data-ttu-id="3f0d0-138">*Создание* маркера HMAC из текста запроса сообщения.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-138">*Generate* the HMAC token from the request body of the message.</span></span> <span data-ttu-id="3f0d0-139">Для выполнения этой задачи на большинстве платформ используются стандартные библиотеки (*Дополнительные* сведения: [криптография](https://nodejs.org/api/crypto.html#crypto_crypto) для *Node.js и* [Пример веб-перехватчика Teams](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) для C \# ).</span><span class="sxs-lookup"><span data-stu-id="3f0d0-139">There are standard libraries to do this on most platforms (*see* [Crypto](https://nodejs.org/api/crypto.html#crypto_crypto) for Node.js or  *see* [Teams Webhook Sample](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook/blob/23eb61da5a18634d51c5247944843da9abed01b6/WebhookSampleBot/Models/AuthProvider.cs) for C\#).</span></span> <span data-ttu-id="3f0d0-140">Microsoft Teams использует стандартную криптографию HMAC.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-140">Microsoft Teams uses standard SHA256 HMAC cryptography .</span></span> <span data-ttu-id="3f0d0-141">Необходимо преобразовать текст в массив байтов в кодировке UTF8.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-141">You will need to convert the body to a byte array in UTF8.</span></span>
* <span data-ttu-id="3f0d0-142">*Вычислить* хэш из байтового массива маркера безопасности **, предоставляемого Teams,** при регистрации исходящего веб-перехватчика в клиенте Teams].</span><span class="sxs-lookup"><span data-stu-id="3f0d0-142">*Compute* the hash from the byte array of the security token **provided by Teams** when you registered the outgoing webhook in the Teams client].</span></span> <span data-ttu-id="3f0d0-143">Ниже *приведено* [Создание исходящего веб-перехватчика](#create-an-outgoing-webhook).</span><span class="sxs-lookup"><span data-stu-id="3f0d0-143">*See* [Create an outgoing webhook](#create-an-outgoing-webhook), below.</span></span>
* <span data-ttu-id="3f0d0-144">*Преобразуйте* хэш в строку, используя кодировку UTF-8.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-144">*Convert* the hash to a string using UTF-8 encoding.</span></span>
* <span data-ttu-id="3f0d0-145">*Сравните* строковое значение созданного хэша со значением, указанным в HTTP-запросе.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-145">*Compare* the string value of the generated hash with the value provided in the HTTP request.</span></span>

### <a name="3-create-a-method-to-send-a-success-or-failure-response"></a><span data-ttu-id="3f0d0-146">3. Создание метода для отправки ответа об успехе или неудаче</span><span class="sxs-lookup"><span data-stu-id="3f0d0-146">3. Create a method to send a success or failure response</span></span>

<span data-ttu-id="3f0d0-147">Ответы из исходящего веб-перехватчика будут отображаться в той же цепочке ответов, что и исходное сообщение.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-147">Responses from your outgoing webhook will appear in the same reply chain as the original message.</span></span> <span data-ttu-id="3f0d0-148">Когда пользователь выполняет запрос, Microsoft Teams отправляет службе синхронный HTTP-запрос, и код будет иметь 5 секунд на ответ на сообщение до истечения времени ожидания подключения и завершения.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-148">When the user performs a query, Microsoft Teams issues a synchronous HTTP request to your service and your code will have 5 seconds to respond to the message before the connection times out and terminates.</span></span>

### <a name="example-response"></a><span data-ttu-id="3f0d0-149">Пример отклика</span><span class="sxs-lookup"><span data-stu-id="3f0d0-149">Example response</span></span>

```json
{
    "type": "message",
    "text": "This is a reply!"
}
```

## <a name="create-an-outgoing-webhook"></a><span data-ttu-id="3f0d0-150">Создание исходящего веб-перехватчика</span><span class="sxs-lookup"><span data-stu-id="3f0d0-150">Create an outgoing webhook</span></span>

1. <span data-ttu-id="3f0d0-151">Выберите нужную команду и выберите пункт **Управление группой** в раскрывающемся меню (&#8226;&#8226;&#8226;).</span><span class="sxs-lookup"><span data-stu-id="3f0d0-151">Select the appropriate team and select **Manage team** from the (&#8226;&#8226;&#8226;) drop-down menu.</span></span>
1. <span data-ttu-id="3f0d0-152">Перейдите на вкладку **приложения** на панели навигации.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-152">Choose the **Apps** tab from the navigation bar.</span></span>
1. <span data-ttu-id="3f0d0-153">В правом нижнем углу окна выберите **создать исходящий веб-перехватчик**.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-153">From the window's lower right corner select **Create an outgoing webhook**.</span></span>
1. <span data-ttu-id="3f0d0-154">В появившемся всплывающем окне заполните обязательные поля:</span><span class="sxs-lookup"><span data-stu-id="3f0d0-154">In the resulting popup window complete the required fields:</span></span>

>* <span data-ttu-id="3f0d0-155">**Name** — заголовок веб-перехватчика и @mention касание.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-155">**Name** - The webhook title and @mention tap.</span></span>
>* <span data-ttu-id="3f0d0-156">**URL-адрес обратного вызова** — конечная точка HTTPS, принимающая полезные данные JSON и принимающая запросы POST от Teams.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-156">**Callback URL** - The HTTPS endpoint that accepts JSON payloads and will receive POST requests from Teams.</span></span>
>* <span data-ttu-id="3f0d0-157">**Description** — подробная строка, которая будет отображаться в карточке профиля и на панели мониторинга приложения уровня группы.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-157">**Description** - A detailed string that will appear in the profile card and the team-level App dashboard.</span></span>
>* <span data-ttu-id="3f0d0-158">**Изображение профиля** (необязательно) значок приложения для веб-перехватчика.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-158">**Profile Picture** (optional) an app icon for your webhook.</span></span>
>* <span data-ttu-id="3f0d0-159">Нажмите кнопку **создать** в правом нижнем углу всплывающего окна, и исходящий веб-перехватчик будет добавлен в каналы текущей группы.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-159">Select the **Create** button from lower right corner of the pop-up window and the outgoing webhook will be added to the current team's channels.</span></span>
>* <span data-ttu-id="3f0d0-160">В следующем диалоговом окне отображается маркер безопасности [кода HMAC](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) , который будет использоваться для проверки подлинности вызовов между Teams и назначенной внешней службой.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-160">The next dialog window will display an [Hash-based Message Authentication Code (HMAC)](https://security.stackexchange.com/questions/20129/how-and-when-do-i-use-hmac/20301) security token that will be used to authenticate calls between Teams and the designated outside service.</span></span>
>* <span data-ttu-id="3f0d0-161">Если URL-адрес является допустимым, а маркеры проверки подлинности сервера и клиента равны (то есть подтверждение HMAC), исходящий веб-перехватчик будет доступен пользователям группы.</span><span class="sxs-lookup"><span data-stu-id="3f0d0-161">If the URL is valid and the server and client authentication tokens are equal (i.e., an HMAC handshake), the outgoing webhook will be available to the team's users.</span></span>

## <a name="code-samples"></a><span data-ttu-id="3f0d0-162">Примеры кода</span><span class="sxs-lookup"><span data-stu-id="3f0d0-162">Code samples</span></span>

<span data-ttu-id="3f0d0-163">Вы можете просматривать примеры кода исходящих веб-перехватчиков на сайте GitHub:</span><span class="sxs-lookup"><span data-stu-id="3f0d0-163">You can view outgoing webhook code samples on GitHub:</span></span>

### <a name="nodejs"></a><span data-ttu-id="3f0d0-164">Node.js</span><span class="sxs-lookup"><span data-stu-id="3f0d0-164">Node.js</span></span>

[<span data-ttu-id="3f0d0-165">OfficeDev/мстеамс-Samples-исходящий-веб-перехватчик — NodeJS</span><span class="sxs-lookup"><span data-stu-id="3f0d0-165">OfficeDev/msteams-samples-outgoing-webhook-nodejs</span></span>](https://github.com/OfficeDev/msteams-samples-outgoing-webhook-nodejs)

### <a name="c"></a><span data-ttu-id="3f0d0-166">Диска\#</span><span class="sxs-lookup"><span data-stu-id="3f0d0-166">C\#</span></span>

[<span data-ttu-id="3f0d0-167">OfficeDev/Microsoft-Teams-Sample-исходящий-веб-перехватчик</span><span class="sxs-lookup"><span data-stu-id="3f0d0-167">OfficeDev/microsoft-teams-sample-outgoing-webhook</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-outgoing-webhook)
