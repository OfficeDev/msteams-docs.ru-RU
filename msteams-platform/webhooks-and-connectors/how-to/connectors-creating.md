---
title: Соединители Office 365
description: В этой статье описывается начало работы с соединителями Office 365 в Microsoft Teams
keywords: соединитель Teams O365
ms.date: 04/19/2019
ms.openlocfilehash: e26c264cc418d326e783ff0378089d2565ecbfef
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "41675158"
---
# <a name="creating-office-365-connectors-for-microsoft-teams"></a>Создание соединителей Office 365 для Microsoft Teams

>С помощью приложений Microsoft Teams вы можете добавить существующий соединитель Office 365 или создать новый, чтобы включить его в Microsoft Teams. Для получения дополнительных сведений ознакомьтесь со статьей [Создание собственного соединителя](/outlook/actionable-messages/connectors-dev-dashboard#build-your-own-connector) .

## <a name="adding-a-connector-to-your-teams-app"></a>Добавление соединителя в приложение Teams

Вы можете распространить зарегистрированный соединитель в рамках пакета приложений Teams. Независимо от того, как как отдельное решение, так и с одним из нескольких [возможностей](~/concepts/extensibility-points.md) , которые вы можете использовать в Teams, вы можете [упаковать](~/concepts/build-and-test/apps-package.md) и [опубликовать](~/concepts/deploy-and-publish/apps-publish.md) соединитель как часть отправки AppSource, или вы можете предоставить его пользователям непосредственно для отправки в Teams.

Чтобы распространить соединитель, необходимо зарегистрировать его с помощью [панели мониторинга разработчика соединителей](https://outlook.office.com/connectors/home/login/#/publish). По умолчанию после регистрации соединителя предполагается, что соединитель будет работать во всех продуктах Office 365, поддерживающих их, в том числе Outlook и Teams. Если это _не_ так, и вам нужно создать соединитель, который работает только в Microsoft Teams, свяжитесь с нами непосредственно в разделе [поддержка отправки в магазине Teams](mailto:TeamsSubSupport@microsoft.com).

> [!IMPORTANT]
> После выбора команды **сохранить** в панели мониторинга разработчика соединители ваш соединитель будет зарегистрирован. Если вы хотите опубликовать соединитель в AppSource, следуйте инструкциям в статье [Публикация приложения Microsoft Teams в AppSource](~/concepts/deploy-and-publish/apps-publish.md). Если вы не хотите публиковать свое приложение в AppSource, а просто распространять его непосредственно в вашей организации, вы можете сделать это, [опубликовав в вашей](#publish-connectors-for-your-organization)Организации. Если вы хотите опубликовать только в вашей организации, никаких дополнительных действий на панели мониторинга соединителя не требуется.

### <a name="integrating-the-configuration-experience"></a>Интеграция интерфейса настройки

Ваши пользователи будут выполнять весь процесс настройки соединителя без необходимости выхода из клиента Teams. Для достижения такой возможности Teams внедряет страницу конфигурации непосредственно в IFRAME. Последовательность операций выглядит следующим образом:

1. Пользователь щелкает соединитель, чтобы начать процесс настройки.
2. Teams загрузит свой интерфейс настройки в линию.
3. Пользователь взаимодействует с веб-интерфейсом, чтобы завершить настройку.
4. Пользователь нажимает "Save", который активирует обратный вызов в коде.
5. Код будет обрабатывать событие Save, извлекая параметры веб-перехватчиков (описанные ниже). Затем код должен сохранить веб-перехватчик для последующей публикации событий.

Вы можете использовать существующий интерфейс веб-конфигурации или создать отдельную версию, которая будет размещена в Teams. Код должен выполнять следующие действия:

1. Включите пакет SDK для JavaScript для Microsoft Teams. Это предоставляет коду доступ к API для выполнения распространенных операций, таких как извлечение текущего пользователя/канала/контекста команды и инициализация потоков проверки подлинности. Инициализируйте пакет SDK, `microsoftTeams.initialize()`вызвав метод.
2. Вызов `microsoftTeams.settings.setValidityState(true)` , когда требуется включить кнопку Сохранить. Это следует делать в ответ на допустимые входные данные пользователя, такие как выбор или обновление поля.
3. Зарегистрируйте `microsoftTeams.settings.registerOnSaveHandler()` обработчик событий, который вызывается, когда пользователь нажимает кнопку Save (сохранить).
4. Вызов `microsoftTeams.settings.setSettings()` для сохранения параметров соединителя. Сохраненные здесь также отображаются в диалоговом окне настройки, если пользователь пытается обновить существующую конфигурацию для соединителя.
5. Вызов `microsoftTeams.settings.getSettings()` для извлечения свойств веб-перехватчика, включая сам URL-адрес. Этот метод следует вызывать в дополнение к событиям Save, поэтому его также следует вызывать при первой загрузке страницы в случае повторной настройки.
6. Необязательно Зарегистрируйте `microsoftTeams.settings.registerOnRemoveHandler()` обработчик событий, который вызывается, когда пользователь удаляет соединитель. Это событие дает службе возможность выполнять какие – либо действия по очистке.

#### <a name="getsettings-response-properties"></a>`GetSettings()`свойства ответа

>[!Note]
>Параметры, возвращаемые при `getSettings` вызове, отличаются от тех, которые были вызваны из вкладки и отличаются от описанных [здесь](/javascript/api/%40microsoft/teams-js/settings.settings?view=msteams-client-js-latest).

| Параметр   | Сведения |
|-------------|---------|
| `entityId`       | Идентификатор сущности, заданный кодом при вызове `setSettings()`. |
| `configName`  | Имя конфигурации, заданное кодом при вызове `setSettings()`. |
| `contentUrl` | URL-адрес страницы конфигурации, заданный кодом при вызове`setSettings()` |
| `webhookUrl` | URL-адрес веб-перехватчика, созданный для этого соединителя. Сохраним URL-адрес веб-перехватчика и используйте его для отправки в канал структурированного JSON для отправки карточек. Параметр `webhookUrl` возвращается только в том случае, если приложение возвращается успешно. |
| `appType` | Возвращаемыми значениями могут быть `mail`, `groups` или `teams` (для почты Office 365, функции "Группы Office 365" и Microsoft Teams соответственно). |
| `userObjectId` | Это уникальный идентификатор, соответствующий пользователю Office 365, который инициировал установку соединителя. Этот параметр должен быть защищен. Это значение используется для сопоставления пользователя в Office 365, который настраивает конфигурацию, и пользователя в вашей службе. |

Если вам нужно проверить подлинность пользователя при загрузке страницы на шаге 2, обратитесь к [этой ссылке](~/tabs/how-to/authentication/auth-flow-tab.md) , чтобы узнать, как интегрировать имя входа при внедрении страницы.

> [!NOTE]
> Из-за соображений совместимости между клиентами код должен вызываться `microsoftTeams.authentication.registerAuthenticationHandlers()` с использованием URL-адреса и методов обратного вызова для успешного и `authenticate()`неудачи перед вызовом.

#### <a name="handling-edits"></a>Обработка изменений

Код должен обрабатывать пользователей, возвращающих изменения существующей конфигурации соединителя. Для этого выполните вызов `microsoftTeams.settings.setSettings()` во время начальной настройки со следующими параметрами:

- `entityId`— Это настраиваемый идентификатор, который понимается службой и представляет то, что настроено пользователем.
- `configName`— Это понятное имя, которое может получить ваш код конфигурации.
- `contentUrl`— Это настраиваемый URL-адрес, который загружается, когда пользователь редактирует существующую конфигурацию соединителя. Вы можете использовать этот URL-адрес, чтобы упростить код для обработки сценария изменения.

Как правило, этот вызов выполняется в рамках обработчика событий Save. Затем при загрузке `contentUrl` указанного выше кода должен вызываться `getSettings()` предварительное заполнение любых параметров или форм в пользовательском интерфейсе конфигурации.

#### <a name="handling-removals"></a>Обработка удалений

При необходимости можно выполнить обработчик события, когда пользователь удаляет существующую конфигурацию соединителя. Этот обработчик регистрируется с помощью `microsoftTeams.settings.registerOnRemoveHandler()`вызова. Этот обработчик можно использовать для выполнения таких операций очистки, как удаление записей из базы данных.

### <a name="including-the-connector-in-your-manifest"></a>Включение соединителя в манифест

Вы можете скачать автоматически созданный манифест приложения Teams с портала. Тем не менее, прежде чем использовать его для тестирования или публикации приложения, необходимо выполнить следующие действия:

- Включите два значка, следуя инструкциям в разделе [значки](~/concepts/build-and-test/apps-package.md#icons).
- Измените `icons` часть манифеста, чтобы она ссылалась на имена файлов значков, а не URL-адресов.

Следующий файл manifest. JSON содержит основные элементы, необходимые для тестирования и передачи приложения.

> [!NOTE]
> Замените `id` и `connectorId` в приведенном ниже примере GUID соединителя.

#### <a name="example-manifestjson-with-connector"></a>Пример манифеста. JSON с соединителем

```json
{
  "$schema": "https://developer.microsoft.com/json-schemas/teams/v1.5/MicrosoftTeams.schema.json",
  "manifestVersion": "1.5",
  "id": "e9343a03-0a5e-4c1f-95a8-263a565505a5",
  "version": "1.0",
  "packageName": "com.sampleapp",
  "developer": {
    "name": "Publisher",
    "websiteUrl": "https://www.microsoft.com",
    "privacyUrl": "https://www.microsoft.com",
    "termsOfUseUrl": "https://www.microsoft.com"
  },
  "description": {
    "full": "This is a sample manifest for an app with a connector with an inline configuration experience.",
    "short": "This is a sample manifest for an app with a connector."
  },
  "icons": {
    "outline": "sampleapp-outline.png",
    "color": "sampleapp-color.png"
  },
  "connectors": [
    {
      "connectorId": "e9343a03-0a5e-4c1f-95a8-263a565505a5",
      "configurationUrl": "https://teamstodoappconnectorwithinlineconfig.azurewebsites.net/Connector/Setup",
      "scopes": [
        "team"
      ]
    }
  ],
  "name": {
    "short": "Sample App",
    "full": "Sample App Long Name"
  },
  "accentColor": "#FFFFFF"
}
```

## <a name="testing-your-connector"></a>Тестирование соединителя

Чтобы протестировать соединитель, отправьте его в команду так же, как и для любого другого приложения. ZIP-пакет можно создать с помощью файла манифеста на панели мониторинга разработчика соединителей (с изменением, как указано в предыдущем разделе) и двумя файлами значков.

После отправки приложения откройте список соединителей из любого канала. Прокрутите страницу вниз, чтобы просмотреть приложение в **отправленном** разделе.

![Снимок экрана: диалоговое окно "Отправить раздел" в соединителе](~/assets/images/connectors/connector_dialog_uploaded.png)

Теперь вы можете запустить интерфейс настройки. Помните, что этот процесс выполняется полностью в Microsoft Teams в качестве размещаемого интерфейса.

Чтобы проверить, правильно `HttpPOST` ли работает действие, [отправьте сообщения в соединитель](~/webhooks-and-connectors/how-to/connectors-using.md).

## <a name="publish-connectors-for-your-organization"></a>Публикация соединителей для Организации

Иногда вы не хотите публиковать приложение Connector в общедоступном AppSource/хранилище, но оно должно быть доступно только пользователям в Организации. В таких случаях вы можете отправить приложение настраиваемого соединителя в [Каталог приложений организации](~/concepts/deploy-and-publish/apps-publish.md). Таким образом, ваше приложение Connector будет доступно только для этой Организации, и вам не нужно будет публиковать соединитель в общедоступном хранилище.

После отправки пакета приложений для настройки и использования соединителя в группе его можно установить из каталога приложений организации, выполнив следующие действия:

1. Выберите значок приложения на дальней левой вертикальной панели навигации.
1. В окне **приложения** выберите **соединители**.
1. Выберите соединитель, который вы хотите добавить, и отобразится всплывающее диалоговое окно.
1. Выберите команду **Добавить в строку группы** .
1. В следующем диалоговом окне введите имя группы или канала.
1. Выберите элемент **Настройка соединительной** панели в правом нижнем углу диалогового окна.
1. Соединитель будет доступен в разделе &#9679;&#9679;&#9679; => *More Options* => *Connector* => ** => Connectors*for Teams* for Teams. Вы можете перейти к этому разделу или найти приложение Connector.
1. Чтобы настроить или изменить соединитель, выберите панель **настройки** .
