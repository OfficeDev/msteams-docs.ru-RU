### YamlMime:Tutorial
title: Развернутые ссылки в Teams с помощью бота
metadata:
  title: Развернутые ссылки в Teams с помощью бота
  description: В этом руководстве вы узнаете, как настроить Teams ссылку разгрузки бота.
  audience: Developer
  level: Beginner
  ms.date: 01/20/2022
  ms.topic: interactive-tutorial
  nextTutorialHref: messaging-extensions/how-to/link-unfurling.md
  nextTutorialTitle: Подробнее о разгрузки ссылок
  ms.custom: mvc
  ms.localizationpriority: high
  ms.openlocfilehash: e425b62ff9df1bf12f7635254a11a91fe3590ffe
  ms.sourcegitcommit: 65cea59cc0602269395a2f87e023a4057d9cc55e
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 03/23/2022
  ms.locfileid: "63766901"
items:
- durationInMinutes: 1
  content: "Microsoft Bot Framework расширяет спецификацию карт, добавляя набор предопределяющих карт, которые боты могут использовать в качестве части бот-сообщений. Разгрузка ссылки с помощью бота в Teams позволяет зарегистрировать приложение и получить действие вызова при вклеив URL-адрес с определенным доменом в область составить сообщение. Вызов содержит полный URL-адрес, и вы можете ответить на него карточкой. Пользователь может развязать ссылку с помощью бота с дополнительной информацией, чтобы получить расширенный интерфейс.\n\n > [!NOTE]\n > В настоящее время разгрузка ссылок не поддерживается для мобильных клиентов.\n\n **Ключевые функции разгрузки ссылок** \n\n * Позволяет пользователю вклеить URL-адреса и отвечать карточкой.\n * Позволяет пользователю зарегистрировать приложение и получить действие вызова.\n\nЭто пошаговая руководство по созданию бота для выполнения разгрузки ссылок в Microsoft Teams для `https://www.BotFramework.com`. Вы увидите следующий вывод:\n\n:::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/final-image.png\" alt-text=\"Развертывание ссылки\" border=\"true\":::\n"
- title: Предварительные требования
  durationInMinutes: 1
  content: "Убедитесь, что вы установите следующие средства и настроите среду разработки: \n\n* [Microsoft Teams с](https://teams.microsoft.com/) допустимой учетной записью\n* [.NET Core SDK](https://dotnet.microsoft.com/download) версии 3.1\n* [Последняя версия Visual Studio](https://visualstudio.microsoft.com/downloads/)\n* [Последняя версия ngrok или](https://ngrok.com/download) любое эквивалентное решение для туннелей\n\n  > [!NOTE]\n  > После скачивания ngrok зарегистриройте и установите [authtoken](https://ngrok.com/download).\n"
- title: Настройка локальной среды
  durationInMinutes: 1
  content: "\n1. Откройте [примеры BotBuilder](https://github.com/microsoft/BotBuilder-Samples).\n1. Выберите **код**.\n1. В меню dropdown выберите **Open с GitHub Desktop**.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/clonerepository-new.png\" alt-text=\"Репозиторий клонов\" border=\"true\":::\n\n1. Выберите **клон**. \n"
- title: Создание и регистрация бота на портале Azure
  durationInMinutes: 5
  content: "Следующие действия помогают создать и зарегистрировать бота на портале Azure:\n\n* Создайте ресурс Azure Bot для регистрации бота в службе Azure Bot.\n* Создание секрета клиента, чтобы включить проверку подлинности SSO бота.\n* Добавьте Teams канал, чтобы развернуть бот в Teams канал.\n* Для создания туннеля к конечным точкам веб-сервера используйте ngrok.\n* Добавьте конечную точку обмена сообщениями в созданный туннель ngrok.\n\n**Создание ресурса Azure Bot**\n\n1. Перейдите [на Microsoft Azure портал.](https://portal.azure.com/)\n1. Выберите **Создать ресурс**.\n1. В поле поиска введите **Azure Bot**.\n1. Выберите **Ввод**.\n1. Выберите **Azure Bot**.\n\n   :::image type=\"content\" source=\"~/assets/images/bots/createazurebot.png\" alt-text=\"Создание карты-бота Azure\" border=\"true\":::\n\n1. Нажмите **Создать**.\n1. Введите необходимое имя ручки бота в **ручке Bot**.\n1. В **списке выпаданий** подписки выберите **msteams.nonprod.pub.msft.aplt**.\n1. Из списка **выпаданий** группы Ресурсов выберите существующую группу ресурсов. \n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/review-plus-create.png\" alt-text=\"Выберите ресурс Azure bot\" border=\"true\":::\n   \n   Можно также создать новую группу ресурсов (выберите **Создание** новых > введите имя ресурса > выберите **ОК**).\n\n1. Если вы создали новую группу ресурсов, выберите необходимое расположение из списка выпаданий расположения группы новых ресурсов.\n\n   :::image type=\"content\" source=\"~/assets/images/meetings-side-panel/newresource.png\" alt-text=\"Новое расположение группы ресурсов\" border=\"true\":::\n\n1. В разделе **Microsoft App ID** по умолчанию **выбирается новый ID** приложения Майкрософт. \n\n   Вы можете выбрать использование **существующей** регистрации приложений и **ввести** существующий код приложения и существующий пароль **приложения, или** создать **новый код Приложения Майкрософт**.\n\n   > [!NOTE]\n   > Вы не можете создать несколько ботов с одним и тем же **microsoft App ID**.\n\n1. Выберите **тип приложения в качестве** **multi tenant**.\n\n1. Выберите **Проверить и создать**.\n\n   :::image type=\"content\" source=\"~/assets/images/meeting-token-generator/register-bot-3.png\" alt-text=\"Создание ID приложения Майкрософт\" border=\"true\":::\n\n1. Если проверка пройдет, выберите **Создать**. \n\n   Подготовка службы бота занимает несколько минут. \n\n1. Выберите пункт **Перейти к ресурсу**. \n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/botdeployment.png\" alt-text=\"Развертывание приложения\" border=\"true\":::\n\n   Создан бот Azure.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/bot-page.png\" alt-text=\"Созданный ресурс бота Azure\" border=\"true\":::\n    \n  **Создание секрета клиента**\n\n   Выполните следующие действия, если вы создали новый **microsoft App ID**:\n\n1. В левой панели выберите **Конфигурация**. \n\n   > [!TIP]\n   > Сохраните **microsoft App ID** или **client ID** для будущих ссылок.\n\n1. Рядом с **microsoft App ID** выберите **Управление**.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/config1.png\" alt-text=\"Созданный ресурс бота Azure\" border=\"true\":::\n\n1. В разделе **Секреты клиента** выберите **новый секрет клиента**. \n\n   :::image type=\"content\" source=\"~/assets/images/meetings-side-panel/newclientsecret.png\" alt-text=\"Секрет нового клиента\" border=\"true\":::\n        \n   **Появится окно \"Добавление секрета клиента**\".\n\n1. **Введите Описание**.\n\n1. Нажмите **Добавить**.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/clientsecret.png\" alt-text=\"Добавление секрета клиента в приложение\" border=\"true\":::\n   \n1. В **столбце Значение** выберите **Копию в буфер обмена.**\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/clientvalue.png\" alt-text=\"Значение секрета клиента\" border=\"true\":::\n         \n   > [!TIP]\n   > Сохраните **значение \"Секреты клиента** \" или пароль приложения для будущей ссылки.\n\n **Добавление канала Teams**\n\n1. Нажмите **Главная**.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/gotohome.png\" alt-text=\"Домашняя страница\" border=\"true\":::\n   \n1. Выберите бот из **последних ресурсов**.\n\n1. Выберите **Каналы в** левой области. \n\n1. Выберите **Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/>.\n\n1. Выберите почтовый ящик, чтобы принять **Условия службы**.\n\n1. Выберите **Согласование**.\n\n   :::image type=\"content\" source=\"~/assets/images/meetings-side-panel/terms.png\" alt-text=\"Условия обслуживания\" border=\"true\":::\n  \n1. Нажмите кнопку **Сохранить**.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/configteams.png\" alt-text=\"Выберите Teams\" border=\"true\":::\n  \n**Создание туннеля для локального веб-сервера**\n\n     Use ngrok to create a tunnel to your locally running web server's publicly available HTTPS endpoints. Run the following command in ngrok:\n\n   ```bash\n   ngrok http -host-header=localhost 3978\n   ```\n   > [!TIP]\n   > Если **вы ERR_NGROK_4018,** выполните действия, которые отображаются в командной подсказке для регистрации и проверки подлинности ngrok. Затем запустите `ngrok http -host-header=localhost 3978` команду.\n\n**Добавление конечной точки обмена сообщениями**\n\n1. Из ngrok скопируйте URL-адрес HTTPS (https to io).\n\n    ![URL-адрес https ngrok](~/assets/images/Teams-link-unfurling/ngrok.png)\n\n    > [!NOTE]\n    > URL-адрес HTTPS в ngrok — это ваше полное доменное имя.\n    > Это `WebAppDomain` полностью квалифицированное доменное имя, которое не входит `https://` в него.\n\n1. В **Параметры** для созданного вами бота Azure выберите **Конфигурация**.\n\n1. В **конечной точке** обмена сообщениями используйте URL-адрес HTTPS, доступный в ngrok, а в конце **URL-адреса добавьте /api/messages**.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/messaging-endpoint.png\" alt-text=\"Конечная точка обмена сообщениями\" border=\"true\":::\n     \n1. Нажмите **Применить**.\n\n    Вы успешно создали бот в службе Azure Bot.\n"
- title: Обновление регистрации приложения Azure AD
  durationInMinutes: 1
  content: "1. Перейдите на [портал Azure](https://portal.azure.com/).\n\n1. Выберите **Azure Active Directory**.\n\n1. С левой области выберите **регистрацию приложения**.\n\n1. Выберите бот.\n   \n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/appregister.png\" alt-text=\"Регистрация приложения\" border=\"true\":::\n   \n1. Выберите **Expose aPI**.\n\n1. Выберите **набор**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/exposeanapi.png\" alt-text=\"Предоставление API\" border=\"true\":::\n  \n1. Установите **URI ID приложения** в виде `api://your ngrok/botid-{your AppID}`.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/setlink.png\" alt-text=\"Настройка ссылки\" border=\"true\":::\n           \n   На следующем изображении показано имя домена:\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/appIDuri.png\" alt-text=\"ID приложения\" border=\"true\":::\n  \n    > [!NOTE]\n    > Если вы используете службу тоннелей, например ngrok, убедитесь, что вы обновляете значение всякий раз, когда изменяется поддомен ngrok.\n    > `For example: api://f631****.ngrok.io/92c11075-c629-4a1e-ab58-02b4fd4204c2`, где `f631****.ngrok.io` новое имя поддомена ngrok.\n\n1. Нажмите **Добавить область**. \n   \n   :::image type=\"content\" source=\"../msteams-platform/assets/images/meetings-side-panel/selectscope.png\" alt-text=\"Выбор области\" border=\"true\"::: \n      \n1. На панели, которая отображается, введите `access_as_user` имя **Область**.\n\n1. Установите **Кто может согласиться?** .`Admins and users`\n\n1. Чтобы настроить запросы на `access_as_user` согласие администратора и пользователя с соответствующими значениями для области, в полях необходимо предоставить следующие сведения:</br>\n\n     * Введите `Teams can access the user’s profile` **имя отображения согласия администратора**.\n\n     * Введите `Allows Teams to call the app’s web APIs as the current user` в **качестве описания согласия администратора**.\n\n     * Введите `Teams can access the user profile and make requests on the user’s behalf` имя **отображения согласия пользователя**.\n\n     * Введите `Enable Teams to call this app’s APIs with the same rights as the user` в **качестве описания согласия пользователя**.\n\n1. Убедитесь, что параметру **Состояние** присвоено значение **Включено**.\n\n1. Выберите **Добавить область для** сохранения.\n\n    :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/addscope.png\" alt-text=\"Добавление области\" border=\"true\"::: \n    \n    > [!NOTE]\n    > Имя **Scope должно** совпадать с URI `/access_as_user` **ID** приложения с приложением в конце.</br>\n       `api://your ngrok/botid-00000000-0000-0000-0000-000000000000/access_as_user`\n\n      :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/scope.png\" alt-text=\"Scopes\" border=\"true\"::: \n    \n1. В разделе **Авторизованные клиентские приложения** укажите приложения, которые необходимо авторизовать для веб-приложения вашего приложения. \n\n1. Выберите **Добавить клиентское приложение**. \n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/meetings-side-panel/selectclientapp.png\" alt-text=\"Выбор клиентского приложения\" border=\"true\":::\n   \n1. **Введите client ID**: `1fec8e78-bce4-4aaf-ab1b-5451cc387264` для Teams настольного приложения. \n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/meetings-side-panel/addclientapplication1.png\" alt-text=\"Добавление клиентского приложения\" border=\"true\":::\n   \n   **Введите client ID**: `5e3ce6c0-2b1f-4285-8d4b-75ee78787346` для Teams веб-приложения.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/meetings-side-panel/addclientapplication2.png\" alt-text=\"Добавление клиентского приложения\" border=\"true\":::\n  \n1. Выберите **разрешенные области**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/authorizedscope.png\" alt-text=\"Добавление клиентского приложения\" border=\"true\":::\n  \n   На следующем изображении отображается **client Id**:\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/meetings-side-panel/clientapps.png\" alt-text=\"Клиентские приложения\" border=\"true\"::: \n     \n1. На левой панели выберите **разрешения API**. \n\n   > [!NOTE]\n   > Пользователи должны соглашаться на разрешения API только в том случае, если AAD зарегистрировано в другом клиенте.\n\n1. Выберите **Добавить разрешение**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/meetings-side-panel/addpermission.png\" alt-text=\"Добавление разрешений\" border=\"true\":::\n  \n1. Выберите **Microsoft Graph**.\n\n1. Выберите **Делегированные разрешения**.\n\n1. Выберите следующие разрешения:</br>\n     * **email**\n     * **offline_access**\n     * **OpenId**\n     * **profile**\n     * **User.Read**\n\n1. Выберите **Добавить разрешения**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/meetings-side-panel/other-permissions.png\" alt-text=\"Другие разрешения\" border=\"true\":::\n     \n1. На левой панели выберите **проверку подлинности,** чтобы установить URI перенаправления. \n\n   > [!NOTE]\n   > Если приложению не предоставлено согласие ИТ-администратора, пользователи должны предоставить согласие при первом использовании приложения.\n           \n     1. Выберите **Добавить платформу**.\n     1. Выберите платформу **Веб**.\n\n        :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/webauth.png\" alt-text=\"Web\" border=\"true\":::\n     \n     1. Введите URI перенаправления для приложения, примыкая `auth-end` к полностью квалифицированному доменному имени:</br> \n       `https://your ngrok/auth-end`. </br>\n\n     1. Включить **неявные грантовые и гибридные** потоки, выбрав следующие почтовые ящики:\n         * **Маркеры ID**\n         * **Маркеры доступа**\n\n     1. Нажмите **Настроить**.\n\n        :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/authend.png\" alt-text=\"Auth-end\" border=\"true\":::\n        \n"
- title: Настройка параметров приложения и файлов манифеста
  durationInMinutes: 1
  content: "1. Перейдите **к appsettings.json в** клонированном репозитории.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/appsettingslocation.png\" alt-text=\"Расположение параметров приложения\" border=\"true\":::\n  \n1. Откройте **appsettings.json** в Visual Studio.\n\n1. Обновление следующих сведений:  \n\n     * Настройка `\"MicrosoftAppType\"` **multiTenant**.\n     * Установите `\"MicrosoftAppId\"` для вашего бота **microsoft App ID**.\n     * Задайте `\"MicrosoftAppPassword\"` значение секретного ИД клиента вашего бота.\n     * Установите `\"MicrosoftAppTenantId\"` как пустое для бота MultiTenant.\n\n       :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/appsettings.png\" alt-text=\"Параметры приложения\" border=\"true\":::\n    \n1. Перейдите **к manifest.json в** клонированном репозитории.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/manifestlocation.png\" alt-text=\"[Расположение файла Манифеста\" border=\"true\":::\n    \n1. Откройте **manifest.json** в Visual Studio.\n\n1. Добавьте в файл манифеста следующий фрагмент кода, если он еще не представлен:\n\n   ```json\n   \"bots\": [\n    {\n      \"botId\": \"<<YOUR-MICROSOFT-APP-ID>>\",\n      \"scopes\": [\n        \"personal\",\n        \"team\",\n        \"groupchat\"\n      ],\n      \"supportsFiles\": false,\n      \"isNotificationOnly\": false\n    }      \n   ```\n\n1. Замените все случаи с `<<YOUR-MICROSOFT-APP-ID>>` помощью microsoft **App ID вашего бота**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/manifest.png\" alt-text=\"Изображение Манифеста\" border=\"true\":::\n  \n"
- title: Создание и запуск службы
  durationInMinutes: 1
  content: "**Создание и запуск службы с использованием последней версии Visual Studio или командной строки**\n\n# <a name=\"visual-studio\"></a>[Visual Studio](#tab/vs)\n\n   1. Запуск последней версии Visual Studio.\n   1. Перейдите к **файлу FileOpen** >  >  **Project/Solution**.\n\n      :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/VSopenfile.png\" alt-text=\"Открытый файл\" border=\"true\":::\n      \n   1. Выберите **файл TeamsLinkUnfurling.csproj** из **папки 55.teams-link-unfurling** .\n\n      :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/csproj.png\" alt-text=\"Выбор из папки\" border=\"true\":::\n  \n   1. Open **Solution Explorer** from **View**.\n\n      :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/solutionexplorer.png\" alt-text=\"Обозреватель решений\" border=\"true\":::\n      \n   1. Щелкните правой кнопкой **мыши teamsLinkUnfurling**.\n\n   1. Выберите **Set as Startup Project**.\n      \n      :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/startup.png\" alt-text=\"Обозреватель решений\" border=\"true\"::: \n      \n   1. Нажмите **кнопку F5** для запуска проекта.\n\n   1. Выберите **Да** , если появится следующий диалог:\n\n      :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/certificate.png\" alt-text=\"Сертификат доверия\" border=\"true\":::\n      \n      Откроется веб-сайт с сообщением о том, **что бот готов!**.\n\n      :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/appisready.png\" alt-text=\"Готовое приложение\" border=\"true\":::\n              \n# <a name=\"command-line\"></a>[Командная строка](#tab/cli)\n\nПерейдите к **примеру BotBuilder-Samples > примеры > csharp_dotnetcore > 55.teams-link-unfurling** в окне Командная подсказка и введите следующую команду:\n\n```bash\ndotnet run\n```\n:::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/dotnetruncmd.png\" alt-text=\"Dotnet\" border=\"true\":::\n\n  ---\n"
- title: Upload ссылка unfurling app
  durationInMinutes: 1
  content: "1. В клонированном репозитории **перейдите csharp_dotnetcore > 55.teams-link-unfurling > TeamsAppManifest**.\n\n1. Создайте .zip со следующими файлами, которые присутствуют в папке **Манифест** : \n   * manifest.json\n   * icon-outline.png\n   * icon-color.png\n\n     :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/zipfile.png\" alt-text=\"Zip-файл\" border=\"true\":::\n   \n1. Перейдите **Microsoft Teams**.\n\n1. Выберите **Приложения**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/AppStore.png\" alt-text=\"Zip-файл\" border=\"true\":::\n   \n1. В левом нижнем углу выберите **Управление приложениями**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/manageapps.png\" alt-text=\"Управление приложениями\" border=\"true\":::\n      \n1. Выберите **Upload приложение в каталоге приложений вашей организации**. \n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/uploadapp.png\" alt-text=\"Upload настраиваемом приложении\" border=\"true\":::\n  \n1. Выберите **Открыть** , чтобы загрузить .zip файл, созданный в **папке TeamsAppManifest** .\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/selectzip.png\" alt-text=\"Выберите почтовый файл\" border=\"true\":::\n  \n1. Нажмите **Добавить**.\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/addapp.png\" alt-text=\"Добавление приложения\" border=\"true\":::\n   \n   Приложение открывается в чате.\n\n1. В области составить сообщение введите `https://www.BotFramework.com`.\n\n   Ссылка разверзется, как показано на следующем изображении:\n\n   :::image type=\"content\" source=\"~/assets/images/Teams-link-unfurling/result.png\" alt-text=\"Ссылка unfurling result\" border=\"true\":::\n   \n1. Нажмите клавишу ВВОД.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/Teams-link-unfurling/result-1.png\" alt-text=\"Ссылка unfurling result\" border=\"true\":::\n"
- title: Полная задача
  durationInMinutes: 1
  content: >
    Вы придумали что-то подобное?


    :::image type="content" source="../msteams-platform/assets/images/Teams-link-unfurling/final-image.png" alt-text="Развертывание ссылки" border="true":::
- content: Вы завершили учебник, чтобы начать работу с Teams ссылку unfurling app!
