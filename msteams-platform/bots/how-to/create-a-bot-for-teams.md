---
title: Создание бота с помощью App Studio
author: clearab
description: Узнайте, как создать бота Microsoft Teams с помощью App Studio.
ms.topic: conceptual
localization_priority: Priority
ms.author: anclear
ms.openlocfilehash: 42b825ff2883e9b2b8b13dbd6774ed7ce6d0f40f
ms.sourcegitcommit: aca9990e1f84b07b9e77c08bfeca4440eb4e64f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/25/2020
ms.locfileid: "49476973"
---
# <a name="create-a-bot-using-app-studio"></a>Создание бота с помощью App Studio

> [!TIP]
> Ищете быстрый способ приступить к работе? Создайте [бота](../../build-your-first-app/build-bot.md), используя набор средств Microsoft Teams.

Чтобы создать бота для беседы, вам потребуется выполнить следующие действия:

1. Подготовить среду разработки.
1. Создать веб-службу.
1. Зарегистрировать веб-службу в качестве бота в Microsoft Bot Framework.
1. Создать манифест приложения и пакет приложения.
1. Отправить свой пакет в Microsoft Teams.

Создание веб-службы, регистрация веб-службы и создание пакета приложения с помощью Bot Framework могут осуществляться в любом порядке. Но поскольку эти три действия тесно связаны, независимо от порядка их выполнения вам потребуется вернуться, чтобы обновить остальные из них. Для вашей регистрации требуется конечная точка обмена сообщениями из развернутой веб-службы, а вашей веб-службе необходим идентификатор и пароль, созданный при регистрации. Манифесту приложения также требуется идентификатор регистрации, чтобы подключить Teams к вашей веб-службе.

В процессе создания бота вы будете регулярно переходить от изменения манифеста приложения к развертыванию кода в веб-службе. При работе с манифестом приложения учитывайте, что можно вручную выполнять действия с файлом JSON или вносить изменения с помощью App Studio. В любом случае вам потребуется повторно развернуть (отправить) свое приложение в Teams, если вы вносите изменения в манифест. Однако это не требуется при развертывании изменений в веб-службе.

Дополнительные сведения о платформе Bot Framework см. в [документации по Bot Framework](/azure/bot-service/).

[!include[prepare environment](~/includes/prepare-environment.md)]

## <a name="create-your-web-service"></a>Создание веб-службы

Основа вашего бота — это веб-служба. Она определяет единственный маршрут, обычно `/api/messages`, для получения всех запросов. Чтобы приступить к работе, можно воспользоваться одним из нескольких вариантов:

* Начните работу с примером бота для беседы в Teams в [C#/dotnet](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/57.teams-conversation-bot) или [JavaScript](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/57.teams-conversation-bot).
* Если вы используете JavaScript, примените [генератор Yeoman для Microsoft Teams](https://github.com/OfficeDev/generator-teams) для формирования своего приложения Teams, включая веб-службу. Это особенно удобно при создании приложения Teams, содержащего не только бота для беседы.
* Создайте веб-службу с нуля. Вы можете добавить пакет SDK Bot Framework для своего языка или работать непосредственно с полезными данными JSON.

## <a name="register-your-web-service-with-the-bot-framework"></a>Регистрация веб-службы в Bot Framework

> [!IMPORTANT]
> При регистрации веб-службы обязательно присвойте параметру **Отображаемое имя** такое же имя, которое вы использовали для параметра **Краткое имя** в манифесте приложения. Если приложение распространяется путем прямой отправки или через каталог приложений организации, сообщения, отправленные в беседу ботом, будут использовать **отображаемое имя**, указанное при регистрации, а не **краткое имя** приложения.

Регистрация веб-службы в Bot Framework обеспечивает безопасный канал связи между клиентом Teams и вашей веб-службой. Клиент Teams и веб-служба никогда не взаимодействуют напрямую. Вместо этого сообщения направляются через службу Bot Framework Service (Microsoft Teams использует отдельный экземпляр этой службы, совместимый со стандартами Office 365).

У вас есть два варианта регистрации веб-службы в Bot Framework. Чтобы зарегистрировать бота, не используя подписку на Azure, можно применить [App Studio](#using-app-studio) или [портал прежней версии](#in-the-legacy-portal). Кроме того, если у вас уже есть подписка на Azure (или вы не против ее создать), можно использовать [портал Azure](#with-an-azure-subscription) для регистрации вашей веб-службы.

### <a name="without-an-azure-subscription"></a>Без подписки на Azure

Если вы не хотите регистрировать бота в Azure, вы **должны** использовать ссылку https://dev.botframework.com/bots/new или App Studio. Если нажать кнопку *Создать бота* на портале Bot Framework, вы зарегистрируете бота в Microsoft Azure, и вам потребуется предоставить подписку на Azure. Для управления регистрацией или ее переноса в подписку на Azure после создания перейдите на сайт https://dev.botframework.com/bots.

При изменении свойств существующей регистрации Bot Framework, не зарегистрированной в Azure, отображается столбец "Состояние миграции" и синяя кнопка "Миграция", ведущая на портал Microsoft Azure. Не нажимайте кнопку "Миграция", если это не требуется. Вместо этого выберите **имя** бота, и вы сможете изменить его свойства:

   ![Изменение свойств бота](~/assets/images/bots/bf-migrate-bot-to-azure.png)

Сценарии, **требующие** регистрации бота в Azure (путем его создания на портале Azure или с помощью миграции):

* Вы хотите использовать [OAuthPrompt](./authentication/auth-flow-bot.md) платформы Bot Framework для проверки подлинности.
* Вы хотите включить дополнительные каналы, такие как веб-чат, прямая линия или Скайп.

#### <a name="using-app-studio"></a>Использование App Studio

*App Studio* — это приложение Teams, помогающее создавать приложения Teams, включая регистрацию вашей веб-службы в виде бота, создание манифеста приложения и пакета приложения, а также обновление параметров и настроек. Оно также содержит библиотеку элементов управления React и настраиваемые примеры для карточек. См. статью [Начало работы с Teams App Studio](../../concepts/build-and-test/app-studio-overview.md).

Помните, что если вы используете App Studio для регистрации веб-службы, вам потребуется перейти на сайт https://dev.botframework.com/bots для управления регистрацией.

#### <a name="in-the-legacy-portal"></a>На портале прежней версии

Создайте регистрацию бота с помощью ссылки https://dev.botframework.com/bots/new. **После создания бота обязательно добавьте Microsoft Teams в виде канала из списка основных каналов.** Вы можете повторно использовать любой сгенерированный вами идентификатор приложения Майкрософт, если вы уже создали пакет или манифест приложения.

   ![Страница регистрации в Bot Framework](~/assets/images/bots/bfregister.png)

### <a name="with-an-azure-subscription"></a>С помощью подписки на Azure

Вы также можете зарегистрировать свою веб-службу, создав ресурс регистрации каналов ботов на портале Azure.

[!INCLUDE [bot channels registration steps](~/includes/bots/azure-bot-channels-registration.md)]

[Портал Bot Framework](https://dev.botframework.com) оптимизирован для регистрации ботов в Microsoft Azure. Вот некоторые моменты, которые следует знать:

* После создания бота обязательно добавьте Microsoft Teams в виде канала из списка основных каналов.
* Каналы Microsoft Teams для ботов, зарегистрированных в Azure, являются **бесплатными**. Сообщения, отправленные по каналу Teams, НЕ будут учитываться в числе использованных сообщений для бота.
* Если вы зарегистрировали бота с помощью Microsoft Azure, код бота не требуется *размещать* в Microsoft Azure.
* Если вы зарегистрировали бота с помощью портала Microsoft Azure, у вас должна быть учетная запись Microsoft Azure. Вы можете [создать ее бесплатно](https://azure.microsoft.com/free/). Чтобы подтвердить свою личность при создании учетной записи Azure, вам потребуется предоставить кредитную карту, но с нее не будет взиматься плата. Создание и использование ботов в Microsoft Teams всегда бесплатно.

## <a name="create-your-app-manifest-and-package"></a>Создание манифеста и пакета приложения

[Манифест приложения](~/resources/schema/manifest-schema.md) определяет метаданные для приложения, точки расширения, используемые приложением, и указатели на веб-службы, к которым подключаются эти точки расширения. Вы можете использовать App Studio для создания манифеста приложения или создать его вручную.

### <a name="add-using-app-studio"></a>Добавление с помощью App Studio

1. В клиенте Teams откройте App Studio из меню переполнения **...** на панели навигации слева. Если приложение App Studio еще не установлено, это можно сделать, выполнив его поиск.
2. На вкладке **Редактор манифеста** нажмите кнопку **Создать приложение** (а если вы добавляете бота в существующее приложение, можно импортировать пакет приложения).
3. Добавьте сведения о приложении (см. [определение схемы манифеста](~/resources/schema/manifest-schema.md) с полным описанием каждого поля).
4. На вкладке **Боты** нажмите кнопку **Настройка**.
5. Вы можете создать новую регистрацию веб-службы (**Новый бот**) или, если вы уже зарегистрировали одну из них, выберите элемент **Существующий бот**.
6. Выберите возможности и области, которые нужны для бота.
7. При необходимости обновите адрес конечной точки бота, чтобы он указывал на вашего бота. Он должен выглядеть примерно следующим образом: `https://someplace.com/api/messages`.
8. При необходимости добавьте [команды бота](~/bots/how-to/create-a-bot-commands-menu.md).
9. Кроме того, вы можете скачать готовый пакет приложения на вкладке **Тестирование и распространение**.

### <a name="create-it-manually"></a>Создание вручную

Как и в случае расширений для обмена сообщениями и вкладок, вам нужно обновить [манифест приложения](~/resources/schema/manifest-schema.md), чтобы определить своего бота. Добавьте новую структуру JSON верхнего уровня в манифест приложения с использованием свойства `bots`.

|Имя| Тип| Максимальный размер | Обязательный | Описание|
|---|---|---|---|---|
|`botId`|String|64 символа|✔|Уникальный идентификатор приложения Майкрософт для бота, зарегистрированный в Bot Framework. Он может совпадать с общим идентификатором приложения.|
|`needsChannelSelector`|Логический|||Описывает, использует ли бот пользовательское указание для добавления бота в определенный канал. Значение по умолчанию: `false`.|
|`isNotificationOnly`|Логический|||Указывает, является ли бот односторонним и только для уведомлений, в отличие от бота для беседы. Значение по умолчанию: `false`.|
|`supportsFiles`|Логический|||Указывает, поддерживает ли бот возможность отправки и скачивания файлов в личном чате. Значение по умолчанию: `false`.|
|`scopes`|Массив перечислений|3|✔|Указывает, предлагает ли бот функции в контексте канала в `team`, в групповом чате (`groupchat`) или функции, ограниченные только отдельным пользователем (`personal`). Эти параметры не являются исключающими.|

При необходимости можно определить один или несколько списков команд, которые ваш бот может рекомендовать для пользователей. Объект является массивом (не более 2 элементов), и все элементы относятся к типу `object`. Для каждой области, поддерживаемой ботом, требуется определить отдельный список команд. Дополнительные сведения *см.* в статье [Меню ботов](./create-a-bot-commands-menu.md).

|Имя| Тип| Максимальный размер | Обязательный | Описание|
|---|---|---|---|---|
|`items.scopes`|массив перечислений|3|✔|Указывает область, для которой действует список команд. Возможны значения `team`, `personal` и `groupchat`.|
|`items.commands`|массив объектов|10|✔|Массив команд, поддерживаемых ботом:<br>`title`: имя команды бота (строка, 32)<br>`description`: простое описание или пример синтаксиса команды и ее аргумента (строка, 128)|

#### <a name="simple-manifest-example"></a>Пример простого манифеста

Пример ниже является простым объектом бота с двумя определенными списками команд. Это не весь файл манифеста приложения, а только часть, относящаяся к расширениям для обмена сообщениями.

```json
...
  "bots": [
    {
      "botId": "%MICROSOFT-APP-ID-REGISTERED-WITH-BOT-FRAMEWORK%",
      "needsChannelSelector": false,
      "isNotificationOnly": false,
      "scopes": [ "team", "personal", "groupchat" ],
      "supportsFiles": true,
      "commandLists": [
        {
          "scopes": [ "team", "groupchat" ],
          "commands": [
            {
              "title": "Command 1",
              "description": "Description of Command 1"
            },
            {
              "title": "Command N",
              "description": "Description of Command N"
            }
          ]
        },
        {
          "scopes": [ "personal", "groupchat" ],
          "commands": [
            {
              "title": "Personal command 1",
              "description": "Description of Personal command 1"
            },
            {
              "title": "Personal command N",
              "description": "Description of Personal command N"
            }
          ]
        }
      ]
    }
  ],
...
```

#### <a name="create-your-app-package-manually"></a>Создание пакета приложения вручную

Чтобы создать пакет приложения, требуется добавить манифест приложения и (необязательно) значки приложения в ZIP-файл архива. Полные сведения см. в статье [Создание пакета приложения](~/concepts/build-and-test/apps-package.md). Убедитесь, что ZIP-архив содержит только необходимые файлы без дополнительной вложенной структуры папок.

## <a name="upload-your-package-to-microsoft-teams"></a>Отправка пакета в Microsoft Teams

> [!NOTE]
> Чтобы успешно загрузить бота, ваш администратор клиента должен [разрешить загрузку](/microsoftteams/manage-apps#manage-org-wide-app-settings) сторонних или пользовательских приложений в Teams.

Если вы используете App Studio, можно установить приложение из вкладки **Тестирование и распространение** раздела **Редактор манифеста**. Или можно установить пакет приложения, открыв меню переполнения `...` на панели навигации слева, выбрав **Другие приложения** и щелкнув ссылку **Загрузить пользовательское приложение**. Чтобы внести дополнительные изменения перед отправкой, можно также импортировать манифест или пакет приложения в App Studio.

## <a name="bots-in-teams-meetings"></a>Боты на собраниях Teams

В собраниях в Teams поддерживаются боты. Когда бот получает сообщение вызова, он может определить пользователя и клиента по двум деталям: `userId` и `tenantId`. `meetingId` может быть частью объекта `channelData`. Вы можете использовать `userId` и `meetingId` для запроса к API `GetParticipant`, чтобы получить роли пользователей.

## <a name="next-steps"></a>Дальнейшие действия

* [Основы беседы для ботов](./conversations/conversation-basics.md)
* [Подписка на события беседы](./conversations/subscribe-to-conversation-events.md)
