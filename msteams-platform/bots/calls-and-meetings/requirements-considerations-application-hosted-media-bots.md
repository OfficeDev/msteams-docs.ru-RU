---
title: Требования и соображения для ботов-посредников, которые есть в приложении
description: В этой теме рассматриваются важные требования и вопросы, связанные с созданием ботов мультимедиа, которые будут проводиться в приложениях, для Microsoft Teams.
ms.topic: conceptual
keywords: windows server azure vm, на который есть приложение
ms.date: 11/16/2018
ms.openlocfilehash: bf75b7f689713f16cb3ff9ff4313ab829b5cc2d6
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014490"
---
# <a name="requirements-and-considerations-for-application-hosted-media-bots"></a>Требования и соображения для ботов мультимедиа, которые есть в приложении

Не все рекомендации по разработке ботов для обмена сообщениями и интерактивного голосового ответа (IVR) применимы одинаково к построению ботов мультимедиа с хостингом в приложениях. В этой статье описываются некоторые важные требования и соображения по разработке и запуску бота мультимедиа, наемного в приложении.

> [!NOTE]
> Так как платформа microsoft Real-time Media platform для ботов находится в предварительной версии разработчика, рекомендации в этой статье могут быть измениться.

## <a name="application-hosted-media-bot-development-requires-cnet-and-windows-server"></a>Для разработки бота-посредника, наемного в приложении, требуются C#/.NET и Windows Server

- Для бота мультимедиа, размещенного в приложении, требуется библиотека .NET (доступная здесь для доступа к аудио- и видеопотокам, а бот должен быть развернут на компьютере с Windows Server (или гостевой ОС Windows Server в `Microsoft.Graph.Communications.Calls.Media` Azure).[](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/) Поэтому бот должен быть разработан на C# и стандартной платформе .NET Framework и развернут в Microsoft Azure. Вы не можете использовать API C++ или Node.js для доступа к мультимедиа в режиме реального времени, и .NET Core не поддерживается для бота мультимедиа, который поддерживается в приложении.

- Бот мультимедиа, который находится в приложении, может быть находится в одной из следующих сред службы Azure:
  - Облачная служба.
  - Service Fabric с наборами масштаба виртуальной машины (VMSS).
  - Виртуальная машина инфраструктуры как услуга (IaaS).  
  
- Бот мультимедиа, размещаемого в приложении, не может быть развернут в качестве Azure Web App.

- Бот мультимедиа, на основе приложения, должен работать в последней версии `Microsoft.Graph.Communications.Calls.Media` библиотеки .NET. Бот должен использовать либо новую доступную версию пакета [NuGet,](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)либо версию не старше трех месяцев. Более старые версии библиотеки будут неподготовлены и могут не работать через несколько месяцев. Постоянное ведение библиотеки обеспечит наилучшее взаимодействия между ботом и `Microsoft.Graph.Communications.Calls.Media` Microsoft Teams.

## <a name="real-time-media-calls-stay-on-the-machine-where-they-were-created"></a>Вызовы мультимедиа в режиме реального времени остаются на компьютере, где они были созданы

- Вызов мультимедиа в режиме реального времени закреплен на экземпляре виртуальной машины, который принял или запустил вызов. Мультимедиа из вызова или собрания Microsoft Teams будут поступать в этот экземпляр ВМ, а мультимедиа, отправляемые ботом обратно в Microsoft Teams, также должны поступать из этой ВМ.
- Если при остановлении ВМ происходит какой-либо вызов мультимедиа в режиме реального времени, эти вызовы будут неожиданно прерваны. Если бот предварительно знает об ожидающих завершения работы VM, он может попытаться "корректно" закончить вызовы.

## <a name="application-hosted-media-bots-must-be-directly-accessible-on-the-internet"></a>Боты-носители, доступные в приложении, должны быть напрямую доступны в Интернете

- Каждый экземпляр VM, в который в Azure размещен бот мультимедиа, размещенного в приложении, должен быть доступен напрямую из Интернета с помощью общедоступного IP-адреса (ILPIP) на уровне экземпляра.
  - Сведения о получении и настройке ILPIP для облачной службы Azure см. в обзоре общедоступных IP-адресов на уровне [экземпляра (классическая).](/azure/virtual-network/virtual-networks-instance-level-public-ip)
  - Для настройки ILPIP для набора масштаба виртуальных машин [см. общедоступный IPv4 на виртуальную машину.](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine)
- Служба, в которой размещен бот мультимедиа, размещенного в приложении, также должна настроить каждый экземпляр VM с общедоступным портом, который сопостает определенному экземпляру.
  - Для облачной службы Azure для этого требуется конечная точка ввода экземпляра; см. ["Включить связь для экземпляров ролей в Azure".](/azure/cloud-services/cloud-services-enable-communication-role-instances)
  - Для набора масштабирования ВМ необходимо настроить правило NAT в подстройке нагрузки; см. [виртуальные сети и виртуальные машины в Azure.](/azure/virtual-machines/windows/network-overview)
- Эмулятор Bot Framework не поддерживает боты мультимедиа, которые поддерживаются в приложениях.

## <a name="scalability-and-performance-considerations"></a>Рекомендации по масштабируемости и производительности

- Для ботов мультимедиа, которые работают с приложениями, требуется больше вычислительной мощности и пропускной способности сети, чем для ботов обмена сообщениями, что может привести к значительному росту операционных расходов. Разработчик бота мультимедиа в режиме реального времени должен тщательно измерить масштабируемость бота и убедиться, что бот не принимает больше одновременных вызовов, чем может управлять. Бот с поддержкой видео может поддерживать только один или два одновключения сеансов мультимедиа на ядро ЦП (при использовании форматов видео RGB24 или NV12 необработанных).
- Платформа мультимедиа в режиме реального времени в настоящее время не имеет преимуществ графических процессоров (GPU), доступных на VM для разгрузки кодировки и декодирования видео H.264. Вместо этого кодирование и декодировать видео можно в программном обеспечении ЦП. Если графический процессор доступен, бот может использовать его для собственной отрисовки графики (например, если бот использует трехмерный графический механизм).
- Экземпляр VM, на который размещен бот мультимедиа в режиме реального времени, должен иметь не менее 2 ядер ЦП. Для Azure рекомендуется использовать виртуальную машину серии Dv2. Для других типов виртуальных машины Azure система с 4 виртуальными ЦП (vCPU) является минимальным требуемой величиной. Подробные сведения о типах ВМ Azure доступны в [документации Azure.](/azure/virtual-machines/windows/sizes-general)

## <a name="samples-and-additional-resources"></a>Примеры и дополнительные ресурсы

- [Примеры приложений](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/LocalMediaSamples)
- [Документация по SDK для вызовов Graph](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/)
