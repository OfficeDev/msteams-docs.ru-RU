---
title: Требования и соображения к медийным ботам с хостингом приложений
description: Понимание важных требований и соображений, связанных с созданием медиа-ботов с хостингом приложений для Microsoft Teams.
ms.topic: conceptual
localization_priority: Normal
keywords: windows server azure vm с использованием приложения
ms.date: 11/16/2018
ms.openlocfilehash: a66296951dd2f704d531840f79a4c4b955af6bdf
ms.sourcegitcommit: 3560ee1619e3ab6483a250f1d7f2ceb69353b2dc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2021
ms.locfileid: "53335363"
---
# <a name="requirements-and-considerations-for-application-hosted-media-bots"></a><span data-ttu-id="8a409-104">Требования и соображения к медийным ботам с хостингом приложений</span><span class="sxs-lookup"><span data-stu-id="8a409-104">Requirements and considerations for application-hosted media bots</span></span>

<span data-ttu-id="8a409-105">Для доступа к аудио- и видеотеке медиа-боту, размещенного в приложении, требуется [ `Microsoft.Graph.Communications.Calls.Media` библиотека .NET.](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)</span><span class="sxs-lookup"><span data-stu-id="8a409-105">An application-hosted media bot requires the [`Microsoft.Graph.Communications.Calls.Media` .NET library](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/) to access the audio and video media streams.</span></span> <span data-ttu-id="8a409-106">Бот должен быть развернут на компьютере Windows Или гостевой операционной системе Windows Server в Azure.</span><span class="sxs-lookup"><span data-stu-id="8a409-106">The bot must be deployed on a Windows Server machine or Windows Server guest Operating System (OS) in Azure.</span></span>

> [!NOTE]
> * <span data-ttu-id="8a409-107">Рекомендации по разработке ботов обмена сообщениями и интерактивного голосового ответа (IVR) не полностью применимы к построению медиа-ботов, принимающих приложения.</span><span class="sxs-lookup"><span data-stu-id="8a409-107">The guidance for developing messaging and Interactive Voice Response (IVR) bots does not completely apply to building application-hosted media bots.</span></span>
> * <span data-ttu-id="8a409-108">Поскольку медиаплатформа Microsoft в режиме реального времени для ботов находится в предварительной версии разработчика, руководство в этом документе подлежит изменению.</span><span class="sxs-lookup"><span data-stu-id="8a409-108">As the Microsoft Real-time Media Platform for bots is in developer preview, the guidance in this document is subject to change.</span></span>

## <a name="c-or-net-and-windows-server-for-development"></a><span data-ttu-id="8a409-109">C# или .NET и Windows Server для разработки</span><span class="sxs-lookup"><span data-stu-id="8a409-109">C# or .NET and Windows Server for development</span></span>

<span data-ttu-id="8a409-110">Для медиа-бота с хостингом приложения требуется следующее:</span><span class="sxs-lookup"><span data-stu-id="8a409-110">An application-hosted media bot requires the following:</span></span>

- <span data-ttu-id="8a409-111">Бот должен быть разработан в C# стандартном платформа .NET Framework и развернут в Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="8a409-111">The bot must be developed in C# and the standard .NET Framework and deployed in Microsoft Azure.</span></span> <span data-ttu-id="8a409-112">Вы не можете использовать C++ или Node.js API для доступа к средствам массовой информации в режиме реального времени, и .NET Core не поддерживается для сетевого бота, на основе приложения.</span><span class="sxs-lookup"><span data-stu-id="8a409-112">You cannot use C++ or Node.js APIs to access real-time media and .NET Core is not supported for an application-hosted media bot.</span></span>

- <span data-ttu-id="8a409-113">Бот может быть организован в одной из следующих сред служб Azure:</span><span class="sxs-lookup"><span data-stu-id="8a409-113">The bot can be hosted within one of the following Azure service environments:</span></span>
    - <span data-ttu-id="8a409-114">Облачная служба.</span><span class="sxs-lookup"><span data-stu-id="8a409-114">Cloud Service.</span></span>
    - <span data-ttu-id="8a409-115">Service Fabric с наборами масштабирования виртуальных машин (VMSS).</span><span class="sxs-lookup"><span data-stu-id="8a409-115">Service Fabric with Virtual Machine Scale Sets (VMSS).</span></span>
    - <span data-ttu-id="8a409-116">Инфраструктура как виртуальная машина службы (IaaS).</span><span class="sxs-lookup"><span data-stu-id="8a409-116">Infrastructure as a Service (IaaS) Virtual Machine (VM).</span></span>  
  
- <span data-ttu-id="8a409-117">Бот не может быть развернут в качестве веб-приложения Azure.</span><span class="sxs-lookup"><span data-stu-id="8a409-117">The bot cannot be deployed as an Azure web app.</span></span>

- <span data-ttu-id="8a409-118">Бот должен работать в последней версии `Microsoft.Graph.Communications.Calls.Media` библиотеки .NET.</span><span class="sxs-lookup"><span data-stu-id="8a409-118">The bot must be running on a recent version of the `Microsoft.Graph.Communications.Calls.Media` .NET library.</span></span> <span data-ttu-id="8a409-119">Бот должен использовать либо новую доступную версию пакета [NuGet,](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)либо версию, которая не превышает трех месяцев.</span><span class="sxs-lookup"><span data-stu-id="8a409-119">The bot must use either the newest available version of the [NuGet package](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/), or a version that is not more than three months old.</span></span> <span data-ttu-id="8a409-120">Более старые версии библиотеки обесценяются и не работают через несколько месяцев.</span><span class="sxs-lookup"><span data-stu-id="8a409-120">Older versions of the library are deprecated and do not work after a few months.</span></span> <span data-ttu-id="8a409-121">Постоянное ведение библиотеки обеспечивает лучшую возможность взаимодействия между ботом и `Microsoft.Graph.Communications.Calls.Media` Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="8a409-121">Keeping the `Microsoft.Graph.Communications.Calls.Media` library up-to-date ensures the best interoperability between the bot and Microsoft Teams.</span></span>

<span data-ttu-id="8a409-122">В следующем разделе приводится подробная информация о расположении вызовов мультимедиа в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="8a409-122">The next section provides details on where real-time media calls are located.</span></span>

## <a name="real-time-media-calls-stay-where-they-are-created"></a><span data-ttu-id="8a409-123">Вызовы мультимедиа в режиме реального времени остаются там, где они создаются</span><span class="sxs-lookup"><span data-stu-id="8a409-123">Real-time media calls stay where they are created</span></span>

<span data-ttu-id="8a409-124">Вызовы мультимедиа в режиме реального времени остаются на компьютере, на котором они были созданы.</span><span class="sxs-lookup"><span data-stu-id="8a409-124">Real-time media calls stay on the computer where they were created.</span></span> <span data-ttu-id="8a409-125">Вызов мультимедиа в режиме реального времени прикрепяется к экземпляру виртуальной машины (VM), который принял или запустил вызов.</span><span class="sxs-lookup"><span data-stu-id="8a409-125">A real-time media call is pinned to the virtual machine (VM) instance that accepted or started the call.</span></span> <span data-ttu-id="8a409-126">Носителю из Microsoft Teams или собрания передается экземпляр VM, а также носителю, который бот отправляет обратно в Microsoft Teams, также должно исходить из этого VM.</span><span class="sxs-lookup"><span data-stu-id="8a409-126">Media from a Microsoft Teams call or meeting flows to that VM instance, and media the bot sends back to Microsoft Teams must also originate from that VM.</span></span> <span data-ttu-id="8a409-127">Если при прекращении работы VM в режиме реального времени в режиме реального времени вызовы средств массовой информации прекращаются, эти вызовы внезапно прекращаются.</span><span class="sxs-lookup"><span data-stu-id="8a409-127">If there are any real-time media calls in progress when the VM is stopped, those calls are abruptly terminated.</span></span> <span data-ttu-id="8a409-128">Если у бота есть предварительные сведения о ожидаемом закрытии VM, он может прекратить вызовы.</span><span class="sxs-lookup"><span data-stu-id="8a409-128">If the bot has prior knowledge of the pending VM shutdown, it can end the calls.</span></span>

<span data-ttu-id="8a409-129">В следующем разделе приводится подробная информация о доступности медиа-ботов, на которые есть приложения.</span><span class="sxs-lookup"><span data-stu-id="8a409-129">The next section provides details on accessibility of application-hosted media bots.</span></span>

## <a name="application-hosted-media-bots-accessible-on-the-internet"></a><span data-ttu-id="8a409-130">Медиа-боты с хостингом приложений, доступные в Интернете</span><span class="sxs-lookup"><span data-stu-id="8a409-130">Application-hosted media bots accessible on the internet</span></span>

<span data-ttu-id="8a409-131">Медиа-боты, на которые есть приложения, должны быть доступны напрямую в Интернете.</span><span class="sxs-lookup"><span data-stu-id="8a409-131">Application-hosted media bots must be directly accessible on the internet.</span></span> <span data-ttu-id="8a409-132">Эти боты должны включать следующие функции:</span><span class="sxs-lookup"><span data-stu-id="8a409-132">These bots must include the following features:</span></span>

- <span data-ttu-id="8a409-133">Каждый экземпляр VM, где размещен медиа-бот с размещением приложений в Azure, должен быть напрямую доступен из Интернета с помощью общедоступного IP-адреса на уровне экземпляра (ILPIP).</span><span class="sxs-lookup"><span data-stu-id="8a409-133">Each VM instance hosting an application-hosted media bot in Azure must be directly accessible from the internet using an instance-level public IP address (ILPIP).</span></span>
    - <span data-ttu-id="8a409-134">Сведения о получении и настройке ILPIP для облачной службы Azure см. в обзоре общедоступных классических [IP-адресов уровня экземпляров.](/azure/virtual-network/virtual-networks-instance-level-public-ip)</span><span class="sxs-lookup"><span data-stu-id="8a409-134">For obtaining and configuring an ILPIP for an Azure Cloud Service, see [instance level public IP classic overview](/azure/virtual-network/virtual-networks-instance-level-public-ip).</span></span>
    - <span data-ttu-id="8a409-135">Для настройки ILPIP для набора масштабов VM см. [общедоступный IPv4 для виртуальной машины.](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine)</span><span class="sxs-lookup"><span data-stu-id="8a409-135">For configuring an ILPIP for a VM Scale Set, see [public IPv4 per virtual machine](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine).</span></span>
- <span data-ttu-id="8a409-136">Служба, в которой размещен медиа-бот с размещением приложений, также должна настроить каждый экземпляр VM с общедоступным портом, который совмещаяся с конкретным экземпляром.</span><span class="sxs-lookup"><span data-stu-id="8a409-136">The service hosting an application-hosted media bot must also configure each VM instance with a public-facing port which maps to the specific instance.</span></span>
    - <span data-ttu-id="8a409-137">Для облачной службы Azure это требует конечной точки ввода экземпляра.</span><span class="sxs-lookup"><span data-stu-id="8a409-137">For an Azure Cloud Service, this requires an instance input endpoint.</span></span> <span data-ttu-id="8a409-138">Дополнительные сведения см. в [примере включить связь для экземпляров ролей в Azure.](/azure/cloud-services/cloud-services-enable-communication-role-instances)</span><span class="sxs-lookup"><span data-stu-id="8a409-138">For more information, see [enable communication for role instances in Azure](/azure/cloud-services/cloud-services-enable-communication-role-instances).</span></span>
    - <span data-ttu-id="8a409-139">Для набора масштабов VM необходимо настроить правило NAT на балансире нагрузки.</span><span class="sxs-lookup"><span data-stu-id="8a409-139">For a VM Scale Set, a NAT rule on the load balancer must be configured.</span></span> <span data-ttu-id="8a409-140">Дополнительные сведения см. в [виртуальных сетях и виртуальных машинах в Azure.](/azure/virtual-machines/windows/network-overview)</span><span class="sxs-lookup"><span data-stu-id="8a409-140">For more information, see [virtual networks and virtual machines in Azure](/azure/virtual-machines/windows/network-overview).</span></span>
- <span data-ttu-id="8a409-141">Поддерживаемые приложениями медиа-боты не поддерживаются Bot Framework Emulator.</span><span class="sxs-lookup"><span data-stu-id="8a409-141">Application-hosted media bots are not supported by the Bot Framework Emulator.</span></span>

<span data-ttu-id="8a409-142">В следующем разделе приводится подробная информация о масштабируемости и производительности медиа-ботов, на которые было организовано приложение.</span><span class="sxs-lookup"><span data-stu-id="8a409-142">The next section provides details on scalability and performance considerations of application-hosted media bots.</span></span>

## <a name="scalability-and-performance-considerations"></a><span data-ttu-id="8a409-143">Рекомендации по масштабируемости и производительности</span><span class="sxs-lookup"><span data-stu-id="8a409-143">Scalability and performance considerations</span></span>

<span data-ttu-id="8a409-144">Для медиа-ботов, на которые есть приложения, требуются следующие аспекты масштабируемости и производительности:</span><span class="sxs-lookup"><span data-stu-id="8a409-144">The application-hosted media bots require the following scalability and performance considerations:</span></span>
- <span data-ttu-id="8a409-145">Для сетевых ботов, на которые есть приложения, требуется больше вычислительной и сетевой (пропускной способности), чем для ботов обмена сообщениями, что может привести к значительно более высоким эксплуатационным затратам.</span><span class="sxs-lookup"><span data-stu-id="8a409-145">Application-hosted media bots require more compute and network (bandwidth) capacity than messaging bots and may incur significantly higher operational costs.</span></span> <span data-ttu-id="8a409-146">Разработчик медиа-бота в режиме реального времени должен тщательно измерить масштабируемость бота и убедиться, что он не принимает больше одновременных вызовов, чем он может управлять.</span><span class="sxs-lookup"><span data-stu-id="8a409-146">A real-time media bot developer must carefully measure the bot's scalability, and ensure the bot doesn't accept more simultaneous calls than it can manage.</span></span> <span data-ttu-id="8a409-147">Бот с поддержкой видео может поддерживать только одну или две одновечерные сеансы мультимедиа на ядро ЦП (при использовании "необработанных" форматов видео RGB24 или NV12).</span><span class="sxs-lookup"><span data-stu-id="8a409-147">A video-enabled bot may be able to sustain only one or two concurrent media sessions per CPU core (if using the "raw" RGB24 or NV12 video formats).</span></span>
- <span data-ttu-id="8a409-148">В настоящее время медиаплатформа в режиме реального времени не может использовать любые блоки обработки графики (GPU), доступные в VM для загрузки кодирования и декодирования видео H.264.</span><span class="sxs-lookup"><span data-stu-id="8a409-148">The Real-time Media Platform doesn't currently take advantage of any Graphics Processing Units (GPU) available on the VM to off-load H.264 video encoding/decoding.</span></span> <span data-ttu-id="8a409-149">Вместо этого код видео и декодируются в программном обеспечении на ЦП.</span><span class="sxs-lookup"><span data-stu-id="8a409-149">Instead, video encode and decode are done in software on the CPU.</span></span> <span data-ttu-id="8a409-150">Если GPU доступен, бот может использовать его для собственной визуализации графики, например, если бот использует 3D-графический движок.</span><span class="sxs-lookup"><span data-stu-id="8a409-150">If a GPU is available, the bot may take advantage of it for its own graphics rendering, for example, if the bot is using a 3D graphics engine.</span></span>
- <span data-ttu-id="8a409-151">Экземпляр VM, на который размещен медиа-бот в режиме реального времени, должен иметь не менее 2 Ядер ЦП.</span><span class="sxs-lookup"><span data-stu-id="8a409-151">The VM instance hosting the real-time media bot must have at least 2 CPU cores.</span></span> <span data-ttu-id="8a409-152">Для Azure рекомендуется использовать виртуальную машину серии Dv2.</span><span class="sxs-lookup"><span data-stu-id="8a409-152">For Azure, a Dv2-series virtual machine is recommended.</span></span> <span data-ttu-id="8a409-153">Для других типов VM Azure требуется минимальный размер системы с четырьмя виртуальными процессорами (vCPU).</span><span class="sxs-lookup"><span data-stu-id="8a409-153">For other Azure VM types, a system with four virtual CPUs (vCPU) is the minimum size required.</span></span> <span data-ttu-id="8a409-154">Подробные сведения о типах VM Azure доступны в [документации Azure.](/azure/virtual-machines/windows/sizes-general)</span><span class="sxs-lookup"><span data-stu-id="8a409-154">Detailed information about Azure VM types is available in the [Azure documentation](/azure/virtual-machines/windows/sizes-general).</span></span> 

## <a name="code-sample"></a><span data-ttu-id="8a409-155">Пример кода</span><span class="sxs-lookup"><span data-stu-id="8a409-155">Code sample</span></span>

<span data-ttu-id="8a409-156">Примеры медийных ботов, на которые организовано приложение, следуют следующим образом:</span><span class="sxs-lookup"><span data-stu-id="8a409-156">Application-hosted media bots samples are as follows:</span></span>

| <span data-ttu-id="8a409-157">**Пример имени**</span><span class="sxs-lookup"><span data-stu-id="8a409-157">**Sample name**</span></span> | <span data-ttu-id="8a409-158">**Описание**</span><span class="sxs-lookup"><span data-stu-id="8a409-158">**Description**</span></span> | <span data-ttu-id="8a409-159">**Microsoft Graph**</span><span class="sxs-lookup"><span data-stu-id="8a409-159">**Graph**</span></span> |
|------------|-------------|-----------|
| <span data-ttu-id="8a409-160">Пример локального мультимедиа</span><span class="sxs-lookup"><span data-stu-id="8a409-160">Local media sample</span></span> | <span data-ttu-id="8a409-161">Примеры, иллюстрирующие различные локальные сценарии мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="8a409-161">Samples that illustrates different local media scenarios.</span></span> | [<span data-ttu-id="8a409-162">View</span><span class="sxs-lookup"><span data-stu-id="8a409-162">View</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/LocalMediaSamples) |
| <span data-ttu-id="8a409-163">Пример удаленного мультимедиа</span><span class="sxs-lookup"><span data-stu-id="8a409-163">Remote media sample</span></span> | <span data-ttu-id="8a409-164">Примеры, иллюстрирующие различные сценарии удаленного мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="8a409-164">Samples that illustrates different remote media scenarios.</span></span> | [<span data-ttu-id="8a409-165">View</span><span class="sxs-lookup"><span data-stu-id="8a409-165">View</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/RemoteMediaSamples) |

## <a name="see-also"></a><span data-ttu-id="8a409-166">См. также</span><span class="sxs-lookup"><span data-stu-id="8a409-166">See also</span></span>

- [<span data-ttu-id="8a409-167">Graph Вызов документации по SDK</span><span class="sxs-lookup"><span data-stu-id="8a409-167">Graph Calling SDK Documentation</span></span>](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/)
- <span data-ttu-id="8a409-168">Боты требуют больше вычислительной и сетевой пропускной способности, чем боты обмена сообщениями, и понести значительно более высокие эксплуатационные затраты.</span><span class="sxs-lookup"><span data-stu-id="8a409-168">The bots require more compute and network bandwidth capacity than messaging bots and incur significantly higher operational costs.</span></span> <span data-ttu-id="8a409-169">Разработчик медиа-бота в режиме реального времени должен тщательно измерить масштабируемость бота и убедиться, что он не принимает больше одновременных вызовов, чем он может управлять.</span><span class="sxs-lookup"><span data-stu-id="8a409-169">A real-time media bot developer must carefully measure the bot's scalability, and ensure the bot does not accept more simultaneous calls than it can manage.</span></span> <span data-ttu-id="8a409-170">Бот с поддержкой видео может поддерживать только один или два одновечерных сеансов мультимедиа на ядро ЦП при использовании необработанных форматов видео RGB24 или NV12.</span><span class="sxs-lookup"><span data-stu-id="8a409-170">A video-enabled bot can sustain only one or two concurrent media sessions per CPU core if using the raw RGB24 or NV12 video formats.</span></span>
- <span data-ttu-id="8a409-171">В настоящее время медиаплатформа в режиме реального времени не может использовать любые блоки обработки графики (GPU), доступные на VM для загрузки видео кодирования или декодирования H.264.</span><span class="sxs-lookup"><span data-stu-id="8a409-171">The Real-time Media Platform does not currently take advantage of any Graphics Processing Units (GPU) available on the VM to off-load H.264 video encoding or decoding.</span></span> <span data-ttu-id="8a409-172">Вместо этого код видео и декодируются в программном обеспечении на ЦП.</span><span class="sxs-lookup"><span data-stu-id="8a409-172">Instead, video encode and decode are done in software on the CPU.</span></span> <span data-ttu-id="8a409-173">Если GPU доступен, бот использует его для собственной визуализации графики, например, если бот использует 3D-графический движок.</span><span class="sxs-lookup"><span data-stu-id="8a409-173">If a GPU is available, the bot takes advantage of it for its own graphics rendering, for example, if the bot is using a 3D graphics engine.</span></span>
- <span data-ttu-id="8a409-174">Экземпляр VM, на который размещен медиа-бот в режиме реального времени, должен иметь не менее 2 Ядер ЦП.</span><span class="sxs-lookup"><span data-stu-id="8a409-174">The VM instance hosting the real-time media bot must have at least 2 CPU cores.</span></span> <span data-ttu-id="8a409-175">Для Azure рекомендуется использовать виртуальную машину серии Dv2.</span><span class="sxs-lookup"><span data-stu-id="8a409-175">For Azure, a Dv2-series virtual machine is recommended.</span></span> <span data-ttu-id="8a409-176">Для других типов VM Azure требуется минимальный размер системы с 4 виртуальными процессорами (vCPU).</span><span class="sxs-lookup"><span data-stu-id="8a409-176">For other Azure VM types, a system with 4 virtual CPUs (vCPU) is the minimum size required.</span></span> <span data-ttu-id="8a409-177">Дополнительные сведения о типах VM Azure см. в [документации Azure.](/azure/virtual-machines/windows/sizes-general)</span><span class="sxs-lookup"><span data-stu-id="8a409-177">For more information about Azure VM types, see [Azure documentation](/azure/virtual-machines/windows/sizes-general).</span></span>

<span data-ttu-id="8a409-178">В следующем разделе приводится пример, иллюстрирующие различные локальные сценарии мультимедиа.</span><span class="sxs-lookup"><span data-stu-id="8a409-178">The next section provides samples that illustrate different local media scenarios.</span></span>

## <a name="samples-and-additional-resources"></a><span data-ttu-id="8a409-179">Примеры и дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="8a409-179">Samples and additional resources</span></span>

- [<span data-ttu-id="8a409-180">Пример приложений</span><span class="sxs-lookup"><span data-stu-id="8a409-180">Sample applications</span></span>](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/LocalMediaSamples)
- [<span data-ttu-id="8a409-181">Graph для вызова документации по SDK</span><span class="sxs-lookup"><span data-stu-id="8a409-181">Graph calling SDK documentation</span></span>](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/)

## <a name="next-step"></a><span data-ttu-id="8a409-182">Следующий этап</span><span class="sxs-lookup"><span data-stu-id="8a409-182">Next step</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="8a409-183">Поддерживаемые форматы медиа</span><span class="sxs-lookup"><span data-stu-id="8a409-183">Supported media formats</span></span>](~/resources/media-formats.md)
