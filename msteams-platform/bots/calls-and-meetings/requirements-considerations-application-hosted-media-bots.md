---
title: Требования и соображения к медийным ботам с хостингом приложений
description: Понимание важных требований и соображений, а также соображений масштабируемости и производительности, связанных с созданием медийных ботов на Microsoft Teams с использованием примеров и примеров кода.
ms.topic: conceptual
ms.localizationpriority: medium
keywords: средства массовой информации, Windows Azure VM
ms.date: 11/16/2018
ms.openlocfilehash: ddbcf4edd2783d79c8bfdcd057067d7d5a4d1137
ms.sourcegitcommit: 8a0ffd21c800eecfcd6d1b5c4abd8c107fcf3d33
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/12/2022
ms.locfileid: "63453021"
---
# <a name="requirements-and-considerations-for-application-hosted-media-bots"></a>Требования и соображения к медийным ботам с хостингом приложений

Для доступа к аудио- и видеотеке медиа-боту, размещенного в приложении, требуется [библиотека .NET.`Microsoft.Graph.Communications.Calls.Media`](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/) Бот должен быть развернут на локальном компьютере Windows Server или гостевой операционной системе Windows Server в Azure.

> [!NOTE]
>
> * Рекомендации по разработке ботов обмена сообщениями и интерактивного голосового ответа (IVR) не полностью применимы к построению медиа-ботов, принимающих приложения.
> * Поскольку медиаплатформа Microsoft в режиме реального времени для ботов находится в предварительной версии разработчика, руководство в этом документе подлежит изменению.

## <a name="c-or-net-and-windows-server-for-development"></a>C# или .NET и Windows Server для разработки

Для медиа-бота с хостингом приложения требуется следующее:

* Бот должен быть разработан в C# и стандартный платформа .NET Framework и развернут в Microsoft Azure. Вы не можете использовать API C++ или Node.js для доступа к мультимедиа в режиме реального времени, и .NET Core не поддерживается для сетевого бота, на основе приложения.

* Бот может быть организован в одной из следующих сред служб Azure:
  * Облачная служба.
  * Service Fabric с наборами масштабирования виртуальных машин (VMSS).
  * Инфраструктура как виртуальная машина службы (IaaS).  
  
* Бот не может быть развернут в качестве веб-приложения Azure.

* Бот должен работать в последней версии `Microsoft.Graph.Communications.Calls.Media` библиотеки .NET. Бот должен использовать либо новую доступную версию пакета [NuGet, либо](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/) версию, которая не превышает трех месяцев. Более старые версии библиотеки обесценяются и не работают через несколько месяцев. Постоянное `Microsoft.Graph.Communications.Calls.Media` ведение библиотеки обеспечивает лучшую связь между ботом и Microsoft Teams.

В следующем разделе приводится подробная информация о расположении вызовов мультимедиа в режиме реального времени.

## <a name="real-time-media-calls-stay-where-they-are-created"></a>Вызовы мультимедиа в режиме реального времени остаются там, где они создаются

Вызовы мультимедиа в режиме реального времени остаются на компьютере, на котором они были созданы. Вызов мультимедиа в режиме реального времени прикрепяется к экземпляру виртуальной машины (VM), который принял или запустил вызов. Носителю из Microsoft Teams или собрания передается в экземпляр VM, а средства массовой информации, которые бот отправляет обратно в Microsoft Teams, также должны исходить из этого VM. Если при прекращении работы VM в режиме реального времени в режиме реального времени вызовы средств массовой информации прекращаются, эти вызовы внезапно прекращаются. Если у бота есть предварительные сведения о ожидаемом закрытии VM, он может прекратить вызовы.

В следующем разделе приводится подробная информация о доступности медиа-ботов, на которые есть приложения.

## <a name="application-hosted-media-bots-accessible-on-the-internet"></a>Медиа-боты с хостингом приложений, доступные в Интернете

Медиа-боты, на которые есть приложения, должны быть доступны напрямую в Интернете. Эти боты должны включать следующие функции:

* Каждый экземпляр VM, где размещен медиа-бот с размещением приложений в Azure, должен быть напрямую доступен из Интернета с помощью общедоступного IP-адреса на уровне экземпляра (ILPIP).
  * Сведения о получении и настройке ILPIP для облачной службы Azure см. в обзоре общего классического обзора [IP уровня экземпляра](/azure/virtual-network/virtual-networks-instance-level-public-ip).
  * Для настройки ILPIP для набора масштабов VM см. [общедоступный IPv4 для виртуальной машины](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking#public-ipv4-per-virtual-machine).
* Служба, в которой размещен медиа-бот с размещением приложений, также должна настроить каждый экземпляр VM с общедоступным портом, который совмещаяся с конкретным экземпляром.
  * Для облачной службы Azure это требует конечной точки ввода экземпляра. Дополнительные сведения см. в [примере включить связь для экземпляров ролей в Azure](/azure/cloud-services/cloud-services-enable-communication-role-instances).
  * Для набора масштабов VM необходимо настроить правило NAT на балансире нагрузки. Дополнительные сведения см. в [виртуальных сетях и виртуальных машинах в Azure](/azure/virtual-machines/windows/network-overview).

* Поддерживаемые приложениями медиа-боты не поддерживаются Bot Framework Emulator.

В следующем разделе приводится подробная информация о масштабируемости и производительности медиа-ботов, на которые было организовано приложение.

## <a name="scalability-and-performance-considerations"></a>Рекомендации по масштабируемости и производительности

Для медиа-ботов, на которые есть приложения, требуются следующие аспекты масштабируемости и производительности:

* Для сетевых ботов, на которые есть приложения, требуется больше вычислительной и сетевой (пропускной способности), чем для ботов обмена сообщениями, что может привести к значительно более высоким эксплуатационным затратам. Разработчик медиа-бота в режиме реального времени должен тщательно измерить масштабируемость бота и убедиться, что он не принимает больше одновременных вызовов, чем он может управлять. Бот с поддержкой видео может поддерживать только одну или две одновечерные сеансы мультимедиа на ядро ЦП (при использовании "необработанных" форматов видео RGB24 или NV12).
* В настоящее время медиаплатформа в режиме реального времени не может использовать любые блоки обработки графики (GPU), доступные в VM для загрузки кодирования и декодирования видео H.264. Вместо этого код видео и декодируются в программном обеспечении на ЦП. Если GPU доступен, бот может использовать его для собственной визуализации графики, например, если бот использует 3D-графический движок.
* Экземпляр VM, на который размещен медиа-бот в режиме реального времени, должен иметь не менее 2 Ядер ЦП. Для Azure рекомендуется использовать виртуальную машину серии Dv2. Для других типов VM Azure требуется минимальный размер системы с четырьмя виртуальными процессорами (vCPU). Подробные сведения о типах VM Azure доступны в [документации Azure](/azure/virtual-machines/windows/sizes-general).

## <a name="code-sample"></a>Пример кода

Примеры медийных ботов, на которые организовано приложение, следуют следующим образом:

| **Название примера** | **Описание** | **Microsoft Graph** |
|------------|-------------|-----------|
| Пример локального мультимедиа | Примеры, иллюстрирующие различные локальные сценарии мультимедиа. | [Просмотр](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/LocalMediaSamples) |
| Пример удаленного мультимедиа | Примеры, иллюстрирующие различные сценарии удаленного мультимедиа. | [Просмотр](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/RemoteMediaSamples) |

## <a name="next-step"></a>Следующий этап

> [!div class="nextstepaction"]
> [Поддерживаемые форматы медиа](~/resources/media-formats.md)

## <a name="see-also"></a>См. также

* [Graph документация по SDK](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/)
* Боты требуют больше вычислительной и сетевой пропускной способности, чем боты обмена сообщениями, и понести значительно более высокие эксплуатационные затраты. Разработчик медиа-бота в режиме реального времени должен тщательно измерить масштабируемость бота и убедиться, что он не принимает больше одновременных вызовов, чем он может управлять. Бот с поддержкой видео может поддерживать только один или два одновечерных сеансов мультимедиа на ядро ЦП при использовании необработанных форматов видео RGB24 или NV12.
* В настоящее время медиаплатформа в режиме реального времени не может использовать любые блоки обработки графики (GPU), доступные на VM для загрузки видео кодирования или декодирования H.264. Вместо этого код видео и декодируются в программном обеспечении на ЦП. Если GPU доступен, бот использует его для собственной визуализации графики, например, если бот использует 3D-графический движок.
* Экземпляр VM, на который размещен медиа-бот в режиме реального времени, должен иметь не менее 2 Ядер ЦП. Для Azure рекомендуется использовать виртуальную машину серии Dv2. Для других типов VM Azure требуется минимальный размер системы с 4 виртуальными процессорами (vCPU). Дополнительные сведения о типах VM Azure см. в [документации Azure](/azure/virtual-machines/windows/sizes-general).

В следующем разделе приводится пример, иллюстрирующие различные локальные сценарии мультимедиа.

## <a name="samples-and-additional-resources"></a>Примеры и дополнительные ресурсы

* [Пример приложений](https://github.com/microsoftgraph/microsoft-graph-comms-samples/tree/master/Samples/V1.0Samples/LocalMediaSamples)
* [Graph для вызова документации по SDK](https://microsoftgraph.github.io/microsoft-graph-comms-samples/docs/)
