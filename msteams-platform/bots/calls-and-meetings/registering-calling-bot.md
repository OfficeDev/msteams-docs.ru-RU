---
title: Бот регистрации вызовов и собраний для Microsoft Teams
description: Узнайте, как зарегистрировать новый бот аудио- и видеозвонков для Microsoft Teams
ms.topic: conceptual
localization_priority: Normal
keywords: вызов средства аудио- и видеосвязи бота
ms.openlocfilehash: a11350a3c5bae0b2eb3a36b9e1233ed92e1705c8
ms.sourcegitcommit: 825abed2f8784d2bab7407ba7a4455ae17bbd28f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2021
ms.locfileid: "52020150"
---
# <a name="register-calls-and-meetings-bot-for-microsoft-teams"></a>Бот регистрации вызовов и собраний для Microsoft Teams

Бот, который участвует в аудио- или видеозвонков и собраниях в Интернете, является обычным ботом Microsoft Teams со следующими дополнительными функциями, используемыми для регистрации бота:

* Существует новая версия манифеста приложения Teams с двумя дополнительными настройками и `supportsCalling` `supportsVideo` . Эти параметры включены в предварительную [версию](../../resources/dev-preview/developer-preview-intro.md) манифеста приложения Teams для разработчика.
* [Разрешения Microsoft Graph должны](./registering-calling-bot.md#add-graph-permissions) быть настроены для microsoft App ID вашего бота.
* Для звонков graph и разрешений API собраний в Интернете требуется согласие администратора клиента.

## <a name="new-manifest-settings"></a>Новые параметры манифеста

У ботов вызовов и сетевых собраний есть следующие два дополнительных параметра в manifest.js, которые позволяют аудио или видео для вашего бота в Teams.

* `bots[0].supportsCalling`. Если вы присутствуете и настроены, Teams позволяет боту участвовать в `true` звонках и собраниях в Интернете.
* `bots[0].supportsVideo`. Если присутствует и `true` установлено, teams знает, что ваш бот поддерживает видео.

Если вы хотите, чтобы ваш IDE правильно manifest.jsсхему для бота вызовов и собраний для этих значений, вы можете изменить атрибут следующим `$schema` образом:

```json
"$schema": "https://raw.githubusercontent.com/OfficeDev/microsoft-teams-app-schema/preview/DevPreview/MicrosoftTeams.schema.json",
```

В следующем разделе вы можете создать новый бот или добавить возможности вызова к существующему боту.

## <a name="create-new-bot-or-add-calling-capabilities"></a>Создание нового бота или добавление возможностей вызова

Сведения о создании ботов см. в [сайте Create a bot for Teams.](../how-to/create-a-bot-for-teams.md)

**Создание нового бота для Teams**

1. Используйте эту ссылку для создания нового `https://dev.botframework.com/bots/new` бота. Кроме того, если вы выберите кнопку **Создание** бота на портале Bot Framework, вы создайте бот в Microsoft Azure, для которого должна быть учетная запись Azure.
1. Добавьте канал Teams.
1. Выберите **вкладку Вызов** на странице канала Teams. Выберите **Включить вызов,** а затем обновить **веб-ок (для вызова)** с URL-адресом HTTPS, где вы получаете входящие уведомления, например `https://contoso.com/teamsapp/api/calling` . Дополнительные сведения см. [в настройках каналов.](/bot-framework/portal-configure-channels)

    ![Настройка сведений о канале Teams](~/assets/images/calls-and-meetings/configure-msteams-channel.png)

В следующем разделе приводится список разрешений приложений, поддерживаемых для звонков и собраний в Интернете.

## <a name="add-graph-permissions"></a>Добавление разрешений Graph

Граф предоставляет гранулярные разрешения для управления доступом приложений к ресурсам. Вы решаете, какие разрешения для графа ваших запросов приложения. API-интерфейсы для вызовов Graph поддерживают разрешения приложений, которые используются приложениями, которые работают без приписаного пользователя. Администратор клиента должен предоставить согласие на разрешения приложений.

### <a name="application-permissions-for-calls"></a>Разрешения приложения для звонков

В следующей таблице приводится список разрешений приложений для звонков:

|Разрешение    |Отображение строки   |Описание |Требуется согласие администратора |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
| Calls.Initiate.All |Инициировать исходяющие вызовы 1:1 из предварительного просмотра приложения. |Позволяет приложению совершать исходящие звонки одному пользователю и передавать звонки пользователям из каталога вашей организации без необходимости входа пользователя.|Да|
| Calls.InitiateGroupCall.All |Инициировать исходяние групповых вызовов из предварительного просмотра приложения. |Позволяет приложению совершать исходящие звонки нескольким пользователям и добавлять участников в собрания в организации без необходимости входа пользователя.|Да|
| Calls.JoinGroupCall.All |Регистрация групповых звонков и собраний в качестве предварительного просмотра приложения. |Позволяет приложению присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя. Приложение присоединяется к привилегиям пользователя каталога к собраниям в клиенте.|Да|
| Calls.JoinGroupCallasGuest.All |Регистрация групповых звонков и собраний в качестве гостевого предварительного просмотра. |Позволяет приложению анонимно присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя. Приложение присоединяется в качестве гостя к собраниям в клиенте.|Да|
| Calls.AccessMedia.All |Доступ к медиапотокам в вызове в качестве предварительного просмотра приложения. |Позволяет приложению получить прямой доступ к потокам мультимедиа в ходе звонка без необходимости входа пользователя.|Да|

> [!IMPORTANT]
> Нельзя использовать API доступа к мультимедиа для записи или иного сохраняемой медиаконтента из звонков или собраний, которые ваше приложение получает или извлекает данные из записи или записи контента мультимедиа. Сначала необходимо вызвать [ `updateRecordingStatus` API,](/graph/api/call-updaterecordingstatus) чтобы указать, что запись началась, и получить ответ на успех из этого API. Если ваше приложение начинает записывать любое собрание или вызов, оно должно закончить запись перед вызовом API, чтобы указать, что `updateRecordingStatus` запись завершена.

### <a name="application-permissions-for-online-meetings"></a>Разрешения приложений для собраний в Интернете

В следующей таблице приводится список разрешений приложений для собраний в Интернете:

|Разрешение    |Отображение строки   |Описание |Требуется согласие администратора |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
| OnlineMeetings.Read.All |Чтение сведений о собраниях в Интернете из предварительного просмотра приложения|Позволяет приложению читать сведения о собраниях в интернете в организации без участия пользователя.|Да|
| OnlineMeetings.ReadWrite.All |Чтение и создание собраний в Интернете из предварительного просмотра приложения от имени пользователя|Позволяет приложению создавать онлайн-собрания в организации от имени пользователя без подписаного пользователя.|Да|

### <a name="assign-permissions"></a>Назначение разрешений

Чтобы использовать конечную точку [V1 Azure Active Directory (AAD),](/azure/active-directory/develop/azure-ad-endpoint-comparison)необходимо заранее настроить разрешения приложений для бота с помощью портала [Azure.](https://aka.ms/aadapplist)

### <a name="get-tenant-administrator-consent"></a>Получить согласие администратора клиента

Для приложений, использующих конечную точку AAD V1, администратор клиента может дать согласие на разрешения приложений с помощью портала [Azure](https://portal.azure.com) при установке приложения в организации. Кроме того, вы можете предоставить в приложении возможность регистрации, с помощью которой администраторы могут дать согласие на настроенные разрешения. После записи согласия администратора AAD приложение может запрашивать маркеры без повторного запроса согласия.

Вы можете использовать администратора для предоставления разрешений, необходимых вашему приложению на [портале Azure.](https://portal.azure.com) Лучшим вариантом является предоставление администраторам возможности регистрации с помощью конечной точки AAD `/adminconsent` V2. Дополнительные сведения см. [в инструкции по построению URL-адреса согласия администратора.](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent)

> [!NOTE]
> Чтобы создать URL-адрес согласия администратора клиента, необходимо настроить [](https://apps.dev.microsoft.com/) URI перенаправления или url-адрес ответа на портале регистрации приложений. Чтобы добавить URL-адреса ответов для бота, выберите Манифест приложения **для** редактирования дополнительных  >  параметров. Добавьте URL-адрес перенаправления в `replyUrls` коллекцию.

> [!IMPORTANT]
> В любое время, когда вы внося изменения в разрешения приложения, необходимо также повторить процесс согласия администратора. Изменения, внесенные на портале регистрации приложений, не отражаются до повторного получения согласия администратором клиента.

## <a name="next-step"></a>Следующий шаг

> [!div class="nextstepaction"]
> [Уведомления о входящих звонках](~/bots/calls-and-meetings/call-notifications.md)
