---
title: Регистрация абонентского абонента и ленты для Microsoft Teams
description: Сведения о регистрации нового телефонного и видеоабонента для Microsoft Teams
keywords: вызов медиа-данных аудио-и видеороликов Bot
ms.openlocfilehash: 9a246c9b1a5aae230881b468afef6c205d5bdecf
ms.sourcegitcommit: fdcd91b270d4c2e98ab2b2c1029c76c49bb807fa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "44801204"
---
# <a name="registering-a-calling-bot-for-microsoft-teams"></a><span data-ttu-id="374ee-104">Регистрация абонентской ленты для Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="374ee-104">Registering a calling bot for Microsoft Teams</span></span>

<span data-ttu-id="374ee-105">Робот, который участвует в аудио-и видеовызовах и собраниях по сети, — это обычный робот Microsoft Teams с несколькими дополнительными функциями:</span><span class="sxs-lookup"><span data-stu-id="374ee-105">A bot that participates in audio/video calls and online meetings is an ordinary Microsoft Teams bot with a few extra features:</span></span>

* <span data-ttu-id="374ee-106">Существует новая версия манифеста приложения Teams с двумя дополнительными параметрами `supportsCalling` и `supportsVideo` .</span><span class="sxs-lookup"><span data-stu-id="374ee-106">There's a new version of the Teams app manifest with two additional settings, `supportsCalling` and `supportsVideo`.</span></span> <span data-ttu-id="374ee-107">Эти параметры включены в [предварительную](../../resources/dev-preview/developer-preview-intro.md) версию манифеста приложения Microsoft Teams для разработчиков.</span><span class="sxs-lookup"><span data-stu-id="374ee-107">These settings are included in the [Developer Preview](../../resources/dev-preview/developer-preview-intro.md) version of the Microsoft Teams app manifest.</span></span>
* <span data-ttu-id="374ee-108">[Разрешения Microsoft Graph](./registering-calling-bot.md#add-microsoft-graph-permissions) должны быть настроены для идентификатора приложения почтовой компании.</span><span class="sxs-lookup"><span data-stu-id="374ee-108">[Microsoft Graph permissions](./registering-calling-bot.md#add-microsoft-graph-permissions) must be configured for your bot's Microsoft App ID.</span></span>
* <span data-ttu-id="374ee-109">Разрешения API для вызовов Microsoft Graph и онлайн-собраний требуют согласия администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="374ee-109">The Microsoft Graph calls and online meetings APIs permissions require tenant admin consent.</span></span>

<span data-ttu-id="374ee-110">Рассмотрим более подробное описание.</span><span class="sxs-lookup"><span data-stu-id="374ee-110">Let's discuss the above in more detail.</span></span>

## <a name="new-manifest-settings"></a><span data-ttu-id="374ee-111">Новые параметры манифеста</span><span class="sxs-lookup"><span data-stu-id="374ee-111">New manifest settings</span></span>

<span data-ttu-id="374ee-112">Звонки и собрания по сети боты имеют два дополнительных параметра в manifest.js, позволяющих использовать звук и видео для ленты в Teams.</span><span class="sxs-lookup"><span data-stu-id="374ee-112">Calling and online meetings bots have two additional settings in the manifest.json that enable audio/video for your bot in Teams.</span></span>

* <span data-ttu-id="374ee-113">`bots[0].supportsCalling`.</span><span class="sxs-lookup"><span data-stu-id="374ee-113">`bots[0].supportsCalling`.</span></span> <span data-ttu-id="374ee-114">Если этот параметр указан и имеет значение `true` , Teams позволит ему участвовать в звонках и собраниях по сети.</span><span class="sxs-lookup"><span data-stu-id="374ee-114">If present and set to `true`, Teams will allow your bot to participate in calls and online meetings.</span></span>
* <span data-ttu-id="374ee-115">`bots[0].supportsVideo`.</span><span class="sxs-lookup"><span data-stu-id="374ee-115">`bots[0].supportsVideo`.</span></span> <span data-ttu-id="374ee-116">Если задано значение `true` , Teams знают, что ваш Bot поддерживает видео.</span><span class="sxs-lookup"><span data-stu-id="374ee-116">If present and set to `true`, Teams knows that your bot supports video.</span></span>

<span data-ttu-id="374ee-117">Если вы хотите, чтобы ваша среда разработки правильно проверяла manifest.jsсхемы для абонента и робота для этих значений, можно изменить `$schema` атрибут следующим образом:</span><span class="sxs-lookup"><span data-stu-id="374ee-117">If you want your IDE to properly validate the manifest.json schema for your calling and meeting bot for these values, you can change the `$schema` attribute as follows:</span></span>

```json
"$schema": "https://raw.githubusercontent.com/OfficeDev/microsoft-teams-app-schema/preview/DevPreview/MicrosoftTeams.schema.json",
```

## <a name="creating-a-new-bot-or-adding-calling-capabilities-to-an-existing-bot"></a><span data-ttu-id="374ee-118">Создание нового робота или добавление возможностей звонков к существующему интерфейсу Bot</span><span class="sxs-lookup"><span data-stu-id="374ee-118">Creating a new bot or adding calling capabilities to an existing bot</span></span>

<span data-ttu-id="374ee-119">Создание нового элемента Bot подробно описано в разделе [Создание ленты Microsoft Teams](../how-to/create-a-bot-for-teams.md) , но мы будем повторять некоторые из них здесь:</span><span class="sxs-lookup"><span data-stu-id="374ee-119">Creating a new bot is covered in more detail in the [Create a bot for Microsoft Teams](../how-to/create-a-bot-for-teams.md) topic, but we'll repeat some of it here:</span></span>

1. <span data-ttu-id="374ee-120">Используйте эту ссылку для создания нового элемента Bot: `https://dev.botframework.com/bots/new` .</span><span class="sxs-lookup"><span data-stu-id="374ee-120">Use this link to create a new bot: `https://dev.botframework.com/bots/new`.</span></span> <span data-ttu-id="374ee-121">Если вместо этого нажать кнопку *создать на* портале Bot Framework, вы создадите ее в Microsoft Azure, для которой вам потребуется учетная запись Azure.</span><span class="sxs-lookup"><span data-stu-id="374ee-121">If, instead,  you select the *Create a bot* button in the Bot Framework portal, you will create your bot in Microsoft Azure, for which you'll need an Azure account.</span></span>
1. <span data-ttu-id="374ee-122">Добавьте канал Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="374ee-122">Add the Microsoft Teams channel.</span></span> <span data-ttu-id="374ee-123">Перейдите на вкладку "вызов" на странице канала Microsoft Teams и выберите пункт **разрешить вызов**, а затем обновите веб- **перехватчик (для вызова)** , УКАЗАВ URL-адрес HTTPS, на который вы будете получать входящие уведомления, например `https://contoso.com/teamsapp/api/calling` .</span><span class="sxs-lookup"><span data-stu-id="374ee-123">Click on the "Calling" tab on the Microsoft Teams channel page and select **Enable calling**, and then update **Webhook (for calling)** with your HTTPS URL where you will receive incoming notifications, e.g.`https://contoso.com/teamsapp/api/calling`.</span></span> <span data-ttu-id="374ee-124">Для получения дополнительных сведений о настройке каналов обратитесь к разделу [Настройка каналов](/bot-framework/portal-configure-channels) .</span><span class="sxs-lookup"><span data-stu-id="374ee-124">Refer to [Configuring Channels](/bot-framework/portal-configure-channels) for more information on how to configure channels.</span></span>
  <span data-ttu-id="374ee-125">![Настройка сведений о канале Microsoft Teams](~/assets/images/calls-and-meetings/configure-msteams-channel.png)</span><span class="sxs-lookup"><span data-stu-id="374ee-125">![Configure Microsoft Teams channel information](~/assets/images/calls-and-meetings/configure-msteams-channel.png)</span></span>

## <a name="add-microsoft-graph-permissions"></a><span data-ttu-id="374ee-126">Добавление разрешений Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="374ee-126">Add Microsoft Graph permissions</span></span>

<span data-ttu-id="374ee-127">Microsoft Graph предоставляет детальные разрешения, контролирующие доступ приложений к ресурсам.</span><span class="sxs-lookup"><span data-stu-id="374ee-127">Microsoft Graph exposes granular permissions controlling the access that apps have to resources.</span></span> <span data-ttu-id="374ee-128">Вы как разработчик указываете, какие разрешения для Microsoft Graph должно запрашивать ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="374ee-128">As a developer, you decide which permissions for Microsoft Graph your app requests.</span></span>  <span data-ttu-id="374ee-129">API вызовов Microsoft Graph поддерживают _разрешения приложений_, которые используются приложениями, которые запускаются без вошедшего пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-129">The Microsoft Graph Calling APIs support _Application permissions_, which are used by apps that run without a signed-in user present.</span></span>  <span data-ttu-id="374ee-130">Администратор клиента должен предоставить согласие на разрешения приложения.</span><span class="sxs-lookup"><span data-stu-id="374ee-130">A tenant administrator must grant consent to application permissions.</span></span> <span data-ttu-id="374ee-131">Ниже приведен список этих разрешений.</span><span class="sxs-lookup"><span data-stu-id="374ee-131">Below is a list of those permissions:</span></span>

### <a name="application-permissions-calls"></a><span data-ttu-id="374ee-132">Разрешения приложения: звонки</span><span class="sxs-lookup"><span data-stu-id="374ee-132">Application permissions: calls</span></span>

|<span data-ttu-id="374ee-133">Разрешение</span><span class="sxs-lookup"><span data-stu-id="374ee-133">Permission</span></span>    |<span data-ttu-id="374ee-134">Отображаемая строка</span><span class="sxs-lookup"><span data-stu-id="374ee-134">Display String</span></span>   |<span data-ttu-id="374ee-135">Описание</span><span class="sxs-lookup"><span data-stu-id="374ee-135">Description</span></span> |<span data-ttu-id="374ee-136">Необходимость в согласии администратора</span><span class="sxs-lookup"><span data-stu-id="374ee-136">Admin Consent Required</span></span> |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
|<span data-ttu-id="374ee-137">_Calls.Initiate.All_</span><span class="sxs-lookup"><span data-stu-id="374ee-137">_Calls.Initiate.All_</span></span>|<span data-ttu-id="374ee-138">Запуск исходящих звонков 1:1 из приложения (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="374ee-138">Initiate outgoing 1:1 calls from the app (preview)</span></span>|<span data-ttu-id="374ee-139">Позволяет приложению совершать исходящие звонки одному пользователю и передавать звонки пользователям из каталога вашей организации без необходимости входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-139">Allows the app to place outbound calls to a single user and transfer calls to users in your organization’s directory, without a signed-in user.</span></span>|<span data-ttu-id="374ee-140">Да</span><span class="sxs-lookup"><span data-stu-id="374ee-140">Yes</span></span>|
|<span data-ttu-id="374ee-141">_Calls.InitiateGroupCall.All_</span><span class="sxs-lookup"><span data-stu-id="374ee-141">_Calls.InitiateGroupCall.All_</span></span>|<span data-ttu-id="374ee-142">Запуск исходящих групповых звонков из приложения (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="374ee-142">Initiate outgoing group calls from the app (preview)</span></span>|<span data-ttu-id="374ee-143">Позволяет приложению совершать исходящие звонки нескольким пользователям и добавлять участников в собрания в организации без необходимости входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-143">Allows the app to place outbound calls to multiple users and add participants to meetings in your organization, without a signed-in user.</span></span>|<span data-ttu-id="374ee-144">Да</span><span class="sxs-lookup"><span data-stu-id="374ee-144">Yes</span></span>|
|<span data-ttu-id="374ee-145">_Calls.JoinGroupCall.All_</span><span class="sxs-lookup"><span data-stu-id="374ee-145">_Calls.JoinGroupCall.All_</span></span>|<span data-ttu-id="374ee-146">Присоединение к групповым звонкам и собраниям в качестве приложения (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="374ee-146">Join Group Calls and Meetings as an app (preview)</span></span>|<span data-ttu-id="374ee-147">Позволяет приложению присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-147">Allows the app to join group calls and scheduled meetings in your organization, without a signed-in user.</span></span> <span data-ttu-id="374ee-148">Приложение присоединится к собраниям в клиенте с уровнем привилегий пользователя каталога.</span><span class="sxs-lookup"><span data-stu-id="374ee-148">The app will be joined with the privileges of a directory user to meetings in your tenant.</span></span>|<span data-ttu-id="374ee-149">Да</span><span class="sxs-lookup"><span data-stu-id="374ee-149">Yes</span></span>|
|<span data-ttu-id="374ee-150">_Calls.JoinGroupCallasGuest.All_</span><span class="sxs-lookup"><span data-stu-id="374ee-150">_Calls.JoinGroupCallasGuest.All_</span></span>|<span data-ttu-id="374ee-151">Присоединение к групповым звонкам и собраниям в качестве гостя (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="374ee-151">Join Group Calls and Meetings as a guest (preview)</span></span>|<span data-ttu-id="374ee-152">Позволяет приложению анонимно присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-152">Allows the app to anonymously join group calls and scheduled meetings in your organization, without a signed-in user.</span></span> <span data-ttu-id="374ee-153">Приложение присоединится к собраниям в клиенте в качестве гостя.</span><span class="sxs-lookup"><span data-stu-id="374ee-153">The app will be joined as a guest to meetings in your tenant.</span></span>|<span data-ttu-id="374ee-154">Да</span><span class="sxs-lookup"><span data-stu-id="374ee-154">Yes</span></span>|
|<span data-ttu-id="374ee-155">_Calls. акцессмедиа. ALL_ <sup> _см_ .</sup></span><span class="sxs-lookup"><span data-stu-id="374ee-155">_Calls.AccessMedia.All_ <sup>_see below_</sup></span></span>|<span data-ttu-id="374ee-156">Доступ к потокам мультимедиа в ходе звонка в качестве приложения (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="374ee-156">Access media streams in a call as an app (preview)</span></span>|<span data-ttu-id="374ee-157">Позволяет приложению получить прямой доступ к потокам мультимедиа в ходе звонка без необходимости входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-157">Allows the app to get direct access to media streams in a call, without a signed-in user.</span></span>|<span data-ttu-id="374ee-158">Да</span><span class="sxs-lookup"><span data-stu-id="374ee-158">Yes</span></span>|

> [!IMPORTANT]
> <span data-ttu-id="374ee-159">Вы **не можете** использовать API Microsoft. Graph. Calls. Media для записи или сохранения мультимедийного контента из вызовов или собраний, к которым подают доступ Bot.</span><span class="sxs-lookup"><span data-stu-id="374ee-159">You **cannot** use the Microsoft.Graph.Calls.Media API to record or otherwise persist media content from calls or meetings that your bot accesses.</span></span>

### <a name="application-permissions-online-meetings"></a><span data-ttu-id="374ee-160">Разрешения приложений: собрания по сети</span><span class="sxs-lookup"><span data-stu-id="374ee-160">Application permissions: online meetings</span></span>

|<span data-ttu-id="374ee-161">Разрешение</span><span class="sxs-lookup"><span data-stu-id="374ee-161">Permission</span></span>    |<span data-ttu-id="374ee-162">Отображаемая строка</span><span class="sxs-lookup"><span data-stu-id="374ee-162">Display String</span></span>   |<span data-ttu-id="374ee-163">Описание</span><span class="sxs-lookup"><span data-stu-id="374ee-163">Description</span></span> |<span data-ttu-id="374ee-164">Необходимость в согласии администратора</span><span class="sxs-lookup"><span data-stu-id="374ee-164">Admin Consent Required</span></span> |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
|<span data-ttu-id="374ee-165">_OnlineMeetings.Read.All_</span><span class="sxs-lookup"><span data-stu-id="374ee-165">_OnlineMeetings.Read.All_</span></span>|<span data-ttu-id="374ee-166">Чтение сведений собрания по сети из приложения (предварительная версия)</span><span class="sxs-lookup"><span data-stu-id="374ee-166">Read Online Meeting details from the app (preview)</span></span>|<span data-ttu-id="374ee-167">Позволяет приложению считывать сведения собрания по сети в организации без необходимости входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-167">Allows the app to read Online Meeting details in your organization, without a signed-in user.</span></span>|<span data-ttu-id="374ee-168">Да</span><span class="sxs-lookup"><span data-stu-id="374ee-168">Yes</span></span>|
|<span data-ttu-id="374ee-169">_OnlineMeetings.ReadWrite.All_</span><span class="sxs-lookup"><span data-stu-id="374ee-169">_OnlineMeetings.ReadWrite.All_</span></span>|<span data-ttu-id="374ee-170">Чтение и создание собраний по сети из приложения (предварительная версия) от имени пользователя</span><span class="sxs-lookup"><span data-stu-id="374ee-170">Read and Create Online Meetings from the app (preview) on behalf of a user</span></span>|<span data-ttu-id="374ee-171">Позволяет приложению создавать собрания по сети в организации от имени пользователя без необходимости входа пользователя.</span><span class="sxs-lookup"><span data-stu-id="374ee-171">Allows the app to create Online Meetings in your organization on behalf of a user, without a signed-in user.</span></span>|<span data-ttu-id="374ee-172">Да</span><span class="sxs-lookup"><span data-stu-id="374ee-172">Yes</span></span>|

### <a name="assigning-permissions"></a><span data-ttu-id="374ee-173">Назначение разрешений</span><span class="sxs-lookup"><span data-stu-id="374ee-173">Assigning permissions</span></span>

<span data-ttu-id="374ee-174">Необходимо предварительно настроить разрешения приложения для ленты.</span><span class="sxs-lookup"><span data-stu-id="374ee-174">You must configure the application permissions for your bot in advance.</span></span> <span data-ttu-id="374ee-175">Мы рекомендуем использовать [портал регистрации приложений (Майкрософт](https://apps.dev.microsoft.com/) ), как описано [здесь](/graph/docs/concepts/auth_register_app_v2) , так как в этом случае вы настроили ваш Bot; Тем не менее, вы по-прежнему можете использовать [портал Azure](https://aka.ms/aadapplist) , если вы предпочитаете использовать [конечную точку Azure AD](/azure/active-directory/develop/azure-ad-endpoint-comparison)версии 1.</span><span class="sxs-lookup"><span data-stu-id="374ee-175">We recommend using the [Microsoft App Registration Portal](https://apps.dev.microsoft.com/) as described [here](/graph/docs/concepts/auth_register_app_v2) because that's where your bot was configured; however, you can still use the [Azure portal](https://aka.ms/aadapplist) if you prefer to use the [Azure AD V1 endpoint](/azure/active-directory/develop/azure-ad-endpoint-comparison).</span></span>

### <a name="getting-tenant-administrator-consent"></a><span data-ttu-id="374ee-176">Обеспечение согласия администратора клиента</span><span class="sxs-lookup"><span data-stu-id="374ee-176">Getting tenant administrator consent</span></span>

<span data-ttu-id="374ee-177">Для приложений, использующих конечную точку Azure AD версии 1, администратор клиента может согласиться с разрешениями приложения с помощью [портала Azure](https://portal.azure.com) , если приложение установлено в Организации, или вы можете предоставить возможность регистрации в приложении, через которую администраторы могут предоставить разрешения, настроенные вами.</span><span class="sxs-lookup"><span data-stu-id="374ee-177">For apps using the Azure AD V1 endpoint, a tenant administrator can consent to the application permissions using the [Azure portal](https://portal.azure.com) when your app is installed in their organization, or you can provide a sign-up experience in your app through which administrators can consent to the permissions you configured.</span></span> <span data-ttu-id="374ee-178">После регистрации согласия администратора в Azure AD ваше приложение может запросить маркеры без необходимости повторного запроса согласия.</span><span class="sxs-lookup"><span data-stu-id="374ee-178">Once administrator consent is recorded by Azure AD, your app can request tokens without having to request consent again.</span></span>

<span data-ttu-id="374ee-179">Вы можете использовать администратора для предоставления необходимых разрешений для приложения на [портале Azure](https://portal.azure.com); Тем не менее, часто лучше обеспечить возможность регистрации администраторов с помощью конечной точки Azure AD v2 `/adminconsent` .</span><span class="sxs-lookup"><span data-stu-id="374ee-179">You can rely on an administrator to grant the permissions your app needs at the [Azure portal](https://portal.azure.com); though, often a better option is to provide a sign-up experience for administrators by using the Azure AD V2 `/adminconsent` endpoint.</span></span>  <span data-ttu-id="374ee-180">Ознакомьтесь с [инструкциями по созданию URL-адреса согласия администратора](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent) для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="374ee-180">Please refer to the [instructions on constructing an Admin Consent URL](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent) for more information.</span></span>

> [!NOTE]
> <span data-ttu-id="374ee-181">Для создания URL-адреса согласия администратора клиента требуется настроенный URL-адрес перенаправления/ответа на [портале регистрации приложений](https://apps.dev.microsoft.com/).</span><span class="sxs-lookup"><span data-stu-id="374ee-181">Constructing the Tenant Admin Consent URL requires a configured Redirect URI/Reply URL in the [App Registration Portal](https://apps.dev.microsoft.com/).</span></span> <span data-ttu-id="374ee-182">Чтобы добавить URL-адреса ответа для почтового клиента, откройте регистрацию Bot и выберите Дополнительные параметры-> изменить манифест приложения.</span><span class="sxs-lookup"><span data-stu-id="374ee-182">To add reply URLs for your bot, access your bot registration, choose Advanced Options -> Edit Application Manifest.</span></span>  <span data-ttu-id="374ee-183">Добавьте URL-адрес перенаправления в `replyUrls` коллекцию.</span><span class="sxs-lookup"><span data-stu-id="374ee-183">Add your Redirect URL to the `replyUrls` collection.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="374ee-184">Когда вы вносите изменения в разрешения приложения, необходимо также повторить процесс разрешения администратора.</span><span class="sxs-lookup"><span data-stu-id="374ee-184">Anytime you make a change to your application's permissions, you must also repeat the Admin Consent process.</span></span> <span data-ttu-id="374ee-185">Изменения, внесенные на портале регистрации приложений, не вступят в силу, пока их не подтвердит администратор клиента.</span><span class="sxs-lookup"><span data-stu-id="374ee-185">Changes made in the app registration portal will not be reflected until consent has been reapplied by the tenant's administrator.</span></span>
