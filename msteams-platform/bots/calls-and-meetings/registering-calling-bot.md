---
title: Регистрация абонентского абонента и ленты для Microsoft Teams
description: Сведения о регистрации нового телефонного и видеоабонента для Microsoft Teams
keywords: вызов медиа-данных аудио-и видеороликов Bot
ms.openlocfilehash: d38b9584440bcff664bd3a2d4b57e52bc695f1b5
ms.sourcegitcommit: 64acd30eee8af5fe151e9866c13226ed3f337c72
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/18/2020
ms.locfileid: "49346849"
---
# <a name="register-a-calling-bot-for-microsoft-teams"></a>Регистрация абонентской ленты для Microsoft Teams

Робот, который участвует в аудио-и видеовызовах и собраниях по сети, — это обычный робот Microsoft Teams с несколькими дополнительными функциями:

* Существует новая версия манифеста приложения Teams с двумя дополнительными параметрами `supportsCalling` и `supportsVideo` . Эти параметры включены в [предварительную](../../resources/dev-preview/developer-preview-intro.md) версию манифеста приложения Microsoft Teams для разработчиков.
* [Разрешения Microsoft Graph](./registering-calling-bot.md#add-microsoft-graph-permissions) должны быть настроены для идентификатора приложения почтовой компании.
* Разрешения API для вызовов Microsoft Graph и онлайн-собраний требуют согласия администратора клиента.

Рассмотрим более подробное описание.

## <a name="new-manifest-settings"></a>Новые параметры манифеста

Звонки и собрания по сети боты имеют два дополнительных параметра в manifest.js, позволяющих использовать звук и видео для ленты в Teams.

* `bots[0].supportsCalling`. Если этот параметр указан и имеет значение `true` , Teams позволит ему участвовать в звонках и собраниях по сети.
* `bots[0].supportsVideo`. Если задано значение `true` , Teams знают, что ваш Bot поддерживает видео.

Если вы хотите, чтобы ваша среда разработки правильно проверяла manifest.jsсхемы для абонента и робота для этих значений, можно изменить `$schema` атрибут следующим образом:

```json
"$schema": "https://raw.githubusercontent.com/OfficeDev/microsoft-teams-app-schema/preview/DevPreview/MicrosoftTeams.schema.json",
```

## <a name="creating-a-new-bot-or-adding-calling-capabilities-to-an-existing-bot"></a>Создание нового робота или добавление возможностей звонков к существующему интерфейсу Bot

Создание нового элемента Bot подробно описано в разделе [Создание ленты Microsoft Teams](../how-to/create-a-bot-for-teams.md) , но мы будем повторять некоторые из них здесь:

1. Используйте эту ссылку для создания нового элемента Bot: `https://dev.botframework.com/bots/new` . Если вместо этого нажать кнопку *создать на* портале Bot Framework, вы создадите ее в Microsoft Azure, для которой вам потребуется учетная запись Azure.
1. Добавьте канал Microsoft Teams. Перейдите на вкладку "вызов" на странице канала Microsoft Teams и выберите пункт **разрешить вызов**, а затем обновите веб- **перехватчик (для вызова)** , УКАЗАВ URL-адрес HTTPS, на который вы будете получать входящие уведомления, например `https://contoso.com/teamsapp/api/calling` . Для получения дополнительных сведений о настройке каналов обратитесь к разделу [Настройка каналов](/bot-framework/portal-configure-channels) .
  ![Настройка сведений о канале Microsoft Teams](~/assets/images/calls-and-meetings/configure-msteams-channel.png)

## <a name="add-microsoft-graph-permissions"></a>Добавление разрешений Microsoft Graph

Microsoft Graph предоставляет детальные разрешения, контролирующие доступ приложений к ресурсам. Вы как разработчик указываете, какие разрешения для Microsoft Graph должно запрашивать ваше приложение.  API вызовов Microsoft Graph поддерживают _разрешения приложений_, которые используются приложениями, которые запускаются без вошедшего пользователя.  Администратор клиента должен предоставить согласие на разрешения приложения. Ниже приведен список этих разрешений.

### <a name="application-permissions-calls"></a>Разрешения приложения: звонки

|Разрешение    |Отображаемая строка   |Описание |Необходимость в согласии администратора |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
|_Calls.Initiate.All_|Запуск исходящих звонков 1:1 из приложения (предварительная версия)|Позволяет приложению совершать исходящие звонки одному пользователю и передавать звонки пользователям из каталога вашей организации без необходимости входа пользователя.|Да|
|_Calls.InitiateGroupCall.All_|Запуск исходящих групповых звонков из приложения (предварительная версия)|Позволяет приложению совершать исходящие звонки нескольким пользователям и добавлять участников в собрания в организации без необходимости входа пользователя.|Да|
|_Calls.JoinGroupCall.All_|Присоединение к групповым звонкам и собраниям в качестве приложения (предварительная версия)|Позволяет приложению присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя. Приложение присоединится к собраниям в клиенте с уровнем привилегий пользователя каталога.|Да|
|_Calls.JoinGroupCallasGuest.All_|Присоединение к групповым звонкам и собраниям в качестве гостя (предварительная версия)|Позволяет приложению анонимно присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя. Приложение присоединится к собраниям в клиенте в качестве гостя.|Да|
|_Calls. акцессмедиа. ALL_ <sup> _см_ .</sup>|Доступ к потокам мультимедиа в ходе звонка в качестве приложения (предварительная версия)|Позволяет приложению получить прямой доступ к потокам мультимедиа в ходе звонка без необходимости входа пользователя.|Да|

> [!IMPORTANT]
> Вы **не можете** использовать API Microsoft. Graph. Calls. Media для записи или сохранения мультимедийного контента из вызовов или собраний, к которым подают доступ Bot.

### <a name="application-permissions-online-meetings"></a>Разрешения приложений: собрания по сети

|Разрешение    |Отображаемая строка   |Описание |Необходимость в согласии администратора |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
|_OnlineMeetings.Read.All_|Чтение сведений собрания по сети из приложения (предварительная версия)|Позволяет приложению считывать сведения собрания по сети в организации без необходимости входа пользователя.|Да|
|_OnlineMeetings.ReadWrite.All_|Чтение и создание собраний по сети из приложения (предварительная версия) от имени пользователя|Позволяет приложению создавать собрания по сети в организации от имени пользователя без необходимости входа пользователя.|Да|

### <a name="assigning-permissions"></a>Назначение разрешений

Чтобы использовать [конечную точку Azure AD](/azure/active-directory/develop/azure-ad-endpoint-comparison)версии 1, необходимо предварительно настроить разрешения на доступ к приложениям для пользователя Bot с помощью [портала Azure](https://aka.ms/aadapplist) .

### <a name="getting-tenant-administrator-consent"></a>Обеспечение согласия администратора клиента

Для приложений, использующих конечную точку Azure AD версии 1, администратор клиента может согласиться с разрешениями приложения с помощью [портала Azure](https://portal.azure.com) , если приложение установлено в Организации, или вы можете предоставить возможность регистрации в приложении, через которую администраторы могут предоставить разрешения, настроенные вами. После регистрации согласия администратора в Azure AD ваше приложение может запросить маркеры без необходимости повторного запроса согласия.

Вы можете использовать администратора для предоставления необходимых разрешений для приложения на [портале Azure](https://portal.azure.com); Тем не менее, часто лучше обеспечить возможность регистрации администраторов с помощью конечной точки Azure AD v2 `/adminconsent` .  Ознакомьтесь с [инструкциями по созданию URL-адреса согласия администратора](https://developer.microsoft.com/graph/docs/concepts/auth_v2_service#3-get-administrator-consent) для получения дополнительных сведений.

> [!NOTE]
> Для создания URL-адреса согласия администратора клиента требуется настроенный URL-адрес перенаправления/ответа на [портале регистрации приложений](https://apps.dev.microsoft.com/). Чтобы добавить URL-адреса ответа для почтового клиента, откройте регистрацию Bot и выберите Дополнительные параметры-> изменить манифест приложения.  Добавьте URL-адрес перенаправления в `replyUrls` коллекцию.

> [!IMPORTANT]
> Когда вы вносите изменения в разрешения приложения, необходимо также повторить процесс разрешения администратора. Изменения, внесенные на портале регистрации приложений, не вступят в силу, пока их не подтвердит администратор клиента.
