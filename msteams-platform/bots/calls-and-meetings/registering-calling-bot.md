---
title: Регистрация вызовов и собраний бота для Microsoft Teams
description: Узнайте, как зарегистрировать новый бот аудио- и видеозвонков для Microsoft Teams, создать новый бот или добавить функцию вызова, а также добавить разрешения на график.
ms.topic: conceptual
ms.localizationpriority: medium
keywords: вызов средства аудио- и видеосвязи бота
ms.openlocfilehash: 144e623ea21da51b8a06bf20f50a60345dda081a
ms.sourcegitcommit: af1d0a4041ce215e7863ac12c71b6f1fa3e3ba81
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2021
ms.locfileid: "60889106"
---
# <a name="register-calls-and-meetings-bot-for-microsoft-teams"></a>Регистрация вызовов и собраний бота для Microsoft Teams

Бот, который участвует в аудио- или видеозвонков и собраниях в Интернете, является обычным Microsoft Teams ботом со следующими дополнительными функциями, используемыми для регистрации бота:

* Существует новая версия манифеста Teams с двумя дополнительными настройками и `supportsCalling` `supportsVideo` . Эти параметры включены в [](../../resources/dev-preview/developer-preview-intro.md) предварительную версию манифеста Teams разработчика.
* [Разрешения Graph](./registering-calling-bot.md#add-graph-permissions) Microsoft должны быть настроены для microsoft App ID вашего бота.
* Разрешения Graph и разрешений API собраний в Интернете требуют согласия администратора клиента.

## <a name="new-manifest-settings"></a>Новые параметры манифеста

Боты вызовов и сетевых собраний имеют следующие два дополнительных параметра в manifest.json, которые позволяют аудио или видео для вашего бота в Teams.

* `bots[0].supportsCalling`. Если вы присутствуете и Teams позволяет вашему боту участвовать в `true` звонках и собраниях в Интернете.
* `bots[0].supportsVideo`. Если присутствует и `true` установлено, Teams знает, что ваш бот поддерживает видео.

Если вы хотите, чтобы ваш IDE правильно проверял схему manifest.json для бота вызовов и собраний для этих значений, вы можете изменить атрибут `$schema` следующим образом:

```json
"$schema": "https://raw.githubusercontent.com/OfficeDev/microsoft-teams-app-schema/preview/DevPreview/MicrosoftTeams.schema.json",
```

В следующем разделе вы можете создать новый бот или добавить возможности вызова к существующему боту.

## <a name="create-new-bot-or-add-calling-capabilities"></a>Создание нового бота или добавление возможностей вызова

Сведения о создании ботов см. в [сайте Create a bot for Teams.](../how-to/create-a-bot-for-teams.md)

**Создание нового бота для Teams**

1. Используйте эту ссылку для создания нового `https://dev.botframework.com/bots/new` бота. Кроме того, при выборе кнопки **Создание** бота на портале Bot Framework создается бот в Microsoft Azure, для которого должна быть учетная запись Azure.
1. Добавьте Teams канал.
1. Выберите **вкладку Вызов** на Teams канале. Выберите **Включить вызов,** а затем обновить **веб-ок (для вызова)** с URL-адресом HTTPS, где вы получаете входящие уведомления, например `https://contoso.com/teamsapp/api/calling` . Дополнительные сведения см. [в настройках каналов.](/bot-framework/portal-configure-channels)

    ![Настройка Teams канала](~/assets/images/calls-and-meetings/configure-msteams-channel.png)

В следующем разделе приводится список разрешений приложений, поддерживаемых для звонков и собраний в Интернете.

## <a name="add-graph-permissions"></a>Добавление Graph разрешений

В Graph предоставляется детализация разрешений для управления доступом приложений к ресурсам. Вы решаете, какие разрешения Graph запросы приложения. В Graph API поддерживаются разрешения приложений, которые используются приложениями, которые работают без приписаного пользователя. Администратор клиента должен предоставить согласие на разрешения приложений.

### <a name="application-permissions-for-calls"></a>Разрешения приложения для звонков

В следующей таблице приводится список разрешений приложений для звонков:

|Разрешение    |Отображение строки   |Описание |Требуется согласие администратора |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
| Calls.Initiate.All |Инициировать исходяющие вызовы 1:1 из предварительного просмотра приложения. |Позволяет приложению совершать исходящие звонки одному пользователю и передавать звонки пользователям из каталога вашей организации без необходимости входа пользователя.|Да|
| Calls.InitiateGroupCall.All |Инициировать исходяние групповых вызовов из предварительного просмотра приложения. |Позволяет приложению совершать исходящие звонки нескольким пользователям и добавлять участников в собрания в организации без необходимости входа пользователя.|Да|
| Calls.JoinGroupCall.All |Регистрация групповых звонков и собраний в качестве предварительного просмотра приложения. |Позволяет приложению присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя. Приложение присоединяется к привилегиям пользователя каталога к собраниям в клиенте.|Да|
| Calls.JoinGroupCallasGuest.All |Регистрация групповых звонков и собраний в качестве гостевого предварительного просмотра. |Позволяет приложению анонимно присоединяться к групповым звонкам и запланированным собраниям в организации без необходимости входа пользователя. Приложение присоединяется в качестве гостя к собраниям в клиенте.|Да|
| Calls.AccessMedia.All |Доступ к медиапотокам в вызове в качестве предварительного просмотра приложения. |Позволяет приложению получить прямой доступ к потокам мультимедиа в ходе звонка без необходимости входа пользователя.|Да|

> [!IMPORTANT]
> Нельзя использовать API доступа к мультимедиа для записи или иного сохраняемой медиаконтента из звонков или собраний, которые ваше приложение получает или извлекает данные из записи или записи контента мультимедиа. Сначала необходимо вызвать [ `updateRecordingStatus` API,](/graph/api/call-updaterecordingstatus) чтобы указать, что запись началась, и получить ответ на успех из этого API. Если ваше приложение начинает записывать любое собрание или вызов, оно должно закончить запись перед вызовом API, чтобы указать, что `updateRecordingStatus` запись завершена.

### <a name="application-permissions-for-online-meetings"></a>Разрешения приложений для собраний в Интернете

В следующей таблице приводится список разрешений приложений для собраний в Интернете:

|Разрешение    |Отображение строки   |Описание |Требуется согласие администратора |
|:-----------------------------|:-----------------------------------------|:-----------------|:-----------------|
| OnlineMeetings.Read.All |Чтение сведений о собраниях в Интернете из предварительного просмотра приложения|Позволяет приложению читать сведения о собраниях в интернете в организации без участия пользователя.|Да|
| OnlineMeetings.ReadWrite.All |Чтение и создание собраний в Интернете из предварительного просмотра приложения от имени пользователя|Позволяет приложению создавать онлайн-собрания в организации от имени пользователя без подписаного пользователя.|Да|

### <a name="assign-permissions"></a>Назначение разрешений

Чтобы использовать конечную точку [Azure Active Directory (AAD) V1,](/azure/active-directory/develop/azure-ad-endpoint-comparison)необходимо заранее настроить разрешения приложения для бота с помощью портала [Azure.](https://aka.ms/aadapplist)

### <a name="get-tenant-administrator-consent"></a>Получить согласие администратора клиента

Для приложений с AAD конечной точкой V1 администратор клиента может дать согласие на разрешения приложений с помощью портала [Azure](https://portal.azure.com) при установке приложения в организации. Кроме того, вы можете предоставить в приложении возможность регистрации, с помощью которой администраторы могут дать согласие на настроенные разрешения. После записи согласия администратора AAD приложение может запрашивать маркеры без повторного запроса согласия.

Вы можете использовать администратора для предоставления разрешений, необходимых вашему приложению на [портале Azure.](https://portal.azure.com) Лучшим вариантом является предоставление администраторам возможности регистрации с помощью конечной точки AAD `/adminconsent` V2. Дополнительные сведения см. [в инструкции по построению URL-адреса согласия администратора.](/graph/uth-v2-service#3-get-administrator-consent)

> [!NOTE]
> Чтобы создать URL-адрес согласия администратора клиента, необходимо настроить [](https://apps.dev.microsoft.com/) URI перенаправления или url-адрес ответа на портале регистрации приложений. Чтобы добавить URL-адреса ответов для бота, выберите Манифест приложения **для** редактирования дополнительных  >  параметров. Добавьте URL-адрес перенаправления в `replyUrls` коллекцию.

> [!IMPORTANT]
> В любое время, когда вы внося изменения в разрешения приложения, необходимо также повторить процесс согласия администратора. Изменения, внесенные на портале регистрации приложений, не отражаются до повторного получения согласия администратором клиента.

## <a name="next-step"></a>Следующий этап

> [!div class="nextstepaction"]
> [Уведомления о входящих звонках](~/bots/calls-and-meetings/call-notifications.md)

## <a name="see-also"></a>См. также

* [Уведомления о входящих звонках](~/bots/calls-and-meetings/call-notifications.md)
* [Разработка ботов вызовов и сетевых собраний на локальном компьютере](~/bots/calls-and-meetings/debugging-local-testing-calling-meeting-bots.md)
