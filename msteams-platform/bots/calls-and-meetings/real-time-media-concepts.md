---
title: Звонки и собрания по сети в реальном времени с помощью Microsoft Teams
description: Основные понятия, связанные с созданием Bot, которые могут выполнять голосовые и видеозвонки в режиме реального времени и собраний по сети.
keywords: поток аудио аудио-и видеоконференций для собраний мультимедиа в режиме реального времени, размещенной в службе мультимедиа
ms.openlocfilehash: 0ec99d1caa8810d292170c7c70a1518de7301873
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "41675330"
---
# <a name="real-time-media-calls-and-meetings-with-microsoft-teams"></a>Звонки и собрания в режиме реального времени с помощью Microsoft Teams

Платформа мультимедиа реального времени позволяет Боты взаимодействовать с вызовами и собраниями Microsoft Teams с помощью голосовой связи, видео и демонстрации экрана в режиме реального времени. Это расширенная возможность, позволяющая интерфейсу Bot отправлять и принимать голосовые и видеоконтенты *по кадрам*. У Bot есть доступ к потокам мультимедиа голосовой, видео и экрана. (Боты, какие самоработающие носители называются _размещенными на сервере_ Боты, в отличие от более простых _размещенных в службах носителей_ Боты, которые полагаются на мультимедийную платформу реального времени для обработки мультимедиа.)

Например, при вызове 1:1 с помощью Bot, когда пользователь говорит, Bot будет получать звуковые кадры 50 в секунду с каждым кадром, содержащим 20 миллисекунд (МС) звукового сигнала. Размещаемый в приложении робот Media поддерживает распознавание речи в режиме реального времени при получении звуковых кадров, а не ждет записи после того, как пользователь перестает говориться. С помощью Bot вы также можете отправлять и получать видео с разрешением высокого разрешения, в том числе видеоконтент для демонстрации экрана.

Платформа предоставляет простой API, подобный сокету, для отправки и получения носителей, а также поддерживает кодирование аудио-и видеосигналов в режиме реального времени с помощью кодеков, таких как SILK и G. 722 для аудио и H. 264 для видео. Платформа также обрабатывает все данные шифрования, расшифровки и расшифровки пакетов мультимедиа автоматически, поэтому программа-робот просто должна самостоятельно подделаться с реальными аудио-и видеоматериалами. Поносительный робот в реальном времени может участвовать в вызовах 1:1, а также собраниях с несколькими участниками.

В этой статье описываются основные понятия, связанные с созданием Bot, который может выполнять аудио-и видеозвонки в режиме реального времени с помощью Microsoft Teams.

## <a name="media-session"></a>Сеанс мультимедиа

Когда поток мультимедиа Bot в реальном времени отвечает на входящий звонок или присоединяется к собранию Microsoft Teams, он должен объявлять, какую модальности он намеревается поддерживать. Для каждого поддерживаемого модальности Bot указывает, может ли он отправлять и получать мультимедиа, только получение или только отправку. Например, Bot, предназначенный для обработки вызовов 1:1 Teams, могут отправлять и получать звук, а только *отправлять* видео (так как им не нужно получать видео абонента). Набор аудио-и видеомодальности, установленный между Bot и вызывающим абонентом или собранием Teams, называется **сеансом мультимедиа**.

Поддерживаются два типа видео модальности: **основной** **Видеообмен и видео на основе видео**. Основное видео используется для передачи видео с веб-камеры пользователя. Средство демонстрации экрана с видео позволяет пользователю предоставлять общий доступ к экрану в виде видеопотока. Платформа позволяет использовать для отправки и/или приема *видеороликов* .

Когда вы присоединяетесь к собранию Teams, Bot может одновременно получать несколько основных потоков видео — до 10 для каждого сеанса мультимедиа. Это позволяет Bot "видеть" несколько участников собрания.

## <a name="frames-and-frame-rate"></a>Частота кадров и кадров

Media Bot в реальном времени взаимодействует напрямую с аудио и видео модальности сеанса мультимедиа. Это означает, что Bot отправляет и/или получает носитель в виде последовательности **кадров**, где каждый кадр представляет единицу содержимого. Одна секунда звука может быть передаваться в виде последовательности из 50 кадров, каждая из которых содержит 20 миллисекунд (МС) — 1/50-е секунды для речевого контента. Одна секунда видео может быть разрезаться как последовательность из 30 неподвижных изображений, каждый из которых предназначен для просмотра только для 33.3 MS — 1/30-30 секунд — перед отображением следующего кадра видеосвязи. Количество кадров, передаваемых или отображаемых в секунду, называется **частотой кадров**. "30fps" указывает 30 кадров в секунду.

## <a name="audio-format"></a>Формат звука

Каждая секунда звука представлена **как 16 000-примерами**, каждый из которых содержит 16-разрядные данные. Звуковая рамка 20 мс содержит 320 образцов (640 байт данных).

## <a name="video-format"></a>Формат видео

Для видео поддерживается несколько форматов. Двумя ключевыми свойствами видеоформата являются размер и **цветовой формат** **кадра** . Поддерживаемые размеры кадров включают 640x360 ("360p"), 1280x720 ("720p") и 1920x1080 ("1080p"). Поддерживаемые цветовые форматы включают NV12 (12 бит на пиксель) и RGB24 (24 бита на пиксель).

Видеокадр "720p" содержит 921 600 пикселей (1280 раз 720). В цветном формате RGB24 каждая точка представляется как 3 байта (24 бита), состоящие из одного байта, в каждом из компонентов красного, зеленого и синего цвета. Таким образом, для одного кадра RGB24 видео 720p требуется 2 764 800 байт данных (921 600 пикселей по 3 байт/пиксель). При частоте кадров 30fps отправка 720p RGB24 видеокадров означает обработку примерно 80 МБ/с содержимого (которое значительно сжимается с помощью видеокодека H. 264 до передачи по сети).

Расширенная возможность платформы позволяет использовать для отправки и получения видеороликов в виде **закодированных** кадров H. 264. Это поддерживает Боты, которые предоставляют собственные кодировщики и декодеры H. 264 или не требуют декодирования видеопотока в необработанные изображения RGB24 или NV12.

## <a name="active-and-dominant-speakers"></a>Активный и главный динамики

При присоединении к собранию Teams, состоящей из нескольких участников, Bot могут определять, какие участники собрания в данный момент говорят. **Активные динамики** определяют, какие участники будут слышаться в каждом полученном звуковом кадре. **Доминирующие динамики** определяют, какие участники в настоящее время являются наиболее активными (или "главными") в беседе группы, хотя голосовые сообщения могут не присутствовать в каждом звуковом кадре. Набор доминирующего динамика может измениться по мере того, как они переходят на другой участник.

## <a name="video-subscription"></a>Подписка на видео

При вызове 1:1 Bot автоматически получает видео абонента, если для ленты включено получение видео. В собрании Teams Bot должен указывать на платформу, для которой он хочет просмотреть. **Видеоподписка** — это запрос, получающий основной ролик или общий доступ к содержимому участника с экрана. По мере того как участники собрания выполняют свои беседы, Bot могут изменить свои подписку на видео на основе обновлений главного набора динамиков или уведомлений, указывающих на то, какой участник в данный момент использует общий доступ к экрану.

## <a name="developer-resources"></a>Ресурсы для разработчиков

Чтобы разработать размещенный в приложении робот, необходимо установить следующий пакет NuGet в проекте Visual Studio:

- [Библиотека Microsoft. Graph. Calls. Media .NET](https://www.nuget.org/packages/Microsoft.Graph.Communications.Calls.Media/)

Для среды Боты, размещаемой в приложении, требуется .NET/C# и Windows Server, как подробно описано в статье [требования и рекомендации для среды Боты, размещаемой у приложения](requirements-considerations-application-hosted-media-bots.md#application-hosted-media-bot-development-requires-cnet-and-windows-server).
