---
title: Расширения для система обмена сообщениями
author: clearab
description: Обзор расширений обмена сообщениями на платформе Microsoft Teams
localization_priority: Normal
ms.topic: overview
ms.author: anclear
ms.openlocfilehash: a5d30912d5cc580b6e85e19178c49d91811bc11f
ms.sourcegitcommit: a732789190f59ec1f3699e8ad2f06387e8fe1458
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2021
ms.locfileid: "52058539"
---
# <a name="messaging-extensions"></a><span data-ttu-id="e2780-103">Расширения для система обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="e2780-103">Messaging extensions</span></span>

<span data-ttu-id="e2780-104">Расширения обмена сообщениями позволяют пользователям взаимодействовать с веб-службой с помощью кнопок и форм в клиенте Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="e2780-104">Messaging extensions allow the users to interact with your web service through buttons and forms in the Microsoft Teams client.</span></span> <span data-ttu-id="e2780-105">Они могут искать или инициировать действия во внешней системе из области композитного сообщения, командного окна или непосредственно из сообщения.</span><span class="sxs-lookup"><span data-stu-id="e2780-105">They can search or initiate actions in an external system from the compose message area, the command box, or directly from a message.</span></span> <span data-ttu-id="e2780-106">Результаты этого взаимодействия можно отправить клиенту Microsoft Teams в виде богато отформатированной карты.</span><span class="sxs-lookup"><span data-stu-id="e2780-106">You can send back the results of that interaction to the Microsoft Teams client in the form of a richly formatted card.</span></span> <span data-ttu-id="e2780-107">В этом документе представлен обзор расширения обмена сообщениями, задач, выполняемых в различных сценариях, работы над расширением обмена сообщениями, команд действий и поиска и разгрузки ссылок.</span><span class="sxs-lookup"><span data-stu-id="e2780-107">This document gives an overview of the messaging extension, tasks performed under different scenarios, working of messaging extension, action and search commands, and link unfurling.</span></span>

<span data-ttu-id="e2780-108">На следующем изображении отображаются расположения, из которых вызываются расширения обмена сообщениями:</span><span class="sxs-lookup"><span data-stu-id="e2780-108">The following image displays the locations from where messaging extensions are invoked:</span></span>

![Расположение ссылок на расширение обмена сообщениями](~/assets/images/messaging-extension-invoke-locations.png)

## <a name="scenarios-where-messaging-extensions-are-used"></a><span data-ttu-id="e2780-110">Сценарии использования расширений обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="e2780-110">Scenarios where messaging extensions are used</span></span>

| <span data-ttu-id="e2780-111">Сценарий</span><span class="sxs-lookup"><span data-stu-id="e2780-111">Scenario</span></span> | <span data-ttu-id="e2780-112">Пример</span><span class="sxs-lookup"><span data-stu-id="e2780-112">Example</span></span> |
|:-----------------|:-----------------|
|<span data-ttu-id="e2780-113">Вы хотите, чтобы какая-то внешняя система для действий и результат действия были отправлены обратно в разговор.</span><span class="sxs-lookup"><span data-stu-id="e2780-113">You want some external system to do an action  and the result of the action to be sent back to your conversation.</span></span>|<span data-ttu-id="e2780-114">Зарезервировать ресурс и разрешить каналу знать зарезервированный интервал времени.</span><span class="sxs-lookup"><span data-stu-id="e2780-114">Reserve a resource and allow the channel to know the reserved time slot.</span></span>|
|<span data-ttu-id="e2780-115">Вы хотите найти что-то во внешней системе и поделиться результатами с беседой.</span><span class="sxs-lookup"><span data-stu-id="e2780-115">You want to find something in an external system, and share the results with the conversation.</span></span>|<span data-ttu-id="e2780-116">Найди рабочий элемент в Azure DevOps и поделитесь им с группой в качестве адаптивной карты.</span><span class="sxs-lookup"><span data-stu-id="e2780-116">Search for a work item in Azure DevOps, and share it with the group as an Adaptive Card.</span></span>|
|<span data-ttu-id="e2780-117">Вы хотите выполнить сложную задачу с несколькими шагами или большим количеством информации во внешней системе и поделиться результатами с беседой.</span><span class="sxs-lookup"><span data-stu-id="e2780-117">You want to complete a complex task involving multiple steps or lots of information in an external system, and share the results with a conversation.</span></span>|<span data-ttu-id="e2780-118">Создайте ошибку в системе отслеживания на основе сообщения Teams, назначьте эту ошибку Бобу и отправьте карту в поток беседы с деталями ошибки.</span><span class="sxs-lookup"><span data-stu-id="e2780-118">Create a bug in your tracking system based on a Teams message, assign that bug to Bob, and send a card to the conversation thread with the bug's details.</span></span>|

## <a name="understand-how-messaging-extensions-work"></a><span data-ttu-id="e2780-119">Понимание работы расширений обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="e2780-119">Understand how messaging extensions work</span></span>

<span data-ttu-id="e2780-120">Расширение обмена сообщениями состоит из веб-службы, на которой вы работаете, и манифеста приложений, определяющих, откуда вызывается веб-служба в клиенте Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="e2780-120">A messaging extension consists of a web service that you host and an app manifest, which defines where your web service is invoked from in the Microsoft Teams client.</span></span> <span data-ttu-id="e2780-121">Веб-служба воспользовалась схемой обмена сообщениями Bot Framework и протоколом безопасной связи, поэтому необходимо зарегистрировать веб-службу в качестве бота в bot Framework.</span><span class="sxs-lookup"><span data-stu-id="e2780-121">The web service takes advantage of the Bot Framework's messaging schema and secure communication protocol, so you must register your web service as a bot in the Bot Framework.</span></span> 

> [!NOTE]
> <span data-ttu-id="e2780-122">Хотя веб-службу можно создавать вручную, используйте [bot Framework SDK](https://github.com/microsoft/botframework) для работы с протоколом.</span><span class="sxs-lookup"><span data-stu-id="e2780-122">Though you can create the web service manually, use [Bot Framework SDK](https://github.com/microsoft/botframework) to work with the protocol.</span></span>

<span data-ttu-id="e2780-123">В манифесте приложения для приложения Microsoft Teams одно расширение обмена сообщениями определяется с до десяти различными командами.</span><span class="sxs-lookup"><span data-stu-id="e2780-123">In the app manifest for Microsoft Teams app, a single messaging extension is defined with up to ten different commands.</span></span> <span data-ttu-id="e2780-124">Каждая команда определяет тип, например действие или поиск, а также расположения клиента, откуда он вызывается.</span><span class="sxs-lookup"><span data-stu-id="e2780-124">Each command defines a type, such as action or search and the locations in the client from where it is invoked.</span></span> <span data-ttu-id="e2780-125">Расположения ссылок — это область сообщений, командная планка и сообщение.</span><span class="sxs-lookup"><span data-stu-id="e2780-125">The invoke locations are compose message area, command bar, and message.</span></span> <span data-ttu-id="e2780-126">При вызове веб-служба получает сообщение HTTPS с полезной нагрузкой JSON, включая всю соответствующую информацию.</span><span class="sxs-lookup"><span data-stu-id="e2780-126">On invoke, the web service receives an HTTPS message with a JSON payload including all the relevant information.</span></span> <span data-ttu-id="e2780-127">Откликайся с помощью полезной нагрузки JSON, что позволяет клиенту Teams знать следующее взаимодействие, чтобы включить.</span><span class="sxs-lookup"><span data-stu-id="e2780-127">Respond with a JSON payload, allowing the Teams client to know the next interaction to enable.</span></span> 

## <a name="types-of-messaging-extension-commands"></a><span data-ttu-id="e2780-128">Типы команд расширения обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="e2780-128">Types of messaging extension commands</span></span>

<span data-ttu-id="e2780-129">Существует два типа команд расширения обмена сообщениями, команда действий и команда поиска.</span><span class="sxs-lookup"><span data-stu-id="e2780-129">There are two types of messaging extension commands, action command and search command.</span></span> <span data-ttu-id="e2780-130">Тип команды расширения обмена сообщениями определяет элементы пользовательского интерфейса и потоки взаимодействия, доступные веб-службе.</span><span class="sxs-lookup"><span data-stu-id="e2780-130">The messaging extension command type defines the UI elements and interaction flows available to your web service.</span></span> <span data-ttu-id="e2780-131">Для обоих типов команд доступны некоторые взаимодействия, например проверка подлинности и конфигурация.</span><span class="sxs-lookup"><span data-stu-id="e2780-131">Some interactions, such as authentication and configuration are available for both types of commands.</span></span>

### <a name="action-commands"></a><span data-ttu-id="e2780-132">Команды действий</span><span class="sxs-lookup"><span data-stu-id="e2780-132">Action commands</span></span>

<span data-ttu-id="e2780-133">Команды действий используются, чтобы представить пользователям модальный всплывающий модуль для сбора или отображения сведений.</span><span class="sxs-lookup"><span data-stu-id="e2780-133">Action commands are used to present the users with a modal popup to collect or display information.</span></span> <span data-ttu-id="e2780-134">Когда пользователь представляет форму, веб-служба отвечает, вставляя сообщение в беседу напрямую или вставляя сообщение в область составить сообщение.</span><span class="sxs-lookup"><span data-stu-id="e2780-134">When the user submits the form, your web service responds by inserting a message into the conversation directly or by inserting a message into the compose message area.</span></span> <span data-ttu-id="e2780-135">После этого пользователь может отправить сообщение.</span><span class="sxs-lookup"><span data-stu-id="e2780-135">After that the user can submit the message.</span></span> <span data-ttu-id="e2780-136">Для более сложных процессов можно сцепить несколько форм.</span><span class="sxs-lookup"><span data-stu-id="e2780-136">You can chain multiple forms together for more complex workflows.</span></span>

<span data-ttu-id="e2780-137">Команды действий запускаются из области составить сообщение, поле команды или из сообщения.</span><span class="sxs-lookup"><span data-stu-id="e2780-137">The action commands are triggered from the compose message area, the command box, or from a message.</span></span> <span data-ttu-id="e2780-138">При вызове команды из сообщения начальная полезной нагрузки JSON, отправленная боту, включает все сообщения, из которых она была вызвана.</span><span class="sxs-lookup"><span data-stu-id="e2780-138">When the command is invoked from a message, the initial JSON payload sent to your bot includes the entire message it was invoked from.</span></span> <span data-ttu-id="e2780-139">На следующем изображении отображается командный модуль командной задачи расширения обмена сообщениями: модуль командной задачи расширения ![ обмена сообщениями.](~/assets/images/task-module.png)</span><span class="sxs-lookup"><span data-stu-id="e2780-139">The following image displays the messaging extension action command task module: ![messaging extension action command task module](~/assets/images/task-module.png)</span></span>

### <a name="search-commands"></a><span data-ttu-id="e2780-140">Команды поиска</span><span class="sxs-lookup"><span data-stu-id="e2780-140">Search commands</span></span>

<span data-ttu-id="e2780-141">Команды поиска позволяют пользователям искать информацию во внешней системе вручную через поле поиска или вставить ссылку на отслеживаемого домена в область составить сообщение и вставить результаты поиска в сообщение.</span><span class="sxs-lookup"><span data-stu-id="e2780-141">Search commands allow the users to search an external system for information either manually through a search box, or by pasting a link to a monitored domain into the compose message area, and insert the results of the search into a message.</span></span> <span data-ttu-id="e2780-142">В основном потоке команд поиска начальное сообщение вызова включает строку поиска, отправленную пользователем.</span><span class="sxs-lookup"><span data-stu-id="e2780-142">In the most basic search command flow, the initial invoke message includes the search string that the user submitted.</span></span> <span data-ttu-id="e2780-143">Вы отвечаете со списком карт и предварительных просмотров карт.</span><span class="sxs-lookup"><span data-stu-id="e2780-143">You respond with a list of cards and card previews.</span></span> <span data-ttu-id="e2780-144">Клиент Teams передает список предварительных просмотров карт для пользователя.</span><span class="sxs-lookup"><span data-stu-id="e2780-144">The Teams client renders a list of card previews for the user.</span></span> <span data-ttu-id="e2780-145">Когда пользователь выбирает карту из списка, полноразмерная карта вставляется в область составить сообщение.</span><span class="sxs-lookup"><span data-stu-id="e2780-145">When the user selects a card from the list, the full-size card is inserted into the compose message area.</span></span>

<span data-ttu-id="e2780-146">Карточки запускаются из области составить сообщение или командное поле и не запускаются из сообщения.</span><span class="sxs-lookup"><span data-stu-id="e2780-146">The cards are triggered from the compose message area or the command box and not triggered from a message.</span></span> <span data-ttu-id="e2780-147">Их нельзя запускать из сообщения.</span><span class="sxs-lookup"><span data-stu-id="e2780-147">They can not be triggered from a message.</span></span>
<span data-ttu-id="e2780-148">На следующем изображении отображается командный модуль командной задачи расширения обмена сообщениями:</span><span class="sxs-lookup"><span data-stu-id="e2780-148">The following image displays the messaging extension search command task module:</span></span>

![Команда поиска расширения обмена сообщениями](~/assets/images/search-extension.png)

> [!NOTE]
> <span data-ttu-id="e2780-150">Дополнительные сведения о картах см. [в том, что такое карточки.](../task-modules-and-cards/what-are-cards.md)</span><span class="sxs-lookup"><span data-stu-id="e2780-150">For more information on cards, see [what are cards](../task-modules-and-cards/what-are-cards.md).</span></span>

## <a name="link-unfurling"></a><span data-ttu-id="e2780-151">Развертывание ссылки</span><span class="sxs-lookup"><span data-stu-id="e2780-151">Link unfurling</span></span>

<span data-ttu-id="e2780-152">Веб-служба вызывается, когда URL-адрес вклеен в области составить сообщение.</span><span class="sxs-lookup"><span data-stu-id="e2780-152">A web service is invoked when a URL is pasted in the compose message area.</span></span> <span data-ttu-id="e2780-153">Эта функция называется разгрузка ссылок.</span><span class="sxs-lookup"><span data-stu-id="e2780-153">This functionality is known as link unfurling.</span></span> <span data-ttu-id="e2780-154">Вы можете подписаться, чтобы получить вызов, когда URL-адреса, содержащие определенный домен, вклеились в область составить сообщение.</span><span class="sxs-lookup"><span data-stu-id="e2780-154">You can subscribe to receive an invoke when URLs containing a particular domain are pasted into the compose message area.</span></span> <span data-ttu-id="e2780-155">Веб-служба может "разверять" URL-адрес в подробную карту, предоставляя больше информации, чем стандартная карта предварительного просмотра веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="e2780-155">Your web service can "unfurl" the URL into a detailed card, providing more information than the standard website preview card.</span></span> <span data-ttu-id="e2780-156">Можно добавить кнопки, чтобы пользователи могли немедленно принять меры, не покидая клиента Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="e2780-156">You can add buttons to allow the users to immediately take action without leaving the Microsoft Teams client.</span></span>
<span data-ttu-id="e2780-157">На следующих изображениях отображается функция разгрузки ссылки при вклеии ссылки в расширении обмена сообщениями:</span><span class="sxs-lookup"><span data-stu-id="e2780-157">The following images display link unfurling feature when a link is pasted in messaging extension:</span></span>
 
![unfurl link](../assets/images/messaging-extension/unfurl-link.png)

![разгрузка ссылки](../assets/images/messaging-extension/link-unfurl.gif)

## <a name="code-sample"></a><span data-ttu-id="e2780-160">Пример кода</span><span class="sxs-lookup"><span data-stu-id="e2780-160">Code sample</span></span>

| <span data-ttu-id="e2780-161">**Пример имени**</span><span class="sxs-lookup"><span data-stu-id="e2780-161">**Sample name**</span></span> | <span data-ttu-id="e2780-162">**Описание**</span><span class="sxs-lookup"><span data-stu-id="e2780-162">**Description**</span></span> | <span data-ttu-id="e2780-163">**.NET**</span><span class="sxs-lookup"><span data-stu-id="e2780-163">**.NET**</span></span> | <span data-ttu-id="e2780-164">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="e2780-164">**Node.js**</span></span> | <span data-ttu-id="e2780-165">**Python**</span><span class="sxs-lookup"><span data-stu-id="e2780-165">**Python**</span></span> |
|------------|-------------|----------------|------------|
| <span data-ttu-id="e2780-166">Расширение обмена сообщениями с командами на основе действий</span><span class="sxs-lookup"><span data-stu-id="e2780-166">Messaging extension with action-based commands</span></span> | <span data-ttu-id="e2780-167">В этом примере показано, как создать расширение обмена сообщениями на основе действий.</span><span class="sxs-lookup"><span data-stu-id="e2780-167">This sample illustrates how to build an action-based messaging extension.</span></span> | [<span data-ttu-id="e2780-168">View</span><span class="sxs-lookup"><span data-stu-id="e2780-168">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/51.teams-messaging-extensions-action) | [<span data-ttu-id="e2780-169">View</span><span class="sxs-lookup"><span data-stu-id="e2780-169">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/51.teams-messaging-extensions-action) | [<span data-ttu-id="e2780-170">View</span><span class="sxs-lookup"><span data-stu-id="e2780-170">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/51.teams-messaging-extensions-action) |
| <span data-ttu-id="e2780-171">Расширение обмена сообщениями с командами на основе поиска</span><span class="sxs-lookup"><span data-stu-id="e2780-171">Messaging extension with search-based commands</span></span> | <span data-ttu-id="e2780-172">В этом примере показано, как создать расширение обмена сообщениями на основе поиска.</span><span class="sxs-lookup"><span data-stu-id="e2780-172">This sample illustrates how to build a Search-based Messaging Extension.</span></span> | [<span data-ttu-id="e2780-173">View</span><span class="sxs-lookup"><span data-stu-id="e2780-173">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/50.teams-messaging-extensions-search) | [<span data-ttu-id="e2780-174">View</span><span class="sxs-lookup"><span data-stu-id="e2780-174">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/50.teams-messaging-extensions-search) | [<span data-ttu-id="e2780-175">View</span><span class="sxs-lookup"><span data-stu-id="e2780-175">View</span></span>](https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/50.teams-messaging-extension-search) |

## <a name="see-also"></a><span data-ttu-id="e2780-176">См. также</span><span class="sxs-lookup"><span data-stu-id="e2780-176">See also</span></span>

- [<span data-ttu-id="e2780-177">Создать расширение для обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="e2780-177">Create a messaging extension</span></span>](../build-your-first-app/build-messaging-extension.md)


## <a name="next-step"></a><span data-ttu-id="e2780-178">Следующий шаг</span><span class="sxs-lookup"><span data-stu-id="e2780-178">Next step</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="e2780-179">Определение команды расширения обмена сообщениями действий</span><span class="sxs-lookup"><span data-stu-id="e2780-179">Define action messaging extension command</span></span>](~/messaging-extensions/how-to/action-commands/define-action-command.md)

> [!div class="nextstepaction"]
> [<span data-ttu-id="e2780-180">Определение команды расширения обмена сообщениями поиска</span><span class="sxs-lookup"><span data-stu-id="e2780-180">Define search messaging extension command</span></span>](~/messaging-extensions/how-to/search-commands/define-search-command.md)
