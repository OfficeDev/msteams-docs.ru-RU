---
title: Создание расширения для сообщений с помощью App Studio
author: clearab
description: Узнайте, как создать расширение системы обмена сообщениями Microsoft Teams с помощью App Studio.
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: c3437457f7084d2d768af0f0db5208525c368682
ms.sourcegitcommit: 3fc7ad33e2693f07170c3cb1a0d396261fc5c619
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "48796185"
---
# <a name="create-a-messaging-extension-using-app-studio"></a>Создание расширения для сообщений с помощью App Studio

> [!TIP]
> Ищете быстрый способ приступить к работе? Создайте [расширение системы обмена сообщениями](../../build-your-first-app/build-messaging-extension.md) с помощью набора инструментов Microsoft Teams.

На высоком уровне необходимо выполнить следующие действия, чтобы создать расширение системы обмена сообщениями.

1. Подготовка среды разработки
2. Создание и развертывание веб-службы (при разработке используйте службу туннелирования, например ngrok, чтобы запускать ее локально)
3. Регистрация веб-службы в Bot Framework
4. Создайте свой пакет приложений
5. Отправка пакета в Microsoft Teams

Создание веб-службы, создание пакета приложения и регистрация веб-службы с помощью Bot Framework можно выполнять в любом порядке. Так как эти три части так интертвинед, вам потребуется вернуться, чтобы обновить другие. Для регистрации требуется конечная точка обмена сообщениями из развернутой веб-службы, а веб-службе требуется идентификатор и пароль, созданные при регистрации. Манифест приложения также должен использовать этот идентификатор для подключения Teams к вашей веб-службе.

Когда вы создаете расширение системы обмена сообщениями, регулярно перемещайтесь между изменением манифеста приложения и развертыванием кода в веб-службе. При работе с манифестом приложения помните, что вы можете вручную управлять файлом JSON или вносить изменения через приложение App Studio. В любом случае вам потребуется повторно развернуть (отправить) ваше приложение в Teams, если вы вносите изменения в манифест, но это не нужно делать при развертывании изменений в веб-службе.

[!include[prepare environment](~/includes/prepare-environment.md)]

## <a name="create-your-web-service"></a>Создание веб-службы

Сердце расширения системы обмена сообщениями — это веб-служба. Он будет определять один маршрут, как правило, `/api/messages` для получения всех запросов. Если вы приступите к работе с нуля, вы можете выбрать один из вариантов.

* Воспользуйтесь одним из учебных [руководств,](#learn-more) посвященных созданию веб-службы.
* Выберите один из примеров расширения обмена сообщениями, доступных в [репозитории примера ленты Bot](https://github.com/Microsoft/BotBuilder-Samples) , чтобы начать с.
* Если вы используете JavaScript, используйте [генератор Yeoman для Microsoft Teams](https://github.com/OfficeDev/generator-teams) , чтобы сформировать шаблон приложения Teams, в том числе веб-службу.
* Создайте веб-службу с нуля. Вы можете добавить пакет SDK Bot Framework для своего языка или работать непосредственно с полезными данными JSON.

## <a name="register-your-web-service-with-the-bot-framework"></a>Регистрация веб-службы в Bot Framework

Расширения обмена сообщениями используют схему обмена сообщениями и протокол безопасного обмена сообщениями в среде Bot. Если вы еще не сделали это, вам потребуется зарегистрировать веб-службу в Bot Framework. Идентификатор приложения Microsoft (мы будем называть его идентификатором ленты в Teams, чтобы определить его с помощью идентификатора другого приложения, с которым вы можете работать), а конечная точка обмена сообщениями будет использоваться в вашем расширении обмена сообщениями для получения и ответа на запросы. Если вы используете существующую регистрацию, убедитесь, что вы [включили канал Microsoft Teams](/azure/bot-service/bot-service-manage-channels.md?view=azure-bot-service-4.0&preserve-view=true).

Если вы выберете один из примеров или начните с одного из доступных примеров, вы будете участником регистрации веб-службы. Если вы хотите зарегистрировать службу вручную, у вас есть три варианта. Если вы решите зарегистрировать, не используя подписку на Azure, вы не сможете использовать упрощенный процесс проверки подлинности OAuth, предоставленный в интерфейсе Bot. Вы сможете перенести регистрацию в Azure после создания.

* Если у вас есть подписка на Azure (или вы хотите создать новую), вы можете зарегистрировать веб-службу вручную с помощью портала Azure. Создайте ресурс "регистрация каналов ленты". Вы можете выбрать бесплатную ценовую категорию, поскольку сообщения от Microsoft Teams не будут подсчитывать общее количество разрешенных сообщений в месяц.
* Если вы не хотите использовать подписку на Azure, вы можете использовать [устаревший портал регистрации](https://dev.botframework.com/bots/new).
* Кроме того, с помощью App Studio можно зарегистрировать веб-службу (Bot). Веб-службы, зарегистрированные с помощью App Studio, не зарегистрированы в Azure. [Портал прежних версий](https://dev.botframework.com/bots) можно использовать для просмотра и переноса регистраций, управления ими и их переноса.

## <a name="create-your-app-manifest"></a>Создание манифеста приложения

Вы можете использовать App Studio для создания манифеста приложения или создать его вручную.

### <a name="create-your-app-manifest-using-app-studio"></a>Создание манифеста приложения с помощью App Studio

Вы можете использовать приложение App Studio в клиенте Microsoft Teams, чтобы помочь создать манифест приложения.

1. В клиенте Teams откройте App Studio из меню переполнения **...** на панели навигации слева. Если он еще не установлен, можно сделать это, выполнив поиск.
2. На вкладке **редактор манифеста** выберите **создать новое приложение** (или, если вы добавляете расширение для обмена сообщениями в существующее приложение, вы можете импортировать пакет приложения)
3. Добавьте сведения о приложении (см. [определение схемы манифеста](~/resources/schema/manifest-schema.md) с полным описанием каждого поля).
4. На вкладке **расширения обмена сообщениями** нажмите кнопку **установить** .
5. Вы можете создать новую веб-службу (Bot) для используемого расширения обмена сообщениями, или если вы уже зарегистрировали одну из них, а затем добавить ее здесь.
6. При необходимости обновите адрес конечной точки бота, чтобы он указывал на вашего бота. Он должен выглядеть примерно следующим образом: `https://someplace.com/api/messages`.
7. Кнопка **Добавить** в разделе **команда** поможет добавить команды к своему расширению обмена сообщениями. В разделе [Дополнительные сведения приведены](#learn-more) ссылки на дополнительные сведения о добавлении команд. Помните, что вы можете определить до 10 команд для своего расширения обмена сообщениями.
8. Раздел **обработчики сообщений** позволяет добавить домен, на котором будет запускаться обмен сообщениями. Для получения дополнительных сведений обратитесь к разделу [Link унфурлинг](~/messaging-extensions/how-to/link-unfurling.md) .

На вкладке **Готово => тест и распределить** можно **скачать** пакет приложения (включая манифест приложения, а также значки приложений) или **установить** пакет.

### <a name="create-your-app-manifest-manually"></a>Создание манифеста приложения вручную

Как и в случае с Боты и вкладками, вы обновляете [Манифест](~/resources/schema/manifest-schema.md#composeextensions) приложения, чтобы включить свойства расширения обмена сообщениями. Эти свойства определяют, как ваше расширение обмена сообщениями отображается и работает в клиенте Microsoft Teams. Расширения обмена сообщениями поддерживаются начиная с версии 1.0 манифеста.

#### <a name="declare-your-messaging-extension"></a>Объявление расширения обмена сообщениями

Чтобы добавить расширение системы обмена сообщениями, включите новую структуру JSON верхнего уровня в манифест приложения со `composeExtensions` свойством. Вы можете создать одно расширение обмена сообщениями для своего приложения, используя до 10 команд.

> [!NOTE]
> Манифест содержит ссылки на расширения обмена сообщениями `composeExtensions` . Это необходимо для обеспечения обратной совместимости.

Определение расширения — это объект, имеющий следующую структуру:

| Имя свойства | Назначение | Обязательный? |
|---|---|---|
| `botId` | Уникальный идентификатор приложения Майкрософт для бота, зарегистрированный в Bot Framework. Как правило, это должен быть тот же идентификатор, что и для всего приложения Teams. | Да |
| `canUpdateConfiguration` | Включает пункт меню **параметров** . | Нет |
| `commands` | Массив команд, поддерживаемых этим расширением обмена сообщениями. Можно выполнить не более 10 команд. | Да |

#### <a name="define-your-commands"></a>Определение команд

Ваш модуль обмена сообщениями должен объявить одну или несколько команд, определяющих, где пользователи могут активировать ваш модуль обмена сообщениями, и тип взаимодействия. Дополнительные сведения о командах расширения системы обмена сообщениями приведены в [статье](#learn-more) дополнительные сведения.

#### <a name="simple-manifest-example"></a>Пример простого манифеста

В приведенном ниже примере показан объект простого расширения обмена сообщениями в манифесте приложения с помощью команды поиска. Это не весь файл манифеста приложения, а только часть, относящаяся к расширениям для обмена сообщениями. Полный пример приведен в статье [схема манифеста приложения](~/resources/schema/manifest-schema.md) .

```json
...
"composeExtensions": [
  {
    "botId": "abcd1234-1fc5-4d97-a142-35bb662b7b23",
    "canUpdateConfiguration": true,
    "commands": [
      {
        "id": "searchCmd",
        "description": "Search you ToDo's",
        "title": "Search",
        "initialRun": true,
        "parameters": [
          {
            "name": "searchKeyword",
            "description": "Enter your search keywords",
            "title": "Keywords"
          }
        ]
      }
    ]
  }
]
...
```

## <a name="add-your-invoke-message-handlers"></a>Добавление обработчиков сообщений о вызовах

Когда ваши пользователи запускают расширение системы обмена сообщениями, необходимо обработать исходное сообщение о вызове, собрать некоторую информацию от пользователя, затем обработать эту информацию и ответить соответствующим образом. Для этого сначала необходимо решить, какие команды вы хотите добавить в расширение системы обмена сообщениями, и либо [добавить команды действий](~/messaging-extensions/how-to/action-commands/define-action-command.md) , либо [добавить команды поиска](~/messaging-extensions/how-to/search-commands/define-search-command.md).

## <a name="messaging-extensions-in-teams-meetings"></a>Расширения обмена сообщениями в собраниях Teams

После начала собрания участники Teams могут напрямую взаимодействовать с расширением обмена сообщениями во время интерактивного звонка. При создании расширения обмена сообщениями для собраний учитывайте следующее:

1. **Location** . Ваш модуль обмена сообщениями можно вызвать из области создание сообщения, команды или @mentioned в чате для собрания.

1. **Metadata (метаданные** ). При вызове расширения обмена сообщениями он может идентифицировать пользователя и клиента из `userId` и `tenantId` . `meetingId` может быть частью объекта `channelData`. Приложение может использовать `userId` `meetingId` `GetParticipant` запрос API и для получения ролей пользователей.

1. **Тип команды** . Если расширение сообщения использует [команды на основе действий](../../messaging-extensions/what-are-messaging-extensions.md#action-commands), оно должно соответствовать вкладкам проверки подлинности [с единым входом](../../tabs/how-to/authentication/auth-aad-sso.md) .

1. **Взаимодействие с пользователем** . Расширение системы обмена сообщениями должно выглядеть и работать так же, как и за пресроком собрания.

## <a name="next-steps"></a>Дальнейшие действия

* [Создание команд действий](~/messaging-extensions/how-to/action-commands/define-action-command.md)
* [Создание команд поиска](~/messaging-extensions/how-to/search-commands/define-search-command.md)
* [Развернуть ссылку](~/messaging-extensions/how-to/link-unfurling.md)

## <a name="learn-more"></a>Подробнее

Попробуйте это в кратком руководстве:

* Примеры использования C #
  * [Расширение системы обмена сообщениями с помощью команд на основе действий](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/51.teams-messaging-extensions-action)
  * [Расширение системы обмена сообщениями с помощью команд на основе поиска](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/50.teams-messaging-extensions-search)
* Примеры использования JavaScript
  * [Расширение системы обмена сообщениями с помощью команд на основе действий](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/51.teams-messaging-extensions-action)
  * [Расширение системы обмена сообщениями с помощью команд на основе поиска](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/50.teams-messaging-extensions-search)

Узнайте больше о концепциях разработки teams:

* [Общие сведения о возможностях приложений Teams](../../concepts/capabilities-overview.md)
* [Что такое расширения обмена сообщениями?](~/messaging-extensions/what-are-messaging-extensions.md)
