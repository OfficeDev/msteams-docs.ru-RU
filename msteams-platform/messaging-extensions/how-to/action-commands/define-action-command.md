---
title: Определение команд действий для расширения обмена сообщениями
author: clearab
description: Обзор расширений обмена сообщениями на платформе Microsoft Teams
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: 89cf92260418701ef4809f5a13750b991b9f7acb
ms.sourcegitcommit: b51a4982842948336cfabedb63bdf8f72703585e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/25/2020
ms.locfileid: "48279683"
---
# <a name="define-messaging-extension-action-commands"></a>Определение команд действий для расширения обмена сообщениями

[!include[v4-to-v3-SDK-pointer](~/includes/v4-to-v3-pointer-me.md)]

Команды действий позволяют предоставить пользователям модальное всплывающее окно (называемое модулем задач в Teams) для сбора и отображения информации, а затем обработки их взаимодействия и отправки информации обратно в Teams. Прежде чем приступать к созданию команды, необходимо принять решение:

1. Откуда можно запустить команду действия?
1. Как будет создаваться модуль задач?
1. Будет ли Последнее сообщение или карточка отправляться каналу из ленты, или сообщение или карточка будут вставлены в область сообщений для отправки пользователю?

## <a name="choose-action-command-invoke-locations"></a>Выбор мест вызова команды действия

В первую очередь необходимо выбрать, где можно запустить команду действия (или более конкретную, *вызвать*ее) из. Указав параметр `context` в манифесте приложения, вы можете вызвать команду из одного или нескольких из следующих расположений:

* Кнопки в нижней части области "Создание сообщения".
* @Mentioning ваше приложение в поле команда. Note: невозможно ответить с сообщением Bot, вставленным непосредственно в беседу, если ваше расширение обмена сообщениями вызвано из командной поля.
* Непосредственно из существующего сообщения с помощью... меню переполнения сообщения. Note: начальный вызов почтового робота будет содержать объект JSON, содержащий сообщение, из которого оно было вызвано, которое можно обработать перед представлением в модуле задачи.

## <a name="choose-how-to-build-your-task-module"></a>Выбор способа построения модуля задач

В дополнение к выбору того, откуда может вызываться команда, необходимо также выбрать способ заполнения формы в модуле задач для пользователей. Существует три варианта создания формы, отображаемой в модуле задачи:

* **Статический список параметров** — это самый простой вариант. Вы можете определить список параметров (полей ввода) в манифесте приложения, который будет отображаться клиентом Teams. Вы не можете управлять форматированием с помощью этого параметра.
* **Адаптивная карта** — вы можете выбрать использование адаптивной карточки, которая обеспечивает больший контроль над пользовательским интерфейсом, но по-прежнему ограничит доступ к доступным элементам управления и параметрам форматирования.
* **Встроенное представление веб-сайта** — если вам требуется полный контроль над пользовательским интерфейсом и элементами управления, можно выбрать внедрение настраиваемого веб-представления в модуль задачи.

Если вы решили создать модуль задач со статическим списком параметров, первый вызов расширения системы обмена сообщениями будет выполняться, когда пользователь отправит модуль задачи. При использовании встроенного веб-представления или адаптивной карточки ваше расширение системы обмена сообщениями должно обрабатывать начальное событие Invoke от пользователя, создавать модуль задач и возвращать его обратно клиенту.

## <a name="choose-how-the-final-message-will-be-sent"></a>Выбор способа отправки итогового сообщения

В большинстве случаев команда действия приведет к вставке карточки в окно сообщения создать. Пользователь может принять решение отправить его в канал или чат. Сообщение в этом случае поступает от пользователя, и у вас не будет возможность изменить открытку или изменить ее.

Если расширение системы обмена сообщениями запускается из поля создать или напрямую из сообщения, веб-служба может вставить конечный ответ непосредственно в канал или чат. В этом случае Адаптивная карта поступает от Bot, а Bot может обновляться, а Bot также может отвечать на поток бесед, если это необходимо. Вам потребуется добавить `bot` объект в манифест приложения с помощью того же идентификатора и определить соответствующие области.

## <a name="add-the-command-to-your-app-manifest"></a>Добавление команды в манифест приложения

Теперь, когда вы решили, как пользователи будут взаимодействовать с командой действия, необходимо добавить его в манифест приложения. Чтобы сделать это, добавьте новый `composeExtension` объект на верхний уровень манифеста приложения JSON. Это можно сделать с помощью App Studio или вручную.

### <a name="create-a-command-using-app-studio"></a>Создание команды с помощью App Studio

В следующих действиях предполагается, что вы уже [создали расширение системы обмена сообщениями](~/messaging-extensions/how-to/create-messaging-extension.md).

1. В клиенте Microsoft Teams откройте **app Studio** и выберите вкладку **редактор манифестов** .
2. Если вы уже создали пакет приложения в App Studio, выберите его из списка. В противном случае вы можете импортировать существующий пакет приложения.
3. Нажмите кнопку **Add (добавить** ) в разделе Command (Добавить).
4. Выберите **Разрешить пользователям активировать действия во внешних службах в Teams**.
5. Если вы хотите использовать статический набор параметров для создания модуля задачи, выберите этот параметр. В противном случае выберите вариант для **выборки динамического набора параметров из ленты**.
6. Добавьте **идентификатор команды** и **название**.
7. Выберите место, с которого будет запускаться команда действия.
8. Если вы используете параметры для модуля задачи, добавьте первый из них.
9. Нажмите кнопку Save (Сохранить)
10. Если требуется добавить дополнительные параметры, нажмите кнопку **Добавить** в разделе **Параметры** , чтобы добавить их.

### <a name="manually-create-a-command"></a>Создание команды вручную

Чтобы вручную добавить команду расширения обмена сообщениями на основе действий в манифест приложения, необходимо добавить к `composeExtension.commands` массиву объектов следующие параметры.

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Уникальный идентификатор, назначенный этой команде. Запрос пользователя будет включать этот идентификатор. | Да | 1.0 |
| `title` | Имя команды. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Необходимое значение — `action`. | Нет | 1.4 |
| `fetchTask` | `true` для адаптивной карточки или встроенного веб-представления для модуля задач, `false` для статического списка параметров или при загрузке веб-представления с помощью `taskInfo` | Нет | 1.4 |
| `context` | Необязательный массив значений, определяющий расположение, из которого может вызываться расширение обмена сообщениями. Возможные значения: `message` , `compose` , или `commandBox` . Значение по умолчанию: `["compose", "commandBox"]`. | Нет | 1.5 |

Если вы используете статический список параметров, вы также добавите их.

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `parameters` | Статический список параметров для команды. Используйте, только когда `fetchTask` — `false` | Нет | 1.0 |
| `parameter.name` | Имя параметра. Он отправляется службе по запросу пользователя. | Да | 1.0 |
| `parameter.description` | Описывает назначение этого параметра или пример значения, которое следует предоставить. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Краткий заголовком или меткой с понятным пользователем параметром. | Да | 1.0 |
| `parameter.inputType` | Укажите требуемый тип ввода. Возможные значения: `text` , `textarea` , `number` , `date` , `time` , `toggle` . Значение по умолчанию: `text` | Нет | 1.4 |

При использовании внедренного веб-представления можно дополнительно добавить `taskInfo` объект для извлечения веб-представления, не обращаясь непосредственно к объекту Bot. Если выбран этот параметр, поведение аналогично статическому списку параметров в том, что первое взаимодействие с роботом будет [отвечать на действия по отсылке модуля задач](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md). Если вы используете `taskInfo` объект, обязательно задайте `fetchTask` для параметра значение `false` .

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
|`taskInfo`|Указание модуля задач для предварительной загрузки при использовании команды расширения системы обмена сообщениями| Нет | 1.4 |
|`taskInfo.title`|Заголовок исходного модуля задач|Нет | 1.4 |
|`taskInfo.width`|Ширина модуля задачи — число в пикселях или макет по умолчанию, например "крупный", "средний" или "Малый"|Нет | 1.4 |
|`taskInfo.height`|Высота модуля задачи — число в пикселях или макет по умолчанию, например "крупный", "средний" или "Малый"|Нет | 1.4 |
|`taskInfo.url`|URL-адрес начального представления в Интернете|Нет | 1.4 |

#### <a name="app-manifest-example"></a>Пример манифеста приложения

Ниже приведен пример `composeExtensions` объекта, определяющего две команды действия. Это не пример полного манифеста для полной схемы манифеста приложения: [схема манифеста приложения](~/resources/schema/manifest-schema.md).

```json
...
"composeExtensions": [
  {
    "botId": "12a3c29f-1fc5-4d97-a142-12bb662b7b23",
    "canUpdateConfiguration": true,
    "commands": [
      {
        "id": "addTodo",
        "description": "Create a To Do item",
        "title": "Create To Do",
        "type": "action",
        "context": ["commandBox", "message", "compose"],
        "fetchTask": false,
        "parameters": [
          {
            "name": "Name",
            "description": "To Do Title",
            "title": "Title",
            "inputType": "text"
          },
          {
            "name": "Description",
            "description": "Description of the task",
            "title": "Description",
            "inputType": "textarea"
          },
          {
            "name": "Date",
            "description": "Due date for the task",
            "title": "Date",
            "inputType": "date"
          }
        ]
      },
      {
        "id": "reassignTodo",
        "description": "Reassign a todo item",
        "title": "Reassign a todo item",
        "type": "action",
        "fetchTask": true,
      }
    ]
  }
]
...
```

## <a name="next-steps"></a>Дальнейшие действия

Если вы используете адаптивную карту или встроенное веб-представление без `taskInfo` объекта, вам нужно выполнить следующие действия:

* [Создание модуля задачи и ответ на него](~/messaging-extensions/how-to/action-commands/create-task-module.md)

Если вы используете параметры или внедренное веб-представление с `taskInfo` объектом, выполните следующие действия:

* [Отклик на отправку модуля задачи](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md)

[!include[messaging-extension-learn-more](~/includes/messaging-extensions/learn-more.md)]
