---
title: Определение команд действий расширения обмена сообщениями
author: clearab
description: Обзор команд действий расширения обмена сообщениями
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: be2135477c4234187f374aef215f90e8329fb74e
ms.sourcegitcommit: 5739245903278d521ec920427248b6b48676e637
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/07/2021
ms.locfileid: "49778403"
---
# <a name="define-messaging-extension-action-commands"></a>Определение команд действий расширения обмена сообщениями

[!include[v4-to-v3-SDK-pointer](~/includes/v4-to-v3-pointer-me.md)]

С помощью команд действий вы можете представить пользователям модальные всплывающие окна (называемые модулем задач в Teams) для сбора или отображения информации, а затем обработать их взаимодействие и отправить информацию обратно в Teams. Перед созданием команды необходимо решить:

1. Откуда можно запускать команду действия?
1. Как будет создан модуль задачи?
1. Будет ли отправлено в канал окончательное сообщение или карточка от бота или сообщение или карточка будут вставлены в область составить сообщение для отправки пользователем?

## <a name="choose-action-command-invoke-locations"></a>Выбор местоположений вызова команды действия

Первое, что вам нужно решить, — откуда можно инициируете команду действия (или, точнее, *из* нее). Указав манифест приложения, команда может быть вызвана из одного или нескольких `context` из следующих мест:

* Кнопки в нижней части области сообщения составить.
* По @mentioning приложение в командной окне. Примечание. Невозможно ответить сообщением бота, вставленным непосредственно в беседу, если расширение обмена сообщениями вызывается из командного окна.
* Непосредственно из существующего сообщения с помощью ... меню переполнения в сообщении. Примечание. Начальный вызов бота будет включать объект JSON, содержащий сообщение, из которого он был вызван, который можно обработать перед тем, как представить ему модуль задачи.

## <a name="choose-how-to-build-your-task-module"></a>Выбор сборки модуля задачи

Помимо выбора места вызова команды, необходимо также выбрать, как заполнить форму в модуле задачи для пользователей. Существует три варианта создания формы, которая будет отрисовываться внутри модуля задачи:

* **Статический список параметров** — это самый простой вариант. Вы можете определить список параметров (полей ввода) в манифесте приложения, который будет отрисовки клиентом Teams. Вы не можете управлять форматированием с помощью этого параметра.
* **Адаптивная карточка.** Вы можете использовать адаптивную карточку, которая обеспечивает более полный контроль над пользовательским интерфейсом, но ограничивает доступные элементы управления и параметры форматирования.
* **Внедренное представление** веб-страницы. Если вам требуется полный контроль над пользовательским интерфейсом и элементами управления, вы можете встраить пользовательское представление веб-страницы в модуль задачи.

Если вы решили создать модуль задачи со статическим списком параметров, первым вызовом расширения обмена сообщениями будет отправка модуля задачи пользователем. При использовании внедренного представления веб-страницы или адаптивной карточки расширению обмена сообщениями потребуется обработать исходное событие вызова от пользователя, создать модуль задачи и вернуть его клиенту.

## <a name="choose-how-the-final-message-will-be-sent"></a>Выбор того, как будет отправлено окончательное сообщение

В большинстве случаев команда действия приведет к вставке карточки в поле составить сообщение. После этого пользователь может отправить его в канал или чат. В этом случае сообщение поступает от пользователя, и ваш бот не сможет редактировать или обновлять карточку дальше.

Если расширение обмена сообщениями запускается из окна составить или непосредственно из сообщения, веб-служба может вставить окончательный ответ непосредственно в канал или чат. В этом случае адаптивная карточка поступает от бота, бот сможет обновить ее, а при необходимости бот также сможет ответить на беседу. Вам потребуется добавить объект в манифест приложения, используя тот же ИД и `bot` определив соответствующие области.

## <a name="add-the-command-to-your-app-manifest"></a>Добавление команды в манифест приложения

Теперь, когда вы решили, как пользователи будут взаимодействовать с вашей командой действий, пришло время добавить ее в манифест приложения. Для этого вы добавите новый объект на верхний уровень `composeExtension` манифеста приложения JSON. Это можно сделать с помощью App Studio или вручную.

### <a name="create-a-command-using-app-studio"></a>Создание команды с помощью App Studio

В следующих шагах предполагается, что вы уже [создали расширение для обмена сообщениями.](~/messaging-extensions/how-to/create-messaging-extension.md)

1. В клиенте Microsoft Teams откройте **App Studio** и выберите вкладку **"Редактор** манифеста".
2. Если вы уже создали пакет приложения в App Studio, вы выбрали его из списка. В этом случае можно импортировать существующий пакет приложения.
3. Нажмите **кнопку "Добавить"** в разделе "Команда".
4. Choose **Allow users to trigger actions in external services while inside of Teams**.
5. Если вы хотите использовать статический набор параметров для создания модуля задачи, выберите этот параметр. В противном случае выберите **"Получить динамический набор параметров" от бота.**
6. Добавьте **ид команды** и **заголовок.**
7. Выберите, откуда должна запускаться команда действий.
8. Если вы используете параметры для модуля задачи, добавьте первый из них.
9. Нажмите кнопку Save (Сохранить)
10. Если необходимо добавить дополнительные параметры, нажмите **кнопку** "Добавить" в разделе **"Параметры",** чтобы добавить их.

### <a name="manually-create-a-command"></a>Создание команды вручную

Чтобы вручную добавить команду расширения сообщений на основе действий в манифест приложения, необходимо добавить в массив объектов параметры, которые следует `composeExtension.commands` использовать.

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Уникальный ИД, присвоенный этой команде. Запрос пользователя будет включать этот ИД. | Да | 1.0 |
| `title` | Имя команды. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Необходимое значение — `action`. | Нет | 1.4 |
| `fetchTask` | `true` для адаптивной карточки или внедренного представления веб-страницы для модуля задачи, статического списка параметров или при загрузке представления `false` веб-страницы `taskInfo` | Нет | 1.4 |
| `context` | Необязательный массив значений, определяющий, откуда можно вызывать расширение обмена сообщениями. Возможные значения: `message` `compose` , или `commandBox` . Значение по умолчанию: `["compose", "commandBox"]`. | Нет | 1.5 |

Если вы используете статический список параметров, вы также добавим их.

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `parameters` | Статический список параметров для команды. Используйте только в `fetchTask` том случае, если `false` | Нет | 1.0 |
| `parameter.name` | Имя параметра. Он отправляется службе в запросе пользователя. | Да | 1.0 |
| `parameter.description` | Описывает цели этого параметра или пример значения, которое должно быть предоставлено. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Короткое название или метка удобного параметра. | Да | 1.0 |
| `parameter.inputType` | Установите требуемого типа ввода. Возможные значения: `text` `textarea` , , `number` `date` `time` `toggle` . Значение по умолчанию: `text` | Нет | 1.4 |

При использовании внедренного представления веб-страницы можно при желании добавить объект для получения представления веб-страницы, не вызывая `taskInfo` бота напрямую. Если вы решили использовать этот параметр, поведение аналогично использованию статического списка параметров, так как первое взаимодействие с ботом будет отвечать на действие отправки модуля [задачи.](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md) Если вы используете `taskInfo` объект, не забудьте также установить для `fetchTask` параметра `false` ..

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
|`taskInfo`|Указание модуля задачи для предварительной загрузки при использовании команды расширения обмена сообщениями| Нет | 1.4 |
|`taskInfo.title`|Заголовок модуля начальной задачи|Нет | 1.4 |
|`taskInfo.width`|Ширина модуля задачи — число в пикселях или макет по умолчанию, например "большой", "средний" или "маленький".|Нет | 1.4 |
|`taskInfo.height`|Высота модуля задачи — число в пикселях или макет по умолчанию, например "большой", "средний" или "маленький".|Нет | 1.4 |
|`taskInfo.url`|Исходный URL-адрес представления веб-страницы|Нет | 1.4 |

#### <a name="app-manifest-example"></a>Пример манифеста приложения

Ниже приведен пример объекта, `composeExtensions` определяющий две команды действий. Это не пример полного манифеста. Полную схему манифеста приложения см. в схеме [манифеста приложения.](~/resources/schema/manifest-schema.md)

```json
...
"composeExtensions": [
  {
    "botId": "12a3c29f-1fc5-4d97-a142-12bb662b7b23",
    "canUpdateConfiguration": true,
    "commands": [
      {
        "id": "addTodo",
        "description": "Create a To Do item",
        "title": "Create To Do",
        "type": "action",
        "context": ["commandBox", "message", "compose"],
        "fetchTask": true,
        "parameters": [
          {
            "name": "Name",
            "description": "To Do Title",
            "title": "Title",
            "inputType": "text"
          },
          {
            "name": "Description",
            "description": "Description of the task",
            "title": "Description",
            "inputType": "textarea"
          },
          {
            "name": "Date",
            "description": "Due date for the task",
            "title": "Date",
            "inputType": "date"
          }
        ]
      },
      {
        "id": "reassignTodo",
        "description": "Reassign a todo item",
        "title": "Reassign a todo item",
        "type": "action",
        "fetchTask": true,
      }
    ]
  }
]
...
```

## <a name="next-steps"></a>Дальнейшие действия

Если вы используете адаптивную карту или внедренное представление веб-страницы без объекта, вам `taskInfo` необходимо:

* [Создание модуля задачи и реагирование на него](~/messaging-extensions/how-to/action-commands/create-task-module.md)

Если вы используете параметры или внедренное представление веб-страницы с объектом, следующим шагом будет `taskInfo` следующее:

* [Реагирование на отправку модуля задачи](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md)

[!include[messaging-extension-learn-more](~/includes/messaging-extensions/learn-more.md)]
