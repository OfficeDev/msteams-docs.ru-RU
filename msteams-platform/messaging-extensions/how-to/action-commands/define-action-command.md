---
title: Определение команд действий расширения сообщения
author: surbhigupta
description: Обзор команд действий расширения сообщения с примером манифеста приложения
ms.localizationpriority: medium
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: ae0c39136b69b2759908bbbc54d1fff244eae0af
ms.sourcegitcommit: 0117c4e750a388a37cc189bba8fc0deafc3fd230
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2022
ms.locfileid: "65103945"
---
# <a name="define-message-extension-action-commands"></a>Определение команд действий расширения сообщения

[!include[v4-to-v3-SDK-pointer](~/includes/v4-to-v3-pointer-me.md)]

Команды действий позволяют предоставлять пользователям модальное всплывающее окно с именем модуля задач в Teams. Модуль задач собирает или отображает сведения, обрабатывает взаимодействие и отправляет сведения обратно в Teams. В этом документе описывается, как выбрать расположения вызова команды действия, создать модуль задач, отправить окончательное сообщение или карточку, создать команду действия с помощью App Studio или создать его вручную.

Перед созданием команды действия необходимо решить следующие факторы:

1. [Откуда можно активировать команду действия?](#select-action-command-invoke-locations)
1. [Как будет создан модуль задач?](#select-how-to-create-your-task-module)
1. [Будет ли отправлено окончательное сообщение или карточка каналу от бота или сообщение или карточка будут вставлены в область создания сообщения для отправки пользователем?](#select-how-the-final-message-is-sent)

## <a name="select-action-command-invoke-locations"></a>Выбор расположения вызова команды действия

Сначала необходимо определить расположение, из которого должна быть вызвана команда действия. Указав манифест `context` приложения, вы можете вызвать команду из одного или нескольких из следующих расположений:

* Область создания сообщения: кнопки в нижней части области сообщения создания.

    Контекст команды = compose

* Командная строка: @mentioning приложение в командной строке.

    Контекст команд = commandBox

   > [!NOTE]
   > Если из командного поля вызывается расширение сообщения, вы не сможете ответить сообщением бота, вставленным непосредственно в беседу.

* Сообщение: непосредственно из существующего сообщения через меню `...` переполнения сообщения.

    Контекст команд = сообщение

    > [!NOTE]
    > Начальный вызов бота включает объект JSON, содержащий сообщение, из которого он был вызван. Вы можете обработать сообщение перед его представлением с помощью модуля задач.

На следующем рисунке отображаются расположения, из которых вызывается команда action:

![Расположение вызова команды action](~/assets/images/messaging-extension-invoke-locations.png)

## <a name="select-how-to-create-your-task-module"></a>Выбор способа создания модуля задач

Помимо выбора места вызова команды, необходимо также выбрать способ заполнения формы в модуле задач для пользователей. У вас есть три варианта создания формы, отображаемой в модуле задачи:

* **Статический список параметров**: это самый простой метод. Вы можете определить список параметров в манифесте приложения, Teams отрисовка клиента, но не может управлять форматированием в этом случае.
* **Адаптивная карточка**. Вы можете выбрать адаптивную карточку, которая обеспечивает более полный контроль над пользовательским интерфейсом, но по-прежнему ограничивает доступные элементы управления и параметры форматирования.
* **Внедренное веб-представление**. Вы можете внедрить пользовательское веб-представление в модуль задач, чтобы получить полный контроль над пользовательским интерфейсом и элементами управления.

Если вы выбрали создание модуля задачи со статическим списком параметров и когда пользователь отправляет модуль задачи, вызывается расширение сообщения. При использовании внедренного веб-представления или адаптивной карточки расширение сообщения должно обрабатывать начальное событие вызова от пользователя, создавать модуль задачи и возвращать его клиенту.

## <a name="select-how-the-final-message-is-sent"></a>Выбор способа отправки окончательного сообщения

В большинстве случаев команда действия приводит к вставке карточки в окно создания сообщения. Пользователь может отправить его в канал или чат. В этом случае сообщение поступает от пользователя, и бот не может изменить или обновить карточку.

Если расширение сообщения вызывается из поля создания или непосредственно из сообщения, веб-служба может вставить окончательный ответ непосредственно в канал или чат. В этом случае адаптивная карточка поступает от бота, бот обновляет ее и при необходимости отвечает потоку беседы. Необходимо добавить объект в `bot` манифест приложения, используя тот же идентификатор и определив соответствующие области.

## <a name="add-the-action-command-to-your-app-manifest"></a>Добавление команды действия в манифест приложения

Чтобы добавить команду действия в манифест приложения, `composeExtension` необходимо добавить новый объект на верхний уровень JSON манифеста приложения. Для этого можно использовать один из следующих способов:

* [Создание команды действия с помощью App Studio](#create-an-action-command-using-app-studio)
* [Создание команды действия вручную](#create-an-action-command-manually)

### <a name="create-an-action-command-using-app-studio"></a>Создание команды действия с помощью App Studio

Вы можете создать команду действия с помощью **App Studio** или **портала разработчика**.

> [!NOTE]
> App Studio скоро будет выведена из употребления. Настройте, распространите и управляйте Teams приложениями с помощью нового [портала разработчика](https://dev.teams.microsoft.com/).

# <a name="app-studio"></a>[App Studio](#tab/AS)

> [!NOTE]
> Предварительным требованием для создания команды действия является то, что вы уже создали расширение сообщения. Сведения о том, как создать расширение сообщения, см. в разделе ["Создание расширения сообщения"](~/messaging-extensions/how-to/create-messaging-extension.md).

**Создание команды действия**

1. Откройте **App Studio** в клиенте Microsoft Teams и выберите вкладку **редактора манифеста**.
1. Если вы уже создали пакет приложения в **App Studio**, выберите его из списка. Если вы еще не создали пакет приложения, импортируйте существующий.
1. После импорта пакета приложения выберите расширения **сообщений в** разделе **"Возможности"**. Вы получите всплывающее окно для настройки расширения сообщения.
1. Выберите **"Настроить"** в окне, чтобы включить расширение сообщения в интерфейс приложения. На следующем рисунке показано окно настройки расширения сообщения:

    <img src="~/assets/images/messaging-extension/messaging-extension-set-up.png" alt="messaging extension set up" width="500"/>

1. Чтобы создать расширение сообщения, вам потребуется зарегистрированный бот Майкрософт. Вы можете использовать существующий бот или создать новый бот. Выберите **параметр "Создать бот** ", присвойте имя новому боту и нажмите кнопку **"Создать"**. На следующем рисунке показано создание бота для расширения сообщений:

    <img src="~/assets/images/messaging-extension/create-bot-for-messaging-extension.png" alt="create bot for messaging extension" width="500"/>

1. Выберите **"** Добавить" **в разделе "Команда** " на странице расширений сообщений, чтобы включить команды, которые определяют поведение расширения сообщения.
На следующем рисунке показано добавление команды для расширения сообщения:

   <img src="~/assets/images/messaging-extension/include-command.png" alt="include command" width="500"/>

1. Выберите **"Разрешить пользователям активировать действия во внешних службах в Teams**". На следующем рисунке показан выбор команды действия:

    <img src="~/assets/images/messaging-extension/action-command-selection.png" alt="action command selection" width="500"/>

1. Чтобы использовать статический набор параметров для создания модуля задач, выберите "Определить набор статических параметров **для команды"**.

    На следующем рисунке показан выбор статического параметра команды действия:

   <img src="~/assets/images/messaging-extension/action-command-static-parameter-selection.png" alt="action command static parameter selection" width="500"/>

    На следующем рисунке показан пример настройки статического параметра:

   <img src="~/assets/images/messaging-extension/setting-up-of-static-parameter.png" alt="action command static parameter set-up" width="500"/>

    На следующем рисунке показан пример тестирования статических параметров:

   <img src="~/assets/images/messaging-extension/static-parameter-testing.png" alt="action command static parameter testing" width="500"/>

1. Чтобы использовать динамические параметры, выберите **для получения динамического набора параметров из бота**. На следующем рисунке показан выбор параметра команды действия:

    <img src="~/assets/images/messaging-extension/action-command-dynamic-parameter-selection.png" alt="action command dynamic parameter selection" width="500"/>

1. Добавьте идентификатор **команды и** **заголовок**.
1. Выберите расположение, из которого вы хотите вызвать команду действия. На следующем рисунке показано расположение вызова команды действия:

    <img src="~/assets/images/messaging-extension/action-command-invoke-location.png" alt="action command invoke location" width="500"/>

1. Выберите **Сохранить**.
1. Чтобы добавить дополнительные параметры, нажмите кнопку **"** Добавить" в **разделе "Параметры** ".

### <a name="create-an-action-command-manually"></a>Создание команды действия вручную

Чтобы вручную добавить команду расширения сообщения на основе действий в манифест приложения, `composeExtension.commands` необходимо добавить в массив объектов следующие параметры:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Это свойство является уникальным идентификатором, который назначается этой команде. Запрос пользователя включает этот идентификатор. | Да | 1.0 |
| `title` | Это свойство является именем команды. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Это свойство должно иметь значение `action`. | Нет | 1.4 |
| `fetchTask` | Это свойство имеет `true` значение для адаптивной карточки или внедренного веб-представления для модуля задачи,`false` а также для статического списка параметров или при загрузке веб-представления `taskInfo`с помощью . | Нет | 1.4 |
| `context` | Это свойство является необязательным массивом значений, который определяет, откуда вызывается расширение сообщения. Возможные значения — `message`, `compose` и `commandBox`. Значение по умолчанию — `["compose", "commandBox"]`. | Нет | 1.5 |

При использовании статического списка параметров необходимо также добавить следующие параметры:

| Имя свойства | Назначение | Требуется ли? | Минимальная версия манифеста |
|---|---|---|---|
| `parameters` | Это свойство описывает статический список параметров для команды. Используйте только в том случае`fetchTask`.`false` | Нет | 1.0 |
| `parameter.name` | Это свойство описывает имя параметра. Он отправляется в службу в запросе пользователя. | Да | 1.0 |
| `parameter.description` | Это свойство описывает цели параметра или пример значения, которое должно быть предоставлено. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Это свойство представляет собой краткое понятное название параметра или метку. | Да | 1.0 |
| `parameter.inputType` | Для этого свойства задается требуемый тип входных данных. Возможные значения: `text`, , , `number`, `date`, `time``toggle``textarea`. Значение по умолчанию — `text`.. | Нет | 1.4 |

Если вы используете внедренное веб-представление, `taskInfo` при необходимости можно добавить объект для получения веб-представления без прямого вызова бота. При выборе этого параметра поведение аналогично использованию статического списка параметров. В том, что первое взаимодействие с ботом отвечает [на действие отправки модуля задачи](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md). При использовании объекта `taskInfo` необходимо задать для параметра `fetchTask` значение .`false`

| Имя свойства | Назначение | Требуется ли? | Минимальная версия манифеста |
|---|---|---|---|
|`taskInfo`|Укажите модуль задачи для предварительной загрузки при использовании команды расширения сообщения. | Нет | 1.4 |
|`taskInfo.title`|Заголовок модуля начальной задачи. |Нет | 1.4 |
|`taskInfo.width`|Ширина модуля задачи, число в пикселях или макет по умолчанию, например `large`, `medium`или `small`. |Нет | 1.4 |
|`taskInfo.height`|Высота модуля задач, число в пикселях или макет по умолчанию, например `large`, `medium`или `small`.|Нет | 1.4 |
|`taskInfo.url`|Исходный URL-адрес веб-представления.|Нет | 1.4 |

#### <a name="app-manifest-example"></a>Пример манифеста приложения

В следующем разделе приведен пример объекта, определяющего `composeExtensions` две команды действий. Это не пример полного манифеста. Полную схему манифеста приложения см. в [разделе схемы манифеста приложения](~/resources/schema/manifest-schema.md):

```json
...
"composeExtensions": [
  {
    "botId": "12a3c29f-1fc5-4d97-a142-12bb662b7b23",
    "canUpdateConfiguration": true,
    "commands": [
      {
        "id": "addTodo",
        "description": "Create a To Do item",
        "title": "Create To Do",
        "type": "action",
        "context": ["commandBox", "message", "compose"],
        "fetchTask": true,
        "parameters": [
          {
            "name": "Name",
            "description": "To Do Title",
            "title": "Title",
            "inputType": "text"
          },
          {
            "name": "Description",
            "description": "Description of the task",
            "title": "Description",
            "inputType": "textarea"
          },
          {
            "name": "Date",
            "description": "Due date for the task",
            "title": "Date",
            "inputType": "date"
          }
        ]
      },
      {
        "id": "reassignTodo",
        "description": "Reassign a todo item",
        "title": "Reassign a todo item",
        "type": "action",
        "fetchTask": true,
      }
    ]
  }
]
...
```

## <a name="code-sample"></a>Пример кода

| Имя образца           | Описание | .NET    | Node.js   |
|:---------------------|:--------------|:---------|:--------|
|Teams расширения сообщения| Описывает, как определить команды действий, создать модуль задач и реагировать на действие отправки модуля задачи. |[View](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/51.teams-messaging-extensions-action)|[View](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/51.teams-messaging-extensions-action) |

## <a name="step-by-step-guide"></a>Пошаговые инструкции

Выполните [пошаговое руководство,](../../../sbs-meetingextension-action.yml) чтобы создать расширение Teams сообщений на основе действий.

## <a name="next-step"></a>Следующий этап

Если вы используете адаптивную `taskInfo` карточку или внедренное веб-представление без объекта, следующим шагом является следующее:

> [!div class="nextstepaction"]
> [Создание модуля задачи и реагирование на него](~/messaging-extensions/how-to/action-commands/create-task-module.md)

Если вы используете параметры или внедренное `taskInfo` веб-представление с объектом, следующим шагом является следующее:

> [!div class="nextstepaction"]
> [Ответ на отправку модуля задачи](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md)
