---
title: Определение команд действий расширения для сообщений
author: surbhigupta
description: Узнайте, как определить команды действий расширения сообщений с помощью примера манифеста приложения в Microsoft Teams. Пример (.NET, Node.js) определения команд действий, создания модуля задач и реагирования на действие отправки модуля задачи.
ms.localizationpriority: medium
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: cb7d8512b6e8de980778733c39b19e7c1d63fae6
ms.sourcegitcommit: 75d0072c021609af33ce584d671f610d78b3aaef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2022
ms.locfileid: "68100737"
---
# <a name="define-message-extension-action-commands"></a>Определение команд действий расширения для сообщений

[!include[v4-to-v3-SDK-pointer](~/includes/v4-to-v3-pointer-me.md)]

> [!NOTE]
> При запуске действия сообщения сведения о вложении не отправляются в `turncontext` рамках действия вызова.

Команды действий позволяют представить пользователям модальное всплывающее окно, называемее модулем задач в Teams. Модуль задач собирает или выводит сведения, обрабатывает взаимодействие и отправляет сведения обратно в Teams. В этом документе описывается, как выбрать расположения вызова команды действия, создать модуль задач, отправить окончательное сообщение или карточку, создать команду действия с помощью App Studio или вручную.

Перед созданием команды действия необходимо решить следующие важные вопросы:

1. [Откуда можно будет активировать команду действия?](#select-action-command-invoke-locations)
1. [Как будет создан модуль задач?](#select-how-to-create-your-task-module)
1. [Будут ли окончательное сообщение или карточка отправлены в канал ботом или вставлены в область создания сообщения для отправки пользователем?](#select-how-the-final-message-is-sent)

В следующем видео показано, как определить команды действий расширения сообщений:
<br>

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4OANG]
<br>

## <a name="select-action-command-invoke-locations"></a>Выбор расположений, из которых будет вызываться команда действия

Сначала необходимо определить расположение, из которого должна быть вызвана команда действия. Указав `context` в манифесте приложения, вы можете вызвать команду из одного или нескольких следующих расположений:

* Область создания сообщения: кнопки в нижней части области создания сообщения.

    Контекст команды = compose

* Командная строка: @упоминанием приложения в командной строке.

    Контекст команд = commandBox

   > [!NOTE]
   > Если расширение для сообщений вызывается из командного поля, вы не сможете ответить сообщением бота, вставленным непосредственно в беседу.

* Сообщение: непосредственно из существующего сообщения через меню переполнения `...` сообщения.

    Контекст команд = сообщение

    > [!NOTE]
    > Начальный вызов бота включает объект JSON, содержащий сообщение, из которого он был вызван. Вы можете обработать сообщение, прежде чем показать пользователю модуль задач.

На следующем рисунке показаны расположения, из которых вызывается команда действия:

:::image type="content" source="~/assets/images/messaging-extension-invoke-locations.png" alt-text="Расположения вызова команды действия":::

## <a name="select-how-to-create-your-task-module"></a>Выбор способа, которым будет создан модуль задач

Решив, откуда будет вызываться команда, выберите также способ заполнения формы в модуле задач для пользователей. У вас есть три варианта создания формы, показанной в модуле задачи:

* **Статический список параметров**: это самый простой метод. Вы можете определить список параметров в манифесте приложения, отображаемом клиентом Teams, но не можете управлять форматированием в этом случае.
* **Адаптивная карточка**. Вы можете выбрать адаптивную карточку, что обеспечивает более полный контроль над пользовательским интерфейсом, но по-прежнему ограничивает доступность элементов управления и параметров форматирования.
* **Внедренное веб-представление**. Вы можете внедрить пользовательское веб-представление в модуль задач, чтобы получить полный контроль над пользовательским интерфейсом и элементами управления.

Если вы выбрали создание модуля задачи со статическим списком параметров, то при отправке пользователем модуля задачи вызывается расширение для сообщений. При использовании внедренного веб-представления или адаптивной карточки расширение для сообщений должно обрабатывать начальное событие вызова от пользователя, создавать модуль задачи и возвращать его клиенту.

## <a name="select-how-the-final-message-is-sent"></a>Выбор способа, которым будет отправлено окончательное сообщение

В большинстве случаев команда действия приводит к вставке карточки в окно создания сообщения. Пользователь может отправить ее в канал или чат. В этом случае сообщение поступает от пользователя, и бот не может изменить или обновить карточку.

Если расширение для сообщений вызывается из поля создания или непосредственно из сообщения, веб-служба может вставить окончательный ответ непосредственно в канал или чат. В этом случае адаптивная карточка поступает от бота, бот обновляет ее и при необходимости отвечает потоку беседы. Необходимо добавить объект `bot` в манифест приложения, используя тот же идентификатор и определив соответствующие области.

## <a name="add-the-action-command-to-your-app-manifest"></a>Добавление команды действия в манифест приложения

To add the action command to the app manifest, you must add a new `composeExtension` object to the top level of the app manifest JSON. You can use one of the following ways to do so:

* [Создание команды действия с помощью портала разработчика](#create-an-action-command-using-developer-portal)
* [Создание команды действия вручную](#create-an-action-command-manually)

### <a name="create-an-action-command-using-developer-portal"></a>Создание команды действия с помощью портала разработчика

Вы можете создать команду действия с помощью **портала разработчика**.

> [!NOTE]
> Предпосылкой для создания команды действия является уже созданное расширение для сообщений. Сведения о том, как создать расширение для сообщений, см. в разделе [Создание расширения для сообщений](~/messaging-extensions/how-to/create-messaging-extension.md).

Чтобы создать команду действия:

1. Откройте **портал разработчика** в клиенте Microsoft Teams и выберите вкладку **"Приложения** ". Если вы уже создали пакет приложения на портале **разработчика**, выберите его из списка. Если вы еще не создали пакет приложения, импортируйте существующий.
1. После импорта пакета приложения выберите расширения **сообщений в** разделе **"Функции приложения"**.
1. Чтобы создать расширение для сообщений, вам потребуется зарегистрированный бот Майкрософт. Можно использовать существующий бот или создать новый. Выберите **параметр "Создать бот** ", присвойте имя новому боту и нажмите кнопку **"Создать"**.

   :::image type="content" source="../../../assets/images/tdp/bot-page.png" alt-text="На снимке экрана показано, как создать бот на портале разработчика.":::

1. Чтобы использовать существующий бот, выберите  "Выбрать существующий бот" и выберите существующие боты из раскрывающегося списка  или введите идентификатор бота, если идентификатор бота уже создан.

1. Выберите область расширения обмена сообщениями и нажмите кнопку **"Сохранить"**.

1. Выберите **"Добавить команду"** **в разделе** "Команда", чтобы включить команды, которые определяют поведение расширения сообщения.

   :::image type="content" source="../../../assets/images/tdp/add-a-command.PNG" alt-text="Снимок экрана: добавление команды для определения поведения расширения сообщения.":::

1. Выберите **действие и** тип параметра.

1. **Введите идентификатор команды**, **заголовок команды** и **описание команды**.

1. Введите все параметры и выберите тип входных данных из раскрывающегося списка.

   :::image type="content" source="../../../assets/images/tdp/add-a-command-parameter.PNG" alt-text="Снимок экрана: добавление параметров для определения команды расширения сообщения.":::

1. Выберите **"Добавить домен" в разделе** " **Предварительный просмотр ссылок"**.

1. Введите допустимый домен и нажмите кнопку **"Добавить"**.

   :::image type="content" source="../../../assets/images/tdp/add-domain.PNG" alt-text="Снимок экрана: добавление допустимого домена в расширение обмена сообщениями для удаления ссылок.":::

1. Нажмите кнопку **Сохранить**.

   :::image type="content" source="../../../assets/images/tdp/add-a-command-save.PNG" alt-text="Снимок экрана: сохранение всех параметров и параметров для расширения сообщения.":::

**Добавление дополнительных параметров**

1. Щелкните многоточие в разделе команд, а затем выберите " **Изменить параметр"**.

   :::image type="content" source="../../../assets/images/tdp/edit-parameters.PNG" alt-text="На снимках экрана показано, как добавить дополнительные параметры для расширения сообщения.":::

1. Выберите **"Добавить параметры"** и введите все параметры.

   :::image type="content" source="../../../assets/images/tdp/add-parameter.PNG" alt-text="Снимок экрана: добавление дополнительных параметров для расширения сообщения."lightbox="../../../assets/images/tdp/add-a-parameters.PNG":::

### <a name="create-an-action-command-manually"></a>Создание команды действия вручную

Чтобы вручную добавить команду расширения для сообщений на основе действий в манифест приложения, необходимо добавить в массив объектов `composeExtension.commands` следующие параметры:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Это свойство является уникальным идентификатором, который назначается этой команде. Запрос пользователя включает этот идентификатор. | Да | 1.0 |
| `title` | Это свойство является именем команды. Это значение выводится в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Это свойство должно иметь значение `action`. | Нет | 1.4 |
| `fetchTask` | Это свойство имеет значение `true` для адаптивной карточки или внедренного веб-представления для модуля задачи и `false` для статического списка параметров или при загрузке веб-представления посредством `taskInfo`. | Нет | 1.4 |
| `context` | Это свойство является необязательным массивом значений, который определяет, откуда вызывается расширение для сообщений. Возможные значения — `message`, `compose` и `commandBox`. Значение по умолчанию — `["compose", "commandBox"]`. | Нет | 1.5 |

Если вы используете статический список параметров, необходимо также добавить следующие параметры:

| Имя свойства | Назначение | Обязательно? | Минимальная версия манифеста |
|---|---|---|---|
| `parameters` | This property describes the static list of parameters for the command. Only use when `fetchTask` is `false`. | Нет | 1.0 |
| `parameter.name` | Это свойство описывает имя параметра. Оно отправляется в службу в составе запроса пользователя. | Да | 1.0 |
| `parameter.description` | This property describes the parameter’s purposes or example of the value that should be provided. This value appears in the UI. | Да | 1.0 |
| `parameter.title` | Это свойство представляет собой краткое понятное название или метку параметра. | Да | 1.0 |
| `parameter.inputType` | Для этого свойства задается требуемый тип входных данных. Возможные значения: `text`, `textarea`, `number`, `date`, `time`, `toggle`. Значение по умолчанию `text`. | Нет | 1.4 |

Если вы используете внедренное веб-представление, `taskInfo` при необходимости можно добавить объект для получения представления веб-страницы без прямого вызова бота. В этом случае использование аналогично использованию статического списка параметров. В том смысле, что первое взаимодействие с ботом представляет собой [ответ на действие отправки модуля задачи](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md). Если вы используете объект`taskInfo`, необходимо задать для параметра `fetchTask` значение .`false`

| Имя свойства | Назначение | Обязательно? | Минимальная версия манифеста |
|---|---|---|---|
|`taskInfo`|Укажите модуль задачи для предварительной загрузки при использовании команды расширения для обмена сообщениями. | Нет | 1.4 |
|`taskInfo.title`|Заголовок модуля начальной задачи. |Нет | 1.4 |
|`taskInfo.width`|Ширина диалогового окна — количество пикселей или значение по умолчанию, например `large`, `medium` или `small`. |Нет | 1.4 |
|`taskInfo.height`|Высота диалогового окна — количество пикселей или значение по умолчанию, например `large`, `medium` или `small`.|Нет | 1.4 |
|`taskInfo.url`|Исходный URL-адрес веб-представления.|Нет | 1.4 |

#### <a name="app-manifest-example"></a>Пример манифеста приложения

В следующем разделе приведен пример объекта `composeExtensions`, определяющего две команды действий. Это не пример полного манифеста. Полную схему манифеста приложения см. в разделе [схемы манифеста приложения](~/resources/schema/manifest-schema.md):

```json
...
"composeExtensions": [
  {
    "botId": "c8fa3cf6-b1f0-4ba8-a5bf-a241bc29adf3",
    "scopes": [
      "personal",
      "groupchat"
    ],
    "commands": [
      {
        "id": "To do",
        "type": "action",
        "title": "Create To do",
        "description": "Create a To do",
        "initialRun": true,
        "fetchTask": false,
        "context": [
          "commandBox",
          "compose"
        ],
        "parameters": [
          {
            "name": "Name",
            "title": "Title",
            "description": "To do Title",
            "inputType": "text"
          },
          {
            "name": "Description",
            "title": "Description",
            "description": "Description of the task",
            "inputType": "textarea"
          },
          {
            "name": "Date",
            "title": "Date",
            "description": "Due date for the task",
            "inputType": "date"
          }
        ]
      }
    ],
    "canUpdateConfiguration": true,
    "messageHandlers": [
      {
        "type": "link",
        "value": {
          "domains": [
            "yourapp.onmicrosoft.com"
          ]
        }
      }
    ]
  }
]
...
```

## <a name="code-sample"></a>Пример кода

| Название примера           | Описание | .NET    | Node.js   |
|:---------------------|:--------------|:---------|:--------|
|Действие расширения для сообщений Teams| Описывает, как определить команды действий, создать модуль задач и ответить на действие отправки модуля задач. |[Просмотр](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/51.teams-messaging-extensions-action)|[View](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/51.teams-messaging-extensions-action) |

## <a name="step-by-step-guide"></a>Пошаговые инструкции

Следуйте [пошаговому руководству по созданию расширения для сообщений на основе действий](../../../sbs-meetingextension-action.yml)

## <a name="next-step"></a>Следующий этап

Если вы используете адаптивную `taskInfo` карточку или внедренное веб-представление без объекта, следующим шагом является следующее:

> [!div class="nextstepaction"]
> [Создание модуля задачи и реагирование с его помощью](~/messaging-extensions/how-to/action-commands/create-task-module.md)

Если вы используете параметры `taskInfo` или внедренное веб-представление с объектом, следующим шагом является следующее:

> [!div class="nextstepaction"]
> [Ответ на отправку модуля задач](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md)
