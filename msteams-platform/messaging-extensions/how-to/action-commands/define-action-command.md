---
title: Определение команд действий расширения для сообщений
author: surbhigupta
description: В этом модуле вы узнаете, как определить команды действий расширения обмена сообщениями с помощью примера манифеста приложения в Microsoft Teams.
ms.localizationpriority: medium
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: 2769dc4d76f6b417f3264dd321b0d5c5e794c9f8
ms.sourcegitcommit: fb0942afb8be32d92df282dec03fbb3b13f8f303
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2022
ms.locfileid: "67264185"
---
# <a name="define-message-extension-action-commands"></a>Определение команд действий расширения для сообщений

[!include[v4-to-v3-SDK-pointer](~/includes/v4-to-v3-pointer-me.md)]

> [!NOTE]
> При запуске действия сообщения сведения о вложении не отправляются в `turncontext` рамках действия вызова.

Команды действий позволяют представить пользователям модальное всплывающее окно, называемее модулем задач в Teams. Модуль задач собирает или выводит сведения, обрабатывает взаимодействие и отправляет сведения обратно в Teams. В этом документе описывается, как выбрать расположения вызова команды действия, создать модуль задач, отправить окончательное сообщение или карточку, создать команду действия с помощью App Studio или вручную.

Перед созданием команды действия необходимо решить следующие важные вопросы:

1. [Откуда можно будет активировать команду действия?](#select-action-command-invoke-locations)
1. [Как будет создан модуль задач?](#select-how-to-create-your-task-module)
1. [Будут ли окончательное сообщение или карточка отправлены в канал ботом или вставлены в область создания сообщения для отправки пользователем?](#select-how-the-final-message-is-sent)

В следующем видео показано, как определить команды действий расширения сообщений:
<br>

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4OANG]
<br>

## <a name="select-action-command-invoke-locations"></a>Выбор расположений, из которых будет вызываться команда действия

Сначала необходимо определить расположение, из которого должна быть вызвана команда действия. Указав `context` в манифесте приложения, вы можете вызвать команду из одного или нескольких следующих расположений:

* Область создания сообщения: кнопки в нижней части области создания сообщения.

    Контекст команды = compose

* Командная строка: @упоминанием приложения в командной строке.

    Контекст команд = commandBox

   > [!NOTE]
   > Если расширение для сообщений вызывается из командного поля, вы не сможете ответить сообщением бота, вставленным непосредственно в беседу.

* Сообщение: непосредственно из существующего сообщения через меню переполнения `...` сообщения.

    Контекст команд = сообщение

    > [!NOTE]
    > Начальный вызов бота включает объект JSON, содержащий сообщение, из которого он был вызван. Вы можете обработать сообщение, прежде чем показать пользователю модуль задач.

На следующем рисунке показаны расположения, из которых вызывается команда действия:

:::image type="content" source="~/assets/images/messaging-extension-invoke-locations.png" alt-text="Расположения вызова команды действия":::

## <a name="select-how-to-create-your-task-module"></a>Выбор способа, которым будет создан модуль задач

Решив, откуда будет вызываться команда, выберите также способ заполнения формы в модуле задач для пользователей. У вас есть три варианта создания формы, показанной в модуле задачи:

* **Статический список параметров**: это самый простой метод. Вы можете определить список параметров в манифесте приложения, отображаемом клиентом Teams, но не можете управлять форматированием в этом случае.
* **Адаптивная карточка**. Вы можете выбрать адаптивную карточку, что обеспечивает более полный контроль над пользовательским интерфейсом, но по-прежнему ограничивает доступность элементов управления и параметров форматирования.
* **Внедренное веб-представление**. Вы можете внедрить пользовательское веб-представление в модуль задач, чтобы получить полный контроль над пользовательским интерфейсом и элементами управления.

Если вы выбрали создание модуля задачи со статическим списком параметров, то при отправке пользователем модуля задачи вызывается расширение для сообщений. При использовании внедренного веб-представления или адаптивной карточки расширение для сообщений должно обрабатывать начальное событие вызова от пользователя, создавать модуль задачи и возвращать его клиенту.

## <a name="select-how-the-final-message-is-sent"></a>Выбор способа, которым будет отправлено окончательное сообщение

В большинстве случаев команда действия приводит к вставке карточки в окно создания сообщения. Пользователь может отправить ее в канал или чат. В этом случае сообщение поступает от пользователя, и бот не может изменить или обновить карточку.

Если расширение для сообщений вызывается из поля создания или непосредственно из сообщения, веб-служба может вставить окончательный ответ непосредственно в канал или чат. В этом случае адаптивная карточка поступает от бота, бот обновляет ее и при необходимости отвечает потоку беседы. Необходимо добавить объект `bot` в манифест приложения, используя тот же идентификатор и определив соответствующие области.

## <a name="add-the-action-command-to-your-app-manifest"></a>Добавление команды действия в манифест приложения

Чтобы добавить команду действия в манифест приложения, необходимо добавить новый объект `composeExtension` на верхний уровень JSON манифеста приложения. Это можно сделать одним из следующих способов:

* [Создание команды действия с помощью App Studio](#create-an-action-command-using-app-studio)
* [Создание команды действия вручную](#create-an-action-command-manually)

### <a name="create-an-action-command-using-app-studio"></a>Создание команды действия с помощью App Studio

Вы можете создать команду действия с помощью **App Studio** или **портала разработчика**.

> [!WARNING]
 > Если до сих пор вы использовали App Studio, рекомендуем попробовать [Портал разработчика](https://dev.teams.microsoft.com/) для настройки, распространения приложений Teams и управления ими. App Studio не рекомендуется к использованию 1 августа 2022 г.

# <a name="app-studio"></a>[App Studio](#tab/AS)

> [!NOTE]
> Предпосылкой для создания команды действия является уже созданное расширение для сообщений. Сведения о том, как создать расширение для сообщений, см. в разделе [Создание расширения для сообщений](~/messaging-extensions/how-to/create-messaging-extension.md).

**Создание команды действия**

1. Откройте **App Studio** в клиенте Microsoft Teams и выберите вкладку **редактора манифеста**.
1. Если вы уже создали пакет приложения в **App Studio**, выберите его из списка. Если вы еще не создали пакет приложения, импортируйте существующий.
1. После импорта пакета приложения выберите **Расширения сообщений** в разделе **Возможности**. Вы получите всплывающее окно настройки расширения для сообщений.
1. Выберите в окне **Настроить**, чтобы включить расширение для сообщений в интерфейс приложения. На следующем рисунке показано окно настройки расширения для сообщений:

    :::image type="content" source="~/assets/images/messaging-extension/messaging-extension-set-up.png" alt-text="Настройка расширения для сообщений":::

1. Чтобы создать расширение для сообщений, вам потребуется зарегистрированный бот Майкрософт. Можно использовать существующий бот или создать новый. Выберите **Создать бот**, присвойте имя новому боту и щелкните **Создать**. На следующем рисунке показано создание бота расширения для сообщений:

    :::image type="content" source="~/assets/images/messaging-extension/create-bot-for-messaging-extension.png" alt-text="Создание бота расширения для сообщений":::

1. Чтобы использовать существующий бот, выберите **Использовать существующий бот** и щелкните **Выбрать один из существующих ботов**, чтобы выбрать существующие боты из раскрывающегося списка; укажите **Имя бота** и выберите **Сохранить**. Или выберите **Подключение к другому идентификатору бота**, если идентификатор бота уже создан, укажите **Имя бота** и выберите **Сохранить**. 

    :::image type="content" source="~/assets/images/messaging-extension/use-existing-bot.png" alt-text="Использование существующего бота в расширении для сообщений":::

1. Выберите **Добавить** в **разделе "Команды"** на странице расширений для сообщений, чтобы включить команды, определяющие поведение расширения для сообщений. На следующем изображении показано добавление команды для расширения для сообщений:

    :::image type="content" source="~/assets/images/messaging-extension/include-command.png" alt-text="Добавление команды":::

1. Выберите **Разрешить пользователям активировать действия во внешних службах, находясь внутри Teams**. На следующем рисунке показан выбор команды действия:

    :::image type="content" source="~/assets/images/messaging-extension/action-command-selection.png" alt-text="Выбор команды действия":::

1. Чтобы использовать статический набор параметров для создания модуля задач, выберите **Определить набор статических параметров для команды**.

    На следующем рисунке показан выбор статического параметра команды действия:

    :::image type="content" source="~/assets/images/messaging-extension/action-command-static-parameter-selection.png" alt-text="Выбор статического параметра команды действия":::

    На следующем рисунке показан пример настройки статических параметров:

    :::image type="content" source="~/assets/images/messaging-extension/setting-up-of-static-parameter.png" alt-text="Настройка статических параметров команды действия":::

    На следующем рисунке показан пример тестирования статических параметров:

    :::image type="content" source="~/assets/images/messaging-extension/static-parameter-testing.png" alt-text="Тестирование статических параметров в команде действия":::

1. Чтобы использовать динамические параметры, выберите **Получение динамического набора параметров из бота**. На следующем рисунке показан выбор параметра команды действия:

    :::image type="content" source="~/assets/images/messaging-extension/action-command-dynamic-parameter-selection.png" alt-text="Выбор динамического параметра команды действия":::

1. Добавьте **Идентификатор команды** и **Заголовок**.
1. Выберите расположение, из которого хотите вызвать команду действия. На следующем рисунке показано расположение вызова команды действия:

    :::image type="content" source="~/assets/images/messaging-extension/action-command-invoke-location.png" alt-text="Расположение вызова команды действия":::

1. Нажмите **Сохранить**.
1. Чтобы добавить дополнительные параметры, нажмите кнопку **Добавить** в разделе **Параметры**.

### <a name="create-an-action-command-manually"></a>Создание команды действия вручную

Чтобы вручную добавить команду расширения для сообщений на основе действий в манифест приложения, необходимо добавить в массив объектов `composeExtension.commands` следующие параметры:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Это свойство является уникальным идентификатором, который назначается этой команде. Запрос пользователя включает этот идентификатор. | Да | 1.0 |
| `title` | Это свойство является именем команды. Это значение выводится в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Это свойство должно иметь значение `action`. | Нет | 1.4 |
| `fetchTask` | Это свойство имеет значение `true` для адаптивной карточки или внедренного веб-представления для модуля задачи и `false` для статического списка параметров или при загрузке веб-представления посредством `taskInfo`. | Нет | 1.4 |
| `context` | Это свойство является необязательным массивом значений, который определяет, откуда вызывается расширение для сообщений. Возможные значения — `message`, `compose` и `commandBox`. Значение по умолчанию — `["compose", "commandBox"]`. | Нет | 1.5 |

Если вы используете статический список параметров, необходимо также добавить следующие параметры:

| Имя свойства | Назначение | Обязательно? | Минимальная версия манифеста |
|---|---|---|---|
| `parameters` | Это свойство описывает статический список параметров для команды. Применяется, только если свойство `fetchTask` имеет значение `false`. | Нет | 1.0 |
| `parameter.name` | Это свойство описывает имя параметра. Оно отправляется в службу в составе запроса пользователя. | Да | 1.0 |
| `parameter.description` | Это свойство описывает назначение параметра или пример значения, которое должно быть предоставлено. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Это свойство представляет собой краткое понятное название или метку параметра. | Да | 1.0 |
| `parameter.inputType` | Для этого свойства задается требуемый тип входных данных. Возможные значения: `text`, `textarea`, `number`, `date`, `time`, `toggle`. Значение по умолчанию `text`. | Нет | 1.4 |

Если вы используете внедренное веб-представление, `taskInfo` при необходимости можно добавить объект для получения представления веб-страницы без прямого вызова бота. В этом случае использование аналогично использованию статического списка параметров. В том смысле, что первое взаимодействие с ботом представляет собой [ответ на действие отправки модуля задачи](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md). Если вы используете объект`taskInfo`, необходимо задать для параметра `fetchTask` значение .`false`

| Имя свойства | Назначение | Обязательно? | Минимальная версия манифеста |
|---|---|---|---|
|`taskInfo`|Укажите модуль задачи для предварительной загрузки при использовании команды расширения для обмена сообщениями. | Нет | 1.4 |
|`taskInfo.title`|Заголовок модуля начальной задачи. |Нет | 1.4 |
|`taskInfo.width`|Ширина диалогового окна — количество пикселей или значение по умолчанию, например `large`, `medium` или `small`. |Нет | 1.4 |
|`taskInfo.height`|Высота диалогового окна — количество пикселей или значение по умолчанию, например `large`, `medium` или `small`.|Нет | 1.4 |
|`taskInfo.url`|Исходный URL-адрес веб-представления.|Нет | 1.4 |

#### <a name="app-manifest-example"></a>Пример манифеста приложения

В следующем разделе приведен пример объекта `composeExtensions`, определяющего две команды действий. Это не пример полного манифеста. Полную схему манифеста приложения см. в разделе [схемы манифеста приложения](~/resources/schema/manifest-schema.md):

```json
...
"composeExtensions": [
  {
    "botId": "12a3c29f-1fc5-4d97-a142-12bb662b7b23",
    "canUpdateConfiguration": true,
    "commands": [
      {
        "id": "addTodo",
        "description": "Create a To Do item",
        "title": "Create To Do",
        "type": "action",
        "context": ["commandBox", "message", "compose"],
        "fetchTask": false,
        "parameters": [
          {
            "name": "Name",
            "description": "To Do Title",
            "title": "Title",
            "inputType": "text"
          },
          {
            "name": "Description",
            "description": "Description of the task",
            "title": "Description",
            "inputType": "textarea"
          },
          {
            "name": "Date",
            "description": "Due date for the task",
            "title": "Date",
            "inputType": "date"
          }
        ]
      },
      {
        "id": "reassignTodo",
        "description": "Reassign a todo item",
        "title": "Reassign a todo item",
        "type": "action",
        "fetchTask": false,
      }
    ]
  }
]
...
```

## <a name="code-sample"></a>Пример кода

| Название примера           | Описание | .NET    | Node.js   |
|:---------------------|:--------------|:---------|:--------|
|Действие расширения для сообщений Teams| Описывает, как определить команды действий, создать модуль задач и ответить на действие отправки модуля задач. |[Просмотр](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/51.teams-messaging-extensions-action)|[View](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/51.teams-messaging-extensions-action) |

## <a name="step-by-step-guide"></a>Пошаговые инструкции

Следуйте [пошаговому руководству по созданию расширения для сообщений на основе действий](../../../sbs-meetingextension-action.yml)

## <a name="next-step"></a>Следующий этап

Если вы используете адаптивную `taskInfo` карточку или внедренное веб-представление без объекта, следующим шагом является следующее:

> [!div class="nextstepaction"]
> [Создание модуля задачи и реагирование с его помощью](~/messaging-extensions/how-to/action-commands/create-task-module.md)

Если вы используете параметры `taskInfo` или внедренное веб-представление с объектом, следующим шагом является следующее:

> [!div class="nextstepaction"]
> [Ответ на отправку модуля задач](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md)
