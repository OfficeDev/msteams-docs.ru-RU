---
title: Определение команд действий расширения обмена сообщениями
author: surbhigupta
description: Обзор команд действий расширения обмена сообщениями с примером манифеста приложения
ms.localizationpriority: medium
ms.topic: conceptual
ms.author: anclear
ms.openlocfilehash: 938e37fac8cd27257e378fa1177916462b331023
ms.sourcegitcommit: 830fdc80556a5fde642850dd6b4d1b7efda3609d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/09/2022
ms.locfileid: "63399270"
---
# <a name="define-messaging-extension-action-commands"></a>Определение команд действий расширения обмена сообщениями

[!include[v4-to-v3-SDK-pointer](~/includes/v4-to-v3-pointer-me.md)]

Команды действий позволяют представить пользователям модальный всплывающий модуль, называемый модулем задач в Teams. Модуль задач собирает или отображает сведения, обрабатывает взаимодействие и отправляет их обратно в Teams. В этом документе приводятся инструкции по выбору расположения команд действий, созданию модуля задач, отправке окончательного сообщения или карточки, созданию команды действий с помощью студии приложения или созданию его вручную.

Перед созданием команды действий необходимо определиться со следующими факторами:

1. [Откуда можно запускать команду действий?](#select-action-command-invoke-locations)
1. [Как будет создан модуль задач?](#select-how-to-create-your-task-module)
1. [Будет ли отправлено окончательное сообщение или карточка в канал от бота, или сообщение или карточка будут вставлены в область композитного сообщения для отправки пользователем?](#select-how-the-final-message-is-sent)

## <a name="select-action-command-invoke-locations"></a>Выберите расположения команд действий, вызываемой

Сначала необходимо определить расположение, откуда должна вызываться команда действий. Указав манифест `context` приложения, можно вызвать команду из одного или нескольких следующих местоположений:

* Область составить сообщение. Кнопки в нижней части области составить сообщение.

    Контекст команды = составить

* Командная шкатулка. @mentioning приложение в командном окне.

    Контекст команд = commandBox

   > [!NOTE]
   > Если расширение обмена сообщениями вызывается из командного окна, вы не можете отвечать сообщением бота, вставленным непосредственно в беседу.

* Сообщение. Непосредственно из существующего сообщения через меню `...` переполнения сообщения.

    Контекст команд = сообщение

    > [!NOTE]
    > Начальный вызов бота включает объект JSON, содержащий сообщение, из которого он был вызван. Вы можете обработать сообщение перед тем, как представить его с помощью модуля задач.

На следующем изображении отображаются расположения, из которых вызывается команда действий:

![Команда действий вызывает расположения](~/assets/images/messaging-extension-invoke-locations.png)

## <a name="select-how-to-create-your-task-module"></a>Выберите, как создать модуль задач

Помимо выбора, из чего можно вызвать команду, необходимо также выбрать, как заполнить форму в модуле задач для пользователей. У вас есть следующие три варианта создания формы, отрисовываемой внутри модуля задач:

* **Статический список параметров**. Это самый простой метод. Вы можете определить список параметров в манифесте приложения, Teams отрисовки клиента, но не можете управлять форматированием в этом случае.
* **Адаптивная** карта. Можно выбрать адаптивную карту, которая обеспечивает более полный контроль над пользовательским интерфейсом, но по-прежнему ограничивает доступные параметры управления и форматирования.
* **Встроенное представление** веб-сайта. Вы можете встраить настраиваемый веб-просмотр в модуль задач, чтобы иметь полный контроль над пользовательским интерфейсом и средствами управления.

Если вы выберете для создания модуля задач со статическим списком параметров и при отправке пользователем модуля задач, будет вызвано расширение обмена сообщениями. При использовании встроенного веб-представления или адаптивной карты расширение обмена сообщениями должно обрабатывать начальное событие вызова от пользователя, создавать модуль задач и возвращать его клиенту.

## <a name="select-how-the-final-message-is-sent"></a>Выберите, как отправляется окончательное сообщение

В большинстве случаев команда действий приводит к вставки карты в поле составить сообщение. Пользователь может отправить его в канал или чат. В этом случае сообщение поступает от пользователя, и бот не может изменить или обновить карту далее.

Если расширение обмена сообщениями вызывается из окна составить или непосредственно из сообщения, веб-служба может вставить окончательный ответ непосредственно в канал или чат. В этом случае адаптивная карта поступает от бота, бот обновляет ее и при необходимости отвечает на поток беседы. Необходимо добавить объект в `bot` манифест приложения с помощью того же ID и определить соответствующие области.

## <a name="add-the-action-command-to-your-app-manifest"></a>Добавление команды действий в манифест приложения

Чтобы добавить команду действий в манифест приложения, `composeExtension` необходимо добавить новый объект на верхний уровень манифеста приложения JSON. Для этого можно использовать один из следующих способов:

* [Создание команды действий с помощью App Studio](#create-an-action-command-using-app-studio)
* [Создание команды действий вручную](#create-an-action-command-manually)

### <a name="create-an-action-command-using-app-studio"></a>Создание команды действий с помощью App Studio

Вы можете создать команду действий с помощью **App Studio** или **портала разработчиков**.

> [!NOTE]
> App Studio скоро будет обесценив. Настройка, распространение и управление Teams приложениями с помощью нового [портала разработчиков](https://dev.teams.microsoft.com/).

# <a name="app-studio"></a>[App Studio](#tab/AS)

> [!NOTE]
> Обязательным условием для создания команды действий является то, что вы уже создали расширение обмена сообщениями. Сведения о создании расширения обмена сообщениями см. в [сообщении о создании расширения обмена сообщениями](~/messaging-extensions/how-to/create-messaging-extension.md).

**Создание команды действий**

1. Откройте **App Studio** Microsoft Teams клиента и выберите вкладку **Редактор Манифеста**.
1. Если вы уже создали пакет приложений в **App Studio**, выберите его из списка. Если вы не создали пакет приложений, импортировать существующий пакет.
1. После импорта пакета приложений выберите расширения **обмена сообщениями** в **статье Capabilities**. Вы получите всплывающее окно, чтобы настроить расширение обмена сообщениями.
1. Выберите **Настройка в** окне, чтобы включить расширение обмена сообщениями в приложение. На следующем изображении отображается окно расширения обмена сообщениями:

    <img src="~/assets/images/messaging-extension/messaging-extension-set-up.png" alt="messaging extension set up" width="500"/>

1. Для создания расширения обмена сообщениями необходим зарегистрированный бот Майкрософт. Можно использовать существующий бот или создать новый бот. Выберите **создание нового варианта бота** , назови имя нового бота и выберите **Create**. На следующем изображении отображается создание бота для расширения обмена сообщениями:

    <img src="~/assets/images/messaging-extension/create-bot-for-messaging-extension.png" alt="create bot for messaging extension" width="500"/>

1. Выберите **Добавить** в **разделе Команда** страницы расширения обмена сообщениями, чтобы включить команды, которые решают поведение расширения обмена сообщениями.
На следующем изображении отображается добавление команд для расширения обмена сообщениями:

   <img src="~/assets/images/messaging-extension/include-command.png" alt="include command" width="500"/>

1. Выберите **Разрешить пользователям запускать действия во внешних службах, находясь внутри Teams**. На следующем изображении отображается выбор команд действий:

    <img src="~/assets/images/messaging-extension/action-command-selection.png" alt="action command selection" width="500"/>

1. Чтобы создать модуль задач с помощью статичного набора параметров, выберите Определение набора статических **параметров для команды**.

    На следующем изображении отображается выбор статических параметров команды действий:

   <img src="~/assets/images/messaging-extension/action-command-static-parameter-selection.png" alt="action command static parameter selection" width="500"/>

    На следующем изображении отображается пример статического параметра:

   <img src="~/assets/images/messaging-extension/setting-up-of-static-parameter.png" alt="action command static parameter set-up" width="500"/>

    На следующем изображении отображается пример тестирования статических параметров:

   <img src="~/assets/images/messaging-extension/static-parameter-testing.png" alt="action command static parameter testing" width="500"/>

1. Чтобы использовать динамические параметры, выберите **для получения динамического набора параметров из бота**. На следующем изображении отображается выбор параметров команды действий:

    <img src="~/assets/images/messaging-extension/action-command-dynamic-parameter-selection.png" alt="action command dynamic parameter selection" width="500"/>

1. Добавьте **командный id** и **заголовок**.
1. Выберите расположение, в котором необходимо вызвать команду действий. На следующем изображении отображается расположение вызова команды действий:

    <img src="~/assets/images/messaging-extension/action-command-invoke-location.png" alt="action command invoke location" width="500"/>

1. Выберите **Сохранить**.
1. Чтобы добавить дополнительные параметры, выберите кнопку **Добавить** в разделе **Параметры** .

### <a name="create-an-action-command-manually"></a>Создание команды действий вручную

Чтобы вручную добавить команду расширения обмена сообщениями на основе действий в манифест приложения, `composeExtension.commands` необходимо добавить в массив объектов следующие параметры:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Это свойство — уникальный ID, который вы назначаете этой команде. Запрос пользователя включает этот ID. | Да | 1.0 |
| `title` | Это свойство — командное имя. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Это свойство должно быть .`action` | Нет | 1.4 |
| `fetchTask` | Это свойство предназначено `true` для адаптивной карты или встроенного веб-представления для модуля задач,`false` а также для статичного списка параметров или при загрузке веб-представления с помощью .`taskInfo` | Нет | 1.4 |
| `context` | Это свойство — необязательный массив значений, определяющий, откуда вызывается расширение обмена сообщениями. Возможные значения — `message`, `compose` и `commandBox`. Значение по умолчанию — `["compose", "commandBox"]`. | Нет | 1.5 |

Если используется статический список параметров, необходимо также добавить следующие параметры:

| Имя свойства | Назначение | Требуется? | Минимальная версия манифеста |
|---|---|---|---|
| `parameters` | Это свойство описывает статический список параметров для команды. Используйте только тогда, когда `fetchTask` это `false`. | Нет | 1.0 |
| `parameter.name` | Это свойство описывает имя параметра. Это отправляется в службу в запросе пользователя. | Да | 1.0 |
| `parameter.description` | Это свойство описывает цели параметра или пример значения, которое должно быть предоставлено. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Это свойство — короткое удобное название параметра или метка. | Да | 1.0 |
| `parameter.inputType` | Это свойство задалось типу входных данных. Возможные значения включают `text`, `textarea`, `number`, `date`, `time``toggle`. По умолчанию установлено значение `text`. | Нет | 1.4 |

Если вы используете встроенное веб-представление, `taskInfo` можно дополнительно добавить объект для получения веб-представления без вызова бота напрямую. При выборе этого параметра поведение аналогично использованию статического списка параметров. В том, что первое взаимодействие с ботом [отвечает на отправку действия модуля задач](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md). Если вы используете объект `taskInfo` , необходимо установить параметр `fetchTask` `false`.

| Имя свойства | Назначение | Требуется? | Минимальная версия манифеста |
|---|---|---|---|
|`taskInfo`|Укажите модуль задач для предварительной загрузки при использовании команды расширения обмена сообщениями. | Нет | 1.4 |
|`taskInfo.title`|Начальное название модуля задач. |Нет | 1.4 |
|`taskInfo.width`|Ширина модуля задач, число пикселей или макет по умолчанию, например `large`, `medium`или `small`. |Нет | 1.4 |
|`taskInfo.height`|Высота модуля задач, число пикселей `large`или макет по умолчанию, например , `medium`или `small`.|Нет | 1.4 |
|`taskInfo.url`|Начальный URL-адрес веб-просмотра.|Нет | 1.4 |

#### <a name="app-manifest-example"></a>Пример манифеста приложения

В следующем разделе приводится пример объекта, определяющий `composeExtensions` две команды действий. Это не пример полного манифеста. Полную схему манифеста приложения см. в [схеме манифеста приложения](~/resources/schema/manifest-schema.md):

```json
...
"composeExtensions": [
  {
    "botId": "12a3c29f-1fc5-4d97-a142-12bb662b7b23",
    "canUpdateConfiguration": true,
    "commands": [
      {
        "id": "addTodo",
        "description": "Create a To Do item",
        "title": "Create To Do",
        "type": "action",
        "context": ["commandBox", "message", "compose"],
        "fetchTask": true,
        "parameters": [
          {
            "name": "Name",
            "description": "To Do Title",
            "title": "Title",
            "inputType": "text"
          },
          {
            "name": "Description",
            "description": "Description of the task",
            "title": "Description",
            "inputType": "textarea"
          },
          {
            "name": "Date",
            "description": "Due date for the task",
            "title": "Date",
            "inputType": "date"
          }
        ]
      },
      {
        "id": "reassignTodo",
        "description": "Reassign a todo item",
        "title": "Reassign a todo item",
        "type": "action",
        "fetchTask": true,
      }
    ]
  }
]
...
```

## <a name="code-sample"></a>Пример кода

| Имя образца           | Описание | .NET    | Node.js   |
|:---------------------|:--------------|:---------|:--------|
|Teams расширения обмена сообщениями| Описывает, как определить команды действий, создать модуль задач и реагировать на отправку действия модуля задач. |[View](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/csharp_dotnetcore/51.teams-messaging-extensions-action)|[View](https://github.com/microsoft/BotBuilder-Samples/tree/master/samples/javascript_nodejs/51.teams-messaging-extensions-action) |

## <a name="step-by-step-guide"></a>Пошаговые инструкции

Следуйте [пошаговом](../../../sbs-meetingextension-action.yml) руководстве по созданию расширения Teams сообщений на основе действий.

## <a name="next-step"></a>Следующий этап

Если вы используете адаптивную карту или встроенное веб-представление `taskInfo` без объекта, следующий шаг:

> [!div class="nextstepaction"]
> [Создание и реагирование с помощью модуля задач](~/messaging-extensions/how-to/action-commands/create-task-module.md)

Если вы используете параметры или встроенное веб-представление `taskInfo` с объектом, следующим шагом будет следующее:

> [!div class="nextstepaction"]
> [Ответ на отправку модуля задач](~/messaging-extensions/how-to/action-commands/respond-to-task-module-submit.md)
