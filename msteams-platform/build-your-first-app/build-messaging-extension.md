---
title: Начало работы — создание расширения обмена сообщениями
author: heath-hamilton
description: Быстро создайте расширение обмена сообщениями Microsoft Teams с помощью набор средств.
ms.author: lajanuar
ms.date: 11/04/2020
ms.topic: tutorial
ms.openlocfilehash: 09e851820314efd3dc114b926a0111603cac18a4
ms.sourcegitcommit: 79e6bccfb513d4c16a58ffc03521edcf134fa518
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2021
ms.locfileid: "51696880"
---
# <a name="build-a-messaging-extension-for-microsoft-teams"></a>Создание расширения обмена сообщениями для Microsoft Teams

Существует два типа расширений обмена *сообщениями* Teams: [команды поиска](../messaging-extensions/how-to/search-commands/define-search-command.md) и [команды действий.](../messaging-extensions/how-to/action-commands/define-action-command.md)

В этом уроке будет создаваться команда поиска *(также* известная как расширение обмена сообщениями на основе *поиска),* которая является ярлыком для поиска внешнего контента и совместного использования его в Teams. Пользователи могут получать доступ к командам поиска из [командного или командного окна Teams.](../messaging-extensions/what-are-messaging-extensions.md)

## <a name="your-assignment"></a>Назначение

Отдел поддержки организации общается с пользователями через Teams, но билеты находятся в отдельной системе. Это означает, что сотрудники службы поддержки должны постоянно ходить между приложениями. Вы изучите, как уменьшить этот объем переключения контекста, создав простое расширение обмена сообщениями на основе поиска для Teams.

## <a name="what-youll-learn"></a>Что вы узнаете

> [!div class="checklist"]
>
> * Создание бота расширения проекта приложения и обмена сообщениями с помощью microsoft Teams набор средств для Visual Studio Code
> * Определение конфигураций приложений и некоторых строительных лесов, соответствующих расширению обмена сообщениями
> * Локальное хост-приложение
> * Настройка бота для расширения обмена сообщениями
> * Боковая загрузка и тестирование расширения обмена сообщениями в Teams

## <a name="before-you-begin"></a>Прежде чем начать

Если еще нет, убедитесь, что вы понимаете и установите необходимые условия [для разработки Teams.](build-first-app-overview.md#get-prerequisites)

## <a name="1-create-your-app-project"></a>1. Создание проекта приложения

Программа Microsoft Teams набор средств позволяет настроить следующие компоненты для расширения обмена сообщениями:

* **Конфигурации приложений и леса,** соответствующие расширениям обмена сообщениями
* **Бот** для расширения обмена сообщениями, который автоматически зарегистрирован в службе Microsoft Azure Bot

> [!TIP]
> Если вы еще не создали проект приложения Teams, может [](../build-your-first-app/build-and-run.md) оказаться полезным выполнять эти инструкции, которые подробно объясняют проекты.

1. В Visual Studio коде выберите **Microsoft Teams** в левой панели действий и создайте новое приложение :::image type="icon" source="../assets/icons/vsc-toolkit.png"::: **Teams.**
1. При запросе впишитесь в учетную запись разработки Microsoft 365.
1. На экране **Добавить возможности** выберите расширение обмена **сообщениями затем** **Далее**.
1. Введите имя приложения Teams. (Это имя по умолчанию для вашего приложения, а также имя каталога проектов приложений на локальной машине.)
1. На экране **расширения настройки обмена сообщениями** сделайте следующее:
    1. Выберите только **параметр На основе** поиска для типа расширения обмена сообщениями.
    1. Выберите **Создать новый бот,** а **затем создать регистрацию бота.** В случае успешной работы новый бот будет иметь **зарегистрированный** статус.
    1. На данный момент выберите **нет** для параметра "Нет" для разгрузки ссылки.
1. Выберите **Готово** в нижней части экрана, чтобы настроить проект.

## <a name="2-identify-relevant-app-project-components"></a>2. Определение соответствующих компонентов проекта приложения

Большая часть конфигураций приложений и строительных лесов создается автоматически при создании проекта с командной набор средств.

### <a name="app-configurations"></a>Конфигурации приложений

Чтобы просмотреть или обновить конфигурации расширения обмена сообщениями, выберите **App Studio** в наборе инструментов и перейдите к **расширениям обмена сообщениями.**

### <a name="app-scaffolding"></a>Строительные леса приложений

Строительные леса приложений предоставляют файл, расположенный в корневом каталоге проекта, для обработки того, как расширение обмена сообщениями (или технически бот расширения обмена сообщениями) отвечает на поисковые запросы `botActivityHandler.js` в Teams. [](#4-configure-the-bot-for-your-messaging-extension)

## <a name="3-set-up-a-secure-tunnel-to-your-app"></a>3. Настройка безопасного туннеля в приложении

В целях тестирования разберем расширение обмена сообщениями на локальном веб-сервере (порт 3978).

1. Если вы еще не сделали этого, установите [ngrok](https://ngrok.com/download).
1. В терминале запустите `ngrok http -host-header=rewrite 3978` .
1. Скопируйте URL-адрес HTTPS в выходе (например, ), так как `https://468b9ab725e9.ngrok.io` Teams требует подключений HTTPS.

С помощью этого URL-адреса Teams (для которой требуются подключения HTTPS) смогут пройдите туннель туда, где размещено ваше приложение (в `localhost` порту 3978).

## <a name="4-configure-the-bot-for-your-messaging-extension"></a>4. Настройка бота для расширения обмена сообщениями

Расширения обмена сообщениями используют боты для отправки и обработки запросов пользователей из Teams в вашу службу. Бот должен быть зарегистрирован в службе Azure Bot Service, что было сделано при настройках приложения с помощью teams набор средств.

Для получения и обработки поисковых запросов в расширении обмена сообщениями необходимо указать URL-адрес конечной точки бота. Как правило, URL-адрес выглядит `https://HOST_URL/api/messages` как . Это можно быстро настроить в наборе инструментов.

1. В Visual Studio коде выберите **Microsoft Teams** в левой панели действий и выберите Open Microsoft Teams :::image type="icon" source="../assets/icons/vsc-toolkit.png"::: **набор средств**.
1. Перейдите **к ботам > существующие регистрации** ботов и выберите бот, созданный во время установки.
1. В поле **адресов конечной точки** бота введите URL-адрес ngrok (например, ), где вы размещены бот и `https://468b9ab725e9.ngrok.io` приложение к `/api/messages` ней.

Ваш бот сможет обрабатывать запросы в расширении обмена сообщениями.

## <a name="5-build-and-run-your-app"></a>5. Сборка и запуск приложения

Вы настроили URL-адрес для расширения обмена сообщениями и настроили его для обработки поиска. Пришло время, чтобы ваше приложение было запущено.

1. В терминале перейдите в корневой каталог проекта приложения и запустите `npm install` .
1. Запуск `npm start` .

В случае успеха вы увидите следующее сообщение, указывающее, что служба расширения обмена сообщениями прослушивает действия в `localhost` вашем :

`Bot/ME service listening at http://localhost:3978`

## <a name="6-sideload-your-messaging-extension-in-teams"></a>6. Sideload your messaging extension in Teams

При запуске расширения обмена сообщениями его можно установить в Teams.

> [!TIP]
> Если вы еще не перегружали приложение Teams до и не могли решить проблемы, следуйте [этим инструкциям.](../build-your-first-app/build-and-run.md#4-sideload-your-app-in-teams)

1. В Visual Studio коде нажмите **клавишу F5,** чтобы запустить веб-клиент Teams.
1. В диалоговом окте установке приложения выберите **Добавить для меня**.

## <a name="7-test-your-messaging-extension"></a>7. Проверьте расширение обмена сообщениями

Узнайте, как работают расширения обмена сообщениями в чате Teams.

1. Запустите новый чат. В окне составить выберите **Больше** и выберите приложение расширения обмена сообщениями, которое :::image type="icon" source="../assets/icons/teams-client-more.png"::: вы только что загружены.
1. Попробуйте найти что-то (например, **Билеты).** Если приложение работает, вы увидите пример результатов поиска (вы можете добавить свои собственные позже).<br/>
   :::image type="content" source="../assets/images/build-your-first-app/me-teams-test.png" alt-text="Снимок экрана, показывающий, как в поле &quot;Команды&quot; используется расширение обмена сообщениями на основе поиска.":::

## <a name="well-done"></a>Прекрасно

Поздравляем! У вас есть базовое расширение обмена сообщениями Teams, настроенное для поиска внешнего контента в окне составить или команду.

## <a name="next-steps"></a>Дальнейшие действия

См. следующие страницы для продолжения и создания полноцельного расширения обмена сообщениями:

1. [Определите команды поиска,](../messaging-extensions/how-to/search-commands/define-search-command.md) которые имеют отношение к вашей службе.
1. Настройка службы для [реагирования на поиск пользователей.](../messaging-extensions/how-to/search-commands/respond-to-search.md)

## <a name="troubleshooting"></a>Устранение неполадок

Следующие сведения могут помочь, если у вас были проблемы с завершением этого руководства.

### <a name="bot-isnt-connected-to-teams"></a>Бот не подключен к Teams

Если приложение установлено, но оно не работает, убедитесь, что бот расширения обмена сообщениями подключен к каналу [Teams службы ](https://docs.microsoft.com/azure/bot-service/channel-connect-teams?view=azure-bot-service-4.0&preserve-view=true)Azure Bot.

Важно понимать, что это не то же самое, что канал в Teams. В этом случае канал — это способ подключения службы Azure Bot к Teams или другому поддерживаемом приложению майкрософт или сторонних [коммуникаций.](https://docs.microsoft.com/azure/bot-service/bot-service-channels-reference?view=azure-bot-service-4.0&preserve-view=true)

## <a name="learn-more"></a>Подробнее

* [Включить функцию разгрузки ссылок](../messaging-extensions/how-to/link-unfurling.md)
* Следуйте [нашим рекомендациям по проектированию](../messaging-extensions/design/messaging-extension-design.md) и создайте с помощью готовых к производству шаблонов [пользовательского](../concepts/design/design-teams-app-ui-templates.md) интерфейса для создания бесшовного интерфейса.
* [Добавление проверки подлинности](../messaging-extensions/how-to/add-authentication.md)
* [Создание расширения обмена сообщениями на основе действий](../messaging-extensions/how-to/action-commands/define-action-command.md)
* [Microsoft Bot Framework](https://dev.botframework.com/)

