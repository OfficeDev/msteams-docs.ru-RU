---
title: 'Начало работы : создание расширения для обмена сообщениями'
author: heath-hamilton
description: Быстро создайте расширение обмена сообщениями Microsoft Teams с помощью microsoft Teams набор средств.
ms.author: lajanuar
ms.date: 11/04/2020
ms.topic: tutorial
ms.openlocfilehash: 86d44740feaa2cd33aff0e1dde14d757420d90d6
ms.sourcegitcommit: 00c657e3bf57d3b92aca7da941cde47a2eeff4d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "49911921"
---
# <a name="build-a-messaging-extension-for-microsoft-teams"></a>Создание расширения обмена сообщениями для Microsoft Teams

Существует два типа расширений обмена сообщениями приложений *Teams:* команды [поиска](../messaging-extensions/how-to/search-commands/define-search-command.md) и [команды действий.](../messaging-extensions/how-to/action-commands/define-action-command.md)

В этом уроке вы создадим команду поиска *(также* называется расширением обмена сообщениями на основе *поиска),* которая является ярлыком для поиска внешнего контента и его совместного использования в Teams. Пользователи могут получать доступ к командам поиска из [командного окна или составить](../messaging-extensions/what-are-messaging-extensions.md)teams.

## <a name="your-assignment"></a>Назначение

Службы поддержки вашей организации взаимодействуют с пользователями через Teams, но билеты находятся в отдельной системе. Это означает, что сотрудники службы поддержки должны постоянно переходить между приложениями. Вы изучите, как уменьшить этот объем переключения контекста, создав простое расширение обмена сообщениями на основе поиска для Teams.

## <a name="what-youll-learn"></a>Что вы узнаете

> [!div class="checklist"]
>
> * Создание проекта приложения и бота расширения для обмена сообщениями с помощью microsoft Teams набор средств для Visual Studio кода
> * Определение конфигураций приложений и некоторых из них, соответствующих расширениям обмена сообщениями
> * Локальное приложение
> * Настройка бота для расширения обмена сообщениями
> * Загрузка неогрузки и тестирование расширения обмена сообщениями в Teams

## <a name="before-you-begin"></a>Прежде чем начать

Если вы еще не знаете и не установили необходимые условия для [разработки Teams.](build-first-app-overview.md#get-prerequisites)

## <a name="1-create-your-app-project"></a>1. Создайте проект приложения

Microsoft Teams набор средств поможет вам настроить следующие компоненты для расширения обмена сообщениями:

* **Конфигурации приложений и скафолдинг,** соответствующие расширениям обмена сообщениями
* **Бот** для расширения обмена сообщениями, который автоматически регистрируется в службе ботов Microsoft Azure

> [!TIP]
> Если вы еще не создавали проект приложения Teams, возможно, вам будет полезно следовать этим инструкциям, чтобы подробнее объяснить проекты. [](../build-your-first-app/build-and-run.md)

1. В Visual Studio кода выберите **Microsoft Teams** в левой панели действий и выберите :::image type="icon" source="../assets/icons/vsc-toolkit.png"::: **"Создать новое приложение Teams".**
1. При запросе во sign in with your Microsoft 365 development account.
1. On the **Add capabilities** screen, select **Messaging Extension** then **Next**.
1. Введите имя приложения Teams. (Это имя приложения по умолчанию, а также имя каталога проекта приложения на локальном компьютере.)
1. На экране **"Настройка расширения обмена** сообщениями" сделайте следующее:
    1. Выберите только параметр **на основе** поиска для типа расширения обмена сообщениями.
    1. Выберите **"Создать нового бота",** а **затем создать регистрацию бота.** В случае успеха новый бот будет иметь **зарегистрированный** статус.
    1. На данный момент выберите **"Нет"** для параметра "Отметь ссылку".
1. Выберите **"Готово"** в нижней части экрана, чтобы настроить проект.

## <a name="2-identify-relevant-app-project-components"></a>2. Определение соответствующих компонентов проекта приложения

Большая часть конфигураций и скафаолдинга приложений автоматически заданная при создании проекта с помощью командной набор средств.

### <a name="app-configurations"></a>Конфигурации приложений

Чтобы просмотреть или обновить конфигурации расширения обмена сообщениями, выберите **App Studio** в наборе средств и перейдите к **расширениям системы обмена сообщениями.**

### <a name="app-scaffolding"></a>Скафаолдинг приложений

Скафолдинг приложения предоставляет файл, расположенный в корневом каталоге проекта, для обработки того, как расширение обмена сообщениями (или, технически, бот расширения сообщений) отвечает на поисковые запросы в `botActivityHandler.js` Teams. [](#4-configure-the-bot-for-your-messaging-extension)

## <a name="3-set-up-a-secure-tunnel-to-your-app"></a>3. Настройка безопасного туннеля для приложения

Для тестирования разберем расширение обмена сообщениями на локальном веб-сервере (порт 3978).

1. Если вы еще не сделали этого, установите [ngrok.](https://ngrok.com/download)
1. В терминале запустите `ngrok http -host-header=rewrite 3978` .
1. Скопируйте URL-адрес HTTPS в выходных данных (например, ),так как `https://468b9ab725e9.ngrok.io` Teams требует подключения HTTPS.

С помощью этого URL-адреса Teams (для которого требуются подключения HTTPS) будет иметь туннель, в котором вы будете размещены ваше приложение (через порт `localhost` 3978).

## <a name="4-configure-the-bot-for-your-messaging-extension"></a>4. Настройка бота для расширения обмена сообщениями

Расширения обмена сообщениями используют боты для отправки и обработки запросов пользователей из Teams в вашу службу. Бот должен быть зарегистрирован в службе ботов Azure, что было сделано при настройках приложения с помощью командной набор средств.

Вам по-прежнему необходимо указать URL-адрес конечной точки бота для получения и обработки поисковых запросов в расширении обмена сообщениями. Как правило, URL-адрес `https://HOST_URL/api/messages` выглядит. Это можно быстро настроить в наборе средств.

1. В Visual Studio code выберите **Microsoft Teams** в левой панели действий и :::image type="icon" source="../assets/icons/vsc-toolkit.png"::: выберите команду **"Открыть Microsoft Teams набор средств.**
1. Перейдите **в > регистрации** существующих ботов и выберите бота, созданного во время установки.
1. В поле **адреса конечной точки бота** введите URL-адрес ngrok (например, ),где размещен бот, и введите к ней `https://468b9ab725e9.ngrok.io` `/api/messages` приложение.

Бот сможет обрабатывать запросы в расширении обмена сообщениями.

## <a name="5-build-and-run-your-app"></a>5. Сборка и запуск приложения

Вы настроили URL-адрес для своего расширения обмена сообщениями и настроили его для обработки поиска. Настало время, чтобы ваше приложение было запущено.

1. В терминале перейдите в корневой каталог проекта приложения и запустите `npm install` его.
1. Запустите `npm start` .

В случае успеха вы увидите следующее сообщение, указывающее, что ваша служба расширения обмена сообщениями прослушивает ваши действия на вашем `localhost` компьютере:

`Bot/ME service listening at http://localhost:3978`

## <a name="6-sideload-your-messaging-extension-in-teams"></a>6. Загрузка нео sideload расширения обмена сообщениями в Teams

После запуска расширения обмена сообщениями его можно установить в Teams.

> [!TIP]
> Если вы еще не выгружали неогруженные приложения Teams и не могли с ним работать, выполните [указанные здесь инструкции.](../build-your-first-app/build-and-run.md#4-sideload-your-app-in-teams)

1. В Visual Studio Code нажмите клавишу **F5,** чтобы запустить веб-клиент Teams.
1. В диалоговом окте "Установка приложения" выберите **"Добавить для меня".**

## <a name="7-test-your-messaging-extension"></a>7. Проверьте расширение обмена сообщениями

Узнайте, как расширения обмена сообщениями работают в чате Teams.

1. Запустите новый чат. В поле составить  выберите "Больше" и выберите приложение расширения обмена сообщениями, :::image type="icon" source="../assets/icons/teams-client-more.png"::: которое вы только что загружены.
1. Попробуйте найти что-то (например, **"Билеты").** Если приложение работает, вы увидите примеры результатов поиска (вы сможете добавить собственные позже).<br/>
   :::image type="content" source="../assets/images/build-your-first-app/me-teams-test.png" alt-text="Снимок экрана, показывающий, как расширение обмена сообщениями на основе поиска используется в поле составить Teams.":::

## <a name="well-done"></a>Прекрасно

Поздравляем! У вас есть базовое расширение обмена сообщениями Teams, настроенное для поиска внешнего содержимого в окне составить или в командной окне.

## <a name="next-steps"></a>Дальнейшие действия

Чтобы продолжить и создать полно функцию расширения обмена сообщениями, см. следующие страницы:

1. [Определите команды поиска,](../messaging-extensions/how-to/search-commands/define-search-command.md) релевантные для вашей службы.
1. Настройте службу для [реагирования на поисковые запросы пользователей.](../messaging-extensions/how-to/search-commands/respond-to-search.md)

## <a name="troubleshooting"></a>Устранение неполадок

Следующие сведения могут помочь, если у вас были проблемы с выполнением этого руководства.

### <a name="bot-isnt-connected-to-teams"></a>Бот не подключен к Teams

Если вы установили приложение, но оно не работает, убедитесь, что бот расширения обмена сообщениями подключен к каналу Teams службы ботов [Azure. ](https://docs.microsoft.com/azure/bot-service/channel-connect-teams?view=azure-bot-service-4.0&preserve-view=true)

Важно понимать, что это не то же самое, что канал в Teams. В этом случае служба ботов Azure подключает бота к Teams или другому поддерживаемом [приложению Майкрософт](https://docs.microsoft.com/azure/bot-service/bot-service-channels-reference?view=azure-bot-service-4.0&preserve-view=true)или стороннему приложению для связи.

## <a name="learn-more"></a>Дополнительные сведения

* [Включить функцию unfurling ссылки](../messaging-extensions/how-to/link-unfurling.md)
* Следуйте [нашим рекомендациям по проектированию](../messaging-extensions/design/messaging-extension-design.md) и создавайте [шаблоны](../concepts/design/design-teams-app-ui-templates.md) пользовательского интерфейса, готовые к выпуску, чтобы удобо поработать.
* [Добавление проверки подлинности](../messaging-extensions/how-to/add-authentication.md)
* [Создание расширения обмена сообщениями на основе действий](../messaging-extensions/how-to/action-commands/define-action-command.md)
* [Microsoft Bot Framework](https://dev.botframework.com/)
