---
title: Изменения API-интерфейса Bot для участников группы или чата (обновление 2020)
author: ojasvichoudhary
description: Описание предстоящих и выполняемых изменений API-интерфейсов Bot, используемых для получения участников команд и сеансов
keywords: Список членов группы API-интерфейсов Bot Framework
ms.topic: reference
ms.author: ojchoudh
ms.openlocfilehash: 243969796d9d1dc427ab7736cf5e0f0d320731c7
ms.sourcegitcommit: 3fc7ad33e2693f07170c3cb1a0d396261fc5c619
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "48796145"
---
# <a name="changes-to-teams-bot-apis-for-fetching-teamchat-members"></a><span data-ttu-id="180e8-104">Изменения в API-интерфейсах ленты Teams для извлечения участников группы или чата</span><span class="sxs-lookup"><span data-stu-id="180e8-104">Changes to Teams Bot APIs for Fetching Team/Chat Members</span></span>

<span data-ttu-id="180e8-105">В настоящее время разработчики-роботы, желающие получить информацию для одного или нескольких участников беседы или команды, используют API Microsoft Teams Bot `TeamsInfo.GetMembersAsync` (для C#) или `TeamsInfo.getMembers` (для TypeScript/Node.js), [описанные здесь](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile).</span><span class="sxs-lookup"><span data-stu-id="180e8-105">Currently, bot developers who want to retrieve information for one or more members of a chat or team use the Microsoft Teams bot APIs `TeamsInfo.GetMembersAsync` (for C#) or `TeamsInfo.getMembers` (for TypeScript/Node.js) APIs [(documented here)](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile).</span></span> <span data-ttu-id="180e8-106">В настоящее время эти API имеют несколько недостатков:</span><span class="sxs-lookup"><span data-stu-id="180e8-106">These APIs have several shortcomings today:</span></span>

* <span data-ttu-id="180e8-107">**В крупных командах производительность снижается, и время ожидания может быть больше.**</span><span class="sxs-lookup"><span data-stu-id="180e8-107">**For large teams, performance is poor and timeouts are more likely.**</span></span> <span data-ttu-id="180e8-108">Максимальный размер команды значительно увеличился с момента выпуска Microsoft Teams на ранних 2017.</span><span class="sxs-lookup"><span data-stu-id="180e8-108">The maximum team size has grown considerably since Microsoft Teams was released in early 2017.</span></span> <span data-ttu-id="180e8-109">Так как `GetMembersAsync` / `getMembers` возвращает весь список элементов, он занимает много времени, чтобы вызов API возвращался для крупных команд, и вы можете попробовать еще раз.</span><span class="sxs-lookup"><span data-stu-id="180e8-109">Since `GetMembersAsync`/`getMembers` returns the entire member list, it takes a long time for the API call to return for large teams, and it’s not uncommon for the call to time out and you have to try again.</span></span>
* <span data-ttu-id="180e8-110">**Получить сведения о профиле для отдельного пользователя очень трудоемко.**</span><span class="sxs-lookup"><span data-stu-id="180e8-110">**Getting profile details for a single user is cumbersome.**</span></span> <span data-ttu-id="180e8-111">Чтобы получить сведения о профиле для одного пользователя, необходимо извлечь весь список участников, а затем выполнить поиск нужного пользователя.</span><span class="sxs-lookup"><span data-stu-id="180e8-111">To get the profile information for a single user, you have to retrieve the entire member list and then search for the one you want.</span></span> <span data-ttu-id="180e8-112">True, существует вспомогательная функция в пакете SDK Bot для упрощения, но в этом случае она неэффективна.</span><span class="sxs-lookup"><span data-stu-id="180e8-112">True, there’s a helper function in the Bot Framework SDK to make it simpler, but under the covers it’s not efficient.</span></span>

<span data-ttu-id="180e8-113">Как и в случае с введением групп по всей Организации, мы осознали, что имелось время для более точного выравнивания этих API с помощью Office 365: Боты, используемые в крупных командах, могут получать основные сведения о профиле, аналогичные `User.ReadBasic.All` разрешениям Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="180e8-113">Separately, with the introduction of org-wide teams, we realized it was time to better align these APIs with Office 365 privacy controls: bots used in large teams are able to retrieve basic profile information, which is similar to the `User.ReadBasic.All` Microsoft Graph permission.</span></span> <span data-ttu-id="180e8-114">Администраторы клиентов имеют большой контроль над тем, какие приложения и боты можно использовать в клиенте, но эти параметры отличаются от тех, которые управляют Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="180e8-114">Tenant administrators have a great deal of control over which apps and bots can be used in their tenant, but these settings are different than the ones governing Microsoft Graph.</span></span>

<span data-ttu-id="180e8-115">Ниже показан пример представления JSON, который возвращается этими API на сегодняшний день.</span><span class="sxs-lookup"><span data-stu-id="180e8-115">Here’s a sample JSON representation of what’s returned by these APIs today.</span></span> <span data-ttu-id="180e8-116">Ниже приведены некоторые из этих полей.</span><span class="sxs-lookup"><span data-stu-id="180e8-116">I’ll refer to some of the fields below.</span></span>

```json
[{
    "id": "29:1GcS4EyB_oSI8A88XmWBN7NJFyMqe3QGnJdgLfFGkJnVelzRGos0bPbpsfJjcbAD22bmKc4GMbrY2g4JDrrA8vM06X1-cHHle4zOE6U4ttcc",
    "name": "Anon1 (Guest)",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "anonymous"
}, {
    "id": "29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk",
    "objectId": "76b0b09f-d410-48fd-993e-84da521a597b",
    "givenName": "John",
    "surname": "Patterson",
    "email": "johnp@fabrikam.com",
    "userPrincipalName": "johnp@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}, {
    "id": "29:1URzNQM1x1PNMr1D7L5_lFe6qF6gEfAbkdG8_BUxOW2mTKryQqEZtBTqDt10-MghkzjYDuUj4KG6nvg5lFAyjOLiGJ4jzhb99WrnI7XKriCs",
    "objectId": "6b7b3b2a-2c4b-4175-8582-41c9e685c1b5",
    "givenName": "Rick",
    "surname": "Stevens",
    "email": "Rick.Stevens@fabrikam.com",
    "userPrincipalName": "rstevens@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}]
```

## <a name="api-changes"></a><span data-ttu-id="180e8-117">Изменения API</span><span class="sxs-lookup"><span data-stu-id="180e8-117">API Changes</span></span>
<span data-ttu-id="180e8-118">Ниже приведены будущие изменения API:</span><span class="sxs-lookup"><span data-stu-id="180e8-118">Here are the upcoming API changes:</span></span>

* <span data-ttu-id="180e8-119">Мы создали новый API [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile) для получения сведений о профиле участников беседы или команды.</span><span class="sxs-lookup"><span data-stu-id="180e8-119">We've created a new API [`TeamsInfo.GetPagedMembersAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetching-the-roster-or-user-profile) for retrieving profile information for members of a chat/team.</span></span> <span data-ttu-id="180e8-120">Этот API теперь доступен в пакете SDK для Bot Framework 4,8.</span><span class="sxs-lookup"><span data-stu-id="180e8-120">This API is now available with the Bot Framework 4.8 SDK.</span></span> <span data-ttu-id="180e8-121">Для разработки во всех остальных версиях используется [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable) метод.</span><span class="sxs-lookup"><span data-stu-id="180e8-121">For development in all other versions use the [`GetConversationPagedMembers`](https://docs.microsoft.com/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable) method.</span></span> <span data-ttu-id="180e8-122">**Примечание** : в V3 или v4 лучше всего выполнить обновление до последней версии пункта (3.30.2 или 4,8 соответственно).</span><span class="sxs-lookup"><span data-stu-id="180e8-122">**Note** : In either v3 or v4, the best action is to upgrade to the latest point release (3.30.2 or 4.8 respectively).</span></span> 
* <span data-ttu-id="180e8-123">Мы создали новый API [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) для получения сведений о профиле для одного пользователя.</span><span class="sxs-lookup"><span data-stu-id="180e8-123">We've created a new API [`TeamsInfo.GetMemberAsync`](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) for retrieving the profile information for a single user.</span></span> <span data-ttu-id="180e8-124">Он принимает идентификатор группы или чата, а также [имя участника-пользователя](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) ( `userPrincipalName` , см. *выше* ), идентификатор объекта Azure Active Directory (, см. выше) `objectId` или идентификатор пользователя Teams (см *see above* `id` . *выше* ) в качестве параметров и возвращает сведения о профиле для этого пользователя.</span><span class="sxs-lookup"><span data-stu-id="180e8-124">It takes the ID of the team/chat and a [UPN](https://docs.microsoft.com/windows/win32/ad/naming-properties#userprincipalname) (`userPrincipalName`, *see above* ), Azure Active Directory Object ID (`objectId`, *see above* ), or the Teams user ID (`id`, *see above* ) as parameters and returns the profile information for that user.</span></span> <span data-ttu-id="180e8-125">**Примечание** : мы изменим в соответствии с тем, `objectId` `aadObjectId` что вызывается в `Activity` объекте сообщения Bot Framework.</span><span class="sxs-lookup"><span data-stu-id="180e8-125">**Note** : We're changing `objectId` to `aadObjectId` to match what it's called in the `Activity` object of a Bot Framework message.</span></span> <span data-ttu-id="180e8-126">Новый API доступен в версии 4,8 с пакетом SDK для Bot.</span><span class="sxs-lookup"><span data-stu-id="180e8-126">The new API is available with version 4.8 of the Bot Framework SDK.</span></span> <span data-ttu-id="180e8-127">Он скоро будет доступен в версии пакета SDK для Teams (Bot) для Team Framework 3. x, а также в то же время вы можете использовать конечную точку [REST](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) .</span><span class="sxs-lookup"><span data-stu-id="180e8-127">It will soon be available in the Teams SDK extension Bot Framework 3.x as well; meanwhile you can use the [REST](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) endpoint.</span></span>
* <span data-ttu-id="180e8-128">`TeamsInfo.GetMembersAsync` (C#) и `TeamsInfo.getMembers` (TypeScript/Node.js) формально формально и больше не работает в поздних 2021.</span><span class="sxs-lookup"><span data-stu-id="180e8-128">`TeamsInfo.GetMembersAsync` (C#) and `TeamsInfo.getMembers` (TypeScript/Node.js) is formally deprecated and will stop working in late 2021.</span></span> <span data-ttu-id="180e8-129">Мы будем объявлять о конкретном расписание в 2020 мая, основываясь на отзывах разработчиков.</span><span class="sxs-lookup"><span data-stu-id="180e8-129">We'll announce a specific timetable in May 2020, based on feedback from developers.</span></span> <span data-ttu-id="180e8-130">После того, как новые постраничные API будут доступны, разработчикам следует обновить свои Боты, чтобы использовать ее.</span><span class="sxs-lookup"><span data-stu-id="180e8-130">Once the new paged API is available, developers should update their bots to use it.</span></span> <span data-ttu-id="180e8-131">(Это также относится к [базовым API REST, которые используются этими API](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json)).</span><span class="sxs-lookup"><span data-stu-id="180e8-131">(This also applies to the [underlying REST API these APIs use](https://docs.microsoft.com/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).)</span></span>
* <span data-ttu-id="180e8-132">С опозданием 2021 Боты не сможет получить доступ к `userPrincipalName` `email` свойствам участников разговора или рабочей группы и будет использовать Microsoft Graph для их извлечения.</span><span class="sxs-lookup"><span data-stu-id="180e8-132">By late 2021, bots will not be able to proactively retrieve the `userPrincipalName` or `email` properties for members of a chat/team and will need to use Microsoft Graph to retrieve them.</span></span> <span data-ttu-id="180e8-133">В частности, `userPrincipalName` и `email` свойства не будут возвращены из нового `GetConversationPagedMembers` API, начиная с позднего 2021.</span><span class="sxs-lookup"><span data-stu-id="180e8-133">Specifically, `userPrincipalName` and `email` properties won't be returned from the new `GetConversationPagedMembers` API starting in late 2021.</span></span> <span data-ttu-id="180e8-134">Для получения этих сведений Боты должен использовать Microsoft Graph с маркером доступа.</span><span class="sxs-lookup"><span data-stu-id="180e8-134">Bots will have to use Microsoft Graph with an access token to retrieve this information.</span></span> <span data-ttu-id="180e8-135">Очевидно, что это существенное изменение: мы должны упростить, чтобы Боты получить маркер доступа, и мы должны упростить и упростить процесс разрешения конечных пользователей.</span><span class="sxs-lookup"><span data-stu-id="180e8-135">This is obviously a major change: We must make it easier for bots to get an access token, and we must streamline and simplify the end-user consent process.</span></span>

## <a name="feedback-and-more-information"></a><span data-ttu-id="180e8-136">Отзывы и дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="180e8-136">Feedback and More Information</span></span>
<span data-ttu-id="180e8-137">Мы будем использовать эту страницу для предоставления актуальной информации об этих изменениях.</span><span class="sxs-lookup"><span data-stu-id="180e8-137">We'll use this page for providing up to date information on these changes.</span></span> <span data-ttu-id="180e8-138">Если у вас возникнут вопросы, используйте "Отправить Отзывы > на этой странице" в разделе **отзывов** , приведенном ниже.</span><span class="sxs-lookup"><span data-stu-id="180e8-138">If you have questions, use the "Send feedback > on this page" in the **Feedback** section below.</span></span> 
