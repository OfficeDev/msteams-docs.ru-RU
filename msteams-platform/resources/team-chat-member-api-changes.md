---
title: Изменения API-интерфейса бота для участников группы или чата
author: ojasvichoudhary
description: Описывает предстоящие и происходящие изменения API ботов, используемых для искания членов групп и чатов
keywords: Список участников группы apis для базы ботов
localization_priority: Normal
ms.topic: reference
ms.author: ojchoudh
ms.openlocfilehash: d2eb75a69100a6daaf3af3a021b9896c42abe5f1
ms.sourcegitcommit: 6e4d2c8e99426125f7b72b9640ee4a4b4f374401
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/24/2021
ms.locfileid: "53114247"
---
# <a name="teams-bot-api-changes-to-fetch-team-or-chat-members"></a><span data-ttu-id="cdfb3-104">Teams API бота для получения участников группы или чата</span><span class="sxs-lookup"><span data-stu-id="cdfb3-104">Teams bot API changes to fetch team or chat members</span></span>

>[!NOTE]
> <span data-ttu-id="cdfb3-105">Начался процесс амортизации `TeamsInfo.getMembers` и `TeamsInfo.GetMembersAsync` API.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-105">The deprecation process for `TeamsInfo.getMembers` and `TeamsInfo.GetMembersAsync` APIs have started.</span></span> <span data-ttu-id="cdfb3-106">Первоначально они в значительной степени перенастраиваются до пяти запросов в минуту и возвращают не более 10 000 участников в каждой команде.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-106">Initially, they are heavily throttled to five requests per minute and return a maximum of 10K members per team.</span></span> <span data-ttu-id="cdfb3-107">В результате полный список не возвращается по мере увеличения размера группы.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-107">This results in the full roster not being returned as team size increases.</span></span>
> <span data-ttu-id="cdfb3-108">Необходимо обновить до версии 4.10 или выше SDK Bot Framework и перейти на paginated конечные точки API или API одного `TeamsInfo.GetMemberAsync` пользователя.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-108">You must update to version 4.10 or higher of the Bot Framework SDK and switch to the paginated API endpoints, or the `TeamsInfo.GetMemberAsync` single user API.</span></span> <span data-ttu-id="cdfb3-109">Это также относится к вашему боту, даже если вы не используете эти API напрямую, так как более старые SDKs называют эти API во время [событий membersAdded.](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added)</span><span class="sxs-lookup"><span data-stu-id="cdfb3-109">This also applies to your bot even if you are not directly using these APIs, as older SDKs call these APIs during [membersAdded](../bots/how-to/conversations/subscribe-to-conversation-events.md#team-members-added) events.</span></span> <span data-ttu-id="cdfb3-110">Чтобы просмотреть список предстоящих изменений, см. изменения [API.](team-chat-member-api-changes.md#api-changes)</span><span class="sxs-lookup"><span data-stu-id="cdfb3-110">To view the list of upcoming changes, see [API changes](team-chat-member-api-changes.md#api-changes).</span></span> 

<span data-ttu-id="cdfb3-111">В настоящее время разработчики ботов, которые хотят получить сведения для одного или более членов чата или группы, используют API Microsoft Teams для C# или для `TeamsInfo.GetMembersAsync` `TeamsInfo.getMembers` API typeScript или Node.js.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-111">Currently, bot developers who want to retrieve information for one or more members of a chat or team use the Microsoft Teams bot APIs `TeamsInfo.GetMembersAsync` for C# or `TeamsInfo.getMembers` for TypeScript or Node.js APIs.</span></span> <span data-ttu-id="cdfb3-112">Дополнительные сведения см. в [дополнительных сведениях о реестре или профиле пользователя.](../bots/how-to/get-teams-context.md#fetch-the-roster-or-user-profile)</span><span class="sxs-lookup"><span data-stu-id="cdfb3-112">For more information, see [fetch roster or user profile](../bots/how-to/get-teams-context.md#fetch-the-roster-or-user-profile).</span></span> <span data-ttu-id="cdfb3-113">Эти API имеют несколько недостатков.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-113">These APIs have several shortcomings.</span></span>

<span data-ttu-id="cdfb3-114">В настоящее время, если вы хотите получить сведения для одного или [](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) более членов чата или группы, вы можете использовать API Microsoft Teams бота для C# или для `TeamsInfo.GetMembersAsync` `TeamsInfo.getMembers` API typeScript Node.js или Node.js.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-114">Currently, if you want to retrieve information for one or more members of a chat or team, you can use the [Microsoft Teams bot APIs](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) `TeamsInfo.GetMembersAsync` for C# or `TeamsInfo.getMembers` for TypeScript or Node.js APIs.</span></span> <span data-ttu-id="cdfb3-115">Эти API имеют следующие недостатки:</span><span class="sxs-lookup"><span data-stu-id="cdfb3-115">These APIs have the following shortcomings:</span></span>

* <span data-ttu-id="cdfb3-116">Для больших групп производительность является низкой, а время выполнения более вероятно: максимальный размер группы значительно вырос с момента выпуска Teams в начале 2017 г.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-116">For large teams, performance is poor and timeouts are more likely: The maximum team size has grown considerably since Teams was released in early 2017.</span></span> <span data-ttu-id="cdfb3-117">При возвращении или возвращении всего списка участников для вызова API для больших групп требуется много времени, и для вызова обычно требуется время ожидания, и вам придется попробовать `GetMembersAsync` `getMembers` еще раз.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-117">As `GetMembersAsync` or `getMembers` returns the entire member list, it takes a long time for the API call to return for large teams, and it is common for the call to time out and you have to try again.</span></span>
* <span data-ttu-id="cdfb3-118">Получение сведений о профиле для одного пользователя затруднено: чтобы получить сведения о профиле для одного пользователя, необходимо получить весь список участников, а затем найти нужный.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-118">Getting profile details for a single user is difficult: To get the profile information for a single user, you have to retrieve the entire member list and then search for the one you want.</span></span> <span data-ttu-id="cdfb3-119">Существует функция помощника в SDK Bot Framework, чтобы упростерить ее, но она неэффективна.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-119">There is a helper function in the Bot Framework SDK to make it simpler, but it is not efficient.</span></span>

<span data-ttu-id="cdfb3-120">С введением широкой группы организаций существует требование, чтобы лучше согласовать эти API с Office 365 конфиденциальности.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-120">With the introduction of organization wide teams, there is a requirement to better align these APIs with Office 365 privacy controls.</span></span> <span data-ttu-id="cdfb3-121">Боты, используемые в больших группах, могут получать основные сведения о профиле, аналогичные разрешению `User.ReadBasic.All` Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-121">Bots used in large teams are able to retrieve basic profile information similar to the `User.ReadBasic.All` Microsoft Graph permission.</span></span> <span data-ttu-id="cdfb3-122">Администраторы клиентов имеют большой контроль над тем, какие приложения и боты можно использовать в клиенте, но эти параметры отличаются от microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-122">Tenant administrators have a great deal of control over which apps and bots can be used in their tenant, but these settings are different from Microsoft Graph.</span></span>

<span data-ttu-id="cdfb3-123">В следующем коде представлен пример представления JSON того, что возвращается Teams API бота:</span><span class="sxs-lookup"><span data-stu-id="cdfb3-123">The following code provides a sample JSON representation of what is returned by Teams bot APIs:</span></span>

```json
[{
    "id": "29:1GcS4EyB_oSI8A88XmWBN7NJFyMqe3QGnJdgLfFGkJnVelzRGos0bPbpsfJjcbAD22bmKc4GMbrY2g4JDrrA8vM06X1-cHHle4zOE6U4ttcc",
    "name": "Anon1 (Guest)",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "anonymous"
}, {
    "id": "29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk",
    "objectId": "76b0b09f-d410-48fd-993e-84da521a597b",
    "givenName": "John",
    "surname": "Patterson",
    "email": "johnp@fabrikam.com",
    "userPrincipalName": "johnp@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}, {
    "id": "29:1URzNQM1x1PNMr1D7L5_lFe6qF6gEfAbkdG8_BUxOW2mTKryQqEZtBTqDt10-MghkzjYDuUj4KG6nvg5lFAyjOLiGJ4jzhb99WrnI7XKriCs",
    "objectId": "6b7b3b2a-2c4b-4175-8582-41c9e685c1b5",
    "givenName": "Rick",
    "surname": "Stevens",
    "email": "Rick.Stevens@fabrikam.com",
    "userPrincipalName": "rstevens@fabrikam.com",
    "tenantId":"72f988bf-86f1-41af-91ab-2d7cd011db47",
    "userRole": "user"
}]
```

## <a name="api-changes"></a><span data-ttu-id="cdfb3-124">Изменения API</span><span class="sxs-lookup"><span data-stu-id="cdfb3-124">API Changes</span></span>

<span data-ttu-id="cdfb3-125">Ниже следующую статью предстоящих изменений API:</span><span class="sxs-lookup"><span data-stu-id="cdfb3-125">Following are the upcoming API changes:</span></span>

* <span data-ttu-id="cdfb3-126">Для получения сведений о профиле для участников чата или группы создается новый [`TeamsInfo.GetPagedMembersAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) API.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-126">A new API is created [`TeamsInfo.GetPagedMembersAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile) for retrieving profile information for members of a chat or team.</span></span> <span data-ttu-id="cdfb3-127">Этот API теперь доступен с версией Bot Framework 4.8 или более поздней SDK.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-127">This API is now available with the Bot Framework version 4.8 or later SDK.</span></span> <span data-ttu-id="cdfb3-128">Для разработки во всех других версиях используйте [`GetConversationPagedMembers`](/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) метод.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-128">For development in all other versions, use the [`GetConversationPagedMembers`](/dotnet/api/microsoft.bot.connector.conversationsextensions.getconversationpagedmembersasync?view=botbuilder-dotnet-stable&preserve-view=true) method.</span></span>

    > [!NOTE]
    > <span data-ttu-id="cdfb3-129">В v3 или v4 лучшим действием является обновление до последнего выпуска точки 3.30.2 или 4.8 или более поздней версии соответственно.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-129">In either v3 or v4, the best action is to upgrade to the latest point release that is 3.30.2 or 4.8 or later respectively.</span></span>

* <span data-ttu-id="cdfb3-130">Для получения сведений о профиле для одного пользователя создается новый [`TeamsInfo.GetMemberAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) API.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-130">A new API is created [`TeamsInfo.GetMemberAsync`](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#get-single-member-details) for retrieving the profile information for a single user.</span></span> <span data-ttu-id="cdfb3-131">В качестве параметров принимается ID группы или чата и [upN,](/windows/win32/ad/naming-properties#userprincipalname) то есть Azure Active Directory Object ID, или Teams пользователя в качестве параметров и возвращает сведения о профиле для этого `userPrincipalName` `objectId` `id` пользователя.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-131">It takes the ID of the team or chat and a [UPN](/windows/win32/ad/naming-properties#userprincipalname) that is `userPrincipalName`, Azure Active Directory Object ID `objectId`, or the Teams user ID `id` as parameters and returns the profile information for that user.</span></span>

    > [!NOTE]
    > <span data-ttu-id="cdfb3-132">`objectId` изменен в `aadObjectId` соответствие с тем, что называется в `Activity` объекте сообщения Bot Framework.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-132">`objectId` is changed to `aadObjectId` to match what is called in the `Activity` object of a Bot Framework message.</span></span> <span data-ttu-id="cdfb3-133">Новый API доступен с версией 4.8 или более поздней версией SDK bot Framework.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-133">The new API is available with version 4.8 or later of the Bot Framework SDK.</span></span> <span data-ttu-id="cdfb3-134">Он также доступен в Teams SDK extension Bot Framework 3.x.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-134">It is also available in the Teams SDK extension Bot Framework 3.x.</span></span> <span data-ttu-id="cdfb3-135">Между тем можно использовать конечную [точку REST.](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details)</span><span class="sxs-lookup"><span data-stu-id="cdfb3-135">Meanwhile, you can use the [REST](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#get-single-member-details) endpoint.</span></span>

* <span data-ttu-id="cdfb3-136">`TeamsInfo.GetMembersAsync` в C# и `TeamsInfo.getMembers` в TypeScript или Node.js формально отстает.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-136">`TeamsInfo.GetMembersAsync` in C# and `TeamsInfo.getMembers` in TypeScript or Node.js is formally deprecated.</span></span> <span data-ttu-id="cdfb3-137">После того как новый API будет доступен, необходимо обновить боты, чтобы использовать его.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-137">Once the new API is available, you must update your bots to use it.</span></span> <span data-ttu-id="cdfb3-138">Это также относится к основному [API REST, который используют эти API.](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json)</span><span class="sxs-lookup"><span data-stu-id="cdfb3-138">This also applies to the [underlying REST API that these APIs use](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=json#tabpanel_CeZOj-G++Q_json).</span></span>
* <span data-ttu-id="cdfb3-139">К концу 2022 г. боты не смогут активно извлекать свойства или свойства для членов `userPrincipalName` `email` чата или группы.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-139">By late 2022, bots cannot proactively retrieve the `userPrincipalName` or `email` properties for members of a chat or team.</span></span> <span data-ttu-id="cdfb3-140">Боты должны использовать Graph для их получения.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-140">Bots must use Graph to retrieve them.</span></span> <span data-ttu-id="cdfb3-141">Свойства `userPrincipalName` и свойства не `email` возвращаются из нового `GetConversationPagedMembers` API, начиная с конца 2022 г.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-141">The `userPrincipalName` and `email` properties are not returned from the new `GetConversationPagedMembers` API starting in late 2022.</span></span> <span data-ttu-id="cdfb3-142">Боты должны использовать Graph с маркером доступа для получения информации.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-142">Bots have to use Graph with an access token to retrieve information.</span></span> <span data-ttu-id="cdfb3-143">Ботам необходимо упростить процедуру получения маркера доступа, упростить и упростить процесс согласия конечных пользователей.</span><span class="sxs-lookup"><span data-stu-id="cdfb3-143">It must be made easier for bots to get an access token and streamline and simplify the end-user consent process.</span></span>
