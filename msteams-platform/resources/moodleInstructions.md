---
title: Установка интеграции Moodle с Microsoft Teams
description: Установка и настройка приложения интеграции Moodle для Microsoft Teams
keywords: Подключаемый модуль интеграции приложений Teams Moodle
ms.topic: how-to
ms.author: lajanuar
author: laujan
ms.openlocfilehash: bb3de6b3897105ff3564ecd332cba28a0db85b0f
ms.sourcegitcommit: a16590b2ccc46e1b6d17cbb367762a3c16ff779c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/05/2021
ms.locfileid: "50115743"
---
# <a name="installing-the-moodle-integration-with-microsoft-teams"></a>Установка интеграции Moodle с Microsoft Teams

[Moodle](https://moodle.org/)— популярные системы управления обучением с открытым кодом (LMS) теперь интегрированы с Microsoft Teams. Эта интеграция помогает преподавателям и преподавателям совместно работать над курсами Moodle, задавать вопросы о оценках и заданиях и получать уведомления непосредственно в Teams.

Чтобы помочь ИТ-администраторам легко настроить эту интеграцию, мы обновили подключаемый модуль Microsoft 365 Moodle с открытым кодом со следующими возможностями:

* Автоматическая регистрация сервера Moodle в [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) (Azure AD).
* Развертывание бота-помощника Moodle в Azure одним щелчком мыши.
* Автоматическая подготовка команд и автоматическая синхронизация регистрации команд для всех или выбранных курсов Moodle.
* Автоматическая установка вкладки Moodle и бота помощника Moodle в каждой синхронизированной команде.

Дополнительные информацию о функциях, которые  предоставляет эта интеграция, см. в [статьях Microsoft Teams и Moodle.](https://education.microsoft.com/resource/3dffb3a8)

## <a name="prerequisites"></a>Предварительные условия

Чтобы установить и настроить это приложение, вам потребуется:

1. Учетные данные администратора Moodle.

1. Учетные данные администратора Azure AD.

1. Подписка Azure, в которой можно создавать новые ресурсы.

## <a name="step-1-install-the-microsoft-365-moodle-plugins"></a>Шаг 1. Установка подключаемых модульов Microsoft 365 Moodle

Интеграция Moodle в Microsoft Teams состоит из набора подключаемых [модульов Microsoft 365 Moodle](https://github.com/Microsoft/o365-moodle)с открытым кодом. Чтобы установить подключаемый модуль на сервере Moodle, необходимо установить следующее:

1. Текущая [стабильная версия Moodle.](https://download.moodle.org/releases/latest/)

1. Подключаемые модуль Moodle [OpenID Connect](https://moodle.org/plugins/auth_oidc) и подключаемые модуль интеграции [Microsoft 365](https://moodle.org/plugins/local_o365) загружены и сохранены на локальном компьютере.

> [!NOTE]
> Установка подключаемых модульов OpenID Connect и интеграции Microsoft 365 необходима для интеграции Teams. Кроме того, настоятельно рекомендуется подключаемый модуль [темы Microsoft 365](https://moodle.org/plugins/theme_boost_o365teams) Teams.

3. Войдите на сервер Moodle с  учетной записью администратора и выберите "Администрирование сайта" в блоке "Параметры", расположенном на левой панели навигации. [](https://docs.moodle.org/22/en/Settings_block)

1. Выберите **вкладку "Подключаемый** модуль" и выберите **"Установить подключаемый модуль".**

1. В разделе **"Установить подключаемый модуль** из ZIP-файла" выберите **кнопку "Выбрать файл".**

1. Выберите **параметры отправки** файла в левой области навигации, найдите скачаный выше файл и выберите **"Отправить этот файл".**

1. Выберите параметр **администрирования сайта** на левой панели навигации, чтобы вернуться на панель мониторинга администрирования. Прокрутите вниз до **локальных подключаемых модуль** и выберите ссылку **"Интеграция Microsoft 365".** **Не открывая эту страницу конфигурации на отдельной вкладке браузера в процессе установки.**

Дополнительные сведения об установке подключаемых модульов Moodle можно найти в [документации Moodle.](https://docs.moodle.org/34/en/Installing_plugins)

> [!IMPORTANT]
>
> * Не открывая страницу настройки подключаемого модуль Microsoft 365 Moodle на отдельной вкладке браузера, вы будете возвращаться к этому набору страниц на протяжении всего процесса.  <br/><br/>
>* Если у вас нет существующего сайта Moodle, ознакомьтесь с репоигром Moodle в [Azure,](https://github.com/azure/moodle) где вы можете быстро развернуть экземпляр Moodle и настроить его в зависимости от ваших потребностей.

## <a name="step-2-configure-the-connection-between-the-microsoft-365-plugin-and-azure-active-directory-azure-ad"></a>Шаг 2. Настройка подключения между подключаемым модульом Microsoft 365 и Azure Active Directory (Azure AD)

Затем необходимо зарегистрировать Moodle в качестве приложения в Azure AD. Мы предоставили сценарий PowerShell, который поможет вам выполнить этот процесс. Сценарий PowerShell подготовка нового приложения Azure AD для клиента Microsoft 365, который будет использоваться подключаемый модуль Microsoft 365 Moodle. Сценарий подавит приложение для клиента Microsoft 365, настроит необходимые URL-адреса ответов и разрешения для этого приложения, а также возвратит `AppID` и `Key` . Вы можете использовать созданную и на странице настройки подключаемого модуль Microsoft 365 Moodle для настройки сайта `AppID` `Key` сервера Moodle с помощью Azure AD.

>[!IMPORTANT]
> Сценарий PowerShell не обновляется последними элементами конфигурации, поэтому вам придется вручную выполнить настройку, следуя шагам, описанным на страницах выпусков Moodle [3.8.0.4 и 3.9.1](https://docs.moodle.org/39/en/Office365#3.8.0.4_and_3.9.1_release) и [3.8.0.5 и 3.9.2.](https://docs.moodle.org/39/en/Office365#3.8.0.5_and_3.9.2_release) </br></br>
> Подробные инструкции по автоматизации сценария PowerShell  вручную см. в подстроке "Регистрация экземпляра [Moodle в качестве приложения".](https://docs.moodle.org/34/en/Office365#Register_your_Moodle_instance_as_an_Application)

### <a name="the-moodle-tab-for-microsoft-teams-information-flow"></a>Информационный поток на вкладке Moodle для Microsoft Teams

<img width="530px" src="../assets/images/MoodleTabInformationFlow.png" alt="Moodle tab for Microsoft Teams information flow" />

1. На странице подключаемой программы интеграции Microsoft 365 выберите вкладку **"Установка".**

1. Выберите **кнопку "Скачать сценарий PowerShell"** и сохраните ее на локальном компьютере.

1. Вам потребуется подготовить сценарий PowerShell из ZIP-файла. Для этого:

    * Скачайте и извлеките `Moodle-AzureAD-Powershell.zip` файл.
    * Откройте извлеченную папку.
    * Щелкните файл правой `Moodle-AzureAD-Script.ps1` кнопкой мыши и выберите **"Свойства".**
    * На **вкладке "Общие"** окна "Свойства" в нижней части окна поимяйте его рядом с атрибутом `Unblock`  "Безопасность".
    * Нажмите кнопку **ОК**.
    * Скопируйте путь к извлеченной папке.

1. Затем вы запустите PowerShell как администратор:

    * Выберите "Начните".
    * Введите PowerShell.
    * Щелкните правой кнопкой мыши Windows PowerShell.
    * Выберите "Запуск от администратора".

1. Перейдите в неподтверченный каталог, введя путь `cd .../.../Moodle-AzureAD-Powershell` `.../...` к каталогу.

1. Выполните сценарий PowerShell:

    * Введите `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser` .
    * Введите `./Moodle-AzureAD-Script.ps1` .
    * Войдите в учетную запись администратора Microsoft 365 во всплывающее окно.
    * Введите имя приложения Azure AD (например, подключаемый модуль Moodle/Moodle).
    * Введите URL-адрес сервера Moodle.
    * **Скопируйте ИД приложения** и **ключ приложения,** созданные сценарием, и сохраните их.

1. Далее необходимо добавить подключаемый ` AppID` модуль `Key` Microsoft 365 Moodle и его. Верните на страницу администрирования подключаемой модуль (администрирование ➡ подключаемых ➡ интеграции с Microsoft 365).

1. На **вкладке "Установка"** добавьте  ранее скопированные **ИД** приложения и ключ приложения, а затем выберите **"Сохранить изменения".**

1. После обновления страницы должен отвести новый раздел **"Выбор метода подключения".** Select the checkbox labeled **Default** and then select **Save changes** again.

1. После обновления страницы вы увидите еще один новый раздел согласия администратора **& дополнительные сведения.**
    * Выберите **ссылку "Предоставить согласие** администратора", введите свои  учетные данные глобального администратора Microsoft 365, а затем примите решение о предоставлении разрешений.
    * Рядом с **полем клиента Azure AD выберите** кнопку **"Обнаружить".**
    * Рядом с **URL-адресом OneDrive для бизнеса** выберите кнопку **"Обнаружить".**
    * После заполнения полей снова выберите кнопку **"Сохранить изменения".**

1. Выберите **кнопку** "Обновить", чтобы проверить установку, а затем **сохраните изменения.**

1. Затем необходимо синхронизировать пользователей между сервером Moodle и Azure AD. В зависимости от среды на этом этапе можно выбрать различные параметры. Для начала сделайте следующее:
    * Переход на **вкладку "Параметры синхронизации"**
    * В разделе **"Синхронизация пользователей с Azure AD"** выберите те из них, которые применяются к вашей среде. Как правило, вы выбираете по крайней мере следующее:  

        ✔ создание учетных записей в Moodle для пользователей в Azure AD. 
        ✔ всех учетных записей в Moodle для пользователей в Azure AD.  

    * В разделе **"Ограничение создания** пользователей" можно настроить фильтр, чтобы ограничить пользователей Azure AD, которые будут синхронизированы с Moodle.
    * В **разделе "Сопоставление** полей пользователей" можно настроить сопоставление полей профиля пользователя Moodle в Azure AD.
    * В разделе **"Синхронизация Teams"** можно выбрать автоматическое создание групп (то есть команд) для некоторых или всех существующих курсов Moodle.

> [!NOTE]
> Moodle [Cron](https://docs.moodle.org/310/en/Cron) будет работать в соответствии с расписанием задач (по умолчанию один раз в день). Однако обрезка должна запускаться чаще, чтобы синхронизировать все.

13. Чтобы проверить [задания обрезки](https://docs.moodle.org/310/en/Cron) (и/или запустить их вручную для первого запуска), выберите ссылку на страницу управления запланированными задачами в разделе "Синхронизация пользователей с **Azure AD".**  После этого вы будете **перенаться на страницу "Запланированные задачи".**

    * Прокрутите вниз и найдите пользователей **синхронизации с заданием Azure AD** и выберите **"Запустить сейчас".**
    * Если вы решили создать группы на основе существующих курсов, вы также можете запустить задание "Создание групп пользователей" в **Microsoft 365.**

1. Вернись на страницу администрирования подключаемго модуль (администрирование сайта ➡ подключаемых ➡ интеграции Microsoft 365) и выберите страницу **параметров Teams.** Вам потребуется настроить некоторые параметры, чтобы включить интеграцию приложений Teams.

    * Чтобы включить **OpenID Connect,** выберите ссылку "Управление проверкой подлинности" и выберите значок глаза в строке  **OpenId Connect,** если он затенен.
    * Далее необходимо включить встраив кадр. Выберите **ссылку "Http Security"** (Безопасность HTTP), а затем — "Allow **frame embedding"**(Разрешить встраиение кадров).
    * Далее необходимо включить веб-службы, которые будут использовать функции API Moodle. Выберите **ссылку "Дополнительные** функции", а  затем убедитесь, что рядом с веб-службами выбрана проверка.
    * Наконец, необходимо включить внешние службы для Microsoft 365. Выберите **ссылку "Внешние службы",** а затем:  

        ✔ выберите **"Изменить"** в **строке "Веб-службы Microsoft 365 Moodle".**  
        ✔ пометить его рядом с **"Включено"** и выберите **"Сохранить изменения"**

    * Затем необходимо изменить разрешения пользователей, подлинность которых была заверяема, чтобы разрешить им создавать маркеры веб-служб. Выберите **ссылку на роль редактирования "Пользователь с проверкой** подлинности". Прокрутите страницу вниз и найдите возможность создания **маркера** веб-службы и пометите ее как **"Разрешить".**

## <a name="step-3-deploy-the-moodle-assistant-bot-to-azure"></a>Шаг 3. Развертывание бота помощника Moodle в Azure

Бесплатный бот помощника Moodle для Microsoft Teams помогает преподавателям и учащимся отвечать на вопросы о курсах, заданиях, оценках и других сведениях в Moodle. Бот также отправляет уведомления Moodle учащимся и преподавателям в Teams. Бот — это проект с открытым исходным кодом, поддерживаемый корпорацией Майкрософт и доступный на [GitHub.](https://github.com/microsoft/Moodle-Teams-Bot)

> [!NOTE]
> В этом разделе вы развернете ресурсы в подписке Azure. Все ресурсы будут настроены на **бесплатном уровне.** В зависимости от использования бота может потребоваться масштабировать эти ресурсы.
> Если вы хотите использовать вкладку Moodle без бота, переперейти к [шагу 4.](#step-4-deploy-your-microsoft-teams-app)

### <a name="moodle-bot-information-flow"></a>Поток сведений о боте Moodle

<img width="530px" src="../assets/images/MoodleBotInformationFlow.png" alt="Moodle bot for Microsoft Teams information flow" />

Чтобы установить бота, сначала необходимо зарегистрировать его на платформе [удостоверений Майкрософт.](https://identity.microsoft.com/Landing) Это позволяет боту проверить подлинность в конечных точках Майкрософт. Чтобы зарегистрировать бота:

1. Вернись на страницу администрирования подключаемго модуль (администрирование сайта ➡ подключаемых ➡ интеграции с Microsoft 365) и выберите вкладку **"Параметры Teams".**

1. Выберите **ссылку на портал регистрации приложений Майкрософт** и войдите в систему с помощью своего ИД Майкрософт.

1. Введите имя приложения (например, MoodleBot) и выберите кнопку **"Создать".**

1. **Скопируйте ИД приложения** и в paste его в поле **Bot Application ID** на странице **"Параметры группы".**

1. Выберите **кнопку "Создать новый пароль".** Скопируйте созданный пароль и  в paste его в поле "Пароль приложения-бота" на странице **"Параметры группы".**

1. Прокрутите страницу до нижней части формы и выберите **"Сохранить изменения".**

Теперь, когда вы создали свой ИД приложения и пароль, пришло время развернуть бота в Azure:

> [!div class="checklist"]
> * Нажать кнопку "Развернуть в **Azure"** и заполнить форму необходимыми сведениями (на странице "Параметры группы" находятся код приложения бота, пароль приложения бота и секрет Moodle.  Сведения Azure см. на странице **"Установка".** 
> * Завершив заполнение формы, выберите его, чтобы согласиться с условиями.
> * Выберите **кнопку "Купить"** (все ресурсы Azure развертываются на бесплатном уровне).

После завершения развертывания ресурсов в Azure необходимо настроить подключаемый модуль Microsoft 365 Moodle с конечной точкой обмена сообщениями. Вам потребуется получить конечную точку от бота в Azure:

1. Войдите на [портал Azure.](https://portal.azure.com)

1. На левой области  выберите группы ресурсов и выберите группу ресурсов, которая использовалась (или была создана) при развертывании бота.

1. Выберите ресурс **Бота WebApp** из списка ресурсов в группе.

1. **Скопируйте конечную точку обмена сообщениями** из раздела **"Обзор".**

1. В Moodle откройте **страницу "Параметры** команды" подключаемого модульа Microsoft 365 Moodle.

1. В поле **конечной точки бота** в paste the URL-адрес, который вы только что скопировали, и измените word *messages* to *webhook*. ТЕПЕРЬ URL-адрес должен выглядеть следующим образом:  `https://botname.azurewebsites.net/api/webhook`

1. Выберите **"Сохранить изменения"**.

1. После сохранения изменений перейдите на  вкладку "Параметры  группы", выберите кнопку "Скачать файл манифеста" и сохраните пакет манифеста приложения на компьютере (вы будете использовать его в следующем разделе).

## <a name="step-4-deploy-your-microsoft-teams-app"></a>Шаг 4. Развертывание приложения Microsoft Teams

Теперь, когда бот развернут в Azure и настроен для беседы с сервером Moodle, пора развернуть приложение Microsoft Teams. Для этого вы загрузите файл манифеста приложения, загруженный со страницы параметров команды подключаемой установки Microsoft 365 Moodle на предыдущем шаге.

Перед установкой приложения необходимо убедиться, что включены внешние приложения и отправка приложений. Для этого вы можете следовать шагам в документации по подготовке клиента [Microsoft 365 в Teams.](../concepts/build-and-test/prepare-your-o365-tenant.md) После того как вы убедитесь, что внешние приложения включены, выполните следующие действия, чтобы развернуть приложение:

1. Откройте **Microsoft Teams.** 

1. Выберите **значок приложения** в левой нижней части панели навигации.

1. Выберите **ссылку "Отправить пользовательское приложение"** в списке параметров.

> [!Note]
> Если вы вошли с учетной записи глобального администратора, вы сможете отправить приложение в каталог приложений вашей организации, в противном случае вы сможете загрузить приложение только для команды, в которой вы входите.

4. Выберите `manifest.zip` пакет, который вы скачали ранее, и выберите **"Сохранить".** Если вы не скачали пакет манифеста приложения, это можно сделать на вкладке **"Параметры** группы" на странице конфигурации подключаемого модуль в Moodle.

Теперь, когда у вас установлено приложение, вы можете добавить вкладку в любой канал, к который у вас есть доступ. Для этого перейдите к каналу, выберите символ **плюса** (➕) и выберите приложение в списке. Следуйте подсказкам, чтобы завершить добавление вкладки курса Moodle в канал.

## <a name="step-5-allow-automatic-creation-of-moodle-tabs-in-microsoft-teams"></a>Шаг 5. Разрешить автоматическое создание вкладок Moodle в Microsoft Teams

Несмотря на то что вкладки Moodle можно создавать вручную в Microsoft Teams, вы можете решить, что они будут созданы автоматически, когда команды создаются при синхронизации курса. Для этого вы настроите ид загруженного приложения Microsoft Teams в Moodle:

1. Откройте Microsoft Teams.

1. Выберите значок "Приложения" в левой нижней части панели навигации.

1. Найдите загруженное приложение **Moodle, ➡** значок **параметров,** ➡ **ссылку на копию.**

1. В текстовом редакторе в paste the copied content. Он должен содержать URL-адрес, например ht&#8203;tps://teams.microsoft.com/l/app/00112233-4455-6677-8899-aabbccddeeff. Скопируйте последнюю часть URL-адреса, `00112233-4455-6677-8899-aabbccddeeff` например, ИД приложения Microsoft Teams.

1. В Moodle откройте вкладку приложения **Teams Moodle** на странице настройки подключаемой программы Microsoft 365 Moodle.

1. В paste the ID of the Microsoft Teams app into the Moodle app ID field, and save changes.

Теперь, когда курс Moodle синхронизируется, Microsoft Teams автоматически установит приложение Moodle в команде, создаст вкладку Moodle в общем канале Teams и настроит его так, чтобы оно содержало страницу курса Moodle, из которого оно синхронизируется.

### <a name="thats-it-you-and-your-team-can-now-start-working-with-your-moodle-courses-directly-from-microsoft-teams"></a>Вот и все! Теперь вы и ваша команда можете начать работать с курсами Moodle непосредственно из Microsoft Teams.

Чтобы поделиться с нами любыми запросами функций или отзывами, посетите нашу страницу [голосовой связи пользователя.](https://microsoftteams.uservoice.com/forums/916759-moodle)
