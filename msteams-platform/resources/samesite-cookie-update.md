---
title: Атрибут cookie SameSite
author: laujan
description: описывает атрибуты cookie SameSite
keywords: Атрибуты cookie samesite
ms.topic: reference
ms.localizationpriority: medium
ms.author: lomeybur
ms.openlocfilehash: 100bfa29cd8d193e73473bf32834885283f6ba2d
ms.sourcegitcommit: fc9f906ea1316028d85b41959980b81f2c23ef2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2021
ms.locfileid: "59157496"
---
# <a name="samesite-cookie-attribute"></a>Атрибут cookie SameSite 

Cookies — это текстовые строки, отправленные с веб-сайтов и хранимые на компьютере в веб-браузере. Они используются для проверки подлинности и персонализации. Например, файлы cookie используются для отзыва сведений о состоянии, сохранения параметров пользователя, записи просмотра и отображения соответствующих объявлений. Файлы cookie всегда связаны с определенным доменом и устанавливаются различными сторонами. 

## <a name="types-of-cookies"></a>Типы файлов cookie

Типы файлов cookie и соответствующие области:

|Cookie|Область|
| ------ | ------ |
|Первое куки участника|Первое стороное cookie создается веб-сайтами, которые посещает пользователь. Он используется для сохранения данных, например элементов корзины покупок, входа в учетные данные. Например, файлы cookie проверки подлинности и другие аналитические данные.|
|Cookie второй стороны|Cookie второй стороны технически то же самое, что и первое стороне cookie. Разница заключается в том, что данные делятся со второй стороной через соглашение о партнерстве с данными. Например, [Microsoft Teams аналитики и отчетности.](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference) |
|Cookie сторонних сторон|Файл cookie сторонних пользователей устанавливается доменом, помимо домена, который явно посещал пользователь, и используется в основном для отслеживания. Например, **"Как кнопки",** "служба" и "чаты в прямом эфире".|

## <a name="cookies-and-http-requests"></a>Запросы cookie и HTTP

Перед введением ограничений SameSite файлы cookie хранились в браузере. Они были присоединены к каждому веб-запросу HTTP и отправлены на сервер с помощью `Set Cookie` загона http-ответа. Этот метод ввел уязвимости безопасности, такие как подделка запросов на сайте, называемые атаками CSRF. Компонент SameSite сократил экспозицию за счет реализации и управления в загоне SetCookie.

## <a name="samesite-cookie-attribute-initial-release"></a>Атрибут cookie SameSite: начальный выпуск

Версия 51 Google Chrome представила `SetCookie SameSite` спецификацию как необязательный атрибут. Начиная с сборки 17672, Windows 10 поддерживает файлы cookie SameSite для [Microsoft Edge браузера.](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/)

Вы можете отказаться от добавления атрибута cookie SameSite в заготвку или добавить его с одним из двух `SetCookie` параметров, **Lax** и **Strict.** Невыполнение атрибута SameSite считалось состоянием по умолчанию.

## <a name="samesite-cookie-attribute-2020-release"></a>Атрибут cookie SameSite: выпуск 2020

Chrome 80, выпущенный в феврале 2020 г., вводит новые значения cookie и вводит политики cookie по умолчанию. Три значения передаются в обновленный атрибут SameSite: **Strict,** **Lax** или **None.** Если не указано, атрибут Cookie SameSite принимает значение `SameSite=Lax` по умолчанию.    
 
Атрибуты cookie SameSite следуют следующим образом:

|Setting | Правоприменители | Значение |Спецификация атрибута |
| -------- | ----------- | --------|--------|
| **Лакс**  | Файлы cookie отправляются автоматически только в контексте **первой** стороны и с запросами HTTP GET. Файлы cookie SameSite удерживаются во всех запросах на подзапев сайта, таких как вызовы для загрузки изображений или iframes. Они отправляются, когда пользователь переходит на URL-адрес с внешнего сайта, например, следуя ссылке.| **Default** |`Set-Cookie: key=value; SameSite=Lax`|
| **Strict** |Браузер отправляет файлы cookie только для первых запросов контекста сторон. Это запросы, исходимые из сайта, за набором cookie. Если запрос возник из другого URL-адреса, чем текущего расположения, ни одно из файлов cookie, помеченных атрибутом, не `Strict` отправляется.| Необязательна |`Set-Cookie: key=value; SameSite=Strict`|
| **Нет** | Файлы cookie отправляются как в первом контексте сторон, так и в запросах на перекрестное происхождение; однако значение должно быть явно за установлено, и все запросы браузера должны следовать **`None`** **протоколу HTTPS** и включать атрибут, для которого требуется **`Secure`** зашифрованное подключение. Файлы cookie, которые не соблюдают это требование, **отклоняется.** <br/>**Оба атрибута требуются вместе.** Если задан без протокола HTTPS или если он не используется, то сторонние  **`None`** **`Secure`**  файлы cookie отклоняется.| Необязательный, но если установлено, протокол HTTPS необходим. |`Set-Cookie: key=value; SameSite=None; Secure` |

## <a name="teams-implications-and-adjustments"></a>Teams последствий и корректировок

1. Включить соответствующий параметр SameSite для файлов cookie и проверить, что приложения и расширения продолжают работать в Teams.
1. Если ваши приложения или расширения сбой, сделать необходимые исправления до выпуска Chrome 80.
1. Внутренние партнеры Майкрософт могут присоединиться к следующей группе, чтобы получить дополнительные сведения или помочь в этом вопросе: <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47> .

> [!NOTE]
> Необходимо установить атрибуты SameSite для отражения предназначенного использования для файлов cookie. Не полагаться на поведение браузера по умолчанию. Дополнительные сведения см. [в статью Developers: Get Ready for New SameSite=None; Безопасные файлы cookie Параметры](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html).

### <a name="tabs-task-modules-and-messaging-extensions"></a>Вкладки, модули задач и расширения обмена сообщениями

* Teams вкладки используются для встраивки контента, просматриваемой в контексте верхнего `<iframes>` уровня или первого участника.
* Модули задач позволяют создавать модальные всплывающие окна в приложении Teams. Как и вкладка, внутри текущей страницы открывается модальный окне.
* Расширения обмена сообщениями позволяют вставлять обогащенный контент в сообщение чата из внешних ресурсов.

Любые файлы cookie, используемые встроенным контентом, считаются сторонними, если сайт отображается в `<iframe>` . Кроме того, если удаленные ресурсы на странице зависят от файлов cookie, отосланных с запросом и тегами, внешними шрифтами и персонализированным контентом, необходимо убедиться, что они помечены для использования на межу сайте, например или для обеспечения на месте `<img>` `<script>` `SameSite=None; Secure` отката.

### <a name="authentication"></a>Аутентификация

Для этого необходимо использовать поток проверки подлинности на основе веб-сайтов:

* Встроенные страницы контента в вкладки.
* Страница конфигурации, модуль задач и расширение обмена сообщениями.
* Разговорный бот с модулем задач.

В соответствии с обновленными ограничениями SameSite браузер не добавляет cookie на уже заверяемую проверку подлинности веб-сайт, если ссылка происходит из внешнего сайта. Необходимо убедиться в том, что файлы cookie проверки подлинности помечены для использования на разных веб-узлах, или обеспечить, чтобы произошла `SameSite=None; Secure` откатка.

## <a name="android-system-webview"></a>Android System WebView

Android WebView — это системный компонент Chrome, который позволяет приложениям Android отображать веб-контент. Несмотря на то, что новые ограничения по умолчанию, начиная с Chrome 80, они применяются не сразу в WebViews. Они будут применяться в будущем. Чтобы подготовиться, Android позволяет родным приложениям устанавливать файлы cookie непосредственно через [API CookieManager.](https://developer.android.com/reference/android/webkit/CookieManager)

> [!NOTE]     
> * Вы должны объявить первой стороне cookies, `SameSite=Lax` как или , по мере `SameSite=Strict` необходимости.      
> * Вы должны объявить сторонние файлы cookie как `SameSite=None; Secure` .   

## <a name="see-also"></a>См. также

* [Примеры SameSite](https://github.com/GoogleChromeLabs/samesite-examples)
* [Рецепты cookie SameSite](https://web.dev/samesite-cookie-recipes/)
* [Известные несовместимые клиенты]( https://www.chromium.org/updates/same-site/incompatible-clients)
* [Разработчики: Приготовьтесь к новому режиму SameSite=None; безопасной настройке файлов cookie](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)
* [Предстоящие изменения файлов cookie SameSite в ASP.NET и ASP.NET Core](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/)
* [Файлы cookie HTTP](https://developer.mozilla.org/docs/Web/HTTP/Cookies)
