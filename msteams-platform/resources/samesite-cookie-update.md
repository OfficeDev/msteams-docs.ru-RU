---
title: Microsoft Teams и атрибут cookie SameSite (обновление 2020 г.)
author: laujan
description: описывает атрибуты cookie SameSite
keywords: Атрибуты cookie samesite
ms.topic: reference
localization_priority: Normal
ms.author: lomeybur
ms.openlocfilehash: 5713c7aae0461e577627ae7296f0a58a25ba062f
ms.sourcegitcommit: 825abed2f8784d2bab7407ba7a4455ae17bbd28f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2021
ms.locfileid: "52020438"
---
# <a name="microsoft-teams-and-the-samesite-cookie-attribute-2020-update"></a>Microsoft Teams и атрибут cookie SameSite (обновление 2020 г.)

## <a name="cookies-in-brief"></a>Cookies in brief

 Cookies — это текстовые строки, отправленные с веб-сайтов и хранимые на компьютере в веб-браузере. Обычно они используются для проверки подлинности и персонализации, например для отзыва сведений о состоянии, сохранения параметров пользователей, записи просмотра и отображения соответствующих объявлений. Файлы cookie всегда связаны с определенным доменом и могут быть установлены различными сторонами. Они классифицируются следующим образом:

 |Cookie|Область|
 | ------ | ------ |
 |**Первопартийное cookie**|Самостоятельные файлы cookie создаются веб-сайтами, которые посещает пользователь, и используется для сохранения данных, таких как элементы корзины, учетные данные входа (например, cookie-файлы проверки подлинности) и другие аналитики.|
 |**Второе стороне cookie**|Второпартийное cookie—это технически то же самое, что и первопартийное cookie. Разница в том, что данные делятся со второй стороной через соглашение о партнерстве с данными (например, аналитика [Microsoft Teams и отчетность).](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference) |
 |**Сторонние файлы cookie**|Сторонний файл cookie устанавливается доменом, помимо домена, который явно посещал пользователь, и используется в основном для отслеживания (например, кнопок "Нравится"), службы и чатов в прямом эфире.|

### <a name="cookies-and-http-requests"></a>Запросы cookie и HTTP

Перед введением ограничений SameSite, когда файлы cookie хранились в браузере, они были присоединены к каждому веб-запросу *HTTP* и отправлены на сервер Set-Cookie http response header. Предсказуемо, что эта производительность может ввести уязвимости безопасности, такие как атаки на подделку запросов на меж сайте (CSRF). *См.* [файлы cookie HTTP.](https://developer.mozilla.org/docs/Web/HTTP/Cookies) Компонент SameSite смягчил это воздействие с помощью его реализации и управления в загоне SetCookie.

### <a name="samesite-attribute-initial-release"></a>Атрибут SameSite: начальный выпуск

Версия 51 Google Chrome представила спецификацию SetCookie SameSite как *необязательный* атрибут. Начиная со сборки 17672, Windows 10 представила поддержку cookie SameSite для [браузера Microsoft Edge.](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/)

Разработчики могут отказаться от добавления атрибута cookie SameSite в заготвку SetCookie или добавить его с одним из двух параметров, *Lax* и *Strict.* Невыполнение атрибута SameSite считалось состоянием по умолчанию.

## <a name="samesite-cookie-attribute-2020-release"></a>Атрибут cookie SameSite: выпуск 2020

Chrome 80, запланированный на выпуск в феврале 2020 г., вводит новые значения cookie и накладывает политики cookie по умолчанию. Три значения можно передать в обновленный атрибут SameSite: *Strict,* *Lax* или *None.* Файлы cookie, не указывав атрибут SameSite, будут по умолчанию `SameSite=Lax` .

|Setting | Правоприменители | Значение |Спецификация атрибута |
| -------- | ----------- | --------|--------|
| **Лакс**  | Файлы cookie будут отправлены автоматически только в *контексте* первой стороны и с запросами HTTP GET. Файлы cookie SameSite будут отказано в межсайтовом подзапросах, таких как вызовы для загрузки изображений или iframes, но будут отправлены при переходе пользователя на URL-адрес с внешнего сайта, например, по ссылке.| **Default** |`Set-Cookie: key=value; SameSite=Lax`|
| **Strict** |Браузер отправляет файлы cookie только для запросов контекста первой стороны (запросы, возникающие с сайта, замещая файл cookie). Если запрос исходил из другого URL-адреса, чем текущего расположения, ни одно из файлов cookie, помеченных атрибутом, не `Strict` будет отправлено.| Необязательна |`Set-Cookie: key=value; SameSite=Strict`|
| **Нет** | Файлы cookie будут отправлены как в первом, так и в межпромысных запросах; однако значение должно быть явно за установлено, и все запросы браузера должны следовать **`None`** **протоколу HTTPS** и включать атрибут, для которого требуется **`Secure`** зашифрованное подключение. Файлы cookie, которые не соблюдают это требование, будут **отклонены.** <br/>**Оба атрибута требуются вместе.** Если только указано без или если протокол HTTPS не используется, сторонное **`None`** **`Secure`**  cookie будет отклонено.| Необязательный, но если установлено, протокол HTTPS необходим. |`Set-Cookie: key=value; SameSite=None; Secure` |

## <a name="handling-incompatible-clients"></a>Обработка несовместимых клиентов

> [!IMPORTANT]
> В `SameSite=None`  настоящее время не поддерживается [**клиентом или**](/aspnet/core/security/samesite?view=aspnetcore-3.1#test-with-electron&preserve-view=true) более старыми версиями Chrome или Safari. **См.** [известные несовместимые клиенты]( https://www.chromium.org/updates/same-site/incompatible-clients).
>Однако существует два **обходных решения:**
>
>1. Проверьте пользователя-агента, чтобы предоставить правильное свойство SameSite. Вы можете реализовать проверку пользователя и агента в [**C#**](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/) [**иNode.js.**](https://web.dev/samesite-cookie-recipes/)
>2. Установите атрибуты cookie с помощью новых и старых моделей. *См.* [в обращении с несовместимыми клиентами](https://web.dev/samesite-cookie-recipes/#handling-incompatible-clients)<br><br>
>**Если приложение работает в клиенте на рабочем столе Teams и вы задайте атрибут SameSite, ваше приложение будет работать `SameSite=None` не так, как ожидалось.**

Использование любого подхода гарантирует, что ваше приложение будет работать правильно, когда клиент настольных компьютеров Teams будет обновлен до совместимой версии `SameSite=None`   Chromium.

## <a name="teams-implications-and-adjustments"></a>Последствия и корректировки команд

>[!WARNING]
>**Приложения, работающие в настольном клиенте Teams, несовместимы с атрибутом, и они `SameSite=None`  будут работать не так, как ожидалось.** См. **выше решения обходных** решений.

1. Встройте соответствующий параметр SameSite для файлов cookie и проверьте, продолжают ли приложения и расширения работать в Teams.
1. Если ваши приложения или расширения сбой, сделать необходимые исправления до выпуска Chrome 80.
1. Внутренние партнеры Майкрософт могут присоединиться к следующей группе, если им потребуется больше информации или помощь в этом вопросе: <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47> .

> [!NOTE]
> Для наилучшей практики рекомендуется всегда устанавливать атрибуты SameSite, чтобы они отражали предназначенное использование файлов cookie, не полагаясь на поведение браузера по умолчанию. *См.* [статью Developers: Get Ready for New SameSite=None; Безопасные параметры cookie](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html).

### <a name="tabs-task-modules-and-message-extensions"></a>Вкладки, модули задач и расширения сообщений

* Вкладки Teams используются для встраивки контента, просматриваемого в контексте верхнего `<iframes>` или первого уровня.
* Модули задач позволяют создавать модальные всплывающие окна в приложении Teams. Как и вкладка, внутри текущей страницы открывается модальный окне.
* Расширения сообщений позволяют вставлять обогащенный контент в сообщение чата из внешних ресурсов.

Все файлы cookie, используемые встроенным контентом, будут считаться сторонними при отобралении сайта в `<iframe>` . Кроме того, если удаленные ресурсы на странице зависят от файлов cookie, отосланных с запросом (например, тегами, внешними шрифтами и персонализированным контентом), необходимо убедиться, что они помечены для использования на разных `<img>` веб-узлах или будут иметь место. `<script>` `SameSite=None; Secure`

### <a name="authentication"></a>Проверка подлинности

* Если требуется проверка подлинности для встроенных страниц контента на вкладке, необходимо использовать поток проверки подлинности на основе веб-данных.
* Поток проверки подлинности на веб-основе также может использоваться для страницы конфигурации, модуля задач или расширения обмена сообщениями.
* Вы можете использовать поток проверки подлинности на веб-основе для беседуемого бота, необходимого для использования модуля задач.

В соответствии с обновленными ограничениями SameSite браузер не будет добавлять cookie на уже заверяемом веб-сайте, если ссылка происходит из внешнего сайта. Необходимо убедиться в том, что файлы cookie проверки подлинности помечены для использования на разных веб-узлах или будут иметь место для `SameSite=None; Secure` отката.

### <a name="android-system-webview"></a>Android System WebView

Android WebView — это системный компонент Chrome, который позволяет приложениям Android отображать веб-контент. Хотя новые ограничения станут по умолчанию, начиная с Chrome 80, они не будут немедленно применяться в WebViews. Они будут применяться в будущем. Чтобы подготовиться, Android позволяет родным приложениям устанавливать файлы cookie непосредственно через [API CookeManager:](https://developer.android.com/reference/android/webkit/CookieManager)

* Для файлов cookie, которые необходимы только в контексте первой стороны, их следует объявить как `SameSite=Lax` `SameSite=Strict` соответствующие или соответствующие.
* Для файлов cookie, необходимых в стороном контексте, необходимо убедиться, что они объявлены `SameSite=None; Secure` как .

## <a name="learn-more"></a>Подробнее

[Примеры SameSite](https://github.com/GoogleChromeLabs/samesite-examples)

[Рецепты cookie SameSite](https://web.dev/samesite-cookie-recipes/)

[Известные несовместимые клиенты]( https://www.chromium.org/updates/same-site/incompatible-clients)

[Разработчики: готовьтесь к new SameSite=None; Безопасные параметры cookie](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)

**Влияние OpenId Connect**<br>
[Предстоящие изменения cookie SameSite в ASP.NET и ASP.NET Core](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/)
