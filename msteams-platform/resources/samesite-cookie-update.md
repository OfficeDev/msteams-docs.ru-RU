---
title: Атрибут cookie SameSite
author: laujan
description: Сведения о типах файлов cookie, включая файлы cookie SameSite, их атрибутах, их последствиях на вкладке Teams, модулях задач и расширениях сообщений, а также их проверке подлинности в Teams
keywords: samesite атрибутов cookie
ms.topic: reference
ms.localizationpriority: medium
ms.author: lomeybur
ms.openlocfilehash: 1fbaf46da93a0d7c253f1f5d2ad6c9ae1764565a
ms.sourcegitcommit: 0117c4e750a388a37cc189bba8fc0deafc3fd230
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/27/2022
ms.locfileid: "65104492"
---
# <a name="samesite-cookie-attribute"></a>Атрибут cookie SameSite

Файлы cookie — это текстовые строки, отправляемые с веб-сайтов и хранящиеся на компьютере в веб-браузере. Они используются для проверки подлинности и персонализации. Например, файлы cookie используются для отзыва сведений с отслеживанием состояния, сохранения параметров пользователя, просмотра записей и отображения соответствующей рекламы. Файлы cookie всегда связаны с определенным доменом и устанавливаются различными сторонами.

## <a name="types-of-cookies"></a>Типы файлов cookie

Типы файлов cookie и соответствующие им области:

|Cookie|Область|
| ------ | ------ |
|Файл cookie от первой стороны|Пользовательский файл cookie создается веб-сайтами, которые посещает пользователь. Он используется для сохранения данных, таких как элементы корзины для покупок, учетные данные для входа. Например, файлы cookie проверки подлинности и другая аналитика.|
|Сторонний файл cookie|Второй файл cookie технически совпадает с файлом cookie от первой стороны. Разница заключается в том, что данные совместно используются второй стороной в рамках соглашения о партнерских отношениях с данными. Например, Microsoft Teams [аналитики и отчетов](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference). |
|Сторонние файлы cookie|Сторонний файл cookie устанавливается доменом, отличным от домена, который пользователь явно посещает и в основном используется для отслеживания. Например, кнопки **"** Нравится", подача рекламы и чаты в реальном времени.|

## <a name="cookies-and-http-requests"></a>Файлы cookie и HTTP-запросы

До появления ограничений SameSite файлы cookie хранимы в браузере. Они были присоединены к каждому веб-запросу HTTP и отправлены `Set Cookie` на сервер с помощью заголовка http-ответа. В этом методе появились уязвимости безопасности, такие как подделка межсайтовых запросов, называемые атаками CSRF. Компонент SameSite снижает уязвимость за счет его реализации и управления в заголовке SetCookie.

## <a name="samesite-cookie-attribute-initial-release"></a>Атрибут файла cookie SameSite: начальный выпуск

В Google Chrome версии 51 спецификация `SetCookie SameSite` представлена как необязательный атрибут. Начиная со сборки 17672, Windows 10 поддерживает файлы cookie SameSite для [браузера MicrosoftEdge&nbsp;](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/).

Вы можете отказаться от добавления атрибута cookie SameSite `SetCookie` в заголовок или добавить его с одним из двух параметров: **Lax** и **Strict**. Нереплментированные атрибуты SameSite считаются состоянием по умолчанию.

## <a name="samesite-cookie-attribute-2020-release"></a>Атрибут файла cookie SameSite: выпуск 2020 г.

Chrome 80, выпущенный в феврале 2020 г., вводит новые значения файлов cookie и по умолчанию налагает политики файлов cookie. В обновленный атрибут SameSite передаются три значения: **Strict**, **Lax** или **None**. Если значение не указано, атрибут SameSite файлов cookie принимает значение `SameSite=Lax` по умолчанию.

Атрибуты cookie SameSite перечислены ниже.

|Setting | Исполнения | Значение |Спецификация атрибута |
| -------- | ----------- | --------|--------|
| **Лакса**  | Файлы cookie отправляются автоматически только в контексте от первой **стороны** и с помощью HTTP-запросов GET. Файлы cookie SameSite удерживаются при запросах к подсайтов сайтам, таких как вызовы для загрузки изображений или iframes. Они отправляются, когда пользователь переходит по URL-адресу с внешнего сайта, например, по ссылке.| **Default** |`Set-Cookie: key=value; SameSite=Lax`|
| **Строгий** |Браузер отправляет файлы cookie только для запросов контекста от первой стороны. Это запросы, исходящие с сайта, на котором задается файл cookie. Если запрос был отправлен по URL-адресу, отличному от URL-адреса текущего расположения, ни один из файлов cookie, помеченных атрибутом `Strict` , не отправляется.| При необходимости |`Set-Cookie: key=value; SameSite=Strict`|
| **Нет** | Файлы cookie отправляются как в исходном контексте, так и в запросах между источниками; Однако значение должно быть **`None`** явно задано, и все запросы браузера должны следовать протоколу **HTTPS** **`Secure`** и включать атрибут, для которого требуется зашифрованное подключение. Файлы cookie, которые не соответствуют требованиям, **отклоняются**. <br/>**Оба атрибута являются обязательными вместе**. Если  **`None`** указан без протокола **`Secure`**  HTTPS или если он не используется, сторонние файлы cookie отклоняются.| Необязательный, но, если задано, требуется протокол HTTPS. |`Set-Cookie: key=value; SameSite=None; Secure` |

## <a name="teams-implications-and-adjustments"></a>Teams последствия и корректировки

1. Включите соответствующий параметр SameSite для файлов cookie и убедитесь, что приложения и расширения продолжают работать в Teams.
1. В случае сбоя приложений или расширений внесите необходимые исправления до выпуска Chrome 80.
1. Внутренние партнеры Майкрософт могут присоединиться к следующей команде для получения дополнительных сведений или справки по этой проблеме. <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47>

> [!NOTE]
> Необходимо задать атрибуты SameSite, чтобы отразить предполагаемое использование файлов cookie. Не следует полагаться на поведение браузера по умолчанию. Дополнительные сведения см. в [разделе Developers: Get Ready for New SameSite=None; Защита файлов cookie Параметры](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html).

### <a name="tabs-task-modules-and-message-extensions"></a>Вкладки, модули задач и расширения сообщений

* Teams вкладки используются `<iframes>` для внедрения содержимого, просматриваемого на верхнем уровне или в контексте от первой стороны.
* Модули задач позволяют создавать модальные всплывающие окна в приложении Teams. Как и на вкладке, на текущей странице открывается модальное окно.
* Расширения сообщений позволяют вставлять обогащенное содержимое в сообщение чата из внешних ресурсов.

Все файлы cookie, используемые внедренным содержимым, считаются сторонними при отображении сайта в `<iframe>`. Кроме того, `<img>` `<script>` если какие-либо удаленные ресурсы на странице зависят от файлов cookie, отправляемых с запросом и тегами, внешними шрифтами и персонализированным содержимым, необходимо убедиться, что они помечены для межсайтового использования, `SameSite=None; Secure` например для резервного копирования.

### <a name="authentication"></a>Проверка подлинности

Поток проверки подлинности на основе Интернета необходимо использовать для следующих действий:

* Внедренные страницы содержимого на вкладке.
* Страница конфигурации, модуль задач и расширение сообщения.
* Чат-бот с модулем задачи.

В соответствии с обновленными ограничениями SameSite браузер не добавляет файл cookie на уже прошедший проверку подлинности веб-сайт, если ссылка является производным от внешнего сайта. Необходимо убедиться, что файлы cookie `SameSite=None; Secure` проверки подлинности помечены для использования между сайтами, или обеспечить резервирование.

## <a name="android-system-webview"></a>Android System WebView

Android WebView — это системный компонент Chrome, который позволяет приложениям Android отображать веб-содержимое. Хотя новые ограничения применяются по умолчанию, начиная с Chrome 80, они не применяются сразу к веб-представлениям. Они будут применены в будущем. Для подготовки Android позволяет собственным приложениям задавать файлы cookie непосредственно через [API CookieManager](https://developer.android.com/reference/android/webkit/CookieManager).

> [!NOTE]
>
> * Необходимо объявить файлы cookie от первой стороны соответствующим `SameSite=Lax` `SameSite=Strict`образом или по мере необходимости.
> * Файлы cookie сторонних производителей необходимо объявить как `SameSite=None; Secure`.

## <a name="see-also"></a>См. также

* [Примеры SameSite](https://github.com/GoogleChromeLabs/samesite-examples)
* [Рецепты файлов cookie SameSite](https://web.dev/samesite-cookie-recipes/)
* [Известные несовместимые клиенты]( https://www.chromium.org/updates/same-site/incompatible-clients)
* [Разработчики: Приготовьтесь к новому режиму SameSite=None; безопасной настройке файлов cookie](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)
* [Предстоящие изменения файлов cookie SameSite в ASP.NET и ASP.NET Core](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/)
* [Файлы cookie HTTP](https://developer.mozilla.org/docs/Web/HTTP/Cookies)
