---
title: Microsoft Teams и атрибут печенья SameSite (обновление 2020 года)
author: laujan
description: описывает атрибуты файла cookie SameSite
keywords: cookie атрибуты samesite
ms.topic: reference
localization_priority: Normal
ms.author: lomeybur
ms.openlocfilehash: cf28a28050d50b2b6b2601a3231cdad30211ab2c
ms.sourcegitcommit: 51e4a1464ea58c254ad6bd0317aca03ebf6bf1f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "52566714"
---
# <a name="microsoft-teams-and-the-samesite-cookie-attribute-2020-update"></a>Microsoft Teams и атрибут печенья SameSite (обновление 2020 года)

## <a name="cookies-in-brief"></a>Печенье вкратце

 Cookies являются текстовыми строками, отправленными с веб-сайтов и хранящимися на компьютере веб-браузером. Они обычно используются для проверки подлинности и персонализации, например, для отзыва информации о состоянии, сохранения настроек пользователя, записи активности просмотра и отображения соответствующих объявлений. Файлы cookie всегда связаны с определенным доменом и могут быть установлены различными сторонами. Они классифицируются следующим образом:

 |Cookie|Область|
 | ------ | ------ |
 |**Печенье первой стороны**|Файлы cookie от первой стороны создаются веб-сайтами, которые посещает пользователь, и используются для сохранения данных, таких как товары корзины, учетные данные входа. Например, файлы cookie-файлов аутентификации и другая аналитика.|
 |**Печенье второй стороны**|Печенье второй стороны технически такое же, как и печенье первой стороны. Разница заключается в том, что данные совместно с второй стороной через соглашение о партнерстве данных. Например, [Microsoft Teams аналитики и отчетности.](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference) |
 |**Сторонние файлы cookie**|Сторонний файл cookie устанавливается доменом, не посещенный пользователем, и в основном используется для отслеживания. Например, кнопки "Нравится", рекламные объявления и чаты.|

### <a name="cookies-and-http-requests"></a>Запросы cookie и HTTP

До введения ограничений SameSite, когда файлы cookie хранились в браузере, они были прикреплены к *каждому* веб-запросу HTTP и отправлены на сервер заголовком Set-Cookie ответа HTTP. Как и ожидалось, эта производительность может привести к внедрению уязвимостей безопасности, таких как атаки подделки запросов на кросс-сайт (CSRF). *Смотрите* [файлы cookie HTTP](https://developer.mozilla.org/docs/Web/HTTP/Cookies). Компонент SameSite смягчил эту экспозицию благодаря ее внедрению и управлению в заголовке SetCookie.

### <a name="samesite-attribute-initial-release"></a>Атрибут SameSite: первоначальный релиз

Google Chrome версия 51 представила SetCookie SameSite спецификации в качестве *дополнительного атрибута.* Начиная с Build 17672, Windows 10 представила поддержку печенья SameSite [для Microsoft Edge браузера.](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/)

Разработчики могут отказаться от добавления атрибута печенья SameSite в заголовок SetCookie или добавить его с одним из двух параметров, *Lax* и *Strict.* Неопроверенный атрибут SameSite считался состоянием по умолчанию.

## <a name="samesite-cookie-attribute-2020-release"></a>Атрибут печенья SameSite: релиз 2020 года

Chrome 80, релиз которого запланирован на февраль 2020 года, вводит новые значения cookie и вводит политики cookie по умолчанию. Три значения могут быть переданы в обновленный атрибут SameSite: *Строгий,* *Лакс,* или *Нет*. Файлы cookie, не укажите атрибут SameSite, по `SameSite=Lax` умолчанию.

|Параметр | принуждение | Значение |Спецификация атрибутов |
| -------- | ----------- | --------|--------|
| **слабый**  | Файлы cookie будут автоматически отправлены только *в первом случае* и с запросами HTTP GET. Файлы cookie SameSite будут удержаны на кросс-сайтах, таких как вызовы для загрузки изображений или iframes, но будут отправлены, когда пользователь переходит на URL с внешнего сайта, например, следуя ссылке.| **По умолчанию** |`Set-Cookie: key=value; SameSite=Lax`|
| **строгий** |Браузер будет отправлять файлы cookie только для запросов контекста первой стороны (запросы, исходящие с сайта, устанавливающих cookie). Если запрос получен по другому URL-адресу, чем в текущем местоположении, ни одно из файлов cookie, отмеченных `Strict` атрибутом, не будет отправлено.| Необязательный |`Set-Cookie: key=value; SameSite=Strict`|
| **Нет** | Файлы cookie будут отправлены как в контексте первой стороны, так и в запросах о перекрестном происхождении; однако значение должно быть явно настроено, и **`None`** все запросы браузера **должны следовать протоколу HTTPS** и включать **`Secure`** атрибут, который требует зашифрованного соединения. Файлы cookie, которые не соответствуют этому требованию, будут **отклонены.** <br/>**Оба атрибута необходимы вместе.** Если **`None`** просто указано без **`Secure`**  или если протокол HTTPS не используется, сторонний файл cookie будет отклонен.| Необязательно, но, если установлено, протокол HTTPS не требуется. |`Set-Cookie: key=value; SameSite=None; Secure` |

## <a name="teams-implications-and-adjustments"></a>Teams последствия и корректировки

1. Включите соответствующую настройку SameSite для файлов cookie и подтвердите, что ваши приложения и расширения продолжают работать в Teams.
1. Если ваши приложения или расширения выходят из строя, сделайте необходимые исправления до выпуска Chrome 80.
1. Внутренние партнеры Майкрософт могут присоединиться к следующей команде, если им нужна дополнительная информация или помощь в этой проблеме: <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47> .

> [!NOTE]
> Для наилучшей практики рекомендуется всегда устанавливать атрибуты SameSite, чтобы отразить предполагаемое использование файлов cookie. Не полагайтесь на поведение браузера по умолчанию. Для получения дополнительной информации [см. Безопасные файлы cookie Параметры](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html).

### <a name="tabs-task-modules-and-message-extensions"></a>Вкладки, модули задач и расширения сообщений

* Teams вкладок `<iframes>` используются для встраивания содержимого, которое просматривается в контексте верхнего или первого уровня.
* Модули задач позволяют создавать модальные всплывающие окна в приложении Teams. Как и вкладка, модное окно открывается внутри текущей страницы.
* Расширения сообщений позволяют вставлять обогащенное содержимое в чат-сообщение с внешних ресурсов.

Любые файлы cookie, используемые встроенным контентом, будут считаться сторонними, когда сайт отображается в `<iframe>` . Кроме того, если удаленные ресурсы на странице полагаются на файлы cookie, отправленные с запросом и тегами, внешними шрифтами и персонализированным контентом, необходимо обеспечить их пометку для использования на `<img>` `<script>` кросс-сайте, например, или убедиться, `SameSite=None; Secure` что есть обратный вариант.

### <a name="authentication"></a>Проверка подлинности

* Если требуется аутентификация для встроенных страниц содержимого во вкладок, вам нужно будет использовать поток проверки подлинности на веб-сайте.
* Поток проверки подлинности в Интернете также может использоваться для страницы конфигурации, модуля задач или расширения обмена сообщениями.
* Вы можете использовать поток веб-аутентификации для разговорного бота, необходимого для использования модуля задач.

В соответствии с обновленными ограничениями SameSite браузер не будет добавлять файлы cookie на уже аутентифицированный веб-сайт, если ссылка происходит от внешнего сайта. Необходимо обеспечить пометку файлов cookie-файлов аутентификации для использования на кросс-сайте `SameSite=None; Secure` или убедиться в том, что есть обратный вариант.

### <a name="android-system-webview"></a>Android система WebView

Android WebView является компонентом системы Chrome, который позволяет Android приложений для отображения веб-контента. Хотя новые ограничения станут по умолчанию, начиная с Chrome 80, они не будут немедленно применяться на WebViews. Они будут применяться в будущем. Для подготовки Android позволяет родным приложениям устанавливать файлы cookie непосредственно через [API CookeManager:](https://developer.android.com/reference/android/webkit/CookieManager)

* Для файлов cookie, которые необходимы только в первом случае, вы должны объявить их как `SameSite=Lax` или, в `SameSite=Strict` случае необходимости.
* Для файлов cookie, необходимых в сторонняя контекста, необходимо убедиться, что они объявлены `SameSite=None; Secure` .

## <a name="see-also"></a>См. также

* [Примеры sameSite](https://github.com/GoogleChromeLabs/samesite-examples)

* [Рецепты печенья SameSite](https://web.dev/samesite-cookie-recipes/)

* [Известные несовместимые клиенты]( https://www.chromium.org/updates/same-site/incompatible-clients)

* [Разработчики: Будьте готовы к новому SameSite-None; Безопасный файл Параметры](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)

**OpenId Подключение влияние**<br>
[Предстоящие изменения в файлах Cookie SameSite ASP.NET и ASP.NET Core](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/)
