---
title: Атрибут cookie SameSite
author: laujan
description: Сведения о типах файлов cookie, включая файлы cookie SameSite, их атрибутах, использовании на вкладках Teams, в модулях задач и расширениях для сообщений, а также о проверке подлинности в Teams
ms.topic: reference
ms.localizationpriority: medium
ms.author: lomeybur
ms.openlocfilehash: 8f61788779d34183f7000271245e683f2750f739
ms.sourcegitcommit: 1cda2fd3498a76c09e31ed7fd88175414ad428f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2022
ms.locfileid: "67035326"
---
# <a name="samesite-cookie-attribute"></a>Атрибут cookie SameSite

Файлы cookie — это текстовые строки, отправляемые с веб-сайтов и хранящиеся на компьютере в веб-браузере. Они используются для проверки подлинности и персонализации. Например, файлы cookie используются для отзыва сведений с отслеживанием состояния, сохранения параметров пользователя, записи действий просмотра и отображения соответствующей рекламы. Файлы cookie всегда связаны с определенным доменом и устанавливаются различными сторонами.

## <a name="types-of-cookies"></a>Типы файлов cookie

Типы файлов cookie и соответствующие им области:

|Cookie|Область|
| ------ | ------ |
|Основной файл cookie|Основной файл cookie создается веб-сайтами, которые посещает пользователь. Он используется для сохранения данных, таких как элементы корзины для покупок, учетные данные для входа. Например, файлы cookie проверки подлинности и другая аналитика.|
|Вспомогательный файл cookie|Вспомогательный файл cookie технически совпадает с основным. Разница заключается в том, что данные предоставляются второй стороне в рамках партнерского соглашения об использовании данных. Например, [Аналитика и отчеты Microsoft Teams](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference). |
|Сторонний файл cookie|Сторонний файл cookie устанавливается доменом, отличным от домена, который пользователь явно посещает и используется для отслеживания. Например, кнопки **Нравится**, доставка рекламы и чаты в реальном времени.|

## <a name="cookies-and-http-requests"></a>Файлы cookie и HTTP-запросы

До введения ограничений для SameSite файлы cookie хранились в браузере. Они отправлялись с каждым веб-запросом HTTP на сервер с помощью заголовка HTTP-ответа `Set Cookie`. В этом методе появились уязвимости системы безопасности, такие как подделка межсайтовых запросов, или атаки CSRF. Подверженность риску была снижена за счет реализации компонента SameSite и управления им в заголовке SetCookie.

## <a name="samesite-cookie-attribute-initial-release"></a>Атрибут cookie SameSite: начальный выпуск

В Google Chrome версии 51 была введена спецификация `SetCookie SameSite` как необязательный атрибут. Начиная со сборки 17672, Windows 10 поддерживает файлы cookie SameSite для [браузера Microsoft&nbsp;Edge](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/).

Вы можете отказаться от добавления атрибута cookie SameSite в заголовок `SetCookie` или добавить его с одним из двух параметров: **Lax** либо **Strict**. Стандартным состоянием считался нереализованный атрибут SameSite.

## <a name="samesite-cookie-attribute-2020-release"></a>Атрибут cookie SameSite: выпуск 2020 г.

В выпуске Chrome версии 80 за февраль 2020 г. вводятся новые значения файлов cookie и используются политики файлов cookie по умолчанию. Обновленный атрибут SameSite может иметь одно из трех значений: **Strict**, **Lax** или **None**. Если значение не указано, атрибут SameSite файлов cookie принимает значение `SameSite=Lax` по умолчанию.

Атрибуты cookie SameSite перечислены ниже.

|Setting | Применение | Значение |Спецификация атрибута |
| -------- | ----------- | --------|--------|
| **Lax**  | Файлы cookie отправляются автоматически только в контексте **первой стороны** и с HTTP-запросами GET. Файлы cookie SameSite удерживаются при межсайтовых подзапросах, таких как вызовы для загрузки изображений или элементов IFrame. Они отправляются, когда пользователь переходит к URL-адресу с внешнего сайта, например, по ссылке.| **Default** |`Set-Cookie: key=value; SameSite=Lax`|
| **Строгий** |Браузер отправляет файлы cookie только для запросов в контексте первой стороны. Это запросы с сайта, установившего файл cookie. Если запрос был отправлен с URL-адреса, отличного от URL-адреса текущего расположения, файлы cookie с атрибутом `Strict` не отправляются.| При необходимости |`Set-Cookie: key=value; SameSite=Strict`|
| **Нет** | Файлы cookie отправляются как в исходном контексте, так и в запросах между источниками; Однако значение должно быть **`None`** явно задано, и все запросы браузера должны следовать протоколу **HTTPS** **`Secure`** и включать атрибут, для которого требуется зашифрованное подключение. Файлы cookie, которые не соответствуют требованиям, **отклоняются**. <br/>**Наличие обоих атрибутов обязательно.** Если  **`None`** указан без протокола **`Secure`**  HTTPS или если он не используется, сторонние файлы cookie отклоняются.| Необязательный, но если задан, требует использования протокола HTTPS. |`Set-Cookie: key=value; SameSite=None; Secure` |

## <a name="teams-implications-and-adjustments"></a>Использование и изменение в Teams

1. Включите соответствующий параметр SameSite для файлов cookie и убедитесь, что приложения и расширения продолжают работать в Teams.
1. В случае сбоя приложений или расширений внесите необходимые исправления в выпуск Chrome до версии 80.
1. Внутренние партнеры Майкрософт могут присоединиться к следующей группе, чтобы получить дополнительные сведения или справку по этой проблеме: <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47>

> [!NOTE]
> Атрибуты SameSite должны быть заданы таким образом, чтобы отражать предполагаемое использование файлов cookie. Не используйте стандартное поведение браузера. Дополнительные сведения см. в статье [Разработчики: подготовка к новым параметрам файлов cookie SameSite=None; Secure](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html).

### <a name="tabs-task-modules-and-message-extensions"></a>Вкладки, модули задач и расширения для сообщений

* Вкладки Teams используют `<iframes>` для внедрения содержимого, просматриваемого на верхнем уровне или в контексте первой стороны.
* Модули задач позволяют создавать модальные всплывающие окна в приложении Teams. Как и вкладка, модальное окно открывается на текущей странице.
* Расширения для сообщений позволяют вставлять обогащенное содержимое в сообщение чата из внешних ресурсов.

Все файлы cookie, используемые внедренным содержимым, считаются сторонними при отображении сайта в `<iframe>`. Кроме того, если какие-либо удаленные ресурсы на странице используют файлы cookie, отправляемые в запросе с тегами `<img>` и `<script>`, внешними шрифтами и персонализированным содержимым, убедитесь, что они помечены для межсайтового использования, например с помощью `SameSite=None; Secure`, или доступен резервный вариант.

### <a name="authentication"></a>Проверка подлинности

Поток веб-проверки подлинности необходимо использовать для таких элементов:

* страницы внедренного содержимого на вкладках;
* страница конфигурации, модуль задач и расширение для сообщений;
* бот для бесед с модулем задач.

В соответствии с обновленными ограничениями SameSite браузер не добавляет файл cookie на уже прошедший проверку подлинности веб-сайт, если ссылка является производным от внешнего сайта. Убедитесь, что файлы cookie проверки подлинности помечены для межсайтового использования с помощью `SameSite=None; Secure` или доступен резервный вариант.

## <a name="android-system-webview"></a>Android System WebView

Android WebView — это системный компонент Chrome, который позволяет приложениям для Android отображать веб-содержимое. Хотя новые ограничения применяются по умолчанию, начиная с Chrome 80, они не применяются сразу к веб-представлениям. Они будут применены в будущем. В целях подготовки Android разрешает собственным приложениям задавать файлы cookie непосредственно через [API CookieManager](https://developer.android.com/reference/android/webkit/CookieManager).

> [!NOTE]
>
> * При необходимости объявите основные файлы cookie как `SameSite=Lax` или `SameSite=Strict`.
> * Сторонние файлы cookie следует объявить как `SameSite=None; Secure`.

## <a name="see-also"></a>Дополнительные ресурсы

* [Примеры SameSite](https://github.com/GoogleChromeLabs/samesite-examples)
* [Рецепты с файлами cookie SameSite](https://web.dev/samesite-cookie-recipes/)
* [Известные несовместимые клиенты]( https://www.chromium.org/updates/same-site/incompatible-clients)
* [Разработчики: Приготовьтесь к новому режиму SameSite=None; безопасной настройке файлов cookie](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)
* [Предстоящие изменения файлов cookie SameSite в ASP.NET и ASP.NET Core](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/)
* [Файлы cookie HTTP](https://developer.mozilla.org/docs/Web/HTTP/Cookies)
