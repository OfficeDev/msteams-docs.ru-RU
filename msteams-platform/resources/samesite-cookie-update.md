---
title: Microsoft Teams и атрибут Самесите cookie (обновление 2020)
author: laujan
description: ''
keywords: атрибуты файла самесите
ms.topic: reference
ms.author: lomeybur
ms.openlocfilehash: 167266ba0b5af1c8233cffe1fef496dd94c27ae4
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "41675192"
---
# <a name="microsoft-teams-and-the-samesite-cookie-attribute-2020-update"></a>Microsoft Teams и атрибут Самесите cookie (обновление 2020)

## <a name="cookies-in-brief"></a>Краткие файлы cookie

 Файлы cookie — это текстовые строки, которые отправляются с веб-сайтов и хранятся на компьютере веб-браузером. Обычно они используются для проверки подлинности и личной настройки, например, для отзыва сведений о состоянии, сохранения параметров пользователя, записи сведений о просмотре и отображения релевантных рекламных объявлений. Файлы cookie всегда связаны с определенным доменом и могут устанавливаться различными сторонами. Они делятся на следующие категории:

 |Cookie|Область|
 | ------ | ------ |
 |**Файл cookie первого производителя**|Основной файл cookie создается веб-сайтами, которые пользователь посетит и использует для сохранения данных, таких как элементы корзины для покупок, учетные данные входа (например, файлы cookie проверки подлинности) и другие аналитики.|
 |**Файл cookie второй стороны**|Файлы cookie второй стороны технически являются такими же, как и у первого файла cookie. Разница заключается в том, что данные используются совместно со второй стороной через соглашение о партнерстве связи (например, [Microsoft Teams Analytics и Reporting](/microsoftteams/teams-analytics-and-reports/teams-reporting-reference)). |
 |**Файл cookie стороннего производителя**|Сторонний файл cookie устанавливается доменом, отличным от того, который пользователь посетит явным образом, и в основном используется для отслеживания (например, кнопок "Like"), обслуживания и интерактивных бесед.|

### <a name="cookies-and-http-requests"></a>Файлы cookie и HTTP-запросы

Прежде чем приступить к введению ограничений Самесите, когда файлы cookie были сохранены в браузере, они были подключены к *каждому* HTTP-запросу и отправляются на сервер с помощью заголовка HTTP-ответа Set-cookie. Предсказуемо, это может привести к возникновению уязвимостей системы безопасности, таких как атаки на межсайтовые запросы (КСРФ). *Просмотрите* [файлы cookie HTTP](https://developer.mozilla.org/docs/Web/HTTP/Cookies). Компонент Самесите воспринимается с помощью его реализации и управления в заголовке Сеткукие.

### <a name="samesite-attribute-initial-release"></a>Атрибут Самесите: Initial Release

В Google Chrome версии 51 появилась спецификация Сеткукие Самесите в качестве *необязательного* атрибута. Начиная с сборки 17672, Windows 10 предоставила поддержку Самесите cookie для [браузера Microsoft Edge](https://blogs.windows.com/msedgedev/2018/05/17/samesite-cookies-microsoft-edge-internet-explorer/).

Разработчики могут отказаться от добавления атрибута Самесите cookie к заголовку Сеткукие или добавить его с одним из двух параметров: *нестрогая* и *строгая*. Нереализованный атрибут Самесите рассматривался как состояние по умолчанию.

## <a name="samesite-cookie-attribute-2020-release"></a>Атрибут Самесите cookie: выпуск 2020

Хром 80, запланированный для выпуска в феврале 2020, представляет новые значения файлов cookie и по умолчанию накладывает политики файлов cookie. В обновленный атрибут Самесите можно передать три значения: *строгий*, *нестрогий*или *None*. Файлы cookie, для `SameSite=Lax`которых не указан атрибут самесите, по умолчанию будут иметь значение.

|Setting | Принудительное применение | Значение |Спецификация атрибута |
| -------- | ----------- | --------|--------|
| **Низкий**  | Файлы cookie будут отправляться автоматически только в контексте *первого разработчика* и с запросами HTTP GET. Файлы cookie Самесите будут храниться на подзапросах между сайтами, например вызовы для загрузки изображений или iframes, но будут отправлены, когда пользователь переходит по URL-адресу с внешнего сайта, например, после ссылки.| **Default** |`Set-Cookie: key=value; SameSite=Lax`|
| **Жестк** |Браузер будет отправлять файлы cookie только для запросов первого производителя (запросов, исходящих от сайта, на котором задан файл cookie). Если получен запрос с URL-адреса, отличного от URL-адреса текущего расположения, то не будет отправлен ни один `Strict` из файлов cookie, помеченных атрибутом.| Необязательна |`Set-Cookie: key=value; SameSite=Strict`|
| **Нет** | Файлы cookie отправляются как в первом, так и в запросах между источниками; Однако значение должно быть явно задано, **`None`** а все запросы браузеров **должны следовать протоколу HTTPS** и включать атрибут **`Secure`** , для которого требуется зашифрованное подключение. Файлы cookie, которые не соответствуют этому требованию, будут **отклонены**. <br/>**Оба атрибута являются обязательными**. **`None`** Если он указан без **`Secure`** или не используется протокол HTTPS, файл cookie стороннего производителя будет отклонен.| Необязательный параметр, но если он установлен, то протокол HTTPS является обязательным. |`Set-Cookie: key=value; SameSite=None; Secure` |

## <a name="handling-incompatible-clients"></a>Обработка несовместимых клиентов

> [!IMPORTANT]
> `SameSite=None` В настоящее время не поддерживается [**клиентскими рабочими столами**](/aspnet/core/security/samesite?view=aspnetcore-3.1#test-with-electron) и более старыми версиями Chrome или Safari. *Просмотр* [известных несовместимых клиентов]( https://www.chromium.org/updates/same-site/incompatible-clients).
>Однако существует два **обходных решения**:
>
>1. Проверьте пользовательский агент, чтобы предоставить правильное свойство Самесите. Вы можете реализовать проверку агента пользователя в [**C#**](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/) и [**node. js**](https://web.dev/samesite-cookie-recipes/).
>2. Настройте атрибуты файлов cookie, используя новые и старые модели. *Ознакомьтесь* с [разработкой несовместимых клиентов](https://web.dev/samesite-cookie-recipes/#handling-incompatible-clients)<br><br>
>**Если ваше приложение запущено в настольном клиенте Teams, а атрибут Самесите имеет `SameSite=None` значение, ваше приложение не будет работать должным образом.**

Любой из этих подходов гарантирует, что приложение будет работать правильно при обновлении клиента для настольных компьютеров Teams до `SameSite=None` совместимой версии чромиум.

## <a name="teams-implications-and-adjustments"></a>Влияние и корректировки Teams

>[!WARNING]
>**Приложения, работающие на настольном клиенте Teams `SameSite=None` , несовместимы с атрибутом и не будут работать должным образом.** Ознакомьтесь **с решением,** описанным выше.

1. Включите подходящий параметр Самесите для файлов cookie и убедитесь, что ваши приложения и расширения продолжают работать в Teams.
1. Если произошел отказ ваших приложений или расширений, выполните необходимые исправления перед выпуском Chrome 80.
1. Внутренние партнеры корпорации Майкрософт могут присоединиться к следующей команде, если им нужна дополнительная информация или Справка <https://teams.microsoft.com/l/team/19%3A08b594cd465e4c0491fb751e823802e2%40thread.skype/conversations?groupId=4d6d04cd-dbf0-43c8-a2ff-f80dd38be034&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47>по этой причине:.

> [!NOTE]
> Рекомендуется всегда устанавливать атрибуты Самесите, чтобы отражать предполагаемое использование файлов cookie, не полагайтесь на поведение браузера по умолчанию. *Сведения* [о разработчиках: подготовка к созданию нового самесите = None; Защита параметров файлов cookie](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html).

### <a name="tabs-task-modules-and-message-extensions"></a>Вкладки, модули задач и расширения сообщений

* Вкладки Teams `<iframes>` используются для внедрения содержимого, которое просматривается в контексте верхнего уровня или первого производителя.
* Модули задач позволяют создавать Модальные всплывающие окна в приложении Teams. Как и на вкладке, в текущей странице открывается модальное окно.
* Расширения сообщений позволяют вставлять обогащенные материалы в сообщения чата из внешних ресурсов.

Все файлы cookie, используемые внедренным контентом, будут считаться сторонним поставщиком, когда сайт отображается `<iframe>`в. Кроме того, если на странице есть удаленные ресурсы, которые отправляются с помощью запросов (например, `<img>` `<script>` тегов, внешних шрифтов и персональных контента), необходимо убедиться в том, что они помечены для использования на нескольких сайтах — `SameSite=None; Secure` или убедиться, что резервный вариант установлен.

### <a name="authentication"></a>Проверка подлинности

* Если для внедренных страниц содержимого на вкладках требуется проверка подлинности, необходимо использовать веб-процесс проверки подлинности на основе веб-сайта.
* Веб-процесс проверки подлинности также можно использовать для страницы конфигурации, модуля задачи или расширения обмена сообщениями.
* Вы можете использовать процесс проверки подлинности на основе веб-сайта для диалогового окна "робот", вам потребуется использовать модуль задачи.

В соответствии с обновленными ограничениями Самесите браузер не добавляет файл cookie на веб-сайт, на котором уже выполнена проверка подлинности, если эта ссылка является производной от внешнего сайта. Необходимо убедиться, что файлы cookie для проверки подлинности отмечены для использования на `SameSite=None; Secure` нескольких сайтах — или убедиться, что резервный сервер установлен.

### <a name="android-system-webview"></a>Система Вебвиев системы Android

Android Вебвиев это компонент системы Chrome, позволяющий приложениям Android отображать веб-контент. В то время как новые ограничения станут значением по умолчанию, начиная с Chrome 80, они не будут немедленно применены к представлениям в Интернете. Они будут применены в будущем. Чтобы подготовить, Android позволяет встроенным приложениям задавать файлы cookie непосредственно через [API кукеманажер](https://developer.android.com/reference/android/webkit/CookieManager):

* Для файлов cookie, которые необходимы только в первом контексте, их необходимо объявить как `SameSite=Lax` или `SameSite=Strict`(при необходимости).
* Для файлов cookie, необходимых для стороннего контекста, необходимо убедиться, что они объявлены как `SameSite=None; Secure`.

## <a name="learn-more"></a>Дополнительные сведения

[Примеры Самесите](https://github.com/GoogleChromeLabs/samesite-examples)

[Рецепты для файлов cookie Самесите](https://web.dev/samesite-cookie-recipes/)

[Известные несовместимые клиенты]( https://www.chromium.org/updates/same-site/incompatible-clients)

[Разработчики: Подготовьтесь к использованию нового Самесите = None; Параметры безопасного файла cookie](https://blog.chromium.org/2019/10/developers-get-ready-for-new.html)

**Влияние подключения OpenId**<br>
[Предстоящие изменения файлов cookie Самесите в ядре ASP.NET и ASP.NET](https://devblogs.microsoft.com/aspnet/upcoming-samesite-cookie-changes-in-asp-net-and-asp-net-core/)
