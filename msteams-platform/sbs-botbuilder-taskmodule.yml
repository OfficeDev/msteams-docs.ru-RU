### YamlMime:Tutorial
title: Вызов модулей задач из Microsoft Teams
metadata:
  title: Вызов модулей задач из Microsoft Teams
  description: В этом руководстве вы узнаете, как настроить Teams задач.
  audience: Developer
  level: Beginner
  ms.date: 23/02/2022
  ms.topic: interactive-tutorial
  nextTutorialHref: task-modules-and-cards/task-modules/task-modules-bots.md
  nextTutorialTitle: Дополнительные новости о модулях задач от ботов
  ms.custom: mvc
  ms.localizationpriority: High
  ms.openlocfilehash: 4d2e7c2f1da2c8a0d9f6135c9aaef5ae01f8cec8
  ms.sourcegitcommit: 3dc9b539c6f7fbfb844c47a78e3b4d2200dabdad
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 03/31/2022
  ms.locfileid: "64571509"
items:
- durationInMinutes: 1
  content: >
    Вы можете вызывать модули задач из Teams с помощью адаптивных карт или карт Bot Framework.


    **Ключевые функции модулей задач**


    * Расширение пользовательского интерфейса, избегая нескольких действий.

    * Помогите пользователям отслеживать состояние бота.

    * Извлечение входных данных из пользовательского и отображение пользовательского контента веб-страницы.


    Это пошаговая руководство по созданию примера бота Azure для вызова Teams задачи. Вы увидите следующий вывод:

     ![Модуль задач](~/assets/images/Teams-task-module/final_image.png)
- title: Предварительные требования
  durationInMinutes: 1
  content: "Убедитесь, что вы установите следующие средства и настроите среду разработки: \n\n* [Microsoft Teams с](https://teams.microsoft.com/) допустимой учетной записью\n* [.NET Core SDK](https://dotnet.microsoft.com/download) версии 3.1\n* [Последняя версия Microsoft Visual Studio](https://visualstudio.microsoft.com/downloads/)\n* [ngrok](https://ngrok.com/download) последняя версия или любое эквивалентное решение для туннелей\n\n  > [!NOTE]\n  > После скачивания ngrok зарегистриройте и установите [authtoken](https://ngrok.com/download).\n"
- title: Настройка локальной среды
  durationInMinutes: 1
  content: "Репозиторий `BotBuilder-Samples` клонов в локальный GitHub:  \n\n 1. Откройте [примеры BotBuilder](https://github.com/microsoft/BotBuilder-Samples).\n 1. Выберите **код**.\n 1. В меню dropdown выберите **Open с GitHub Desktop**.\n\n    ![Репозиторий клонов](~/assets/images/Teams-task-module/clonerepository.png)\n\n 1. Выберите **клон**. \n"
- title: Создание и регистрация бота на портале Azure AD
  durationInMinutes: 5
  content: "Чтобы создать и зарегистрировать бота в Microsoft Azure Active Directory (Azure AD), создайте туннель с помощью ngrok и добавьте конечную точку обмена сообщениями выполните следующие действия:\n\n* Создайте ресурс Azure Bot для регистрации бота в Azure Служба Bot.\n* Создание секрета клиента, чтобы включить проверку подлинности SSO бота.\n* Добавьте Teams канал, чтобы развернуть бот в Teams канал.\n* Для создания туннеля к конечным точкам веб-сервера используйте ngrok.\n* Добавьте конечную точку обмена сообщениями в созданный туннель ngrok.\n\n**Создание ресурса Azure Bot**\n\n1. Перейдите [на Microsoft Azure портал.](https://portal.azure.com/)\n1. Выберите **Создать ресурс**.\n1. В поле поиска введите **Azure Bot**.\n1. Выберите **Ввод**.\n1. Выберите **Azure Bot**.\n\n     ![Создание карты-бота Azure](~/assets/images/bots/createazurebot.png)\n\n1. Нажмите **Создать**.\n1. Введите необходимое имя ручки бота в **ручке Bot**.\n1. Выберите **подписку** из списка выпаданий.\n1. Выберите **группу Ресурсов из** списка выпаданий. \n\n    ![Выберите ресурс Azure bot](~/assets/images/Teams-task-module/review-plus-create.png) \n\n   Можно также создать новую группу ресурсов (выберите **Создание** новых > введите имя ресурса > выберите **ОК**).\n\n1. Если вы создали новую группу ресурсов, выберите необходимое расположение из списка выпаданий расположения группы новых ресурсов.\n\n    ![Новое расположение группы ресурсов](~/assets/images/meetings-side-panel/newresource.png)\n\n1. В разделе **Microsoft App ID** по умолчанию **выбирается новый ID** приложения Майкрософт. \n\n   Вы можете выбрать использование **существующей** регистрации приложений и **ввести** существующий код приложения и существующий пароль **приложения, или** создать **новый код Приложения Майкрософт**.\n\n   > [!NOTE]\n   > Вы не можете создать несколько ботов с одним и тем же **microsoft App ID**.\n\n1. Выберите **multiTenant под** типом бота.\n\n    ![Microsoft App ID](~/assets/images/Teams-task-module/config.png)\n\n1. Выберите **Проверить и создать**.\n\n    ![Создание ID приложения Майкрософт](~/assets/images/meeting-token-generator/meeting-token-generator-appidcreate.png)\n\n1. Если проверка пройдет, выберите **Создать**. \n\n    Подготовка службы бота занимает несколько минут. \n\n1. Выберите пункт **Перейти к ресурсу**. \n\n    ![Развертывание приложения](~/assets/images/Teams-task-module/botdeployment.png)\n\n    Создан бот Azure.\n\n    ![Созданный ресурс бота Azure](~/assets/images/Teams-task-module/bot-page.png)\n\n**Создание секрета клиента**\n\n  Выполните следующие действия, если вы создали новый **microsoft App ID**:\n\n1. В левой панели выберите **Конфигурация**. \n\n   > [!TIP]\n   > Сохраните **microsoft App ID** или **client ID** для будущих ссылок.\n\n1. Рядом с **microsoft App ID** выберите **Управление**.\n\n1. В разделе **Секреты клиента** выберите **новый секрет клиента**. \n\n    ![Секрет нового клиента](~/assets/images/meetings-side-panel/newclientsecret.png)\n\n   **Появится окно \"Добавление секрета клиента**\".  \n\n1. **Введите Описание**.\n\n1. Нажмите **Добавить**.\n\n    ![Добавление секрета клиента в приложение](~/assets/images/Teams-task-module/clientsecret.png)\n\n1. В **столбце Значение** выберите **Копию в буфер обмена.**\n\n     ![Значение секрета клиента](~/assets/images/Teams-task-module/clientvalue.png)\n   \n   > [!TIP]\n   > Сохраните **значение \"Секреты клиента** \" или пароль приложения для будущей ссылки.\n\n**Добавление канала Teams**\n\n1. Нажмите **Главная**.\n\n    ![Домашняя страница](~/assets/images/Teams-task-module/gotohome.png)\n\n1. Выберите бот из **последних ресурсов**.\n\n1. Выберите **Каналы в** левой области. \n\n1. Выберите **Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/>.\n\n1. Выберите почтовый ящик, чтобы принять **Условия службы**.\n\n1. Выберите **Согласование**.\n\n      ![Условия обслуживания](~/assets/images/meetings-side-panel/terms.png)\n\n1. Нажмите кнопку **Сохранить**.\n\n      ![Выберите Teams](~/assets/images/Teams-task-module/configteams.png)   \n\n**Создание туннеля для локального веб-сервера**\n\nИспользуйте ngrok для создания туннеля для общедоступных конечных точек HTTPS локального запуска веб-сервера. Запустите следующую команду в ngrok:\n\n ```bash\n ngrok http -host-header=rewrite 3978\n ```\n\n> [!TIP]\n> Если **вы ERR_NGROK_4018,** выполните действия, предусмотренные в командной подсказке для регистрации и проверки подлинности ngrok. Затем запустите `ngrok http -host-header=localhost 3978` команду.\n\n**Добавление конечной точки обмена сообщениями**\n\n1. Из ngrok скопируйте URL-адрес HTTPS (https to io).\n\n    ![URL-адрес https ngrok](~/assets/images/Teams-task-module/ngrok.png)\n\n    > [!NOTE]\n    > URL-адрес HTTPS в ngrok — это ваше полное доменное имя.\n    > Это `WebAppDomain` полностью квалифицированное доменное имя, которое не входит `https://` в него.\n\n1. В **Параметры** для созданного вами бота Azure выберите **Конфигурация**.\n\n1. В **конечной точке** обмена сообщениями используйте URL-адрес HTTPS, доступный в ngrok, а в конце **URL-адреса добавьте /api/messages**.\n\n    ![Конечная точка обмена сообщениями](~/assets/images/Teams-task-module/messaging-endpoint.png)\n\n1. Нажмите **Применить**.\n\n    Вы успешно создали бот в Azure Служба Bot.\n"
- title: Обновление регистрации приложения Azure AD
  durationInMinutes: 1
  content: "1. Перейдите на [портал Azure](https://portal.azure.com/).\n\n1. Выберите **Azure Active Directory**.\n\n1. В левой панели навигации выберите **регистрация приложений**.\n\n1. Выберите бот.\n\n   ![Регистрация приложения](~/assets/images/Teams-task-module/appregister.png)\n\n1. Выберите **Управление**.\n\n1. В левой панели выберите **Expose** **API**.\n\n1. Выберите **набор**.\n\n   ![Предоставление API](~/assets/images/Teams-task-module/exposeanapi.png)\n\n1. Установите **URI ID приложения** в виде `api://{AppID}`.\n\n   ![Настройка ссылки](~/assets/images/Teams-task-module/setlink.png)\n\n1. Вставьте значение `WebAppDomain` между и `/{AppID}``api://` .</br>\n    `api://d4b8****.ngrok.io/{AppID}`</br>\n    \n   На следующем изображении показано имя домена:\n    \n    ![URI кода надстройки](~/assets/images/Teams-task-module/appIDuri.png)\n\n    > [!NOTE]\n    > Если вы используете службу тоннелей, например ngrok, убедитесь, что вы обновляете значение всякий раз, когда изменяется поддомен ngrok.\n    > `For example: api://f631****.ngrok.io/92c11075-c629-4a1e-ab58-02b4fd4204c2`, где `f631****.ngrok.io` новое имя поддомена ngrok.\n\n1. Нажмите **Добавить область**. \n\n   ![Выбор области](~/assets/images/meetings-side-panel/selectscope.png)\n\n1. На панели, которая отображается, введите `access_as_user` имя **Область**.\n\n1. Установите **Кто может согласиться?** .`Admins and users`\n\n1. Чтобы настроить запросы на `access_as_user` согласие администратора и пользователя с соответствующими значениями для области, в полях необходимо предоставить следующие сведения:</br>\n\n     * Введите `Teams can access the user’s profile` **имя отображения согласия администратора**.\n\n     * Введите `Allows Teams to call the app’s web APIs as the current user` в **качестве описания согласия администратора**.\n\n     * Введите `Teams can access the user profile and make requests on the user’s behalf` имя **отображения согласия пользователя**.\n\n     * Введите `Enable Teams to call this app’s APIs with the same rights as the user` в **качестве описания согласия пользователя**.\n\n1. Убедитесь, что параметру **Состояние** присвоено значение **Включено**.\n\n1. Выберите **Добавить область** для сохранения.\n\n    ![Добавление области](~/assets/images/Teams-task-module/addascope.png)\n\n    > [!NOTE]\n    > Имя **Scope должно** совпадать с URI `/access_as_user` **ID** приложения с приложением в конце.</br>\n       `api://d4b8****.ngrok.io/00000000-0000-0000-0000-000000000000/access_as_user`\n\n    ![Scopes](~/assets/images/Teams-task-module/scopes.png) \n\n1. В разделе **Авторизованные клиентские приложения** укажите приложения, которые необходимо авторизовать для веб-приложения вашего приложения. \n\n1. Выберите **Добавить клиентское приложение**. \n\n    ![Выбор клиентского приложения](~/assets/images/meetings-side-panel/selectclientapp.png) \n\n1. **Введите client ID**: `1fec8e78-bce4-4aaf-ab1b-5451cc387264` для Teams мобильного или настольного приложения. \n\n    ![Добавление клиентского приложения 1](~/assets/images/meetings-side-panel/addclientapplication1.png) \n\n   **Введите client ID**: `5e3ce6c0-2b1f-4285-8d4b-75ee78787346` для Teams веб-приложения.\n\n    ![Добавление клиентского приложения 2](~/assets/images/meetings-side-panel/addclientapplication2.png) \n\n1. Выберите **разрешенные области**.\n\n    ![Добавление клиентского приложения 2](~/assets/images/Teams-task-module/authorizedscope.png) \n\n   На следующем изображении отображаются клиентские ИД:\n\n    ![Клиентские приложения](~/assets/images/meetings-side-panel/clientapps.png) \n\n1. На левой панели выберите **разрешения API**. \n\n   > [!NOTE]\n   > Пользователи должны согласиться на разрешения API только в том случае, если приложение Azure AD зарегистрировано в другом клиенте.\n\n1. Выберите **Добавить разрешение**.\n\n    ![Добавление разрешений](~/assets/images/meetings-side-panel/addpermission.png)\n\n1. Выберите **Microsoft Graph**.\n\n1. Выберите **Делегированные разрешения**.\n\n1. Выберите следующие разрешения:</br>\n     * **email**\n     * **offline_access**\n     * **OpenId**\n     * **profile**\n      * **User.Read**\n\n1. Выберите **Добавить разрешения**.\n\n     ![Другие разрешения](~/assets/images/meetings-side-panel/other-permissions.png)\n\n1. На левой панели выберите **проверку подлинности,** чтобы установить URI перенаправления. \n\n   > [!NOTE]\n   > Если приложению не предоставлено согласие ИТ-администратора, пользователи должны предоставить согласие при первом использовании приложения.\n           \n     1. Выберите **Добавить платформу**.\n     1. Выберите платформу **Веб**.\n\n        ![Web](~/assets/images/Teams-task-module/webauth.png)\n\n     1. Введите URI перенаправления для приложения, примыкая `auth-end` к полностью квалифицированному доменному имени:</br> \n       `https://d4b8****.ngrok.io/auth-end`. </br>\n\n     1. Включить **неявные грантовые и гибридные** потоки, выбрав следующие почтовые ящики:\n         * **Маркеры ID**\n         * **Маркеры доступа**\n\n     1. Нажмите **Настроить**.\n\n        ![Auth-end](~/assets/images/Teams-task-module/authend.png)\n"
- title: Настройка параметров приложения и файлов манифеста
  durationInMinutes: 1
  content: "1. Перейдите **к appsettings.json в** клонированном репозитории.\n\n    ![Расположение параметров приложения](~/assets/images/Teams-task-module/appsettingslocation.png)\n\n1. Откройте **appsettings.json** в последней версии Visual Studio и обновив следующую информацию:  \n\n     * Настройка `\"MicrosoftAppType\"` **multiTenant**.\n     * Установите `\"MicrosoftAppId\"` для вашего бота **microsoft App ID**.\n     * Значение `\"MicrosoftAppPassword\"` **\"Значение** **секрета клиента\"**.\n     * Установите `\"MicrosoftAppTenantId\"` для клиента ID клиента, в котором используется приложение.\n     * Установите `\"BaseUrl\"` полное доменное имя (https to io).\n\n    ![Параметры приложения](~/assets/images/Teams-task-module/appsettings.png)\n\n1. Перейдите **к manifest.json в** клонированном репозитории.\n\n    ![Расположение файла Manifest](~/assets/images/Teams-task-module/manifestlocation.png)\n\n1. Откройте **manifest.json** в последней версии Visual Studio и внести следующие изменения:\n\n     * Замените все случаи с `YourDeployedBotUrl.com` вашим именем `WebAppDomain` .\n     * Замените все случаи с `<<YOUR-MICROSOFT-APP-ID>>` помощью microsoft **App ID вашего бота**.\n\n    ![Manifest image2](~/assets/images/Teams-task-module/manifest.png)\n"
- title: Создание и запуск службы
  durationInMinutes: 1
  content: "**Создание и запуск службы с использованием последней версии Visual Studio или командной строки**\n\n# <a name=\"latest-version-of-visual-studio\"></a>[Последняя версия Visual Studio](#tab/latestversionofvisualstudio)\n\n   1. Запуск последней версии Visual Studio.\n   1. Перейдите к **файлу FileOpen** >  >  **Project/Solution**.\n\n      ![Открытый файл](~/assets/images/meeting-token-generator/meeting-token-generator-VSopenfile.png)\n\n   1. Выберите **файл TeamsTaskModule.csproj** из **папки 54.teams-task-module** .\n\n      ![CS proj file](~/assets/images/Teams-task-module/csprojfileopen.png)\n\n   1. Откройте **Обозреватель решений** из **View**.\n\n      ![Обозреватель решений](~/assets/images/Teams-task-module/solutionexplorer.png)\n\n   1. Щелкните правой кнопкой мыши, чтобы **выбрать TeamsTaskModule**.\n\n   1. Выберите **Set as Startup Project**.\n\n      ![Обозреватель решений](~/assets/images/Teams-task-module/startup.png)\n\n   1. Нажмите **кнопку F5** для запуска проекта.\n\n   1. Выберите **Да**, если появится следующий диалог:\n\n      ![Сертификат доверия](~/assets/images/Teams-task-module/certificate.png)\n\n      Откроется веб-сайт с сообщением о том, **что бот готов!**.\n\n      ![Готовое приложение](~/assets/images/Teams-task-module/appisready.png) \n\n    \n# <a name=\"command-line\"></a>[Командная строка](#tab/cli)\n\nПерейдите к **примеру BotBuilder-Samples > > csharp_dotnetcore > 54.teams-task-module** в окне Командная подсказка и введите следующую команду:\n\n```bash\ndotnet run\n```\n\n![Dotnet](~/assets/images/Teams-task-module/dotnetruncmd.png)\n"
- title: Upload модуль задач
  durationInMinutes: 1
  content: "1. В клонированном репозитории перейдите csharp_dotnetcore > **54.teams-task-module > TeamsAppManifest**.\n\n1. Создайте .zip со следующими файлами, присутствующими в **папке TeamsAppManifest** : \n   * manifest.json\n   * icon-outline.png\n   * icon-color.png\n\n   ![Zip-файл](~/assets/images/Teams-task-module/zip-file.png) \n\n1. Перейдите **Microsoft Teams**.\n\n1. Выберите **Приложения**.\n\n   ![Zip-файл](~/assets/images/Teams-task-module/AppStore.png)\n\n1. В левом нижнем углу выберите **Управление приложениями**.\n\n   ![Управление приложениями](~/assets/images/Teams-task-module/manage-apps.png)\n\n1. Выберите **Upload приложение в каталоге приложений вашей организации**. \n\n   ![Upload настраиваемом приложении](~/assets/images/Teams-task-module/upload-app.png)\n\n1. Выберите **Открыть** , чтобы загрузить .zip файл, созданный в **папке TeamsAppManifest** .\n\n   ![Выберите почтовый файл](~/assets/images/Teams-task-module/select-zip.png)\n\n1. Нажмите **Добавить**.\n\n   ![Добавление приложения](~/assets/images/Teams-task-module/add-app.png)\n\n   Приложение открывается в чате.\n\n1. Введите любой текст и выберите Ввод. \n\n   ![Чат](~/assets/images/Teams-task-module/chat_ready.png)\n\n   Приложение отображает вызов **модуля задач из карточки героя** и вызов модуля задач **из адаптивной карты**.         \n"
- title: Взаимодействие с приложением в Teams
  durationInMinutes: 1
  content: >
    1. Выберите **адаптивную карту из** вызовов модулей задач из **карточки** героя или вызова модуля задач **из адаптивной карты**.

       ![Адаптивная карта](~/assets/images/Teams-task-module/adaptive-card.png)

    1. Введите любой текст.


    1. Выберите **Отправить**.

       ![Адаптивный текст карточки](~/assets/images/Teams-task-module/adaptive-card-text.png)

       **Адаптивная карта** отправляет сообщение о признании.

       ![Отправка адаптивной карты](~/assets/images/Teams-task-module/adaptive-card-submit.png)

    1. Выберите **настраиваемую** форму из вызовов модулей задач из **карточки** героя или вызова модуля задач **из адаптивной карты**.

       ![Настраиваемая форма](~/assets/images/Teams-task-module/custom-form.png)

    1. Введите требуемую информацию:

       * **Name**
       * **Электронная почта**
       * **Любимая книга**
       * **Password**
       * **Подтверждение пароля**

    1. Выберите **Подпишитесь**.

       ![Текст настраиваемой формы](~/assets/images/Teams-task-module/custom-text.png)

       **Настраиваемая** форма отправляет сообщение о признании.

       ![Регистрация](~/assets/images/Teams-task-module/custom-on-sign-up.png)

       В чате отображается следующая информация:

       ![Чат](~/assets/images/Teams-task-module/adaptive-custom-chat.png)

    1. Выберите **трубку** из вызовов модулей задач из **карточки героя** или вызова модуля задач **из адаптивной карты**.

       ![YouTube](~/assets/images/Teams-task-module/youtube.png)

    1. Выберите **Play**.

       ![Выбор YouTube](~/assets/images/Teams-task-module/youtube-select.png)

       Видео воспроизводит.
- title: Полная задача
  durationInMinutes: 1
  content: >
    Вы придумали что-то подобное?

       ![Модуль задач](~/assets/images/Teams-task-module/final_image.png)
- content: Вы завершили учебный курс, чтобы начать работу с Teams модулем задач!
