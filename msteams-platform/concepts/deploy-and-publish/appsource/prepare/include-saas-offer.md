---
title: Включение предложения SaaS в приложение
description: Узнайте, как монетизировать приложение Microsoft Teams, продавая планы подписки непосредственно из описания магазина Teams. Общие сведения о публикации приложений, пользователей и администраторов при покупке.
author: heath-hamilton
ms.author: surbhigupta
ms.topic: how-to
ms.localizationpriority: high
ms.openlocfilehash: 500dbd4b3677c802a19eb3d454aa35cad2791f3d
ms.sourcegitcommit: 84747a9e3c561c2ca046eda0b52ada18da04521d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/31/2022
ms.locfileid: "68791827"
---
# <a name="include-a-saas-offer-with-your-teams-app"></a>Включение предложения SaaS в приложение Teams

:::row:::
   :::column span="3":::

С помощью предложения из категории "программное обеспечение как сервис" (SaaS), поддерживающего транзакции, можно монетизировать приложение Teams, продавая планы подписки непосредственно из своего профиля в магазине Teams. Например, у вас есть бесплатное приложение, которое любой желающий может получить в магазине. Теперь пользователям, которые хотят получить больше возможностей, можно предложить планы категории премиум и корпоративные планы.

Монетизация приложения в общих чертах выглядит следующим образом.

1. [Планирование предложения SaaS](#plan-your-saas-offer).

1. [Интеграция с API выполнения SaaS](#integrate-with-the-saas-fulfillment-apis).

1. [Создание начальной страницы для управления подписками](#build-a-landing-page-for-subscription-management).

1. [Создание предложения SaaS](#create-your-saas-offer).

1. [Настройка приложения для предложения SaaS](#configure-your-app-for-the-saas-offer).

1. [Публикация приложения в магазине Teams](#publish-your-app).

   :::column-end:::
   :::column span="1":::

:::image type="content" source="~/assets/images/saas-offer/saas-offer-diagram.png" alt-text="Схема, показывающая процесс привязки предложения SaaS к приложению Teams.":::

   :::column-end:::
:::row-end:::

## <a name="plan-your-saas-offer"></a>Планирование предложения SaaS

Подробные рекомендации см. в статье [Планирование предложения SaaS для коммерческой платформы Майкрософт](/azure/marketplace/plan-saas-offer).

При планировании монетизации приложения Teams следует рассмотреть некоторые вопросы.

* Определение модели подписки. Поддерживающее транзакции предложение SaaS может включать несколько планов подписки. Общедоступные открытые планы подписки являются наиболее распространенными, но можно также ориентироваться на конкретных клиентов, подготовив варианты специально для них. Дополнительные сведения см. в статье [Частные планы на коммерческой платформе Майкрософт](/azure/marketplace/private-plans).
* Ознакомьтесь с вариантом профиля [*Продажа через Microsoft*](/azure/marketplace/plan-saas-offer#listing-options) для предложения SaaS, который необходим для того, чтобы пользователи могли приобретать планы подписки на приложение непосредственно в магазине Teams.
* Узнайте, как [единый вход Azure Active Directory (SSO)](/azure/marketplace/azure-ad-saas) помогает клиентам приобретать подписки и управлять ими. (Наличие SSO Microsoft Azure Active Directory (Azure AD) необходимо для приложений Teams с предложениями SaaS.)
* Следует учитывать, что вы несете ответственность за управление инфраструктурой, необходимой для поддержки использования клиентами предложения SaaS, и оплату ее использования.
* Планирование вариантов для мобильных устройств. Во избежание нарушения политик сторонних магазинов приложений ваше приложение не может включать ссылки, позволяющие пользователям приобретать планы подписки на мобильных устройствах. Тем не менее, если в вашем приложении есть функции, требующие оформления подписки, вы можете сообщить об этом. Дополнительные сведения см. в статье на близкую к этому вопросу тему [Политики коммерческой платформы в отношении сертификации](/legal/marketplace/certification-policies#114048-mobile-experience).

## <a name="integrate-with-the-saas-fulfillment-apis"></a>Интеграция с API выполнения SaaS

Интеграция с API выполнения SaaS необходима для монетизации приложения Teams. Эти API помогают управлять жизненным циклом плана подписки после его приобретения пользователем.

Полные инструкции и информацию об интерфейсах API см. в статье [Документация по API выполнения SaaS](/azure/marketplace/partner-center-portal/pc-saas-fulfillment-apis). Как правило, после приобретения подписки будут выполняться с помощью API перечисленные ниже действия.

1. Получение [*маркера идентификации покупки*](/azure/marketplace/partner-center-portal/pc-saas-fulfillment-life-cycle#purchased-but-not-yet-activated-pendingfulfillmentstart) с помощью URL-адреса начальной страницы.

1. Использование этого маркера для получения сведений о подписке.

1. Уведомление коммерческой платформы об активации подписки.

### <a name="best-practices-for-implementing-subscription-management"></a>Рекомендации по управлению подписками

* С помощью поддерживающих транзакции предложений SaaS для приложений Teams планы подписки (лицензии) должны назначаться отдельным пользователям, а не группам или всей организации.
* После назначения пользователям плана подписки сообщите им об этом с помощью бота Teams или электронной почты. В сообщение включите сведения о том, как добавить приложение в Teams и начать работу.
* Поддержка концепции нескольких администраторов. Иными словами, несколько пользователей в одной и той же организации могут приобретать собственные подписки и управлять ими.

## <a name="manage-license-for-third-party-apps-in-teams"></a>Управление лицензиями для сторонних приложений в Teams

Teams позволяет администраторам или пользователям независимых поставщиков программного обеспечения управлять лицензиями SaaS для сторонних приложений, приобретенных в магазине Teams. Администраторы или пользователи ISV могут легко назначать, отменять назначение, использование и отслеживание лицензий SaaS.

Чтобы включить управление лицензиями для приложения в Teams, выполните следующие действия:

1. [Создание предложения в Центре партнеров](#create-an-offer-in-partner-center)
1. [Обновление приложения Teams](#update-your-teams-app)
1. [После покупки](#post-purchase)
1. [Интеграция с API graph usage Right](#integrate-with-graph-usage-right-api)

### <a name="create-an-offer-in-partner-center"></a>Создание предложения в Центре партнеров

1. Войдите в [Центр партнеров](https://partner.microsoft.com/) и выберите **Центр партнеров**.

   :::image type="content" source="~/assets/images/first-party-license-mgt/partner-center-home-page.png" alt-text="На снимках экрана показано, как войти в учетную запись Центра партнеров.":::

1. На **домашней** странице выберите вкладку **Предложения Marketplace** , чтобы определить предложения коммерческой платформы.

   :::image type="content" source="~/assets/images/first-party-license-mgt/home-page.png" alt-text="На снимках экрана показана домашняя страница и вкладка предложения Marketplace в Центре партнеров.":::

1. Выберите **Обзор** в левой области.

1. Выберите **Новое предложение** > **Программное обеспечение как услуга**.

   :::image type="content" source="~/assets/images/first-party-license-mgt/commercial-marketplace.png" alt-text="На снимках экрана показана страница предложения Marketplace, где можно выбрать новое предложение.":::

1. Введите **идентификатор предложения** и **псевдоним предложения** и нажмите кнопку **Создать**.

   > [!NOTE]
   > Если вы создаете предложение для тестирования, добавьте текст **-ISVPILOT** в конец псевдонима предложения. Это указывает группе сертификации, что предложение предназначено для тестирования. Корпорация Майкрософт периодически удаляет предложения с **помощью -ISVPILOT** . Поэтому не используйте этот тег по другим причинам, кроме тестирования возможности управления лицензиями.

   :::image type="content" source="~/assets/images/first-party-license-mgt/saas.png" alt-text="На снимках экрана показано, как ввести идентификатор предложения и псевдоним предложения в Центре партнеров.":::

1. На странице настройки предложения в разделе сведения об установке установите флажок **Да, я хочу, чтобы корпорация Майкрософт управляла клиентскими лицензиями от моего имени**.

   :::image type="content" source="~/assets/images/first-party-license-mgt/saas-isvpilot.png" alt-text="На снимках экрана показана страница настройки предложения для настройки лицензии для управления приложением в Teams.":::

   > [!NOTE]
   >
   > * Это одноразовый параметр, и вы не сможете изменить его после публикации предложения. Это позволяет клиенту управлять лицензиями для вашего приложения в Teams.
   > * Манифест приложения поддерживает только одно предложение для приложения. Выберите соответствующее решение для управления лицензиями для всех планов, доступных в вашем предложении, и вы не сможете изменить этот параметр после того, как предложение будет отправлено в срок.

1. Выберите **Сохранить черновик**.

1. Выберите **Обзор плана** в области слева, а затем щелкните **Создать план**.

   > [!NOTE]
   > Необходимо добавить по крайней мере один план.

   :::image type="content" source="~/assets/images/first-party-license-mgt/plan-overview.png" alt-text="На снимках экрана показан обзор плана для создания нового плана для приложений в Центре партнеров.":::

1. Введите идентификатор плана и имя плана, а затем нажмите кнопку **Создать**.

1. Введите **имя плана** и **описание плана**.

   > [!NOTE]
   > Сведения о плане отображаются в Teams Marketplace и [Appsource](https://appsource.microsoft.com/) в списке предложений (раздел планов).

   :::image type="content" source="~/assets/images/first-party-license-mgt/plan-listing.png" alt-text="На снимках экрана показана страница плана для добавления имени плана и описания плана для приложения.":::

1. Выберите **Сохранить черновик**.

1. Выберите **Цены и доступность** в области слева.

1. Добавьте сведения о ценах и доступности.

   :::image type="content" source="~/assets/images/first-party-license-mgt/pricing-availability.png" alt-text="На снимках экрана показана страница цен и доступности для добавления предложения SaaS для приложения.":::

1. Выберите **Сохранить черновик**.

1. Выберите **Обзор плана** в верхней части страницы, чтобы перейти на страницу со списком всех планов, созданных для этого предложения.

   :::image type="content" source="~/assets/images/first-party-license-mgt/list-of-plans-created.png" alt-text="На снимках экрана показана страница списка планов с идентификатором службы, моделью ценообразования, доступностью, состоянием и действием.":::

1. Скопируйте идентификатор службы плана, созданного для интеграции с API прав на использование Microsoft Graph.

### <a name="update-your-teams-app"></a>Обновление приложения Teams

Обновите приложение Teams для сопоставления с платными функциями, а [приложение Teams](https://aka.ms/TMTG) — с предложением и публикацией.

### <a name="post-purchase"></a>После покупки

1. После активации клиент перенаправляется с целевой страницы в Управление лицензиями Teams.

1. После успешного завершения покупки подписки клиент перенаправляется на целевую страницу приложения для активации подписки. Это существующий интерфейс для пользователей, приобретая [монетизированные приложения в Teams](https://aka.ms/TMTG).

1. После активации покупки подписки на целевой странице клиент перенаправляется на страницу подписок в Teams с помощью ссылки или кнопки [,](https://teams.microsoft.com/_#/subscriptionManagement) выбранной клиентом на целевой странице издателя.

### <a name="integrate-with-graph-usage-right-api"></a>Интеграция с API graph usage Right

Интеграция с API Graph Usage Right для управления разрешениями пользователей во время запуска приложения клиентом с лицензией на покупку. Необходимо определить разрешения пользователя для приложения с помощью вызова Graph к API прав использования.

Вы можете вызвать API Graph, чтобы определить, имеет ли текущий вошедший в систему пользователь с допустимой подпиской плана доступ к вашему приложению. Чтобы вызвать API Graph UsageRight для проверки разрешений пользователей, выполните следующие действия:

1. Получение маркера OBO пользователя: [получение доступа от имени пользователя — Microsoft Graph | Документация Майкрософт](/graph/auth-v2-user).

1. Вызовите Graph для получения идентификатора объекта пользователя. [Используйте microsoft API Graph — Microsoft Graph | Документация Майкрософт](/graph/use-the-api).

1. Вызов API UsageRights, чтобы определить, у пользователя есть лицензия на план [List user usageRights — бета-версия Microsoft Graph | Документация Майкрософт](/graph/api/user-list-usagerights?view=graph-rest-beta&tabs=http&preserve-view=true).

   > [!NOTE]
   > Для вызова UsageRights необходимо иметь минимальные `User.Read` разрешения.
   > API UsageRights в настоящее время находится в бета-версии. После обновления версии до версии 1 пользователи независимого поставщика программного обеспечения должны обновиться с бета-версии до версии 1.

### <a name="check-license-usage-in-partner-center-analytics"></a>Проверка использования лицензий в аналитике Центра партнеров

1. Войдите в [Центр партнеров](https://partner.microsoft.com/).
1. В левой области перейдите в **раздел Коммерческая платформа > Анализ лицензирования >**.
1. Выберите **План и Клиент** в мини-приложении отчетов, чтобы просмотреть использование за месяц.

## <a name="build-a-landing-page-for-subscription-management"></a>Создание начальной страницы для управления подписками

После завершения пользователем процесса покупки плана подписки на приложение в магазине Teams коммерческая платформа направит его на вашу начальную страницу, где он сможет управлять подпиской (например, назначить лицензию конкретному пользователю в своей организации).

Выберите Нет, в таких случаях **я предпочитаю самостоятельно управлять клиентскими лицензиями** .

Полные инструкции см. в статье [Создание начальной страницы для предложения SaaS](/azure/marketplace/azure-ad-transactable-saas-landing-page).

Когда кто-то завершит покупку плана подписки для вашего приложения и хочет остаться в Teams, не направляя его на целевую страницу, выберите **Да, я хотел бы, чтобы корпорация Майкрософт управляла клиентскими лицензиями от моего имени**.

Дополнительные сведения см. [в статье Управление лицензиями для сторонних приложений в Teams](#manage-license-for-third-party-apps-in-teams).

### <a name="best-practices-for-landing-pages"></a>Рекомендации по начальным страницам

При создании начальной страницы для монетизируемого приложения Teams следует рассмотреть следующие подходы. Пример начальной страницы см. в статье [Процедура покупки для конечного пользователя](#end-user-purchasing-experience).

* Пользователи должны иметь возможность войти на вашу начальную страницу с помощью тех же учетных данных Azure AD, которые использовались для покупки подписки. Дополнительные сведения см. в статье [Azure AD и поддерживающие транзакции предложения SaaS на коммерческой платформе](/azure/marketplace/azure-ad-saas).
* Разрешите пользователям выполнять перечисленные ниже действия на вашей начальной странице. Следует определить, какими должны быть роль и разрешения пользователя. Например, может потребоваться разрешить поиск пользователей только администраторам подписки).
  * Поиск пользователей в их организации по электронной почте или с помощью другого способа идентификации.
  * Просмотр списка пользователей, которым можно назначать лицензии.
  * Назначение лицензии одному или нескольким пользователям одновременно.
  * Назначение различных типов лицензий (при наличии) и управление ими.
  * Проверка того, назначена ли уже определенная лицензия другому пользователю.
  * Отмена своей подписки.
* Предоставьте вводную информацию об использовании вашего приложения.
* Добавьте способы получения поддержки, такие как часто задаваемые вопросы, база знаний или контактный адрес электронной почты.
* Предоставьте ссылку, которая упрощает подписчику доступ к начальной странице. Например, включите эту ссылку во вкладку **О программе** вашего приложения.

## <a name="create-your-saas-offer"></a>Создание предложения SaaS

Теперь, когда вы интегрировали API выполнения SaaS и создали начальную страницу, на которой пользователи смогут управлять своими подписками, следует официально создать, протестировать и опубликовать свое предложение SaaS, поддерживающее транзакции.

### <a name="create-the-offer"></a>Создание предложения

Полные инструкции о том, как это сделать в Центре партнеров, см. в статье [Создание предложения SaaS](/azure/marketplace/create-new-saas-offer). Ниже описаны действия общего характера.

1. Если у вас еще нет учетной записи в [Центре партнеров](https://partner.microsoft.com/), создайте ее.

1. Настройте планы подписки, изложите информацию о ценах и другие сведения для вашего предложения SaaS, поддерживающего транзакции. В частности, выполните перечисленные ниже действия.

    * В разделе **Подробные настройки** выберите **Да**, чтобы указать, что вы продаете предложение через корпорацию Майкрософт.

    * В разделе **Интеграция с Microsoft 365** добавьте ссылку на AppSource в профиль вашего приложения. Это обеспечит пользователям возможность покупать ваши планы подписки не только в Teams, но и в AppSource.

1. Сохраните свои ИД издателя и предложения. (Они понадобятся вам позже, чтобы связать предложение с вашим приложением на портале разработчиков.)

1. Опубликуйте свое предложение на коммерческой платформе.

### <a name="test-the-offer"></a>Тестирование предложения

Перед публикацией предложения SaaS рекомендуется проверить процедуру его приобретения от первого до последнего шага. Это можно проверить, создав отдельное предложение, специально предназначенное для тестирования. Исчерпывающую информацию об этом см. в статьях [Обзор предложения для тестирования](/azure/marketplace/plan-saas-offer#test-offer), [Создания предложения для тестирования](/azure/marketplace/create-saas-dev-test-offer) и [Предварительный просмотр предложения](/azure/marketplace/test-publish-saas-offer).

> [!IMPORTANT]
> Вы можете протестировать сквозную транзакцию в Teams с помощью функции [Предварительное тестирование для приложений с монетизацией](Test-preview-for-monetized-apps.md). Для активных предложений необходимо завершить процесс проверки магазина приложений.

В том, что касается Teams, цель этих тестов — подтвердить, что при выполнении пользователями указанных ниже действий количество лицензий и назначений соответствует их количеству в Центре администрирования Teams.

* Активация и настройка плана подписки на вашей начальной странице.
* Назначение, удаление или переназначение лицензии себе или другим лицам.
* Отмена или продление подписки.

### <a name="publish-the-offer"></a>Публикация предложения

По завершении тестирования [опубликуйте предложение в реальных условиях](/azure/marketplace/test-publish-saas-offer#publish-your-offer-live).

## <a name="configure-your-app-for-the-saas-offer"></a>Настройка приложения для предложения SaaS

Вы опубликовали предложение SaaS, но теперь необходимо связать его с вашим приложением Teams, чтобы пользователи могли увидеть ваши планы подписки в магазине Teams.

1. Перейдите на [Портал разработчика](https://dev.teams.microsoft.com/) и щелкните **Приложения**.
1. На странице **Приложения** выберите приложение, с которое вы связываете с предложением SaaS.
1. Перейдите на страницу **Планы и цены** и укажите свои ИД издателя и предложения. (Если вы не сохранили эти ИД, можно найти их в Центре партнеров.)
1. Выберите **Просмотр** для предварительного просмотра планов подписки на предложение SaaS.
1. Если вас все устраивает, щелкните **Сохранить**.

   В ваш [манифест приложения](~/resources/schema/manifest-schema-dev-preview.md#subscriptionoffer) добавляется свойство `subscriptionOffer`.

   ```json
      "subscriptionOffer": {
        "offerId": "publisherId.offerId"  
        }
   ```

## <a name="publish-your-app"></a>Публикация приложения

Вы создали свое предложение SaaS и связали его с приложением Teams — теперь пора опубликовать приложение в магазине Teams. Полные инструкции см. в статье [Публикация приложения в магазине Teams](~/concepts/deploy-and-publish/appsource/publish.md).

> [!IMPORTANT]
>
> * Даже если ваше приложение уже зарегистрировано в магазине Teams, вам необходимо снова пройти процедуру проверки в магазине, чтобы включить ваше предложение SaaS.
> * Предложения с фиксированной ставкой, созданные без идентификатора предложения и идентификатора издателя в манифесте приложения, следует обновить и повторно отправить на проверку.

После публикации пользователи будут видеть кнопку **Купить подписку** в диалоговом окне сведений о приложении при попытке добавить его в Teams.

## <a name="end-user-purchasing-experience"></a>Процедура покупки для конечного пользователя

В следующем примере показано, каким образом пользователи могут приобрести планы подписки на вымышленное приложение Teams под названием *Recloud*.

1. В магазине Teams найдите и выберите приложение *Recloud*.

1. В диалоговом окне сведений о приложении выберите **Купить подписку**.

    :::image type="content" source="~/assets/images/saas-offer/buysubscriptionplan.png" alt-text="Покупка подписки на выбранное приложение.":::

1. Выберите страну, чтобы увидеть планы подписки для вашего географического расположения.

1. В диалоговом окне **Выбор плана подписки** выберите план и нажмите **Оформить заказ**. (Примечание. Частные планы видны только пользователям в организациях, которым вы предоставляете предложение. Эти планы указаны значком **Специальное предложение**:::image type="icon" source="~/assets/icons/special-icon.png":::.)

    :::image type="content" source="~/assets/images/saas-offer/choosingsubscriptionplan.png" alt-text="Выбор нужного плана подписки.":::

1. В диалоговом окне **Оформление заказа** представьте всю необходимую информацию и щелкните **Отправить заказ**.

    :::image type="content" source="~/assets/images/saas-offer/placesubscriptionorder.png" alt-text="Отправка заказа на подписку.":::

1. При появлении соответствующего запроса выберите **Настроить сейчас**, чтобы настроить подписку.

    :::image type="content" source="~/assets/images/saas-offer/saas-offer-set-up.png" alt-text="Настройка подписки.":::

1. Управление планом подписки с помощью веб-сайта *Recloud* (называемого также [начальная страница](#build-a-landing-page-for-subscription-management)).

    :::image type="content" source="~/assets/images/saas-offer/subscriptionlicenses.png" alt-text="Настройка пользовательских лицензий.":::

## <a name="admin-purchasing-experience"></a>Процедура покупки для администратора

Администраторы могут приобретать планы подписки на приложения в [Центре администрирования Teams](/MicrosoftTeams/purchase-third-party-apps).

## <a name="remove-a-saas-offer-from-your-app"></a>Удаление предложения SaaS из приложения

Если вы отмените привязку к предложению SaaS, включенному в ваш профиль в магазине Teams, необходимо будет повторно опубликовать приложение, чтобы увидеть изменения в магазине.

1. Перейдите на [Портал разработчика](https://dev.teams.microsoft.com/) и щелкните **Приложения**.
1. На странице **Приложения** выберите приложение, из которое удаляется предложение.
1. Перейдите на страницу **Планы и цены** и выберите **Отменить**.
1. После отмены привязки предложения выполните указанные ниже действия, чтобы обновить профиль в магазине.
   1. Нажмите **Распространение > Публикация в магазине Teams**.
   1. Выберите **Открыть центр партнеров**, чтобы начать процесс повторной публикации приложения без предложения.

## <a name="see-also"></a>См. также

* [Обслуживание и поддержка опубликованного приложения](../post-publish/overview.md)
* [Рекомендации по проверке для приложений, связанных с предложением SaaS](teams-store-validation-guidelines.md#apps-linked-to-saas-offer)
