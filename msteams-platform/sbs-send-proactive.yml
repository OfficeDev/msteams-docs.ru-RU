### YamlMime:Tutorial
title: Отправка упреждающих сообщений
metadata:
  title: Отправка упреждающих сообщений
  description: В этой статье вы узнаете, как отправлять упреждающие сообщения, такие как приветственные сообщения, запланированные сообщения и уведомления от бота.
  audience: Developer
  level: Beginner
  ms.date: 06/23/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: ./bots/how-to/conversations/send-proactive-messages.md
  nextTutorialTitle: Дополнительные сведения об упреждающих сообщениях
  ms.custom: mvc
  ms.localizationpriority: high
  ms.openlocfilehash: 9c763e584bcd574c2fc511000f6470d7608e3ac0
  ms.sourcegitcommit: b72f51377f41be18ee9b70b042f736605f755cf1
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 10/21/2022
  ms.locfileid: "68670178"
items:
- durationInMinutes: 1
  content: "Упреждающее сообщение — это любое сообщение, отправленное ботом, которое не является ответом на запрос пользователя, который содержит такие сообщения, как:\n - Приветствия\n - Уведомления\n - Запланированные сообщения\n \nЭто пошаговое руководство поможет отправить упреждающее сообщение от бота. Вы увидите следующие выходные данные:\n\n* Упреждающее привет-сообщение в чате.  \n\n  :::image type=\"content\" source=\"~/assets/images/proactive-scenario/proactive-helo1.png\" alt-text=\"Упреждающее сообщение Hello\":::\n\n* Упреждающее привет-сообщение в виде адаптивной карточки.\n\n  :::image type=\"content\" source=\"~/assets/images/proactive-scenario/proactive-helo-in-adaptive-card.png\" alt-text=\"Упреждающее сообщение Hello в адаптивной карточке\"::: \n"
- title: Предварительные требования
  durationInMinutes: 2
  content: "Убедитесь, что вы установите следующее:    \n\n| &nbsp; | Установка | Для использования... |\n | --- | --- | --- |\n | **Required** | &nbsp; | &nbsp; |\n | &nbsp; | [Visual Studio 2022 версии 17.3](https://visualstudio.microsoft.com)<br> Установите одну из следующих двух рабочих нагрузок:<br> • ASP.NET и веб-разработки <br> • Кроссплатформенная разработка .NET Core | Вы можете установить корпоративную версию в Visual Studio 2022 и установить рабочие нагрузки. |\n | &nbsp; | [ngrok](https://ngrok.com/download) | Функции приложений Teams (боты для общения, расширения сообщений и входящие веб-перехватчики) требуют входящих подключений. Туннель подключает систему разработки к Teams. Он не требуется для приложений, которые включают только вкладки. Этот пакет устанавливается в каталоге проекта (с помощью npm `devDependencies`). |\n | &nbsp; | [Учетная запись разработчика Microsoft 365](/microsoftteams/platform/concepts/build-and-test/prepare-your-o365-tenant) | Доступ к учетной записи Teams с соответствующими разрешениями на установку приложения. |\n | &nbsp; | [Портал разработчика Teams](https://dev.teams.microsoft.com/) | Веб-портала для настройки, управления и распространения приложений Teams, в том числе в вашей организации или магазине Teams. |\n"
- title: Настройка локальной среды
  durationInMinutes: 3
  content: "1.  Скачайте [пример кода](https://github.com/MicrosoftDocs/msteams-docs/tree/master/msteams-platform/assets/downloads/SendProactiveMessages.zip) (ZIP-файл) и извлеките файлы.\n1.  Перейдите к извлеченным файлам и дважды щелкните **ProactiveBot.csproj**. Решение откроется в Visual Studio.\n1.  В Visual Studio щелкните правой кнопкой мыши проект (**ProactiveBot**) и **выберите \"** Сборка\", чтобы создать решение.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/proactivebot-project1.png\" alt-text=\"Упреждающий проект бота\":::\n\n    <br>\n\n    <details>\n\n    <summary><b>Устранение неполадок</b></summary>\n\n    Если вы получаете сообщение **об ошибке \"Не удается найти пакет** \", выполните следующие действия.\n\n    1.  Перейдите к **параметрам диспетчера** >  пакетов **Диспетчера пакетов NuGet** > **tools.**\n    1.  В **отобразимом** окне \"Параметры\" выберите источники пакетов **диспетчера пакетов** >  **NuGet**.\n    1.  Нажмите **Добавить**.\n    1.  Введите `nuget.org` имя **и** поля `https://api.nuget.org/v3/index.json` **\"Источник** \".\n    1.  Нажмите **кнопку \"Обновить** \" и \" **ОК\"**.\n    1.  Перестройте проект.\n    <br>\n\n    </details>\n    \n1. Распакуйте, чтобы установить ngrok.\n   * Windows: дважды щелкните `ngrok.zip`.\n   * Linux или OS X: распакуйте ngrok из терминала и выполните команду `unzip /path/to/ngrok.zip` .\n1. Используйте ngrok для создания туннеля к общедоступным конечным точкам HTTPS локального веб-сервера. Выполните следующую команду в ngrok:\n\n    ```bash\n    ngrok http --host-header=localhost 3978\n    ```\n    \n1. Скопируйте URL-адрес HTTPS из ngrok. \n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/ngrok-base-url1.png\" alt-text=\"Базовый URL-адрес ngrok.\"lightbox=\"~/assets/images/proactive-scenario/ngrok-base-url1.png\":::   \n"
- title: Включение предварительной версии для разработчиков
  durationInMinutes: 1
  content: >
    1. Включите отправку приложений в консоли администрирования клиента.
        1. Войдите в [Центр администрирования Microsoft 365](https://admin.microsoft.com/Adminportal/Home?source=applauncher#/homepage#/) со своими учетными данными администратора.
        1. На панели слева выберите " **Показать все"**.
        1. Выберите **Teams**.

           :::image type="content" source="./assets/images/meeting-token-generator/meeting-token-generator-admincenter_1.png" alt-text="Меню центра администрирования" border="true":::
- title: Создание и установка приложения Teams
  durationInMinutes: 5
  content: "1. Откройте [портал разработчика для Teams](https://dev.teams.microsoft.com).\n\n   Появится следующую страницу:\n\n   :::image type=\"content\" source=\"~/assets/images/proactive-scenario/developer-portal-intro.png\" alt-text=\"Общие сведения о портале разработчика\":::\n\n1. Выберите **приложение \"Импорт** > **приложений\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/upload-app-package.png\" alt-text=\"Выбор и отправка пакета\":::  \n\n1. Выберите **AppManifest и** нажмите кнопку **\"Открыть\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-app-package.png\" alt-text=\"Выбор пакета приложения\":::\n\n1. Нажмите **Импорт**.\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-import.png\" alt-text=\"Выбор элемента &quot;Импорт&quot;\":::\n\n    Появится следующую страницу:\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/proactive-message.png\" alt-text=\"Упреждающее сообщение.\"lightbox=\"~/assets/images/proactive-scenario/proactive-message.png\"::: \n\n1. Выберите **бот функций** > **приложения**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-app-features.png\" alt-text=\"Выбор функций приложения\":::\n\n1. Выберите **\"Создать бот\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-bot.png\" alt-text=\"Выбор бота\":::     \n    \n1. Выберите **\"Новый бот\"**. \n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/create-new-bot.png\" alt-text=\"Создание бота\":::\n\n    Появится окно \"Добавить **бота** \".\n\n1. **Введите бот упреждающего сообщения** и нажмите кнопку **\"Добавить\"**.\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/enter-proactive-message.png\" alt-text=\"Введите упреждающее сообщение\":::\n\n    Теперь бот упреждающего сообщения бота успешно добавлен в приложение. Вы увидите имя **бота** и **идентификатор бота**.\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/bot-name.png\" alt-text=\"Имя и идентификатор бота\":::\n\n   > [!TIP]\n   > Сохраните **идентификатор бота для** дальнейшей справки.\n\n1. Дважды щелкните бот **упреждающего сообщения**.\n\n   **Появится страница демонстрации упреждающего** сообщения.\n\n1. Выберите **\"Настроить** \" и задайте **адрес конечной** точки в формате `https://your ngrok/api/messages`.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-configure.png\" alt-text=\"Выбор параметра &quot;Настройка&quot;\":::\n\n1. Выберите **\"Секреты клиента** > **\", чтобы добавить секрет клиента для бота**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/secret.png\" alt-text=\"Выбор секрета\":::\n\n1. **Появится окно создания секрета** клиента и нажмите кнопку **\"ОК\"**.    \n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/new-secret.png\" alt-text=\"Новый секрет\":::\n\n    > [!TIP]\n    > Сохраните значение **секрета нового клиента** для дальнейшей ссылки.\n\n1. Щелкните значок \"Приложения :::image type=\"icon\" source=\"~/assets/images/proactive-scenario/apps-icon.png\"::: \" и выберите \" **Демонстрация упреждающего сообщения\"**.\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-apps.png\" alt-text=\"Выбор приложений\":::\n\n    Появится следующую страницу:\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/overview-page.png\" alt-text=\"Страница &quot;Обзор&quot;\":::\n\n1. Выберите **\"Компоненты приложения** \" **в разделе \"Настройка** \" и \" **Бот\"**.\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-app-features1.png\" alt-text=\"Выбор функций приложения\":::\n\n1. Выберите **бот упреждающего сообщения** в раскрывающемся списке **\"Выбор существующего бота** \".\n\n     :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-send-proactive-message.png\" alt-text=\"Выбор команды &quot;Отправлять упреждающие сообщения&quot;\":::\n\n1. Выберите \" **Личное сохранение** > **\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-personal.png\" alt-text=\"Выбор личного\":::\n\n1. Откройте файл **appsettings.json** в Visual Studio и обновите следующие сведения:\n\n    * **Задайте для MicrosoftAppID** идентификатор бота.\n    * **Задайте для MicrosoftAppPassword** значение идентификатора секрета клиента.\n\n   :::image type=\"content\" source=\"~/assets/images/proactive-scenario/appsettings.png\" alt-text=\"Файл параметров приложения\":::\n\n1. Выберите **\"Начать отладку** > **отладки\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/debug.png\" alt-text=\"Выбор элемента &quot;Отладка&quot;\":::\n\n   Появится соответствующий пример упреждающего сообщения:\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/proactive-confirm.png\" alt-text=\"Упреждающее подтверждение\":::\n\n1. Назад на портал разработчика, выберите **предварительный просмотр в Teams**.\n    \n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/preview-teams.png\" alt-text=\"Предварительная версия Teams\":::\n\n1. Нажмите **Добавить**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-add.png\" alt-text=\"Нажмите кнопку Add (Добавить)\":::\n\n   Появится следующую страницу.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/teams-open1.png\" alt-text=\"Открытие Teams\":::\n\n   Откройте браузер.\n\n1. Скопируйте и вставьте `http://localhost:3978/api/notify` URL-адрес в браузере, чтобы получить упреждающее привет-сообщение в чате.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/url-paste.png\" alt-text=\"Вставка URL-адреса\":::\n\n1. Перейдите в Teams. При успешной установке бот получает упреждающее сообщение hello.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/proactive-reply.png\" alt-text=\"Упреждающий ответ\":::\n"
- title: Добавление адаптивной карточки в упреждающее сообщение
  durationInMinutes: 10
  content: "1. В Visual Studio остановите процесс отладки.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/stop-debugging.png\" alt-text=\"Остановка отладки\":::\n\n1. Щелкните правой **кнопкой мыши \"Зависимости**\" и выберите **\"Управление пакетами NuGet\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/dependencies.png\" alt-text=\"Упреждающие зависимости\":::\n\n1. В **NuGet ProactiveBot выберите** \" **Обзор** \" и найдите **adaptiveCards**. \n1. Нажмите кнопку **Установить**. \n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-adaptive cards.png\" alt-text=\"Выбор адаптивных карточек\":::\n\n1. В **окне \"Предварительный** просмотр изменений\" нажмите кнопку **\"ОК\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-ok.png\" alt-text=\"Нажмите кнопку &quot;ОК&quot;\":::\n\n1. Откройте файл **NotifyController.cs** в разделе **\"Контроллеры\"**.\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/select-notify.png\" alt-text=\"Выбор уведомления\":::\n\n1. Замените существующий `BotCallback` код следующим кодом для отправки сообщения адаптивной карточки:     \n    \n   ```csharp\n   private async Task BotCallback(ITurnContext turnContext, CancellationToken cancellationToken)\n    {\n                AdaptiveCard card = new AdaptiveCard(new AdaptiveSchemaVersion(1, 0));\n\n                card.Body.Add(new AdaptiveTextBlock()\n                {\n                    Text = \"Proactive Hello\",\n                    Size = AdaptiveTextSize.ExtraLarge\n                });\n\n                card.Body.Add(new AdaptiveImage()\n                {\n                    Url = new Uri(\"http://adaptivecards.io/content/cats/1.png\")\n                });\n\n                Attachment attachment = new Attachment()\n                {\n                    ContentType = AdaptiveCard.ContentType,\n                    Content = card\n                };\n\n                await turnContext.SendActivityAsync(MessageFactory.Attachment(attachment));\n    }\n   ```  \n\n1. Нажмите **клавишу F5** , чтобы выполнить код.\n\n   Появится соответствующий пример упреждающего сообщения:\n\n    :::image type=\"content\" source=\"~/assets/images/proactive-scenario/proactive-confirm.png\" alt-text=\"Упреждающее подтверждение\":::\n\n1. Перейдите в Teams и удалите приложение. \n\n1. Переустановите то же приложение, чтобы получить `conversationUpdate` событие.   \n\n1. Скопируйте и вставьте `http://localhost:3978/api/notify` URL-адрес в браузере, чтобы получить упреждающее сообщение hello в адаптивной карточке.     \n"
- title: Полный запрос
  durationInMinutes: 3
  content: >
    У вас возникла такая проблема? Так отображается упреждающее сообщение привета в адаптивной карточке:


    :::image type="content" source="~/assets/images/proactive-scenario/proactive-helo-in-adaptive-card.png" alt-text="Упреждающее сообщение Hello в адаптивной карточке":::
- content: >-
    Вы завершили сценарий.

    * Вы можете отправлять уведомления на ежедневной основе или периодически запрашивать отзывы у пользователя.

    * Обработайте ограничения регулирования, чтобы избежать нескольких уведомлений.
