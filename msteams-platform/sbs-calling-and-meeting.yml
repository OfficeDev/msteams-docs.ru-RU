### YamlMime:Tutorial
title: Бот для звонков и собраний Teams
metadata:
  title: Бот Teams с вызовами и собраниями
  description: В этом модуле обучения вы узнаете, как настроить функции звонков и собраний в боте для Teams.
  audience: Developer
  level: Beginner
  ms.date: 02/08/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: bots/calls-and-meetings/registering-calling-bot.md
  nextTutorialTitle: Регистрация бота вызовов
  ms.custom: mvc
  ms.localizationpriority: none
  ms.openlocfilehash: b57e9744699c7318674f387451f17afc66c5667e
  ms.sourcegitcommit: 88fb2e9a18de3bd84e3c604ff235fc753c8de8f5
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 11/02/2022
  ms.locfileid: "68818095"
items:
- durationInMinutes: 1
  content: >
    Бот для звонков и собраний Microsoft Teams предоставляет базовые функции, такие как создание звонка, присоединение к вызову, передача или перенаправление звонка, присоединение к запланированному собранию и приглашение участников путем интеграции облачных коммуникаций API Graph.


    Боты могут взаимодействовать с звонками и собраниями Teams с помощью голосовой связи, видео и демонстрации экрана в режиме реального времени. С помощью API Microsoft Graph для звонков и собраний по сети приложения Teams могут взаимодействовать с пользователями с помощью голосовых и видеоданных, чтобы улучшить их взаимодействие. Эти API позволяют добавлять следующие новые функции:


    * Используйте интерактивный голосовой ответ (IVR).

    * Используйте управление вызовами.

    * Предоставление доступа к аудио- и видеопотокам в реальном времени, включая общий доступ к рабочим столам и приложениям.


    Создайте бота и укажите дополнительные сведения и разрешения для использования этих API Graph в приложении Teams.


    Это пошаговое руководство поможет вам настроить бота для звонков и собраний Teams. К концу этого руководства вы можете получить следующие выходные данные:


    :::image type="content" source="./assets/images/calls-and-meetings/final-output.png" alt-text="Окончательные выходные данные.":::
- title: Предварительные требования
  durationInMinutes: 1
  content: "Убедитесь, что установлены следующие средства и настроена среда разработки:\n\n | &nbsp; | Установка | Для использования... |\n | --- | --- | --- |\n | **Required** | &nbsp; | &nbsp; |\n | &nbsp; | [Учетная запись разработчика Microsoft 365](/microsoftteams/platform/concepts/build-and-test/prepare-your-o365-tenant) | Доступ к учетной записи Teams с соответствующими разрешениями для установки приложения. |\n | &nbsp; | [ngrok](https://ngrok.com/download) | Функции приложений Teams (диалоговые боты, расширения сообщений и входящие веб-перехватчики) требуют входящих подключений. Туннель соединяет систему разработки с Teams. Он не требуется для приложений, которые содержат только вкладки. Этот пакет устанавливается в каталоге проекта (с помощью npm `devDependencies`). |\n | &nbsp; | [Visual Studio 2022 версии 17.3](https://visualstudio.microsoft.com)<br> Установите одну из следующих двух рабочих нагрузок:<br> • ASP.NET и веб-разработка <br> • Кроссплатформенная разработка .NET Core | Вы можете установить корпоративную версию в Visual Studio 2022 и установить рабочие нагрузки. |   \n | &nbsp; | [Пакет SDK для .NET Core версии 3.1 (не гостевая учетная запись)](https://dotnet.microsoft.com/en-us/download) | Настраиваемые привязки для локальной отладки и Функции Azure развертываний приложений. Если вы не установили пакет SDK для .NET 3.1 (или более поздней версии) глобально, можно установить переносимую версию. |\n | &nbsp; | [Microsoft Teams и учетная запись Teams](https://www.microsoft.com/microsoft-teams/download-app) | Microsoft Teams для совместной работы со всеми пользователями, с которыми вы работаете, с помощью приложений для чатов, собраний, звонков и всех в одном месте. |\n | &nbsp; | [Windows PowerShell](/microsoftteams/teams-powershell-install) | Установите, выполнив все команды. |\n"
- title: Настройка бота для звонков и собраний
  durationInMinutes: 5
  content: "Зарегистрируйте приложение с помощью регистрации приложения в microsoft портал Azure для интеграции приложения с платформа удостоверений Майкрософт и вызова microsoft API Graph. Выполните следующие действия:\n\n1. Создайте туннель ngrok для конечных точек веб-сервера.\n1. Создайте ресурс бота Azure, чтобы зарегистрировать бота в службе azure bot.\n1. Создайте секрет клиента, который включает проверку подлинности бота с единым входом.\n1. Создайте политику для пользователя демонстрационного клиента для создания собраний по сети с помощью PowerShell.\n1. Добавьте разрешения API для подчиненных вызовов.\n1. Создайте регистрацию канала бота в учетной записи Azure.\n1. Добавьте канал Microsoft Teams для развертывания бота в канале Teams.\n1. Добавьте конечную точку обмена сообщениями в созданный туннель ngrok.\n\n**Создание туннеля ngrok**\n\nИспользуйте ngrok, чтобы создать туннель к общедоступным конечным точкам HTTPS локально работающего веб-сервера. Выполните следующую команду в ngrok:\n\n```bash\nngrok http --host-header=rewrite 3978\n```\n\n**Регистрация приложения в Azure**\n\n1. Перейдите на [страницу портал Azure](https://portal.azure.com/) с помощью личной учетной записи Майкрософт.\n1. Выберите **Azure Active Directory**.\n\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-active-directory.png\" alt-text=\"Azure Active Directory.\":::\n\n1. В левой области выберите **Регистрация приложений**.\n1. Выберите **Новая регистрация**.\n\n   :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-active-directory_1.png\" alt-text=\"Новая служба Azure Active Directory.\":::\n\n\nОткроется окно **регистрации приложения**. Введите сведения о регистрации приложения.\n\n  1. В поле **Имя** введите имя приложения, которое отображается для пользователей.\n\n  1. В разделе **Поддерживаемые типы учетных записей** выберите учетные записи, которые приложение будет поддерживать.\n\n  1. В **поле URI перенаправления (необязательно)** выберите тип **веб-клиента или общедоступного клиента приложения (для мобильных и настольных компьютеров),** а затем введите URI перенаправления для приложения.\n\n     > [!NOTE]\n     > Для веб-приложений укажите базовый URI как `http://localhost:31544`. Для общедоступных клиентских приложений укажите универсальный код ресурса (URI), используемый Azure AD для возврата ответов маркера в виде `myapp://auth`.\n\n  1. Нажмите **Зарегистрировать**.\n\n     :::image type=\"content\" source=\"./assets/images/calls-and-meetings/reg-app_2.png\" alt-text=\"Снимок экрана: выбор регистра.\" lightbox=\"./assets/images/calls-and-meetings/reg-app_1.png\":::\n\n**Создание секрета клиента**\n\n1. На странице **\"Обзор\"** бота выберите **Основные** компоненты и сохраните **идентификатор приложения (клиента)** (Идентификатор приложения Майкрософт) для дальнейшего использования.\n\n   :::image type=\"content\" source=\"./assets/images/calls-and-meetings/microsoft-app-id-new_2.png\" alt-text=\"Снимок экрана: идентификатор приложения Майкрософт.\":::\n\n1. В **разделе Управление** выберите **Сертификаты & секреты**.\n1. Выберите **Секреты** >  клиента **Новый секрет клиента**.\n\nОткроется окно **добавления секрета клиента**.\n\n  1. Введите **описание** в секрет клиента.\n  1. Нажмите **Добавить**.\n\n     :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-client_2.png\" alt-text=\"Снимок экрана: добавляемый секрет клиента.\"lightbox=\"./assets/images/calls-and-meetings/add-client_2.png\":::\n\n  1. Выберите **Копировать в буфер обмена** , чтобы скопировать сведения о **значении** .\n\n     :::image type=\"content\" source=\"./assets/images/calls-and-meetings/client-secret_2.png\" alt-text=\"Screenshirt, показывающий значение, копируемого в буфер обмена.\":::\n\n      > [!TIP]\n      > Сохраните **значение** секретов клиента или пароль приложения для дальнейшего использования.\n\n**Запуск скрипта PowerShell для создания политики**\n\n1. Создайте политику для пользователя демонстрационного клиента для создания собраний по сети с помощью следующего сценария PowerShell:\n\n    > [!NOTE]\n    > Запустите Windows PowerShell PSI от имени администратора и выполните скрипт.\n\n    ```PowerShell\n\n    New-CsApplicationAccessPolicy -Identity \"<<policy-identity/policy-name>>\" -AppIds \"<<azure-client-id>>\" -Description \"Policy-description\"\n    Grant-CsApplicationAccessPolicy -PolicyName \"<<policy-identity/policy-name>>\" -Identity \"<<object-id-of-the-user-to-whom-policy-need-to-be-granted>>\"\n\n    ```\n\n1. Замените `azure-client-id` **идентификатором приложения Майкрософт** и `object-id` **идентификатором клиента** вашей учетной записи, используемой для входа в Teams. Скопируйте ссылку, как показано на следующем рисунке, и вы можете найти идентификатор клиента учетной записи Teams по полученной ссылке:\n\n    1. Выберите **Teams**.\n\n    1. Выберите многоточие ●●●.\n\n    1. Выберите **Получить ссылку на команду**.\n   \n       :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-final.png\" alt-text=\"Снимок экрана: замена идентификатора Microsoft-App.\":::\n   \n1. Добавьте `PolicyName`, `azure-client-id`, `policy-description`и `object-id` в скрипт PowerShell.\n1. Войдите с помощью учетной записи Teams при появлении запроса PowerShell.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell_1.png\" alt-text=\"Снимок экрана: PowerShell.\":::\n\n1. Выполните следующую команду в PowerShell, чтобы проверить, успешно ли создана политика. Замените имя политики определенным именем политики.\n\n \n    ```PowerShell\n    Get-CsApplicationAccessPolicy -Identity “<<policy-identity/policy-name>>”\n    ```\n\n    > [!NOTE]\n    > Убедитесь, что выполняемые скрипты не отключены в системе. Дополнительные сведения см. в [разделе Политики выполнения](https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.2).\n\n**Добавление разрешений API для подчиненных вызовов**\n\n> [!NOTE]\n> Убедитесь, что ваша учетная запись может предоставить согласие администратора корпорации Майкрософт. После добавления разрешений выберите `Grant admin consent for Microsoft` , чтобы узнать состояние согласия.\n\n1. В области **Управление** ботом выберите **Разрешения API**.\n1. Выберите **Добавить разрешение**. Откроется окно **разрешения API запроса**.\n1. Выберите **Microsoft** >  API **Microsoft Graph**.\n1. Выберите **Разрешения приложения**.\n1. Выберите разрешения и добавьте следующие разрешения API Graph приложений в приложение Azure и предоставьте согласие администратора:\n    * `Calls.AccessMedia.All`\n    * `Calls.Initiate.All`\n    * `Calls.InitiateGroupCall.All`\n    * `Calls.JoinGroupCall.All`\n    * `Calls.JoinGroupCallAsGuest.All`\n    * `OnlineMeetings.ReadWrite.All`\n1. Выберите **Добавить разрешения**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/api-permissions_1.png\" alt-text=\"Снимок экрана: добавление разрешений API.\" lightbox=\"./assets/images/calls-and-meetings/api-permissions_1.png\":::\n\n**Создание регистрации канала бота в учетной записи Azure**\n\n1. Перейдите на [портал Azure](https://portal.azure.com/).\n1. Выберите **Создать ресурс**.\n1. Найдите **Azure Bot** в поле поиска.\n1. Выберите **Azure Bot**.\n1. Нажмите **Создать**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-bot_1.png\" alt-text=\"Снимок экрана: домашняя страница бота Azure.\":::\n  \n   **Откроется окно \"Создание бота Azure** \".\n\n1. Введите имя дескриптора бота в поле **Дескриптор бота**.\n1. Выберите **подписку** и **группу ресурсов** в раскрывающемся списке.\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/create-azure-bot.png\" alt-text=\"Снимок экрана: создание бота Azure.\":::\n  \n   Вы также можете создать новую группу ресурсов. Выберите **Создать >** введите имя ресурса > нажмите **кнопку ОК**.\n\n1. Выберите требуемое расположение в раскрывающемся списке **Расположение новой группы ресурсов** , если вы создали новую группу ресурсов.\n\n    :::image type=\"content\" source=\"~/assets/images/bots/newresource.png\" alt-text=\"Снимок экрана: новое расположение группы ресурсов.\":::\n\n1. Выберите **Тип приложения в** качестве **мультитенантного**.\n\n    > [!NOTE]\n    > В `Creation type` разделе Идентификатор приложения Microsoft уже выбран для `Create new Microsoft App ID` создания нового бота. Вы также можете выбрать `Use existing app registration`, если вы уже зарегистрировали бота. Введите идентификатор приложения Майкрософт в `Existing app ID` поле и введите значение в `Existing app password` поле.\n\n1. Выберите **Использовать существующую регистрацию приложения** и введите **идентификатор приложения** Azure, зарегистрированного в демонстрационном клиенте.\n1. Выберите **Проверить и создать**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/review-create_1.png\" alt-text=\"Снимок экрана: выбор нескольких клиентов.\":::\n\n1. Если проверка пройдена, выберите **Создать**.\n\n   Подготовка службы бота займет несколько секунд.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/validation_1.png\" alt-text=\"Снимок экрана: пройденный проход проверки.\":::\n\n1. Выберите пункт **Перейти к ресурсу**. Бот и связанные ресурсы указаны в группе ресурсов.\n\n    Теперь бот Azure создан.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/go-to-resource_1.png\" alt-text=\"Снимок экрана: навигация для перехода к ресурсу.\":::\n\n**Добавление канала Microsoft Teams**\n\n1. Перейдите на **домашнюю страницу**.\n1. Выберите бота в **разделе Последние ресурсы**.\n1. Выберите **Каналы** в области слева.\n1. Выберите **Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/>.    \n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/channels-teams_1.png\" alt-text=\"Снимок экрана: каналы Teams.\":::\n\n1. Установите флажок, чтобы принять **условия предоставления услуг**.\n1. Выберите **Принять**.\n\n    :::image type=\"content\" source=\"~/assets/images/calls-and-meetings/terms.png\" alt-text=\"Условия предоставления услуг\":::\n\n1. Нажмите **Применить**.\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/teams-file-upload-bot/apply-teams_1.png\" alt-text=\"microsoft Teams\":::\n\n1. Выберите **Microsoft Teams** и **перейдите** на вкладку Звонки на странице канала Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/configure-teams.png\" alt-text=\"Настройте Teams.\":::\n\n1. Выберите **Включить вызовы**, а затем обновите **веб-перехватчик** url-адресом HTTPS ngrok (https://yourngrok/api/callback) и добавьте `/api/callback` в конце.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/enable-calling_1.png\" alt-text=\"Включите вызовы.\":::\n\n1. Нажмите **Применить**.\n\n**Добавление конечной точки обмена сообщениями**\n\n1. Перейдите в ngrok.\n1. Скопируйте URL-адрес HTTPS (https to io), как показано на следующем рисунке:\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/ngrok_1.png\" alt-text=\"Снимок экрана: окно ngrok.\":::\n\n1. Перейдите на **домашнюю** страницу бота.\n1. Выберите **Конфигурация** в разделе **Параметры** в области слева.\n1. В **конечной точке обмена сообщениями** добавьте URL-адрес HTTPS из ngrok и в конце URL-адреса добавьте **/api/messages**.\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/messaging-endpoint_1.png\" alt-text=\"Снимок экрана: конечная точка обмена сообщениями.\":::\n\n1. Нажмите **Применить**.\n\n    Вы успешно настроили бот в службе ботов Azure, и вам нужно настроить подключение к службе ботов.\n"
- title: Обновление и создание пакета приложения Teams
  durationInMinutes: 1
  content: "Настройте пример бота, чтобы понять, как проверить подлинность бота для бесед в Microsoft Teams, создать пакет приложения Teams и отправить его в организацию.\n\n1. Обновление appsettings.json в Visual Studio.\n1. Обновите файл manifest.json в Visual Studio и сожмите его в ZIP-файл в проводник.\n\n**Обновление приложений для вызова бота**\n\n1. Перейдите в репозиторий https://github.com/OfficeDev/Microsoft-Teams-Samples.git.\n1. Выберите **Код** и выберите раскрывающийся список.\n1. Выберите **Скачать ZIP-файл**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/git_1.png\" alt-text=\"Снимок экрана: скачивание репозитория.\":::\n\n    > [!NOTE]\n    > Обязательно запишите путь к скачанму репозиторию.\n\n1. В **проводник** перейдите в папку **csharp** **microsoft-Teams-Samples-main** > **samples** > **bot-calling-meeting** > .\n1. Откройте файл **appsettings.json** в Visual Studio и обновите конфигурацию для бота.\n\n    * Вы можете получить на `MicrosoftAppId` странице конфигурации бота. — `MicrosoftAppPassword` это значение для идентификатора секрета клиента, сохраненного ранее.\n    * Вы можете получить `tenantId` или `UserId` по ссылке учетной записи, используемой для входа в Teams. Следуйте по пути на изображении, чтобы получить ссылку для `tenantId`:\n      \n       1. Выберите **Teams**.\n\n       1. Выберите многоточие ●●●.\n\n       1. Выберите **Получить ссылку на команду**.\n\n     :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-final.png\" alt-text=\"Снимок экрана: ссылка на Teams.\":::\n    \n    * Вы можете получить `displayName` и `id` на сайте [Microsoft Graph Explorer](https://developer.microsoft.com/graph/graph-explorer) :\n\n        * Войдите на страницу с помощью учетной записи клиента Teams.\n\n        * Добавьте `Users` в конце URl в поле поиска.\n\n        * Выберите **Выполнить запрос**.\n        \n          :::image type=\"content\" source=\"./assets/images/calls-and-meetings/graph-explorer_1.png\" alt-text=\"Graph Explorer.\":::\n\n\n        * Создаются отображаемые имена и идентификаторы пользователей, связанные с вашей учетной записью.\n\n        * Выберите три учетные записи и добавьте их в `DisplayName` файл и `UserId` в файле appsettings.json.\n   \n          :::image type=\"content\" source=\"./assets/images/calls-and-meetings/graph-explorer_2.png\" alt-text=\"Graph Explorer.\" lightbox=\"./assets/images/calls-and-meetings/graph-explorer_2.png\":::\n\n   \n        > [!NOTE]\n        > `TenantId` или `UserId` учетной записи Teams обозначает, откуда вы хотите инициировать вызов, и `DisplayName` `UserId` пользователей, которым вы хотите перенаправить или перенаправить вызов.\n\n1. Замените `MicrosoftAppId`, `ClientId`, идентификатором `AppId` **приложения (клиента),** а `MicrosoftAppPassword`, `ClientSecret`и `AppSecret` **значением .**\n1. Замените `BotBaseUrl` URL-адресом `ngrok` .\n1. Замените `TenantId` и `UserId`.\n1. Замените `DisplayName` и `Id`.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/appsettings_1.png\" alt-text=\"Снимок экрана: Json Appsettings.\":::\n\n1. Нажмите кнопку **Сохранить**.\n\n**Обновление манифеста**\n\n1. В **проводник** перейдите в папку **манифеста** csharp **bot-calling-meeting** > **csharp** >  **Microsoft-Teams-Samples-main** > **samples** > .\n1. Откройте файл `manifest.json` в Visual Studio.\n1. В файле замените `manifest.json` **{id}, {BotId}** идентификатором приложения Майкрософт.\n1. Добавьте URL-адрес ngrok в **validDomains** , за исключением https://.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/manifest_1.png\" alt-text=\"Снимок экрана: манифест.\" lightbox= \"./assets/images/calls-and-meetings/manifest_1.png\" :::\n\n1. Запакуйте содержимое папки **Manifest** , чтобы создать `manifest.zip`.\n\n    > [!NOTE]\n    > Не `manifest.zip` должен содержать никаких дополнительных папок. В zip-папке должен быть `manifest json` исходный файл, `color` значок и `outline` значок.\n    > Отправьте манифест в демонстрационном клиенте для организации или в учетную запись Teams и запустите решение в Visual Studio.\n\n1. Перейдите в Teams.\n1. Чтобы отправить `manifest.zip`, выберите **Приложения > Управление приложениями > Отправить приложение > Отправить пользовательское приложение**.\n\n   :::image type=\"content\" source=\"./assets/images/calls-and-meetings/upload.png\" alt-text=\"Снимок экрана: выбор добавления выходных данных.\":::\n\n1. Откройте `manifest.zip` папку репозитория в проводник.\n1. Выберите **Добавить** , чтобы установить вызывающего бота в Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/output_1.png\" alt-text=\"Снимок экрана: выбор добавления выходных данных.\":::\n\n    Вы можете взаимодействовать с этим ботом после отладки в Visual Studio.\n"
- title: Взаимодействие с ботом для звонков и собраний
  durationInMinutes: 2
  content: "Бот позволяет получать доступ к службам и содержимому в выделенном пространстве в канале или в чате.\n\nЧтобы использовать бот, выполните следующие действия.\n\n1. В левой области Teams выберите многоточие ●●● и выберите свое приложение в списке.\n1. Бот отправляет приветственный текст с помощью адаптивной карточки.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/bot-with-adaptive-card.png\" alt-text=\"Адаптивная карточка в боте.\":::\n\n1. Выберите **Создать звонок**. \n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/placed-call.png\" alt-text=\"Снимок экрана: размещенный вызов.\":::\n\n1. Выберите **Переключить звонок**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/transfer-call.png\" alt-text=\"Снимок экрана: вызов передачи.\":::\n\n1. Вы можете попросить бота запланировать собрание и пригласить участников.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/meeting.png\" alt-text=\"Снимок экрана: бот для собраний.\":::\n"
- title: Выполнение задачи
  durationInMinutes: 1
  content: >
    Вы придумали такие выходные данные?


    :::image type="content" source="./assets/images/calls-and-meetings/final-output.png" alt-text="Окончательные выходные данные.":::
- content: Вы завершили руководство по началу работы с приложением для звонков ботов и собраний для Microsoft Teams.
