### YamlMime:Tutorial
title: Бот для звонков и собраний Teams
metadata:
  title: Бот Teams с звонками и собранием
  description: В этом учебном модуле вы узнаете, как настроить функции звонков и собраний в боте для Teams.
  audience: Developer
  level: Beginner
  ms.date: 02/08/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: bots/calls-and-meetings/registering-calling-bot.md
  nextTutorialTitle: Регистрация бота вызовов
  ms.custom: mvc
  ms.localizationpriority: none
  ms.openlocfilehash: cd6b8664372dd19bdd9a96bb84529d65b0839405
  ms.sourcegitcommit: ac59d469b823b80e65ee6f7be11ec5c365977a1c
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 10/06/2022
  ms.locfileid: "68490782"
items:
- durationInMinutes: 1
  content: >
    Бот для звонков и собраний предоставляет основные функции, такие как создание звонка, присоединение к звонку, передача или перенаправление звонка, присоединение к запланированному собранию и приглашение участников путем интеграции API облачных коммуникаций Graph API.


    Боты могут взаимодействовать с звонками и собраниями Teams с помощью голосовой связи, видео и демонстрации экрана в режиме реального времени. С помощью API Microsoft Graph для звонков и онлайн-собраний приложения Microsoft Teams теперь могут взаимодействовать с пользователями посредством голосовых вызовов и видеосвязи. Эти API позволяют добавлять следующие новые функции:


    * Интерактивный голосовой ответ (IVR).

    * Управление вызовами.

    * Доступ к аудио- и видеопотокам в режиме реального времени, включая общий доступ к классическим приложениям и приложениям.


    Создайте бота и укажите некоторые дополнительные сведения и разрешения для использования этих API Graph в приложении Teams.


    Это пошаговое руководство поможет вам создать бота с функциями звонков и собраний. К концу этого руководства вы сможете получить следующие выходные данные:


    ![Окончательные выходные данные](~/assets/images/calls-and-meetings/final-output.png)
- title: Предварительные требования
  durationInMinutes: 1
  content: "Убедитесь, что вы установите следующие средства и настроите среду разработки:  \n\n | &nbsp; | Установка | Для использования... |\n | --- | --- | --- |\n | **Required** | &nbsp; | &nbsp; |\n | &nbsp; | [Учетная запись разработчика Microsoft 365](/microsoftteams/platform/concepts/build-and-test/prepare-your-o365-tenant) | Доступ к учетной записи Teams с соответствующими разрешениями на установку приложения. |\n | &nbsp; | [Ngrok](https://ngrok.com/download) | Функции приложений Teams (боты для общения, расширения сообщений и входящие веб-перехватчики) требуют входящих подключений. Туннель подключает систему разработки к Teams. Он не требуется для приложений, которые включают только вкладки. Этот пакет устанавливается в каталоге проекта (с помощью npm `devDependencies`). |\n | &nbsp; | [Visual Studio 2022 версии 17.3](https://visualstudio.microsoft.com)<br> Установите одну из следующих двух рабочих нагрузок:<br> • **ASP.NET и веб-разработки** <br> • **Кроссплатформенная разработка .NET Core** | Вы можете установить корпоративную версию в Visual Studio 2022 и установить рабочие нагрузки. |   \n | &nbsp; | [Пакет SDK для .NET Core версии 3.1 (не гостевой учетной записи) ](https://dotnet.microsoft.com/en-us/download) | Настраиваемые привязки для локальной отладки и Azure Functions приложений. Если пакет SDK для .NET 3.1 (или более поздней версии) не установлен глобально, можно установить переносимую версию. |\n | &nbsp; | [Microsoft Teams и учетная запись Teams](https://www.microsoft.com/microsoft-teams/download-app) | Microsoft Teams для совместной работы со всеми пользователями, с которыми вы работаете, с помощью приложений для чата, собраний, зовите и все в одном месте. |\n | &nbsp; | [Windows PowerShell](/microsoftteams/teams-powershell-install) | Установите, выполнив все команды. |\n"
- title: Настройка бота для звонков и собраний
  durationInMinutes: 5
  content: "Зарегистрируйте приложение с помощью регистрации приложения в microsoft Azure-Portal для интеграции с платформа удостоверений Майкрософт и вызовите Microsoft Graph. Выполните следующие действия:\n\n1. Используйте ngrok для создания туннеля к конечным точкам веб-сервера.\n1. Создайте ресурс Azure Bot для регистрации бота в Azure Служба Bot.\n1. Создайте секрет клиента, который включает проверку подлинности единого входа бота.\n1. Создайте политику для демонстрационного пользователя клиента для создания собраний по сети с помощью PowerShell.\n1. Добавьте разрешения API для подчиненных вызовов.\n1. Создание регистрации канала бота в учетной записи Azure.\n1. Добавьте канал Microsoft Teams для развертывания бота в канале Teams.\n1. Добавьте конечную точку обмена сообщениями в созданный туннель ngrok.\n\n**Создайте туннель ngrok:**\n\nИспользуйте ngrok для создания туннеля к общедоступным конечным точкам HTTPS локального веб-сервера. Выполните следующую команду в ngrok:\n\n```bash\nngrok http --host-header=rewrite 3978\n```\n\n**Зарегистрируйте приложение в Azure:**\n\n1. Войдите в Azure-Portal с [помощью](https://portal.azure.com/) личной учетной записи Майкрософт.\n1. Выберите **службу Azure Active Directory**, а затем App-registraties  слева, а затем нажмите кнопку \"Создать **регистрацию\"**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-active-directory.png\" alt-text=\"Azure Active Directory.\":::\n\n1. **Откроется страница регистрации** приложения. Введите сведения о регистрации приложения.\n1. Введите понятное **имя приложения** , отображаемое для пользователей приложения.\n1. В **разделе \"Поддерживаемые типы** учетных записей\" выберите учетные записи, которые должно поддерживать ваше приложение.\n1. В **поле URI перенаправления** (необязательно) выберите тип веб-приложения или общедоступного клиента (мобильный & desktop **)** и введите URI перенаправления для приложения.\n\n    > [!NOTE]\n    > Для веб-приложений укажите базовый URI как `http://localhost:31544`. Для общедоступных клиентских приложений укажите универсальный код ресурса (URI), используемый Azure AD для возврата ответов маркера как `myapp://auth`.\n\n1. Нажмите **Зарегистрировать**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/reg-app.png\" alt-text=\"Снимок экрана: выбор регистра.\":::\n\n**Чтобы создать секрет клиента:**\n\n1. На **странице \"** Обзор\" бота выберите \" **Основные** компоненты\" и сохраните идентификатор клиента **приложения (идентификатор** приложения Майкрософт) для дальнейшей справки.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/microsoft-app-id-new.png\" alt-text=\"Снимок экрана: идентификатор приложения Майкрософт.\":::\n\n1. В **разделе \"** Управление\" **выберите & секретов** , а затем — \"Секреты **клиента** \" и \"Новый **секрет клиента\"**. **Появится окно \"Добавление секрета** клиента\".  \n\n1. Введите **описание** и нажмите **Добавить**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-client.png\" alt-text=\"Снимок экрана: добавляемый секрет клиента.\":::\n\n1. В столбце **Значение** выберите **Копировать в буфер обмена** и сохраните идентификатор секрета клиента для дальнейшего использования.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/client-secret.png\" alt-text=\"Screenshirt, отображающий значение, копируемое в буфер обмена.\":::\n\n**Запустите сценарий PowerShell, чтобы создать политику:**\n\n1. Создайте политику для демонстрационного пользователя клиента для создания собраний по сети с помощью следующего скрипта PowerShell:\n\n    > [!NOTE]\n    > Запустите Windows PowerShell PSI от имени администратора и выполните скрипт.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell-script.png\" alt-text=\"Снимок экрана: сценарий PowerShell.\":::\n\n1. Замените идентификатор приложения **Майкрософт** `object-id` бота и идентификатор клиента вашей учетной  записи, используемой для входа в Teams (скопируйте ссылку, как показано на следующем рисунке, и идентификатор клиента учетной записи Teams можно найти по полученной ссылке).`azure-client-id`\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Снимок экрана: замена Microsoft-App идентификатора.\":::\n\n1. Добавьте `PolicyName`, `azure-client-id`и `policy-description`в `object-id` скрипт PowerShell. Войдите с помощью учетной записи Teams, когда PowerShell предложит.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell.png\" alt-text=\"Снимок экрана: PowerShell.\":::\n\n1. Выполните следующую команду в PowerShell, чтобы проверить, успешно ли создана политика. Замените имя политики на имя определенной политики.\n\n    ```powershell\n    Get-CsApplicationAccessPolicy -Identity “<<policy-identity/policy-name>>”\n    ```\n\n**Чтобы добавить разрешения API для подчиненных вызовов:**\n\n> [!NOTE]\n> Убедитесь, что ваша учетная запись может предоставить согласие администратора для корпорации Майкрософт. После добавления разрешений выберите `Grant admin consent for Microsoft` , чтобы узнать состояние согласия.\n\n1. В **области** \"Управление ботом\" выберите **разрешения API**.\n1. Выберите **Добавить разрешение**. **Появится окно разрешений API** запроса.\n1. Выберите **API Майкрософт** и **Microsoft Graph**.\n1. Выберите **разрешения приложения**, а затем — разрешения.\n1. Добавьте следующие разрешения Graph API applications в Aplicação Azure AD и предоставьте согласие администратора.\n    * `Calls.AccessMedia.All`\n    * `Calls.Initiate.All`\n    * `Calls.InitiateGroupCall.All`\n    * `Calls.JoinGroupCall.All`\n    * `Calls.JoinGroupCallAsGuest.All`\n    * `OnlineMeetings.ReadWrite.All`\n1. Выберите **Добавить разрешения**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-api-permissions.png\" alt-text=\"Снимок экрана: добавление разрешений API.\":::\n\n**Создайте регистрацию канала бота в учетной записи Azure:**\n\n1. Откройте [Azure-Portal](https://portal.azure.com/).\n1. Выберите **Создать ресурс**.\n1. Найдите **Azure Bot** в поле поиска.\n1. Выберите **Azure Bot**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-bot-homepage.png\" alt-text=\"Снимок экрана: домашняя страница бота Azure.\":::\n\n1. Нажмите **Создать**.\n1. Введите имя дескриптора бота в поле **Дескриптор бота**.\n1. Выберите свою **подписку** в раскрывающемся списке.\n1. Выберите существующую  группу ресурсов из раскрывающегося списка или создайте новую, выберите \"Создать **\", введите** имя ресурса, нажмите кнопку \"ОК\" и выберите  нужное расположение в раскрывающемся списке \"Новое расположение группы ресурсов\".\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/create-azure-bot.png\" alt-text=\"Снимок экрана: создание Azure Bot.\":::\n\n1. Для параметра **Тип приложения** выберите **Мультитенантное** в разделе **Идентификатор приложения Майкрософт**.\n\n    > [!NOTE]\n    > В `Creation type` разделе \"Идентификатор приложения `Create new Microsoft App ID` Майкрософт\" уже выбрано создание бота. Вы также можете выбрать `Use existing app registration`, если вы уже зарегистрировали бота. Введите идентификатор приложения Майкрософт в поле `Existing app ID` и введите значение в `Existing app password` поле.\n\n1. Выберите **\"Использовать существующую регистрацию приложения**\" **и введите** идентификатор приложения и секрет приложения Azure, зарегистрированного в демонстрационном клиенте.\n1. Выберите **Проверить и создать**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/review-create.png\" alt-text=\"Снимок экрана: выбор нескольких клиентов.\":::\n\n1. Если проверка пройдена, нажмите **Создать**.\n\n   Подготовка службы бота займет несколько секунд.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/validation.png\" alt-text=\"Снимок экрана, показывающий проход проверки.\":::\n\n1. Выберите пункт **Перейти к ресурсу**. Бот и связанные ресурсы указаны в группе ресурсов.\n\n    Теперь бот Azure создан.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/go-to-resource.png\" alt-text=\"Снимок экрана: навигация для перехода к ресурсу.\":::\n\n**Чтобы добавить канал Microsoft Teams:**\n\n1. Перейдите на **домашнюю страницу**.\n1. Откройте бот, который указан в разделе **Последние ресурсы**.\n1. Выберите **\"Каналы\"** в левой области и выберите **Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/> из списка доступных каналов.    \n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/channels-teams.png\" alt-text=\"Снимок экрана: каналы Teams.\":::\n\n1. Установите флажок, чтобы принять условия обслуживания, и выберите **Принять**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/terms-of-service.png\" alt-text=\"Снимок экрана: условия обслуживания.\":::\n\n1. Нажмите кнопку **Сохранить**.\n1. Выберите **Microsoft Teams и** **вкладку \"Вызовы** \" на странице канала Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/configure-teams.png\" alt-text=\"Настройте Teams.\":::\n\n1. Выберите **\"Включить вызов**\", а затем **обновите веб-перехватчик** , используя URL-адрес ngrok HTTPS (https://yourNgrok/api/callback) и `/api/callback` добавьте его в конце).\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/enable-calling.png\" alt-text=\"Включите вызовы.\":::\n\n1. Нажмите кнопку **Сохранить**.\n\n**Чтобы добавить конечную точку обмена сообщениями:**\n\n1. Перейдите **на домашнюю** страницу бота **и выберите \"** Конфигурация **\" в разделе \"Параметры** \" на левой панели.\n1. Перейдите в ngrok.\n1. Скопируйте URL-адрес HTTPS (https to io), как показано на следующем рисунке:\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/ngrok.png\" alt-text=\"Снимок экрана: окно Ngrok.\":::\n\n1. В **конечной точке обмена** сообщениями добавьте URL-адрес HTTPS, доступный в ngrok, и в конце URL-адреса добавьте **/api/messages**.\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/messaging-endpoint.png\" alt-text=\"Снимок экрана: конечная точка обмена сообщениями.\":::\n\n1. Нажмите **Применить**.\n\n    Вы успешно настроили бот в Azure Служба Bot и теперь вам нужно настроить подключение к службе бота.\n"
- title: Обновление и создание пакета приложений Teams
  durationInMinutes: 1
  content: "Настройте пример бота, чтобы понять, как выполнить проверку подлинности бота для общения в Microsoft Teams, создать пакет приложений Teams и отправить его в организацию.\n\n1. Обновите файл appsettings.json в Visual Studio.\n1. Обновите файл manifest.json в Visual Studio и сжимайте его в ZIP-файл в проводнике.\n\n**Обновите параметры приложений для вызова бота:**\n\n1. Перейдите в репозиторий https://github.com/OfficeDev/Microsoft-Teams-Samples.git.\n1. Выберите **\"Код** \" и выберите раскрывающийся список.\n1. Выберите \" **Скачать ZIP-файл\"**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/repo-download.png\" alt-text=\"Снимок экрана: скачивание репозитория.\":::\n\n1. Обязательно запишите путь скачанного репозитория.\n1. В **проводник** перейдите в папку **csharp** **bot-calling-meeting** >  в **Microsoft-Teams-Samples-main** >  > .\n1. Откройте файл **appsettings.json** в Visual Studio и обновите конфигурацию для бота.\n\n    * Вы можете получить страницу `MicrosoftAppId` конфигурации бота. Значение `MicrosoftAppPassword` для идентификатора секрета клиента, сохраненного ранее.\n    * Вы можете получить ссылку `Tenant ID` или `UserId` по ссылке учетной записи, используемой для входа в Teams. Следуйте пути на изображении, чтобы получить ссылку для `tenant ID`.\n    \n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Снимок экрана: ссылка на Teams.\":::\n    \n    * Вы можете получить сайт `DisplayName` Обозревателя `UserId` [Microsoft Graph и с его](https://developer.microsoft.com/graph/graph-explorer) помощью.\n        * Войдите на страницу с помощью учетной записи Teams `Users` и добавьте ее в конце поля поиска и нажмите кнопку **\"Выполнить запрос\"**.\n        * Создаются отображаемые имена и идентификаторы пользователей, связанные с вашей учетной записью.\n        * Выберите все три учетные записи и добавьте их в `DisplayName` `UserId` файл appsettings.json и в файле appsettings.json.\n\n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/graph-explorer.png\" alt-text=\"Песочницу Graph.\":::\n\n    > [!NOTE]\n    > `Tenant ID` или `UserId` учетная запись Teams указывает, откуда вы хотите инициировать звонок, а также пользователей, `DisplayName` `UserId` которым вы хотите перенаправить или перенести звонок.\n\n1. Замените `MicrosoftAppId`, `AppId` `ClientId`указав **идентификатор приложения (клиента)** `MicrosoftAppPassword`и значение`ClientSecret``AppSecret`.\n1. Обновите `BotBaseUrl` URL-адрес `ngrok` .\n1. Обновление `Tenant ID` и `UserId`.\n1. Обновление `DisplayName` и `UserId`.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/appsettings.png\" alt-text=\"Снимок экрана: JSON Appsettings.\":::\n\n1. Нажмите кнопку **Сохранить**.\n\n**Чтобы обновить манифест, с помощью этой функции можно выполнить следующее:**\n\n1. В **проводник** перейдите в папку **манифеста csharp** > **bot-calling-meeting** >  в Microsoft-Teams-Samples-main >  > .\n1. Откройте файл `manifest.json` в Visual Studio.\n1. В файле `manifest.json` найдите **{id}, {BotId}** и добавьте идентификатор приложения Майкрософт.\n1. Добавьте URL-адрес ngrok в **validDomains** , https:// и сохраните.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/manifest.png\" alt-text=\"Снимок экрана: манифест.\":::\n\n1. Заархивируйте содержимое **папки манифеста** для создания `manifest.zip`.\n\n    > [!NOTE]\n    > В `manifest.zip` нем не должно быть дополнительных папок. Он должен содержать исходный `manifest json` файл, `color` значок и `outline` значок в ZIP-папке.\n    > Отправьте манифест в демонстрационный клиент для организации или учетной записи Teams и запустите решение в Visual Studio.\n\n1. Перейдите в Teams.\n1. Для отправки `manifest.zip`выберите **\"Store > Manage your apps > Upload a custom app** and open `manifest.zip` from the repo folder in File explorer\".\n1. Выберите **\"Добавить\"** , чтобы установить вызывающий бот в Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/output.png\" alt-text=\"Снимок экрана, показывающий выбор добавления выходных данных.\":::\n\n    Вы можете взаимодействовать с этим ботом после отладки в Visual Studio.\n"
- title: Взаимодействие с ботом для звонков и собраний
  durationInMinutes: 2
  content: >
    Бот позволяет получать доступ к службам и содержимому в выделенном пространстве в канале или в чате.


    Чтобы использовать бот, выполните следующие действия:


    1. В левой области Teams щелкните многоточие '''.'' и выберите свое приложение в списке.

    1. Бот отправит приветственное сообщение с адаптивной карточкой, как показано ниже.

        :::image type="content" source="./assets/images/calls-and-meetings/bot-with-adaptive-card.png" alt-text="Адаптивная карточка в боте.":::

    1. Вы можете попросить бота создать звонок.

        :::image type="content" source="./assets/images/calls-and-meetings/placed-call.png" alt-text="Снимок экрана: размещенный вызов.":::

    1. Вы можете попросить бота перенести звонок.

        :::image type="content" source="./assets/images/calls-and-meetings/transfer-call.png" alt-text="Снимок экрана: вызов передачи.":::

    1. Вы можете попросить бота запланировать собрание и пригласить участников.

        :::image type="content" source="./assets/images/calls-and-meetings/meeting.png" alt-text="Снимок экрана: бот собрания.":::
- title: Полный запрос
  durationInMinutes: 1
  content: >
    У вас возникла такая проблема?


    ![Окончательные выходные данные](~/assets/images/calls-and-meetings/final-output.png)
- content: Вы завершили работу с руководством по началу работы с вызовом бота и приложением для собраний для Microsoft Teams.
