### YamlMime:Tutorial
title: Teams звонков и собраний бота
metadata:
  title: Teams бота с звонками и собраниями
  description: В этом модуле обучения вы узнаете, как настроить функции звонков и собраний в боте для Teams.
  audience: Developer
  level: Beginner
  ms.date: 02/08/2021
  ms.topic: interactive-tutorial
  nextTutorialHref: bots/calls-and-meetings/registering-calling-bot.md
  nextTutorialTitle: Регистрация бота вызовов
  ms.custom: mvc
  ms.localizationpriority: none
  ms.openlocfilehash: 2aecacb1068ad3ccb6a65b4e299dd370c9786d87
  ms.sourcegitcommit: 5070746e736edb4ae77cd3efcb2ab8bb2e5819a0
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 06/16/2022
  ms.locfileid: "66123162"
items:
- durationInMinutes: 1
  content: >
    Бот для звонков и собраний предоставляет основные функции, такие как создание звонка, присоединение к звонку, передача или перенаправление звонка, присоединение к запланированному собранию и приглашение участников путем интеграции API облачных коммуникаций API Graph.


    Боты могут взаимодействовать Teams звонками и собраниями с помощью голосовой связи, видео и демонстрации экрана в режиме реального времени. С помощью API Microsoft Graph для звонков и онлайн-собраний приложения Microsoft Teams теперь могут взаимодействовать с пользователями посредством голосовых вызовов и видеосвязи. Эти API позволяют добавлять следующие новые функции:


    * Интерактивный голосовой ответ (IVR).

    * Управление вызовами.

    * Доступ к аудио- и видеопотокам в режиме реального времени, включая общий доступ к классическим приложениям и приложениям.


    Создайте бот и укажите некоторые дополнительные сведения и разрешения для использования этих Graph API в Teams приложения.


    Это пошаговое руководство поможет вам создать бота с функциями звонков и собраний. К концу этого руководства вы сможете получить следующие выходные данные:


    ![Окончательные выходные данные](~/assets/images/calls-and-meetings/final-output.png)
- title: Предварительные требования
  durationInMinutes: 1
  content: "Убедитесь, что вы установите следующие средства и настроите среду разработки:  \n\n* [Office 365 клиента](https://developer.microsoft.com/microsoft-365/dev-program)\n* [Ngrok или](https://ngrok.com/) эквивалентное решение для туннелирования\n* [Visual Studio 2019](https://visualstudio.microsoft.com/downloads/)\n* [.NET core SDK](https://dotnet.microsoft.com/download) версии 3.1\n* Microsoft Teams с учетной записью (а не гостевой учетной записью)\n* Установите [Windows PowerShell](/microsoftteams/teams-powershell-install), выполнив все команды.\n"
- title: Настройка бота для звонков и собраний
  durationInMinutes: 5
  content: "Зарегистрируйте приложение с помощью регистрации приложения на портале Microsoft Azure для интеграции с платформа удостоверений Майкрософт и вызовите Microsoft Graph. Выполните следующие действия:\n\n1. Используйте ngrok для создания туннеля к конечным точкам веб-сервера.\n1. Создайте ресурс Azure Bot для регистрации бота в Azure Служба Bot.\n1. Создайте секрет клиента, который включает проверку подлинности единого входа бота.\n1. Создайте политику для демонстрационного пользователя клиента для создания собраний по сети с помощью PowerShell.\n1. Добавьте разрешения API для подчиненных вызовов.\n1. Создание регистрации канала бота в учетной записи Azure.\n1. Добавьте Microsoft Teams для развертывания бота в Teams канале.\n1. Добавьте конечную точку обмена сообщениями в созданный туннель ngrok.\n\n**Создайте туннель ngrok:**\n\nИспользуйте ngrok для создания туннеля к общедоступным конечным точкам HTTPS локального веб-сервера. Выполните следующую команду в ngrok:\n\n```bash\nngrok http -host-header=rewrite 3978\n```\n\n**Зарегистрируйте приложение в Azure:**\n\n1. Войдите в учетную запись [портал Azure](https://portal.azure.com/) с помощью личной учетной записи Майкрософт.\n1. Выберите **службу Azure Active Directory** **и выберите Регистрация приложений** в области слева, а затем нажмите кнопку \"Создать **регистрацию\"**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-active-directory.png\" alt-text=\"Azure Active Directory.\":::\n\n1. **Откроется страница регистрации** приложения. Введите сведения о регистрации приложения.\n1. Введите понятное **имя приложения** , отображаемое для пользователей приложения.\n1. В **разделе \"Поддерживаемые типы** учетных записей\" выберите учетные записи, которые должно поддерживать ваше приложение.\n1. В **поле URI перенаправления** (необязательно) выберите тип веб-приложения или общедоступного клиента (мобильный & desktop **)** и введите URI перенаправления для приложения.\n\n    > [!NOTE]\n    > Для веб-приложений укажите базовый URI как `http://localhost:31544`. Для общедоступных клиентских приложений укажите универсальный код ресурса (URI), используемый Azure AD для возврата ответов маркера как `myapp://auth`.\n\n1. Нажмите **Зарегистрировать**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/reg-app.png\" alt-text=\"Зарегистрируйте приложение.\":::\n\n**Чтобы создать секрет клиента:**\n\n1. На **странице \"** Обзор\" бота выберите \" **Основные** компоненты\" и сохраните идентификатор клиента **приложения (идентификатор** приложения Майкрософт) для дальнейшей справки.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/microsoft-app-id-new.png\" alt-text=\"Идентификатор приложения Майкрософт.\":::\n\n1. В **разделе \"** Управление\" **выберите & секретов** , а затем — \"Секреты **клиента** \" и \"Новый **секрет клиента\"**. **Появится окно \"Добавление секрета** клиента\".  \n\n1. Введите **описание** и нажмите **Добавить**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-client.png\" alt-text=\"Добавление секрета клиента.\":::\n\n1. В столбце **Значение** выберите **Копировать в буфер обмена** и сохраните идентификатор секрета клиента для дальнейшего использования.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/client-secret.png\" alt-text=\"Значение.\":::\n\n**Запустите сценарий PowerShell, чтобы создать политику:**\n\n1. Создайте политику для демонстрационного пользователя клиента для создания собраний по сети с помощью следующего скрипта PowerShell:\n\n    > [!NOTE]\n    > Запустите Windows PowerShell PSI от имени администратора и выполните скрипт.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell-script.png\" alt-text=\"Сценарий PowerShell.\":::\n\n1. Замените идентификатор приложения **Майкрософт** `object-id` бота и идентификатор клиента вашей учетной  записи, используемой для входа в Teams (скопируйте ссылку, как показано на следующем рисунке, и вы можете найти идентификатор клиента учетной записи Teams по полученной ссылке).`azure-client-id`\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Teams Link.\":::\n\n1. Добавьте `PolicyName`, `azure-client-id`и `policy-description`в `object-id` скрипт PowerShell. Войдите с помощью Teams учетной записи при появлении запроса PowerShell.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/powershell.png\" alt-text=\"Powershell.\":::\n\n1. Выполните следующую команду в PowerShell, чтобы проверить, успешно ли создана политика. Замените имя политики на имя определенной политики.\n\n    ```powershell\n    Get-CsApplicationAccessPolicy -Identity “<<policy-identity/policy-name>>”\n    ```\n\n**Чтобы добавить разрешения API для подчиненных вызовов:**\n\n> [!NOTE]\n> Убедитесь, что ваша учетная запись может предоставить согласие администратора для корпорации Майкрософт. После добавления разрешений выберите `Grant admin consent for Microsoft` , чтобы узнать состояние согласия.\n\n1. В **области** \"Управление ботом\" выберите **разрешения API**.\n1. Выберите **Добавить разрешение**. **Появится окно разрешений API** запроса.\n1. Выберите **API Майкрософт** и выберите **Microsoft Graph**.\n1. Выберите **разрешения приложения** , а затем — разрешения.\n1. Добавьте следующие API Graph applications в приложение Azure и предоставьте согласие администратора.\n    * `Calls.AccessMedia.All`\n    * `Calls.Initiate.All`\n    * `Calls.InitiateGroupCall.All`\n    * `Calls.JoinGroupCall.All`\n    * `Calls.JoinGroupCallAsGuest.All`\n    * `OnlineMeetings.ReadWrite.All`\n1. Выберите **Добавить разрешения**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/add-api-permissions.png\" alt-text=\"Добавление разрешений API.\":::\n\n**Создайте регистрацию канала бота в учетной записи Azure:**\n\n1. Откройте [портал Azure](https://portal.azure.com/).\n1. Выберите **Создать ресурс**.\n1. Найдите **Azure Bot** в поле поиска.\n1. Выберите **Azure Bot**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/azure-bot-homepage.png\" alt-text=\"Карточка бота Azure.\":::\n\n1. Нажмите **Создать**.\n1. Введите имя дескриптора бота в поле **Дескриптор бота**.\n1. Выберите свою **подписку** в раскрывающемся списке.\n1. Выберите свою **группу ресурсов** в раскрывающемся списке.\n\n    Чтобы создать группу ресурсов, выберите \"Создать **\", введите** имя ресурса, нажмите кнопку **\"** ОК\" и выберите  необходимое расположение в раскрывающемся списке \"Новое расположение группы ресурсов\".\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/create-azure-bot.png\" alt-text=\"Создайте Azure Bot.\":::\n\n1. Для параметра **Тип приложения** выберите **Мультитенантное** в разделе **Идентификатор приложения Майкрософт**.\n\n    > [!NOTE]\n    > В `Creation type` разделе \"Идентификатор приложения `Create new Microsoft App ID` Майкрософт\" уже выбрано создание бота. Вы также можете выбрать `Use existing app registration`, если вы уже зарегистрировали бота. Введите идентификатор приложения Майкрософт в поле `Existing app id` и введите значение в `Existing app password` поле.\n\n1. Выберите **\"Использовать существующую регистрацию приложения**\" **и введите** идентификатор приложения и секрет приложения Azure, зарегистрированного в демонстрационном клиенте.\n1. Выберите **Проверить и создать**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/review-create.png\" alt-text=\"Мультитенантный.\":::\n\n1. Если проверка пройдена, нажмите **Создать**.\n\n   Подготовка службы бота займет несколько секунд.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/validation.png\" alt-text=\"Проверка.\":::\n\n1. Выберите пункт **Перейти к ресурсу**. Бот и связанные ресурсы указаны в группе ресурсов.\n\n    Теперь бот Azure создан.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/go-to-resource.png\" alt-text=\"Перейти к ресурсу.\":::\n\n**Чтобы добавить канал Microsoft Teams:**\n\n1. Перейдите на **домашнюю страницу**.\n1. Откройте бот, который указан в разделе **Последние ресурсы**.\n1. Выберите **\"Каналы**\" в левой области **и выберите Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/> из списка доступных каналов.    \n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/channels-teams.png\" alt-text=\"Каналы Teams.\":::\n\n1. Установите флажок, чтобы принять условия обслуживания, и выберите **Принять**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/terms-of-service.png\" alt-text=\"Условия обслуживания.\":::\n\n1. Нажмите **Сохранить**.\n1. Выберите **Microsoft Teams** и **вкладку \"** Вызов\" на Teams канале.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/configure-teams.png\" alt-text=\"Настройте Teams.\":::\n\n1. Выберите **\"Включить вызов**\", а затем **обновите веб-перехватчик** , используя URL-адрес ngrok HTTPS (https://yourNgrok/api/callback) и `/api/callback` добавьте его в конце).\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/enable-calling.png\" alt-text=\"Включите вызовы.\":::\n\n1. Нажмите **Сохранить**.\n\n**Чтобы добавить конечную точку обмена сообщениями:**\n\n1. Перейдите **на домашнюю** страницу бота и  выберите \"**Конфигурация Параметры** в области слева.\n1. Перейдите в ngrok.\n1. Скопируйте URL-адрес HTTPS (https to io), как показано на следующем рисунке:\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/ngrok.png\" alt-text=\"Ngrok.\":::\n\n1. В **конечной точке обмена** сообщениями добавьте URL-адрес HTTPS, доступный в ngrok, и в конце URL-адреса добавьте **/api/messages**.\n    \n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/messaging-endpoint.png\" alt-text=\"Конечная точка обмена сообщениями.\":::\n\n1. Нажмите **Применить**.\n\n    Вы успешно настроили бот в Azure Служба Bot и теперь вам нужно настроить подключение к службе бота.\n"
- title: Обновление и создание Teams приложения
  durationInMinutes: 1
  content: "Настройте пример бота, чтобы понять, как выполнить проверку подлинности чат-бота в Microsoft Teams создать пакет Teams и отправить его в организацию.\n\n1. Обновите файл appsettings.json в Visual Studio.\n1. Обновите файл manifest.json в Visual Studio и сжимайте его в ZIP-файл в проводнике.\n\n**Обновите параметры приложений для вызова бота:**\n\n1. Перейдите в репозиторий https://github.com/OfficeDev/Microsoft-Teams-Samples.git.\n1. Выберите **\"Код** \" и выберите раскрывающийся список.\n1. Выберите \" **Скачать ZIP-файл\"**.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/repo-download.png\" alt-text=\"Скачивание репозитория.\":::\n\n1. Обязательно запишите путь скачанного репозитория.\n1. В **проводник** перейдите в папку **microsoft-Teams-Samples-main** > **samples** > **bot-calling-meeting** > **csharp**.\n1. Откройте файл **appsettings.json** в Visual Studio и обновите конфигурацию для бота.\n\n    * Вы можете получить страницу `MicrosoftAppId` конфигурации бота. Значение `MicrosoftAppPassword` для идентификатора секрета клиента, сохраненного ранее.\n    * Вы можете получить ссылку `Tenant ID` учетной `UserId` записи, используемой для входа в Teams. Следуйте пути на изображении, чтобы получить ссылку для `tenant id`.\n    \n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/teams-link-new.png\" alt-text=\"Teams Link.\":::\n    \n    * Вы можете получить сайт `DisplayName` `UserId` [Microsoft Graph Explorer и с его помощью](https://developer.microsoft.com/graph/graph-explorer).\n        * Войдите на страницу с помощью Teams `Users` учетной записи и добавьте в конце клавиши URL в поле поиска и выберите \"Выполнить **запрос\"**.\n        * Создаются отображаемые имена и идентификаторы пользователей, связанные с вашей учетной записью.\n        * Выберите все три учетные записи и добавьте их в `DisplayName` `UserId` файл appsettings.json и в файле appsettings.json.\n\n        :::image type=\"content\" source=\"./assets/images/calls-and-meetings/graph-explorer.png\" alt-text=\"Graph Explorer.\":::\n\n    > [!NOTE]\n    > `Tenant ID`или `UserId` учетная запись Teams указывает, откуда вы хотите инициировать звонок, а также пользователей, `DisplayName` `UserId` которым вы хотите перенаправить или перенести звонок.\n\n1. Замените `MicrosoftAppId`, `AppId` `ClientId`указав **идентификатор приложения (клиента)** `MicrosoftAppPassword`и значение`ClientSecret``AppSecret`.\n1. Обновите `BotBaseUrl` URL-адрес `ngrok` .\n1. Обновление `Tenant ID` и `UserId`.\n1. Обновление `DisplayName` и `UserId`.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/appsettings.png\" alt-text=\"Appsettings Json.\":::\n\n1. Нажмите **Сохранить**.\n\n**Чтобы обновить манифест, с помощью этой функции можно выполнить следующее:**\n\n1. В **проводник перейдите** к папке манифеста **CSHARP** > **bot-calling-meeting** >  в **Microsoft-Teams-Samples-main** >  > .\n1. Откройте файл `manifest.json` в Visual Studio.\n1. В файле `manifest.json` найдите **{id}, {BotId}** и добавьте идентификатор приложения Майкрософт.\n1. Добавьте URL-адрес ngrok в **validDomains** , https:// и сохраните.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/manifest.png\" alt-text=\"Манифеста.\":::\n\n1. Заархивируйте содержимое **папки манифеста** для создания `manifest.zip`.\n\n    > [!NOTE]\n    > В `manifest.zip` нем не должно быть дополнительных папок. Он должен содержать исходный `manifest json` файл, `color` значок и `outline` значок в ZIP-папке.\n    > Отправьте манифест в демонстрационный клиент для организации или учетной записи Teams и запустите решение в Visual Studio.\n\n1. Перейдите к Teams.\n1. Для отправки `manifest.zip`выберите **\"Store > Manage your apps > Upload a custom app** and open `manifest.zip` from the repo folder in File explorer\".\n1. Выберите **\"Добавить\"**, чтобы установить вызывающий бот в Teams.\n\n    :::image type=\"content\" source=\"./assets/images/calls-and-meetings/output.png\" alt-text=\"Добавление выходных данных.\":::\n\n    Вы можете взаимодействовать с этим ботом после отладки в Visual Studio.\n"
- title: Взаимодействие с ботом для звонков и собраний
  durationInMinutes: 2
  content: >
    Бот позволяет получать доступ к службам и содержимому в выделенном пространстве в канале или в чате.


    Чтобы использовать бот, выполните следующие действия:


    1. В левой области окна Teams щелкните многоточие '''.'' и выберите свое приложение в списке.

    1. Бот отправит приветственное сообщение с адаптивной карточкой, как показано ниже.

        :::image type="content" source="./assets/images/calls-and-meetings/bot-with-adaptive-card.png" alt-text="Адаптивная карточка в боте.":::

    1. Вы можете попросить бота создать звонок.

        :::image type="content" source="./assets/images/calls-and-meetings/placed-call.png" alt-text="Размещенный звонок.":::

    1. Вы можете попросить бота перенести звонок.

        :::image type="content" source="./assets/images/calls-and-meetings/transfer-call.png" alt-text="Переключить звонок.":::

    1. Вы можете попросить бота запланировать собрание и пригласить участников.

        :::image type="content" source="./assets/images/calls-and-meetings/meeting.png" alt-text="Бот для собраний.":::
- title: Полный запрос
  durationInMinutes: 1
  content: >
    У вас возникла такая проблема?


    ![Окончательные выходные данные](~/assets/images/calls-and-meetings/final-output.png)
- content: Вы завершили работу с руководством по началу работы с вызовом бота и приложением для собраний для Microsoft Teams.
