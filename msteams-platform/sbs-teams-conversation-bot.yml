### YamlMime:Tutorial
title: Создание бота беседы Teams
metadata:
  title: Создание бота беседы Teams
  description: В этом модуле обучения вы узнаете, как создать простой бот беседы в приложении Microsoft Teams.
  audience: Developer
  level: Beginner
  ms.date: 04/01/2022
  ms.topic: interactive-tutorial
  nextTutorialHref: bots/how-to/conversations/channel-and-group-conversations.md
  nextTutorialTitle: Беседы с бото в канале и групповом чате
  ms.custom: mvc
  ms.localizationpriority: none
  ms.openlocfilehash: 0ffb1072424e60c5625ccd0d38f223c5e7643c9e
  ms.sourcegitcommit: 6926cf5eee55d5047c11ca13afc7f6f23e270396
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 10/27/2022
  ms.locfileid: "68740634"
items:
- durationInMinutes: 1
  content: >
    Боты для бесед Teams позволяют пользователям взаимодействовать с веб-службой с помощью текста, интерактивных карточек и модулей задач. Основные беседы обрабатываются через соединитель Bot Framework, один REST API. Этот API позволяет боту взаимодействовать с Teams и другими каналами. Пакет SDK Bot Builder предоставляет следующие возможности:


    * Простой доступ к соединителю Bot Framework.

    * Дополнительные функции для управления потоком и состоянием беседы.

    * Простые способы внедрения когнитивных служб, такие как обработка естественного языка (NLP).


    При первом добавлении бота в группу или команду отправляется вводное сообщение. В сообщении содержится краткое описание функций бота и способы их использования.


    Это пошаговое руководство поможет вам создать простой бот беседы в приложении Teams. Вы увидите следующие выходные данные:


    :::image type="content" source="./assets/images/conversation-bot/final-output.png" alt-text="Окончательные выходные данные."lightbox="assets/images/conversation-bot/final-output.png":::
- title: Предварительные требования
  durationInMinutes: 1
  content: "Чтобы настроить среду разработки, установите следующие средства:\n\n| &nbsp; | Установка | Для использования... |\n | --- | --- | --- |\n | **Required** | &nbsp; | &nbsp; |\n | &nbsp; | [Учетная запись разработчика Microsoft 365](/microsoftteams/platform/concepts/build-and-test/prepare-your-o365-tenant) | Доступ к учетной записи Teams с соответствующими разрешениями для установки приложения. |\n | &nbsp; | [Ngrok](https://ngrok.com/download) | Функции приложений Teams (диалоговые боты, расширения сообщений и входящие веб-перехватчики) требуют входящих подключений. Туннель соединяет систему разработки с Teams. Он не требуется для приложений, которые содержат только вкладки. Этот пакет устанавливается в каталоге проекта (с помощью npm `devDependencies`). |\n | &nbsp; | [Visual Studio 2022 версии 17.3](https://visualstudio.microsoft.com)<br> Установите одну из следующих двух рабочих нагрузок:<br> • **разработка ASP.NET и веб-приложений** <br> • **Кроссплатформенная разработка .NET Core** | Вы можете установить корпоративную версию в Visual Studio 2022 и установить рабочие нагрузки. |   \n | &nbsp; | [Пакет SDK для .NET Core версии 3.1](https://dotnet.microsoft.com/en-us/download) | Настраиваемые привязки для локальной отладки и Функции Azure развертываний приложений. Если вы не установили пакет SDK для .NET 3.1 (или более поздней версии) глобально, можно установить переносимую версию. |\n | &nbsp; | [Microsoft Teams и учетная запись Teams](https://www.microsoft.com/microsoft-teams/download-app) | Microsoft Teams для совместной работы со всеми, с кем вы работаете, с помощью приложений для чата, собраний, звонков и всех в одном месте. |\n"
- title: Настройка бота для общения
  durationInMinutes: 5
  content: "Регистрация бота в службе бота Azure при разработке и размещении в Azure. Выполните следующие действия:\n\n1. Используйте ngrok для создания туннеля к конечным точкам веб-сервера.\n1. Создайте регистрацию канала бота в учетной записи Azure.\n1. Создайте секрет клиента, который обеспечивает проверку подлинности бота с единым входом.\n1. Добавьте разрешения API для подчиненных вызовов.\n1. Добавьте конечную точку обмена сообщениями в созданный туннель ngrok.\n1. Добавьте канал Microsoft Teams для развертывания бота в канале Teams.\n\n**Создание туннеля ngrok**\n\nИспользуйте ngrok, чтобы создать туннель к общедоступным конечным точкам HTTPS локально работающего веб-сервера. Выполните следующую команду в ngrok:\n\n```bash\nngrok http --host-header=rewrite 3978\n```\n\n**Создание регистрации канала Bot в учетной записи Azure**\n\n1. Доступ к [портал Azure](https://portal.azure.com/).\n1. Выберите **Создать ресурс**.\n1. Найдите **Azure Bot** в поле поиска.\n1. Выберите **Azure Bot**.\n\n    :::image type=\"content\" source=\"./assets/images/azure-bot.png\" alt-text=\"Бот Azure.\":::\n\n1. Нажмите **Создать**.\n1. Введите имя дескриптора бота в поле **Дескриптор бота**.\n1. Выберите свою **подписку** в раскрывающемся списке.\n1. Выберите существующую **группу ресурсов** из раскрывающегося списка или создайте новую группу ресурсов, щелкните **Создать**, введите имя ресурса, нажмите **кнопку ОК** и выберите требуемое расположение в раскрывающемся списке **Новое расположение группы ресурсов** .\n1. Выберите **обязательное расположение данных (предварительная версия).**\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/create-azure-bot.png\" alt-text=\"Создание бота Azure.\":::\n\n1. Для параметра **Тип приложения** выберите **Мультитенантное** в разделе **Идентификатор приложения Майкрософт**.\n\n    > [!NOTE]\n    > В разделе **Тип создания** идентификатора приложения Майкрософт для создания бота уже выбран параметр **Создать идентификатор приложения Майкрософт** . Вы также можете **выбрать Использовать существующую регистрацию приложения**, если вы уже зарегистрировали бота. Введите Идентификатор приложения Майкрософт в поле **Существующий идентификатор приложения** и введите значение в поле **Существующий пароль приложения** . \n1. Выберите **Проверить и создать**.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/review-create.png\" alt-text=\"Просмотр и создание.\":::\n\n1. Выберите **Создать**, если проверка пройдена. Подготовка службы бота займет несколько секунд.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/validation-passed.png\" alt-text=\"Проверка бота.\":::\n\n1. Выберите пункт **Перейти к ресурсу**. Бот и связанные ресурсы указаны в группе ресурсов.\n\n    Теперь бот Azure создан.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/go-to-resource.png\" alt-text=\"Перейдите к карточке ресурсов.\":::\n\n**Создание секрета клиента**\n\n1. В разделе **Параметры** выберите **Конфигурация**. Сохраните **Идентификатор приложения Майкрософт** (идентификатор клиента) для дальнейшего использования.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/microsoft-app-id.png\" alt-text=\"Идентификатор приложения Майкрософт.\":::\n\n1. Выберите **Управление** рядом с **идентификатором приложения Майкрософт**.\n\n   :::image type=\"content\" source=\"~/assets/images/manage-bot-label.png\" alt-text=\"управление ботом\":::\n\n1. В разделе **Секреты клиента** выберите **Новый секрет клиента**. Откроется окно **Добавление секрета клиента** .  \n\n    :::image type=\"content\" source=\"./assets/images/meetings-side-panel/newclientsecret.png\" alt-text=\"Новый секрет клиента.\":::\n\n1. Введите **описание** и нажмите **Добавить**.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/add-client-secret.png\" alt-text=\"Добавьте секрет клиента.\":::\n\n1. Выберите **Копировать в буфер обмена** в столбце **Значение** и сохраните идентификатор секрета клиента для дальнейшего использования.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/value.png\" alt-text=\"Карточка значения.\":::\n\n**Добавление разрешений API для подчиненных вызовов**\n\n1. В области **Управление** ботом выберите **Разрешения API**.\n1. Выберите **Добавить разрешение**. Откроется окно **разрешения API запроса**.\n1. Выберите **Api Майкрософт** и **Microsoft Graph**.\n1. Выберите **Разрешения приложения**, а затем разрешения.\n1. Добавьте все разрешения пользователя, необходимые приложению для подчиненных API, например `User.Read`.\n1. Выберите **Добавить разрешения**.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/api-permissions.png\" alt-text=\"Добавление разрешений API.\"lightbox=\"assets/images/conversation-bot/api-permissions.png\":::\n\n**Добавление конечной точки обмена сообщениями**\n\n1. Перейдите на **домашнюю** страницу бота и выберите **Конфигурация** в разделе **Параметры** в области слева.\n1. Перейдите в ngrok.\n1. Скопируйте URL-адрес HTTPS (https to io), как показано на следующем рисунке:\n    \n   :::image type=\"content\" source=\"../msteams-platform/assets/images/ngrok-url.png\" alt-text=\"URL-адрес HTTPS ngrok\":::\n   \n1. В **конечной точке обмена сообщениями** добавьте URL-адрес HTTPS, доступный из ngrok, а в конце URL-адреса добавьте **/api/messages**.\n    \n    :::image type=\"content\" source=\"./assets/images/conversation-bot/messaging-endpoint.png\" alt-text=\"Конечная точка обмена сообщениями.\":::\n\n1. Нажмите **Применить**.\n\n**Добавление канала Microsoft Teams**\n\n1. Перейдите на **домашнюю страницу**.\n1. В разделе **Последние ресурсы** откройте бот.\n1. Выберите **Каналы** в области слева и **Выберите Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/> из списка доступных каналов.    \n    \n    :::image type=\"content\" source=\"~/assets/images/adaptive-cards/channel-teams.png\" alt-text=\"Выбор Teams в каналах\":::\n\n1. Установите флажок, чтобы принять условия обслуживания, и выберите **Принять**.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/terms-of-service.png\" alt-text=\"Условия предоставления услуг.\":::\n\n1. Нажмите кнопку **Сохранить**.\n\n    Вы успешно настроили бот в Azure Служба Bot, и теперь вам нужно настроить подключение к службе бота.\n"
- title: Настройка подключения к службе бота
  durationInMinutes: 1
  content: "Настройте пример бота, чтобы понять, как проверить подлинность бота для бесед в Microsoft Teams и создать пакет приложения Teams и отправить его в организацию.\n\n1. Обновление appsettings.json в Visual Studio.\n1. Обновите файл manifest.json в Visual Studio и сожмите его в ZIP-файл в проводник.\n1. Запустите решение в Visual Studio.\n1. Отправьте бота в Teams.\n\n**Обновление приложений для бота беседы**\n\n1. Перейдите в репозиторий https://github.com/Microsoft/botbuilder-samples.git.\n1. Выберите **Код** и выберите раскрывающийся список.\n1. Выберите **Скачать ZIP-файл**.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/repo.png\" alt-text=\"Клонирование репозитория.\":::\n\n1. Обязательно запишите путь к скачанму репозиторию.\n1. В **проводник** перейдите к **botbuilder-samples** >  > **csharp_dotnetcore** > **57.teams-conversation-bot**.\n1. Откройте файл **appsettings.json** в Visual Studio и обновите конфигурацию для бота.\n\n    * Добавьте имя бота для `MicrosoftAppType`.\n    * Вы можете получить на `MicrosoftAppId` странице конфигурации бота. — `MicrosoftAppPassword` это значение для идентификатора секрета клиента, сохраненное ранее.\n    * Вы можете получить `MicrosoftAppTenantId` или `UserId` по ссылке учетной записи, используемой для входа в Teams. Следуйте по пути на изображении, чтобы получить ссылку для `tenant id`:\n    \n        :::image type=\"content\" source=\"./assets/images/conversation-bot/teams-link-new.png\" alt-text=\"Путь к идентификатору клиента в Teams.\":::\n\n        :::image type=\"content\" source=\"./assets/images/conversation-bot/tenant-id.png\" alt-text=\"Скопируйте ссылку Teams.\":::\n\n        Скопируйте идентификатор клиента из URL-адреса.\n\n        :::image type=\"content\" source=\"./assets/images/conversation-bot/url-tenantid.png\" alt-text=\"TenantID.\":::\n\n1. Нажмите кнопку **Сохранить**.    \n    \n    :::image type=\"content\" source=\"./assets/images/conversation-bot/appsettings.png\" alt-text=\"Appsettings Json.\":::\n\n**Обновление манифеста**\n\n1. В **проводник** перейдите к **botbuilder-samples** >  > **csharp_dotnetcore** > **57.teams-conversation-bot** > **TeamsAppManifest**.\n1. Откройте файл **manifest.json** в Visual Studio.\n1. В файле **manifest.json** найдите **{id}, {botId}** и добавьте идентификатор приложения Майкрософт.\n1. Добавьте URL-адрес ngrok в **допустимые домены** , исключая и сохраняя `https://` .\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/manifest.png\" alt-text=\"Манифеста.\":::\n\n1. Запакуйте содержимое папки **TeamsAppManifest** , чтобы создать **manifest.zip**.\n\n    > [!NOTE]\n    > Объект `manifest.zip` не должен содержать никаких дополнительных папок. В zip-папке должен быть `manifest json` исходный файл, `color` значок и `outline` значок.\n    > Запустите решение в Visual Studio и отправьте манифест в демонстрационном клиенте для организации или в учетную запись Teams.\n\n**Запуск решения в Visual Studio**\n\n1. Откройте Visual Studio.\n1. Выберите **Файл** и **нажмите кнопку Открыть**.\n1. Выберите **Проект или решение**, `.csproj` чтобы открыть файл из проводник.\n1. Перейдите к **botbuilder-samples** >  > **csharp_dotnetcore** > **57.teams-conversation-bot**.\n1. Выберите `TeamsConversationBot.csproj` файл и выберите бота в списке **Запускаемые проекты** .\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/visual-studio.png\" alt-text=\"Отладка Visual Studio.\":::\n\n1. Выберите F5 для отладки. Когда бот будет готов, появится экран подтверждения.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/bot.png\" alt-text=\"Экран готовности бота.\":::\n\n**Отправка приложения в Teams**\n\n1. Перейдите в Teams.\n1. Чтобы отправить **manifest.zip**, выберите **Store > Управление приложениями > Отправить пользовательское приложение** и откройте **manifest.zip** из репозитория в проводник.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/upload-manifest.png\" alt-text=\"Отправка манифеста в Teams.\":::\n\n1. Выберите **Добавить** , чтобы установить бот беседы в Teams.\n\n    :::image type=\"content\" source=\"./assets/images/conversation-bot/add-app-teams.png\" alt-text=\"Добавление приложения в Teams.\":::\n\n    Вы можете взаимодействовать с этим ботом сейчас.\n"
- title: Взаимодействие с ботом беседы
  durationInMinutes: 2
  content: >
    Вы можете взаимодействовать с ботом в Teams, отправив ему сообщение или выбрав команду из списка команд. Бот отвечает на следующие строки:


    В левой области Teams выберите многоточие ●●●,а затем выберите свое приложение из списка. Бот отображает **предложения** следующим образом:


    :::image type="content" source="./assets/images/conversation-bot/suggestions.png" alt-text="Карточка предложений.":::


    | MentionMe    | Показать приветствие   | MessageAllMembers |

    | --- | --- | --- |

    | :::image type="content" source="./assets/images/conversation-bot/mentionme-new.png" alt-text="Карточка упоминания"lightbox="assets/images/conversation-bot/mentionme-new.png"::: | :::image type="content" source="./assets/images/conversation-bot/show-welcome-new.png" alt-text="Показать карточку приветствия"lightbox="assets/images/conversation-bot/show-welcome-new.png"::: | :::image type="content" source="./assets/images/conversation-bot/message-all-members-new.png" alt-text="Карточка MessageAllMembers"lightbox="assets/images/conversation-bot/message-all-members-new.png"::: |

    | **Результат:** Бот отвечает на сообщение и упоминает пользователя. | **Результат:** Бот отправляет карточку приветствия, с которым вы будете взаимодействовать. |  **Результат:** Бот отправляет 1-на-один сообщение каждому участнику текущей беседы. |

    | **Допустимые области:** личный, групповой чат, командный чат. | **Допустимые области:** личный, групповой чат, командный чат. |  **Допустимые области:** личный, групповой чат, командный чат. |


    Вы можете выбрать параметр из списка команд, введя **@TeamsConversationBot** в область создания сообщения и **текст Что делать?** над областью создания.
- title: Выполнение задачи
  durationInMinutes: 1
  content: >
    Ты придумала что-то вроде этого?


    :::image type="content" source="./assets/images/conversation-bot/final-output.png" alt-text="Окончательные выходные данные."lightbox="assets/images/conversation-bot/final-output.png":::
- content: Вы завершили учебник, чтобы приступить к работе с ботом беседы для Microsoft Teams.
