---
title: Использование Набора средств Teams для подготовки облачных ресурсов с помощью Набора средств Teams для Visual Studio
author: surbhigupta
description: В этом модуле вы узнаете, как подготовить облачные ресурсы с помощью Набора средств Teams. Также для создания ресурсов и настройки подготовки ресурсов в Visual Studio
ms.author: v-amprasad
ms.localizationpriority: medium
ms.topic: overview
ms.date: 11/29/2021
ms.openlocfilehash: 00e021e3e42eed6eeb5881d258a9884a7e579377
ms.sourcegitcommit: 65ae3ccc2312ddc6cdaa05096e30bdf9dca10c3f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2022
ms.locfileid: "68027497"
---
# <a name="provision-cloud-resources-using-visual-studio"></a>Подготовка облачных ресурсов с помощью Visual Studio

TeamsFx интегрируется с облаком Azure и Microsoft 365, что позволяет разместить приложение в Azure с помощью одной команды. TeamsFx интегрируется с Azure Resource Manager, что позволяет подготавливать ресурсы Azure. Для подхода к коду приложению требуются облачные ресурсы.

## <a name="prerequisites"></a>Предварительные требования

Ниже приведен список средств, необходимых для подготовки облачных ресурсов.

| &nbsp; | Установка | Для использования... |
| --- | --- | --- |
| &nbsp; | **Required** | &nbsp; |
| &nbsp; | Visual Studio 2022 версии 17.3 | Вы можете установить корпоративный выпуск Visual Studio и установить рабочую нагрузку ASP.NET и средства разработки Microsoft Teams. |
| &nbsp; | [Учетная запись разработчика Microsoft 365](https://developer.microsoft.com/en-us/microsoft-365/dev-program) | Доступ к учетной записи Teams с соответствующими разрешениями на установку приложения. |
| &nbsp; | [Microsoft Teams](https://www.microsoft.com/microsoft-teams/download-app) | Microsoft Teams для взаимодействия в одном месте со всеми пользователями, с которыми вы работаете, с помощью приложений для чата, собраний и звонков. |
| &nbsp; | Набор средств Teams | Расширение Visual Studio, которое создает шаблон проекта для вашего приложения. Используйте последнюю версию. |
| &nbsp; | [Учетная запись Azure](https://portal.azure.com/) | Учетная запись Azure с действительной подпиской. |

## <a name="steps-to-provision-cloud-resources"></a>Действия по подготовке облачных ресурсов

Следующие шаги помогут вам подготовить облачные ресурсы с помощью Visual Studio:

### <a name="sign-in-to-your-microsoft-365-account"></a>Вход в учетную запись Microsoft 365

1. Visual Studio 2022.
2. Откройте проект приложения Microsoft Teams.
3. Выберите **"Проект"**.
4. Выберите **Набор средств Teams**.
5. Выберите **"Подготовка зависимостей приложений Teams"**.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-prepare-app-dependencies.png" alt-text="Подготовка зависимостей приложений teams":::

7. Выберите **"Войти...** ", чтобы войти в свою учетную запись Azure.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-prepare1.png" alt-text="Вход в Microsoft 365":::

    > [!NOTE]
    > Если вы уже вошли в систему, отобразится имя пользователя или вы можете выбрать то же самое, чтобы переключить учетную запись.

8. Откроется веб-браузер по умолчанию, позволяющий [войти в](https://developer.microsoft.com/en-us/microsoft-365/dev-program) учетную запись.
9. Нажмите **кнопку "** Продолжить" после входа в учетную запись.

    :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-signin-M365.png" alt-text="Подтвердите, выбрав &quot;Продолжить&quot;.":::

### <a name="sign-in-to-your-azure-account"></a>Вход в учетную запись Azure

1. Откройте Visual Studio 2022.
2. Откройте проект приложения Teams.
3. Выберите **"Проект"**.
4. Выберите **Набор средств Teams**.
5. Выберите **"Подготовка в облаке"**.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-provision-in-cloud.png" alt-text="Вход в учетную запись Azure":::

6. Выберите **"Войти...** ", чтобы войти в свою учетную запись Azure.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-provision-start.png" alt-text="Вход в учетную запись Azure":::

   > [!NOTE]
   > Если вы уже вошли в систему, отобразится имя пользователя или вы можете переключить учетную запись.

7. Войдите в учетную запись Azure, используя свои учетные данные. Браузер закрывается автоматически.

### <a name="to-provision-cloud-resources"></a>Подготовка облачных ресурсов

1. После открытия проекта в Visual Studio выберите **проект**
2. Выбор **набора средств Teams**
3. Выберите **"Подготовка в облаке"**.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-provision-in-cloud1.png" alt-text="Подготовка в облаке":::

4. В **диалоговом** окне "Подготовка" вы увидите список всех подписок в учетной записи Azure.
5. Вы можете выбрать или создать новую **группу ресурсов**.
6. Выберите **"Подготовка"**.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-provision-select-subscription1.png" alt-text="Выбор группы ресурсов":::

7. В диалоговом окне выводится предупреждение о том, что плата может быть добавлена в соответствии с использованием Azure. Выберите **"Подготовка"**.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-provision-warning.png" alt-text="Предупреждение о подготовке":::

   Процесс подготовки ресурсов в облаке Azure может занять некоторое время.

8. Проверьте окно вывода Набора средств Teams, чтобы отслеживать ход выполнения.
9. После завершения подготовки появится запрос. Выберите **"Просмотреть подготовленные ресурсы** ", чтобы просмотреть все подготовленные ресурсы.

   :::image type="content" source="../assets/images/Tools-and-SDK-revamp/Provision-cloud-resources-in-TTK-VS/teams-toolkit-vs-provision-provision-success.png" alt-text="Просмотр подготовленных ресурсов":::

### <a name="create-resources"></a>Создание ресурсов

При активации команды подготовки в Teams Toolkit или TeamsFx CLI можно создать следующие ресурсы:

* Microsoft Azure Active Directory (Azure AD) в клиенте Microsoft 365.
* Регистрация приложения Teams на платформе Teams клиента Microsoft 365.
* Ресурсы Azure в выбранной подписке Azure.

При создании проекта также необходимо создать ресурсы Azure. Шаблоны Azure Resource Manager (ARM) определяют все ресурсы Azure и помогают создавать необходимые ресурсы Azure во время подготовки.

### <a name="create-resource-for-teams-tab-application"></a>Создание ресурса для приложения вкладки Teams

| Ресурс | Назначение | Описание |
| --- | --- | --- |
| План службы приложений | Размещает веб-приложение на вкладке. | Неприменимо |
| Служба приложений | Размещает приложение вкладки Blazor и простой сервер проверки подлинности, который помогает получить доступ к другим службам. | Добавляет назначенное пользователем удостоверение для доступа к другим ресурсам Azure. |
| Управление удостоверениями | Проверка подлинности запросов между службами Azure. | Совместное использование различных возможностей и ресурсов. |

### <a name="create-resources-for-teams-message-extension-application"></a>Создание ресурсов для приложения расширения сообщений Teams

| Ресурс | Назначение | Описание |
| --- | --- | --- |
| Бот Azure | Регистрирует приложение в качестве бота в платформе бота. | Подключает бота к Teams. |
| Служба приложений плана | Размещает приложение веб-бота. | Неприменимо |
| Служба приложений | Размещает приложение бота. | Добавляет назначенное пользователем удостоверение для доступа к другим ресурсам Azure. |
| Управление удостоверениями | Проверка подлинности запросов между службами Azure. | Совместное использование различных возможностей и ресурсов. |

### <a name="create-resources-for-teams-command-bot-application"></a>Создание ресурсов для приложения командного бота Teams

| Ресурс | Назначение | Описание |
| --- | --- | --- |
| Бот Azure | Регистрирует приложение в качестве бота в платформе бота. | Подключает бота к Teams. |
| План службы приложений | Размещает приложение веб-бота. | Неприменимо |
| Служба приложений | Размещает приложение бота. | Добавляет назначенное пользователем удостоверение для доступа к другим ресурсам Azure. |
| Управление удостоверениями | Проверка подлинности запросов между службами Azure. | Совместное использование различных возможностей и ресурсов. |

### <a name="create-resources-for-teams-notification-bot-with-http-trigger-web-api-server-application"></a>Создание ресурсов для бота уведомлений Teams с помощью триггера HTTP (сервер веб-API)

| Ресурс | Назначение | Описание |
| --- | --- | --- |
| Бот Azure | Регистрирует приложение в качестве бота в платформе бота. | Подключает бота к Teams. |
| План службы приложений | Размещает приложение веб-бота. | Неприменимо |
| Служба приложений | Размещение приложения бота. | Добавляет назначенное пользователем удостоверение для доступа к другим ресурсам Azure. |
| Управляемое удостоверение | Проверка подлинности запросов между службами Azure. | Совместное использование различных возможностей и ресурсов. |

### <a name="create-resource-for-teams-notification-bot-with-http-trigger-azure-function-application"></a>Создание ресурса для бота уведомлений Teams с помощью приложения триггера HTTP (функция Azure)

| Ресурс | Назначение | Описание |
| --- | --- | --- |
| Бот Azure | Регистрирует приложение в качестве бота в платформе бота. | Подключает бота к Teams. |
| Управление удостоверениями | Выполняет проверку подлинности запросов между службами Azure. | Совместное использование различных возможностей и ресурсов. |
| Учетная запись хранения | Помогает создать приложение-функцию. | Неприменимо |
| План службы приложений | Размещает приложение бота-функции. | Неприменимо |
| Приложение-функция | Размещает приложение бота. | - Добавляет назначенное пользователем удостоверение для доступа к другим ресурсам Azure.<br>- Добавляет правило общего доступа к ресурсам независимо от источника (CORS), чтобы разрешить запросы из приложения вкладки.<br>- Добавляет параметр проверки подлинности, который разрешает только запросы из приложения Teams.<br>- Добавляет параметры приложения, необходимые пакету SDK teamsFx. |

### <a name="create-resource-for-teams-notification-bot-with-timer-trigger-azure-function-application"></a>Создание ресурса для бота уведомлений Teams с помощью триггера таймера (функция Azure)

| Ресурс | Назначение | Описание |
| --- | --- | --- |
| Бот Azure | Регистрирует приложение в качестве бота в платформе бота. | Подключает бота к Teams. |
| Управление удостоверениями | Проверка подлинности запросов между службами Azure. | Совместное использование различных возможностей и ресурсов. |
| Учетная запись хранения | Помогает создать приложение-функцию. | Не применимо. |
| План службы приложений | Размещает приложение бота-функции. | Неприменимо |
| Приложение-функция | Размещает приложение бота. | - Добавляет назначенное пользователем удостоверение для доступа к другим ресурсам Azure.<br>- Добавляет правило общего доступа к ресурсам независимо от источника (CORS), чтобы разрешить запросы из приложения вкладки.<br>- Добавляет параметр проверки подлинности, который разрешает только запросы из приложения Teams.<br>- Добавляет параметры приложения, необходимые пакету SDK teamsFx. |

### <a name="create-resources-for-teams-notification-bot-with-http-trigger--timer-trigger-azure-function-application"></a>Создание ресурсов для бота уведомлений Teams с помощью триггера HTTP и триггера таймера (функция Azure)

| Ресурс | Назначение | Описание |
| --- | --- | --- |
| Бот Azure | Регистрирует приложение в качестве бота в платформе бота. | Подключает бота к Teams. |
| Управление удостоверениями | Проверка подлинности запросов между службами Azure. | Совместное использование различных возможностей и ресурсов. |
| Учетная запись хранения | Помогает создать приложение-функцию. | Неприменимо |
| План службы приложений | Размещает приложение бота-функции. | Неприменимо |
| Приложение-функция | Размещает приложение бота. | - Добавляет назначенное пользователем удостоверение для доступа к другим ресурсам Azure.<br>- Добавляет правило общего доступа к ресурсам независимо от источника (CORS), чтобы разрешить запросы из приложения вкладки.<br>- Добавляет параметр проверки подлинности, который разрешает только запросы из приложения Teams.<br>- Добавляет параметры приложения, необходимые пакету SDK teamsFx. |

### <a name="manage-your-resources"></a>Управление ресурсами

Вы можете войти [в портал Azure и](https://portal.azure.com/) управлять всеми ресурсами, созданными набором средств Teams.

* Вы можете выбрать группу ресурсов из существующего списка или новой созданной группы ресурсов.
* Вы можете просмотреть сведения о группе ресурсов, выбранной в разделе обзора оглавлной таблицы.

### <a name="customize-resource-provision"></a>Настройка подготовки ресурсов

Набор средств Teams позволяет использовать инфраструктуру для подхода к коду для определения ресурсов Azure, которые необходимо подготовить. Конфигурацию в Наборе средств Teams можно изменить в соответствии с вашими требованиями.

Набор средств Teams использует шаблон ARM для определения ресурсов Azure. Шаблон ARM — это набор файлов bicep, определяющий инфраструктуру и конфигурацию проекта. Ресурсы Azure можно настраивать, изменяя шаблон ARM. Дополнительные сведения см. в [документе по bicep](/azure/azure-resource-manager/bicep).

Подготовка с помощью ARM включает в себя изменение следующих наборов файлов, параметров и шаблонов:

* Файлы параметров ARM (`azure.parameters.{your_env_name}.json`), расположенные в папке `.fx/configs` , для передачи параметров в шаблоны.
* Файлы шаблонов ARM, расположенные в `templates/azure` папке, содержат следующие файлы:

| Файл | Функция | Разрешение настройки |
| --- | --- | --- |
| main.bicep | Укажите точку входа для ресурса Azure. Предоставление | Да |
| provision.bicep | Создание и настройка ресурсов Azure. | Да |
| config.bicep | Добавьте необходимые конфигурации TeamsFx в ресурсы Azure. | Да |
| provision/xxx.bicep | Создайте и настройте каждый ресурс Azure, потребляемый `provision.bicep`. | Да |
| teamsfx/xxx.bicep | Добавьте необходимые конфигурации TeamsFx в каждый ресурс Azure, используемый `config.bicep`.| Нет |

> [!NOTE]
> После добавления ресурсов или возможностей в проект `teamsfx/xxx.bicep` создается повторно. Чтобы изменить файлы bicep, можно использовать Git для отслеживания изменений в файлах `teamsfx/xxx.bicep` . Это не приводит к потере изменений при добавлении ресурсов или возможностей в проект.

В файлах шаблонов ARM для параметров используются заполнители. Назначение заполнителей — обеспечить создание новых ресурсов в новой среде. Фактические значения разрешены из `.fx/states/state.{env}.json` файла.

### <a name="azure-ad-application-related-parameters"></a>Azure AD параметров, связанных с приложением

| Имя параметра | Заполнитель значения по умолчанию | Значение заполнителя | Создание и настройка |
| --- | --- | --- | --- |
| Microsoft 365 ClientId | {{state.fx-resource-aad-app-for-teams.clientId}} | Идентификатор клиента Azure AD приложения, созданный во время подготовки. | [Настройка значения](#use-an-existing-azure-ad-app-for-your-teams-app) |
| Microsoft 365 ClientSecret | {{state.fx-resource-aad-app-for-teams.clientSecret}} | Секрет клиента Azure AD приложения, созданный во время подготовки. | [Настройка значения](#use-an-existing-azure-ad-app-for-your-teams-app)  |
| Идентификатор клиента Microsoft 365 | {{state.fx-resource-aad-app-for-teams.tenantId}} | Идентификатор клиента приложения Azure AD приложения. | [Настройка значения](#use-an-existing-azure-ad-app-for-your-teams-app)  |
| Microsoft 365 OAuthAuthorityHost | {{state.fx-resource-aad-app-for-teams.oauthHost}} | OAuth authority host of your app's Azure AD app. | [Настройка значения](#use-an-existing-azure-ad-app-for-your-teams-app) |
| botAadAppClientId | {{state.fx-resource-bot.botId}} | Идентификатор клиента Azure AD бота, созданный во время подготовки. | [Настройка значения](#use-an-existing-azure-ad-app-for-your-bot) |
| botAadAppClientSecret | {{state.fx-resource-bot.botPassword}} | Секрет клиента Azure AD бота, созданный во время подготовки. | [Настройка значения](#use-an-existing-azure-ad-app-for-your-bot) |

### <a name="reference-environment-variables-in-parameter-files"></a>Ссылочные переменные среды в файлах параметров

Если значение является секретным, вам не нужно жестко кодировать их в файле параметров. Файлы параметров поддерживают ссылки на значения из переменных среды. Этот синтаксис можно использовать в `{{$env.YOUR_ENV_VARIABLE_NAME}}` значениях параметров набора средств Teams для разрешения из текущей переменной среды.

В следующем примере считывается значение параметра `mySelfHostedDbConnectionString` из переменной среды `DB_CONNECTION_STRING`:

```json
...
    "mySelfHostedDbConnectionString": "{{$env.DB_CONNECTION_STRING}}"
...
```

### <a name="customize-arm-template-files"></a>Настройка файлов шаблонов ARM

Если стандартные шаблоны не соответствуют требованиям приложения, можно настроить шаблоны ARM в папке `templates/azure` . Например, можно настроить шаблон ARM, чтобы создать дополнительные ресурсы Azure для приложения. Вам потребуется базовое знание языка bicep, который используется для создания шаблона ARM.

Чтобы инструмент TeamsFx правильно функционирует, настройте шаблон ARM, который соответствует следующему требованию:

* Убедитесь, что структура папки и имя файла остаются неизменными. Средство может добавлять новое содержимое к существующим файлам при добавлении дополнительных ресурсов или возможностей в проект.
* Убедитесь, что имена автоматически созданных параметров и их свойств остаются невмесятыми. Автоматически созданные параметры можно использовать при добавлении дополнительных ресурсов или возможностей в проект.
* Убедитесь, что выходные данные автоматически созданного шаблона ARM также не изменились. Вы можете добавить дополнительные выходные данные в шаблон ARM. Выходные данные можно использовать `.fx/states/state.{env}.json` и использовать в других функциях, таких как развертывание и проверка файла манифеста.

### <a name="customize-teams-app"></a>Настройка приложения Teams

Вы можете настроить бот или приложение Teams, добавив фрагменты конфигурации для использования Azure AD приложения, созданного вами. Это можно сделать следующими способами:

#### <a name="use-an-existing-azure-ad-app-for-your-bot"></a>Использование существующего приложения Azure AD для бота

Вы можете добавить следующий фрагмент конфигурации`.fx/configs/config.{env}.json`, чтобы использовать Azure AD приложение, созданное вами для приложения Teams. Чтобы создать Azure AD, перейдите по ссылке<https://aka.ms/teamsfx-existing-aad-doc>.

```json
"auth": {
    "clientId": "<your Azure AD app client id>",
    "clientSecret": "{{$env.ENV_NAME_THAT_STORES_YOUR_SECRET}}",
    "objectId": "<your Azure AD app object id>",
    "accessAsUserScopeId": "<id of the access_as_user scope>"
}
```

После добавления фрагмента добавьте секрет клиента в связанную переменную среды, чтобы набор средств Teams разрешал фактический секрет клиента во время подготовки.

> [!NOTE]
> Убедитесь, что одно и то же приложение Azure AD не используется в нескольких средах. Если у вас нет разрешения на обновление Azure AD, вы получите предупреждение с инструкциями по обновлению приложения Azure AD вручную. Следуйте этим инструкциям, чтобы обновить Azure AD после подготовки.

#### <a name="use-an-existing-azure-ad-app-for-your-teams-app"></a>Использование существующего приложения Azure AD для приложения Teams

Вы можете добавить следующий фрагмент конфигурации`.fx/configs/config.{env}.json`, чтобы использовать приложение Azure AD, созданное для бота:

```json
"bot": {
    "appId": "<your Azure AD app client id>",
    "appPassword": "{{$env.ENV_NAME_THAT_STORES_YOUR_SECRET}}"
}
```

После добавления фрагмента добавьте секрет клиента в связанную переменную среды для Набора средств Teams, чтобы разрешить фактический секрет клиента во время подготовки.

#### <a name="skip-adding-user-for-sql-database"></a>Пропустить добавление пользователя для SQL базы данных

Если при попытке добавить пользователя в базу данных SQL при попытке добавить пользователя в базу данных SQL возникает ошибка с недостаточным разрешением, `.fx/configs/config.{env}.json` можно добавить следующий фрагмент конфигурации, чтобы пропустить добавление пользователя базы данных SQL:

```json
"skipAddingSqlUser": true
```

## <a name="see-also"></a>См. также

* [Развертывание приложения Teams в облаке с помощью Visual Studio](deploy-teams-app.md)
* [Изменение манифеста приложения Teams с помощью Visual Studio](VS-TeamsFx-preview-and-customize-app-manifest.md)
* [Локальная отладка приложения Teams для Visual Studio](debug-teams-app-visual-studio.md)
