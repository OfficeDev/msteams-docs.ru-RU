---
title: Регистрация приложения вкладки в Azure AD
description: Описание регистрации приложения табуляции в Azure AD
ms.topic: how-to
ms.localizationpriority: medium
keywords: Вкладки проверки подлинности teams в области клиента маркера доступа Microsoft Azure Active Directory (Azure AD)
ms.openlocfilehash: e508e80f4e2c881e848f628a12392e6ced5e6f4b
ms.sourcegitcommit: e16b51a49756e0fe4eaf239898e28d3021f552da
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2022
ms.locfileid: "65888200"
---
# <a name="register-your-app-in-azure-ad"></a>Регистрация приложения в Azure AD

Azure AD предоставляет доступ к приложению табуляции на основе удостоверения Teams пользователя приложения. Вам потребуется зарегистрировать приложение вкладки в Azure AD, чтобы пользователь приложения, выполнивший вход в Teams, был предоставлен доступ к приложению вкладки.

## <a name="enabling-sso-on-azure-ad"></a>Включение единого входа в Azure AD

Чтобы зарегистрировать приложение вкладки в Azure AD и включить его для единого входа, необходимо создать конфигурации приложений, например создать идентификатор приложения, определить область API и предварительно авторизовать идентификаторы клиентов для доверенных приложений.

:::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/register-azure-ad.png" alt-text="Настройка Azure AD для отправки маркера доступа в клиентское приложение Teams" border="false":::

Создайте регистрацию приложения в Azure AD и предоставьте его (веб-) API с помощью областей (разрешений). Настройте отношение доверия между предоставляемым API в Azure AD и приложением. Это позволяет клиенту Teams получить маркер доступа от имени приложения и вошедого в систему пользователя. Вы можете добавить идентификаторы клиентов для доверенных мобильных, классических и веб-приложений, которые требуется предварительно авторизовать.

Кроме того, может потребоваться настроить дополнительные сведения, например аутентификацию пользователей приложения на платформе или устройстве, на которых вы хотите настроить приложение вкладки.

Поддерживаются разрешения API Graph на уровне пользователя, т. е. электронная почта, профиль, offline_access и OpenId. Если вам требуется доступ к дополнительным областям Graph, `User.Read` `Mail.Read`например или, см. статью "Получение маркера доступа [с разрешениями Graph"](tab-sso-graph-api.md).

Конфигурация Azure AD включает единый вход для приложения вкладки в Teams. Он отвечает маркером доступа для проверки пользователя приложения.

> [!NOTE]
> Microsoft Teams Toolkit регистрирует приложение Azure AD в проекте единого входа.

### <a name="before-you-register-with-azure-ad"></a>Перед регистрацией в Azure AD

Это полезно, если вы заранее узнаете о конфигурации для регистрации приложения в Azure AD. Перед регистрацией приложения убедитесь, что вы готовы настроить следующие сведения:

- **Параметры** с одним или несколькими клиентами: будет ли приложение использоваться только в клиенте Microsoft 365, где оно зарегистрировано, или оно будет использоваться многими клиентами Microsoft 365? Приложения, написанные для одного предприятия, обычно являются одним клиентом; приложения, написанные независимым поставщиком программного обеспечения и используемые многими клиентами, должны быть мультитенантами, чтобы каждый клиент клиента могли получить доступ к приложению.
- **Универсальный код ресурса (URI**) идентификатора приложения— это глобальный уникальный универсальный код ресурса (URI), определяющий веб-API, который вы предоставляете для доступа к приложению через области. Он также называется универсальным кодом ресурса (URI) идентификатора. URI идентификатора приложения включает идентификатор приложения и поддомен, в котором размещено приложение. Доменное имя приложения и доменное имя, которое вы регистрируете для приложения Azure AD, должны совпадать. В настоящее время несколько доменов на приложение не поддерживаются.
- **Область**. Это разрешение, которое авторизованный пользователь приложения или ваше приложение могут предоставить для доступа к ресурсу, предоставляемого API.

> [!NOTE]
>
> - **Бизнес-приложения**: ваша организация может сделать бизнес-приложения доступными через Microsoft Store. Эти приложения являются пользовательскими для вашей организации. Они являются внутренними или конкретными в вашей организации или организации.
> - **Приложения, принадлежащие клиенту**: единый вход также поддерживается для приложений, принадлежащих клиенту, в клиентах Azure AD B2C.

Чтобы создать и настроить приложение в Azure AD для включения единого входа, выполните следующее.

- [Зарегистрируйте и настройте приложение Azure AD.](#create-an-app-registration-in-azure-ad)
- [Настройте область для маркера доступа.](#configure-scope-for-access-token)
- [Настройка версии маркера доступа.](#configure-access-token-version)

## <a name="create-an-app-registration-in-azure-ad"></a>Создание регистрации приложения в Azure AD

Зарегистрируйте новое приложение в Azure AD и настройте клиент и платформу приложения. Вы создадите новый идентификатор приложения, который будет обновлен позже в файле манифеста приложения Teams.

### <a name="to-register-a-new-app-in-azure-ad"></a>Регистрация нового приложения в Azure AD

1. Откройте портал [Azure в](https://ms.portal.azure.com/) веб-браузере.
   Откроется страница портала Microsoft Azure AD.

2. Щелкните **значок регистрации** приложений.

   :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-portal.png" alt-text="Страница портала Azure AD." border="true":::

   **Появится страница регистрации** приложений.

3. **Щелкните значок "+Создать регистрацию**".

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-registrations.png" alt-text="Новая страница регистрации на портале Azure AD." border="true":::

    Появится страница **Регистрация приложения**.

4. Введите имя приложения, которое вы хотите отобразить для пользователя приложения. При необходимости это имя можно изменить на более позднем этапе.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/register-app.png" alt-text="Страница регистрации приложения на портале Azure AD." border="true":::

5. Выберите тип учетной записи пользователя, которая может получить доступ к приложению. Вы можете выбрать один или несколько клиентов или частную учетную запись Майкрософт.

    <details>
    <summary><b>Параметры поддерживаемых типов учетных записей</b></summary>

    | Параметр | Выберите этот параметр, чтобы... |
    | --- | --- |
    | Учетные записи только в этом каталоге организации (только майкрософт — один клиент) | Создайте приложение для использования только пользователями (или гостями) в клиенте. <br> Часто называемая бизнес-приложением, это приложение является однотенантным приложением на платформе удостоверений Майкрософт. |
    | Учетные записи в любом каталоге организации (любой каталог Azure AD — мультитенантный) | Разрешите пользователям в любом клиенте Azure AD использовать ваше приложение. Этот вариант подходит, если, например, вы создаете приложение SaaS и планируете сделать его доступным для нескольких организаций. <br> Этот тип приложения называется мультитенантным приложением на платформе удостоверений Майкрософт.|
    | Учетные записи в любом каталоге организации (любой каталог Azure AD — мультитенантный) и личные учетные записи Майкрософт | Нацелить на широкий набор клиентов. <br> Выбрав этот параметр, вы регистрируете мультитенантное приложение, которое может поддерживать пользователей приложений, у которых также есть личные учетные записи Майкрософт. |
    | Только личные учетные записи Майкрософт | Создайте приложение только для пользователей, имеющих личные учетные записи Майкрософт. |

    </details>

    > [!NOTE]
    > Вам не нужно вводить **URI** перенаправления для включения единого входа для приложения вкладки.

7. Нажмите **Зарегистрировать**.
    В браузере отображается сообщение о том, что приложение создано.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-created-msg.png" alt-text="Зарегистрируйте приложение на портале Azure AD." border="true":::

    Отобразится страница с идентификатором приложения и другими конфигурациями.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/tab-app-created.png" alt-text="Регистрация приложения выполнена успешно." border="true":::

8. Запишите и сохраните идентификатор приложения из **идентификатора приложения (клиента**). Он понадобится для обновления манифеста приложения Teams позже.

    Ваше приложение зарегистрировано в Azure AD. Теперь у вас должен быть идентификатор приложения табуляции.

## <a name="configure-scope-for-access-token"></a>Настройка области для маркера доступа

После создания регистрации нового приложения настройте параметры области (разрешений) для отправки маркера доступа клиенту Teams и авторизации доверенных клиентских приложений для включения единого входа.

Чтобы настроить область действия и авторизовать доверенные клиентские приложения, вам потребуется:

- [Чтобы предоставить API](#to-expose-an-api), настройте параметры области (разрешений) для приложения. Вы предоставите веб-API и настроите URI идентификатора приложения.
- [Чтобы настроить область API](#to-configure-api-scope), определите область для API и пользователей, которые могут дать согласие на область. Вы можете разрешить только администраторам предоставлять согласие на разрешения с более высоким уровнем привилегий.
- [Чтобы настроить авторизованные клиентские](#to-configure-authorized-client-application) приложения, создайте авторизованные идентификаторы клиентов для приложений, которые необходимо предварительно авторизовать. Это позволяет пользователю приложения получать доступ к настроенным областям приложения (разрешениям), без необходимости получения дополнительного согласия. Предварительно авторизовать только те клиентские приложения, которым вы доверяете, так как пользователи приложения не смогут отклонить согласие.

### <a name="to-expose-an-api"></a>Предоставление API

1. На **панели** >  слева выберите "Управление **предоставлением API**".

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/expose-api-menu.png" alt-text="Предоставление параметра меню API." border="true":::

    **Появится страница "Предоставление API**".

1. Выберите **"Задать** ", чтобы создать универсальный код ресурса (URI) идентификатора приложения в формате `api://{AppID}`.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/expose-an-api.png" alt-text="Задание URI идентификатора приложения" border="true":::

    Появится раздел для настройки URI идентификатора приложения.

1. Введите URI идентификатора приложения в формате, описанного здесь.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/set-app-id-uri.png" alt-text="URI идентификатора приложения" border="true":::

    - **URI идентификатора** приложения предварительно заполняется идентификатором приложения (GUID) в формате`api://{AppID}`.
    - Формат URI идентификатора приложения должен быть: `api://fully-qualified-domain-name.com/{AppID}`.
    - Вставка между `fully-qualified-domain-name.com` и `{AppID}` `api://` (то есть GUID). Например, api://example.com/{AppID}.

    Где
    - `fully-qualified-domain-name.com` — это понятное для человека доменное имя, из которого обслуживается приложение табуляции. Доменное имя приложения и доменное имя, которое вы регистрируете для приложения Azure AD, должны совпадать.

      Если вы используете службу туннелирования, например ngrok, это значение необходимо обновлять при каждом изменении поддомена ngrok.
    - `AppID` — это идентификатор приложения (GUID), созданный при регистрации приложения. Его можно просмотреть в разделе **"Обзор** ".

    > [!IMPORTANT]
    >
    > - Универсальный код ресурса (URI) идентификатора приложения для приложения с несколькими возможностями. Если вы создаете приложение с помощью бота, расширения для обмена сообщениями и вкладки, введите **URI**`api://fully-qualified-domain-name.com/BotId-{YourClientId}` идентификатора приложения, где BotID — это идентификатор приложения бота.
    >
    > - **Формат доменного имени**: используйте строчные буквы для доменного имени. Не используйте верхний регистр.
    >
    >   Например, чтобы создать службу приложений или веб-приложение с именем ресурса, "demoapplication":
    >
    >   | Если используется базовое имя ресурса | URL-адрес будет... | Формат поддерживается в... |
    >   | --- | --- | --- |
    >   | *demoapplication* | **<https://demoapplication.example.net>** | Все платформы.|
    >   | *DemoApplication* | **<https://DemoApplication.example.net>** | Только для настольных компьютеров, веб-приложений и iOS. Она не поддерживается в Android. |
    >
    >    Используйте демонстрацию параметра нижнего *регистра в* качестве имени базового ресурса.

1. Нажмите **Сохранить**.

    В браузере отображается сообщение об обновлении URI идентификатора приложения.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-msg.png" alt-text="Сообщение URI идентификатора приложения" border="true":::

    URI идентификатора приложения отображается на странице.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-added.png" alt-text="Обновлен URI идентификатора приложения" border="true":::

1. Запишите и сохраните URI идентификатора приложения. Он понадобится для обновления манифеста приложения Teams позже.

### <a name="to-configure-api-scope"></a>Настройка области API

1. Выберите **"+ Добавить область** " в областях **, определенных в этом разделе API** .

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/select-scope.png" alt-text="Выбор области" border="true":::

    **Появится страница "Добавление области**".

1. Введите сведения о настройке области.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-scope.png" alt-text="Добавление сведений об области" border="true":::

    1. Введите имя области. Это поле является обязательным.
    2. Выберите пользователя, который может дать согласие для этой области. По умолчанию используется только **администратор.**
    3. Введите **отображаемое имя согласия администратора**. Это поле является обязательным.
    4. Введите описание согласия администратора. Это поле является обязательным.
    5. Введите **отображаемое имя согласия пользователя**.
    6. Введите описание согласия пользователя.
    7. Выберите параметр **"Включено** " для состояния.
    8. Нажмите **Добавить область**.

    В браузере отображается сообщение о добавлении области.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added-msg.png" alt-text="Сообщение о добавлении области" border="true":::

    Новая область, которую вы определили, отображается на странице.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added.png" alt-text="Область добавлена и отображена" border="true":::

### <a name="to-configure-authorized-client-application"></a>Настройка авторизованного клиентского приложения

1. Перейдите на **страницу "Предоставление API** " **в раздел** авторизованного клиентского приложения и выберите **"+ Добавить клиентское приложение"**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/auth-client-apps.png" alt-text="Авторизованные клиентские приложения" border="true":::

    **Появится страница "Добавление клиентского** приложения".

1. Введите соответствующий идентификатор клиента Teams для приложений, которые вы хотите авторизовать для веб-приложения приложения.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-client-app.png" alt-text="Добавление клиентского приложения" border="true":::

    > [!NOTE]
    >
    > - Идентификаторы клиентов для мобильных, классических и веб-приложений Teams — это фактические идентификаторы, которые необходимо добавить.
    > - Для приложения вкладки Teams вам потребуется веб-приложение или одностраничные приложения, так как у вас не может быть мобильного или настольного клиентского приложения в Teams.

    1. Выберите один из следующих идентификаторов клиента:

       | Использование идентификатора клиента | Для авторизации... |
       | --- | --- |
       | 1fec8e78-bce4-4aaf-ab1b-5451cc387264 | Мобильное или настольное приложение Teams |
       | 5e3ce6c0-2b1f-4285-8d4b-75ee78787346 | Веб-приложение Teams |

    1. Выберите универсальный код ресурса (URI) идентификатора приложения, созданный для приложения в авторизованных областях, чтобы добавить область в предоставленный веб-API.

    1. Нажмите кнопку **Добавить приложение**.

    В браузере отображается сообщение о добавлении авторизованного клиентского приложения.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Добавлено сообщение о добавлении клиентского приложения" border="true":::

    Идентификатор клиента отображается на странице.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/client-app-added.png" alt-text="Добавлено и отображено клиентское приложение" border="true":::

> [!NOTE]
> Вы можете авторизовать несколько клиентских приложений. Повторите шаги этой процедуры для настройки другого авторизованного клиентского приложения.

## <a name="configure-access-token-version"></a>Настройка версии маркера доступа

Необходимо определить версию маркера доступа, приемлемую для вашего приложения. Эта конфигурация выполняется в манифесте приложения Azure AD.

### <a name="to-define-the-access-token-version"></a>Определение версии маркера доступа

1. Выберите **"Управление** > **манифестом** " на левой панели.

   :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-portal-manifest.png" alt-text="Манифест портала Azure AD" border="true":::

    Появится манифест приложения Azure AD.

1. **Введите 2** в качестве значения свойства`accessTokenAcceptedVersion`.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-manifest-value.png" alt-text="Значение для принятой версии маркера доступа" border="true":::

1. Нажмите кнопку **Сохранить**.

    В браузере отобразится сообщение об успешном обновлении манифеста.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-aad-manifest-msg.png" alt-text="Сообщение об обновлении манифеста":::

Поздравляем! Вы завершили настройку приложения в Azure AD, необходимую для включения единого входа для приложения вкладки.

## <a name="next-step"></a>Следующий этап

> [!div class="nextstepaction"]
> [Настройка кода для включения единого входа](tab-sso-code.md)

## <a name="see-also"></a>См. также

- [Аренда в Azure Active Directory](/azure/active-directory/develop/single-and-multi-tenant-apps)
- [Расширение приложения табуляции с помощью разрешений и области Microsoft Graph](tab-sso-graph-api.md)
- [Краткое руководство. Регистрация приложения на платформе удостоверений Майкрософт](/azure/active-directory/develop/quickstart-register-app)
- [Краткое руководство. Настройка приложения для предоставления веб-API](/azure/active-directory/develop/quickstart-configure-app-expose-web-apis)
- [Поток кода авторизации OAuth 2.0](/azure/active-directory/develop/v2-oauth2-auth-code-flow)
