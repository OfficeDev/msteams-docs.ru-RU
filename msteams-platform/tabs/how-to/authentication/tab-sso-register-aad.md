---
title: Регистрация приложения вкладки в Azure AD.
description: Настройте единый вход (SSO) с Azure AD, настроив URI идентификатора приложения, область для маркера доступа и предварительно авторизовать доверенные клиенты.
ms.topic: how-to
ms.localizationpriority: high
keywords: Вкладки проверки подлинности Teams Маркер доступа Microsoft Azure Active Directory (Azure AD) Область действия единого входа
ms.openlocfilehash: 92b974840262fedb268aa7c160aa28fc0a33e2cb
ms.sourcegitcommit: c1032ea4f48c4bbf5446798ff7d46d7e6e9f55d2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2022
ms.locfileid: "68027097"
---
# <a name="register-your-tab-app-in-azure-ad"></a>Регистрация приложения вкладки в Azure AD

Azure AD предоставляет доступ к приложению вкладки на основе удостоверения Teams пользователя приложения. Вам потребуется зарегистрировать приложение вкладки в Azure AD, чтобы пользователь приложения, вошедший в Teams, мог получить доступ к этому приложению вкладки.

## <a name="enabling-sso-on-azure-ad"></a>Включение единого входа в Azure AD

Регистрация приложения вкладки в Azure AD и включение его для единого входа требует настройки конфигураций приложения, таких как создание идентификатора приложения, определение области действия API и предварительная авторизация идентификаторов клиентов для доверенных приложений.

:::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/register-azure-ad.png" alt-text="Настройка Azure AD для отправки маркера доступа в клиентское приложение Teams":::

Создайте новую регистрацию приложения в Azure AD и предоставьте его (веб-API) с помощью областей (разрешений). Настройте доверительные отношения между открытым API в Azure AD и этим приложением. Он позволяет клиенту Teams получить маркер доступа от имени приложения и вошедого в систему пользователя. Вы можете добавить идентификаторы клиентов для доверенных мобильных, настольных и веб-приложений, которые вы хотите предварительно авторизовать.

Вам также может потребоваться настроить дополнительные сведения, такие как аутентификация пользователей приложения на платформе или устройстве, на которое вы хотите нацелить свое приложение с вкладками.

Поддерживаются разрешения API Graph на уровне пользователя, то есть электронная почта, профиль, offline_access и OpenId. Если вам требуется доступ к дополнительным областям Graph, таким как `User.Read` или `Mail.Read`, см. раздел [Получение маркера доступа с разрешениями Graph](tab-sso-graph-api.md).

Конфигурация Azure AD включает единый вход для приложения с вкладками в Teams. Он отвечает маркером доступа для проверки пользователя приложения.

> [!NOTE]
> Набор инструментов Microsoft Teams регистрирует приложение Azure AD в проекте единого входа.

### <a name="before-you-register-with-azure-ad"></a>Перед регистрацией в Azure AD

Будет полезно, если вы заранее справитесь о конфигурации для регистрации своего приложения в Azure AD. Перед регистрацией приложения убедитесь, что вы подготовили следующие данные:

- **Варианты с одним** или несколькими клиентами. Будет ли ваше приложение использоваться только в клиенте Microsoft 365, где оно зарегистрировано, или оно будет использоваться многими клиентами Microsoft 365? Приложения, написанные для одного предприятия, обычно являются одним клиентом. Приложения, написанные независимым поставщиком программного обеспечения и используемые многими клиентами, должны быть мультитенантами, чтобы каждый клиент клиента могли получить доступ к приложению.
- **URI идентификатора приложения** — это глобально уникальный URI, идентифицирующий веб-API, который вы предоставляете для доступа своего приложения через области. Его также называют идентификатором URI. URI идентификатора приложения включает идентификатор приложения и поддомен, на котором размещено это приложение. Доменное имя вашего приложения и доменное имя, которое вы регистрируете для своего приложения Azure AD, должны совпадать. Сейчас несколько доменов для одного приложения не поддерживаются.
- **Область** — это разрешение, которое может быть предоставлено авторизованному пользователю приложения или вашему приложению для доступа к ресурсу, предоставляемому API.

> [!NOTE]
>
> - **Бизнес-приложения**: ваша организация может сделать бизнес-приложения доступными через Microsoft Store. Эти приложения настроены для вашей организации. Они являются внутренними или специфичными для вашей организации или бизнеса.
> - **Клиентские приложения**: единый вход также поддерживается для клиентских приложений в клиентах Azure AD B2C.

Чтобы создать и настроить приложение в Azure AD для включения единого входа:

- [Зарегистрируйте и настройте приложение Azure AD.](#create-an-app-registration-in-azure-ad)
- [Настройте область для маркера доступа.](#configure-scope-for-access-token)
- [Настройте версию маркера доступа.](#configure-access-token-version)

## <a name="create-an-app-registration-in-azure-ad"></a>Создайте регистрацию приложения в Azure AD.

Зарегистрируйте новое приложение в Azure AD и настройте клиент и платформу приложения. Вы создадите новый идентификатор приложения, который будет обновлен позже в файле манифеста приложения Teams.

### <a name="to-register-a-new-app-in-azure-ad"></a>Чтобы зарегистрировать новое приложение в Azure AD

1. Откройте [портал Azure](https://ms.portal.azure.com/) в веб-браузере.
   Откроется страница портала Microsoft Azure AD.

2. Выберите значок **регистрации приложений**.

   :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-portal.png" alt-text="Страница портала Azure AD.":::

   Появится страница **регистрации приложений**.

3. Выберите значок **+ Новая регистрация**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-registrations.png" alt-text="Новая страница регистрации на портале Azure AD.":::

    Появится страница **Регистрация приложения**.

4. Введите имя своего приложения, которое вы хотите отобразить для пользователя приложения. Если захотите, это имя можно будет изменить позже.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/register-app.png" alt-text="Страница регистрации приложения на портале Azure AD.":::

5. Выберите тип учетной записи пользователя, которая может получить доступ к этому приложению. Вы можете выбрать один или несколько клиентов или частную учетную запись Microsoft.

    <details>
    <summary><b>Параметры для поддерживаемых типов учетных записей</b></summary>

    | Параметр | Выберите это, чтобы... |
    | --- | --- |
    | Только учетные записи в этом организационном каталоге (только Microsoft — один клиент) | Создайте приложение для использования только пользователями (или гостями) в вашем клиенте. <br> Это приложение, часто называемое бизнес-приложением, представляет собой приложение с одним клиентом на платформе удостоверений Майкрософт. |
    | Учетные записи в любом организационном каталоге (любой каталог Azure AD — многоклиентский) | Разрешите пользователям любого клиента Azure AD использовать это приложение. Этот вариант подходит, если, например, вы создаете приложение SaaS и планируете сделать его доступным для нескольких организаций. <br> Этот тип приложения известен как многоклиентское приложение на платформе Microsoft Identity.|
    | Учетные записи в любом организационном каталоге (любой каталог Azure AD — многоклиентский) и личные учетные записи Майкрософт. | Нацелить на самый широкий круг клиентов. <br> Выбирая этот параметр, вы регистрируете многопользовательское приложение, которое может также поддерживать пользователей приложений, имеющих личные учетные записи Майкрософт. |
    | Только личные учетные записи Майкрософт | Создавайте приложение только для пользователей, у которых есть личные учетные записи Microsoft. |

    </details>

    > [!NOTE]
    > Вам не нужно вводить **URI** перенаправления для включения единого входа для приложения вкладки.

7. Нажмите **Зарегистрировать**.
    В браузере появится сообщение о том, что приложение создано.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-created-msg.png" alt-text="Зарегистрируйте приложение на портале Azure AD.":::

    Отобразится страница с идентификатором приложения и другими конфигурациями.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/tab-app-created.png" alt-text="Регистрация приложения прошла успешно.":::

8. Запишите и сохраните идентификатор приложения из **идентификатора приложения (клиента**). Он понадобится вам позже для обновления манифеста приложения Teams.

    Ваше приложение зарегистрировано в Azure AD. Теперь у вас должен быть идентификатор приложения для вкладки.

## <a name="configure-scope-for-access-token"></a>Настройка области для маркера доступа

После создания новой регистрации приложения настройте параметры области (разрешения) для отправки маркера доступа в клиент Teams и авторизации доверенных клиентских приложений для включения единого входа.

Чтобы настроить область действия и авторизовать доверенные клиентские приложения, вам потребуется:

- [Чтобы предоставить API](#to-expose-an-api), настройте параметры области (разрешений) для своего приложения. Вы предоставите веб-API и настроите URI идентификатора приложения.
- [Чтобы настроить область API](#to-configure-api-scope), определите область для API и пользователей, которые могут дать согласие на область действия. Вы можете позволить только администраторам давать согласие на более привилегированные разрешения.
- [Чтобы настроить авторизованное клиентское приложение](#to-configure-authorized-client-application), создайте авторизованные идентификаторы клиентов для приложений, которые вы хотите предварительно авторизовать. Это позволяет пользователю приложения получать доступ к настроенным вами областям приложения (разрешениям) без дополнительного согласия. Предварительно авторизуйте только те клиентские приложения, которым вы доверяете, поскольку пользователи вашего приложения не будут иметь возможности отклонить согласие.

### <a name="to-expose-an-api"></a>Чтобы предоставить API

1. Выберите **Управление** >  **Предоставить API** на панели слева.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/expose-api-menu.png" alt-text="Предоставление параметра меню API.":::

    Появится страница **Предоставление API**.

1. Выберите **Задать**, чтобы сгенерировать URI идентификатора приложения в формате `api://{AppID}`.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/expose-an-api.png" alt-text="Установить URI идентификатора приложения":::

    Появится раздел для настройки идентификатора приложения URI.

1. Введите URI идентификатора приложения в формате, описанном здесь.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/set-app-id-uri.png" alt-text="URI идентификатора приложения.":::

    - **URI идентификатора приложения** предварительно заполняется идентификатором приложения (GUID) в формате`api://{AppID}`.
    - Формат URI идентификатора приложения должен быть: `api://fully-qualified-domain-name.com/{AppID}`.
    - Вставьте между `fully-qualified-domain-name.com` и `{AppID}` `api://` (то есть GUID). Например, api://example.com/{AppID}.

    где
    - `fully-qualified-domain-name.com` — это удобочитаемое доменное имя, из которого обслуживается ваше приложение для вкладок. Доменное имя вашего приложения и доменное имя, которое вы регистрируете для своего приложения Azure AD, должны совпадать.

      Если вы используете службу туннелирования, такую ​​как ngrok, вы должны обновлять это значение при каждом изменении вашего поддомена ngrok.
    - `AppID` — это идентификатор приложения (GUID), созданный при регистрации приложения. Вы можете просмотреть его в разделе **Обзор**.

    > [!IMPORTANT]
    >
    > - **URI идентификатора приложения для приложения с несколькими возможностями**. Если вы создаете приложение с ботом, расширением обмена сообщениями и вкладкой, введите URI идентификатора приложения в виде `api://fully-qualified-domain-name.com/BotId-{YourClientId}`, где BotID — это идентификатор вашего приложения-бота.
    >
    > - **Формат доменного имени**: используйте строчные буквы для доменного имени. Не используйте верхний регистр.
    >
    >   Например, чтобы создать службу приложений или веб-приложение с именем ресурса demoapplication:
    >
    >   | Если используется базовое имя ресурса | URL-адрес будет... | Формат поддерживается на... |
    >   | --- | --- | --- |
    >   | *demoapplication* | `https://demoapplication.example.net` | Все платформы|
    >   | *DemoApplication* | `https://DemoApplication.example.net` | Только для компьютеров, Интернета и iOS. Он не поддерживается в Android. |
    >
    >    Используйте параметр *demoapplication* в нижнем регистре в качестве базового имени ресурса.

1. Нажмите кнопку **Сохранить**.

    В браузере появляется всплывающее сообщение о том, что идентификатор URI идентификатора приложения был обновлен.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-msg.png" alt-text="URI-сообщение идентификатора приложения":::

    URI идентификатора приложения отображается на странице.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/app-id-uri-added.png" alt-text="URI идентификатора приложения обновлен":::

1. Запишите и сохраните URI идентификатора приложения. Он понадобится вам позже для обновления манифеста приложения Teams.

### <a name="to-configure-api-scope"></a>Чтобы настроить область действия API

1. Выберите **+ Добавить область** в разделе **Области, определенные этим API**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/select-scope.png" alt-text="Выберите область":::

    Появится страница **Добавление области**.

1. Введите данные для конфигурации области действия.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-scope.png" alt-text="Добавить сведения об области":::

    1. Введите имя области. Это поле является обязательным.
    2. Выберите пользователя, который может дать согласие на эту область. Параметр по умолчанию — **Только для администраторов**.
    3. Введите **отображаемое имя согласия администратора**. Это поле является обязательным.
    4. Введите описание для согласия администратора. Это поле является обязательным.
    5. Введите **отображаемое имя согласия пользователя**.
    6. Введите описание для описания согласия пользователя.
    7. Выберите параметр **Включено** для состояния.
    8. Нажмите **Добавить область**.

    В браузере появится сообщение о том, что область добавлена.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added-msg.png" alt-text="Добавлено сообщение области действия":::

    Новая область, которую вы определили, отобразится на странице.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/scope-added.png" alt-text="Область действия добавлена ​​и отображена":::

### <a name="to-configure-authorized-client-application"></a>Настройка авторизованного клиентского приложения

1. Перейдите на страницу **Предоставление API** **в раздел** авторизованного клиентского приложения и выберите **+ Добавить клиентское приложение**.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/auth-client-apps.png" alt-text="Авторизованное клиентское приложение":::

    Появится страница **Добавление клиентского приложения**.

1. Введите соответствующий идентификатор клиента Microsoft 365 для клиента Teams для приложений, которые вы хотите авторизовать для веб-приложения приложения.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/add-client-app.png" alt-text="Добавить клиентское приложение":::

    > [!NOTE]
    >
    > - Идентификаторы клиентов Microsoft 365 для мобильных, классических и веб-приложений для Teams, Office и Outlook — это фактические идентификаторы, которые следует добавить.
    > - Для приложения вкладки Teams вам потребуется веб-приложение или SPA, поскольку в Teams не может быть мобильного или настольного клиентского приложения.

    1. Выберите один из следующих идентификаторов клиентов:

       | Использовать идентификатор клиента | Для авторизации... |
       | --- | --- |
       | 1fec8e78-bce4-4aaf-ab1b-5451cc387264 | Мобильное или настольное приложение Teams |
       | 5e3ce6c0-2b1f-4285-8d4b-75ee78787346 | Веб-приложение Teams |
       | 4765445b-32c6-49b0-83e6-1d93765276ca | Веб-приложение Office |
       | 0ec893e0-5785-4de6-99da-4ed124e5296c | Классические приложения Office |
       | d3590ed6-52b3-4102-aeff-aad2292ab01c | Классическое приложение Outlook, мобильное приложение |
       | bc59ab01-8403-45c6-8796-ac3ef710b3e3 | Веб-приложение Outlook |

    1. Выберите URI идентификатора приложения, который вы создали для своего приложения, в **Авторизованных областях**, чтобы добавить область в предоставленный вами веб-API.

    1. Нажмите кнопку **Добавить приложение**.

    В браузере появится сообщение о том, что авторизованное клиентское приложение добавлено.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-app-auth-msg.png" alt-text="Добавлено сообщение о добавлении клиентского приложения":::

    Идентификатор клиента отобразится на странице.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/client-app-added.png" alt-text="Приложение клиента добавлено и отображено":::

> [!NOTE]
> Вы можете авторизовать более одного клиентского приложения. Повторите шаги этой процедуры для настройки другого авторизованного клиентского приложения.

## <a name="configure-access-token-version"></a>Настройка версии маркера доступа

Необходимо определить версию маркера доступа, приемлемую для вашего приложения. Эта настройка выполняется в манифесте приложения Azure AD.

### <a name="to-define-the-access-token-version"></a>Чтобы определить версию маркера доступа

1. Выберите **Управление** > **Манифест** на панели слева.

   :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-portal-manifest.png" alt-text="Манифест портала Azure AD":::

    Появится манифест приложения Azure AD.

1. Введите **2** в качестве значения свойства `accessTokenAcceptedVersion`.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-manifest-value.png" alt-text="Значение для принятой версии маркера доступа":::

1. Нажмите кнопку **Сохранить**.

    В браузере появится сообщение об успешном обновлении манифеста.

    :::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/update-aad-manifest-msg.png" alt-text="Обновленное сообщение манифеста":::

Поздравляем! Вы завершили настройку приложения в Azure AD, необходимую для включения единого входа для своего приложения вкладки.

## <a name="next-step"></a>Следующий этап

> [!div class="nextstepaction"]
> [Настройка кода для включения единого входа](tab-sso-code.md)

## <a name="see-also"></a>См. также

- [Клиент в Azure Active Directory](/azure/active-directory/develop/single-and-multi-tenant-apps)
- [Расширение приложения вкладки с разрешениями и областью действия Microsoft Graph](tab-sso-graph-api.md)
- [Быстрое начало: регистрация приложения на платформе Microsoft Identity](/azure/active-directory/develop/quickstart-register-app)
- [Быстрое начало: настройка приложения для предоставления веб-API](/azure/active-directory/develop/quickstart-configure-app-expose-web-apis)
- [Поток кода авторизации OAuth 2.0](/azure/active-directory/develop/v2-oauth2-auth-code-flow)
