---
title: Устранение неполадок проверки подлинности для вкладок с использованием единого входа в Teams
description: Устранение неполадок проверки подлинности с единым входом в Teams и способ ее использования на вкладках
ms.topic: how-to
ms.localizationpriority: high
keywords: вкладки проверка подлинности Teams Microsoft Azure Active Directory (Azure AD) единый вход ошибки вопросы
ms.openlocfilehash: fa17ffef08f85124a230f76419158f4216f55416
ms.sourcegitcommit: 07f41abbeb1572a306a789485953c5588d65051e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/06/2022
ms.locfileid: "66658954"
---
# <a name="troubleshoot-sso-authentication-in-teams"></a>Устранение неполадок проверки подлинности для единого входа в Teams

Ниже приведен список проблем и вопросов по единому входу, а также способы их устранения.
<br>

## <a name="support-for-microsoft-graph"></a>Поддержка Microsoft Graph

<br>
<details>
<summary>1. Работает ли API Graph в Postman?</summary>
<br>
Вы можете использовать коллекцию Microsoft Graph Postman с API Microsoft Graph.

Дополнительные сведения см. в статье [Использование Postman с API Microsoft Graph](/graph/use-postman).
</details>
<br>
<details>
<summary>2. Работает ли API Graph в песочнице Microsoft Graph?</summary>
<br>
Да, API Graph работает в песочнице Microsoft Graph.

Дополнительные сведения см. в статье [Песочница Graph](https://developer.microsoft.com/graph/graph-explorer).

</details>
<br>

## <a name="error-messages-and-how-to-handle-them"></a>Сообщения об ошибках и способы их обработки

<br>
<details>
<summary>1. Ошибка: отсутствует согласие.</summary>
<br>
Когда служба Azure AD получает запрос на доступ к ресурсу Microsoft Graph, она проверяет, предоставил ли пользователь (или администратор клиента) согласие для этого ресурса. Если нет записи согласия от пользователя или администратора, Azure AD отправляет сообщение об ошибке в вашу веб-службу.

Ваш код должен сообщить клиенту (например, в тексте отклика 403 "Запрещено"), как обрабатывать ошибку:

- Если приложению вкладки требуются области Microsoft Graph, для которых только администратор может предоставить согласие, ваш код должен создать ошибку.
- Если пользователь может дать согласие только на те области, которые ему нужны, ваш код должен инициировать возврат к альтернативной системе проверки подлинности пользователя.

</details>
<br>
<details>
<summary>2. Ошибка: отсутствует область (разрешение).</summary>
<br>
Эта ошибка возникает только во время разработки.

Для обработки этой ошибки ваш код на стороне сервера должен отправить клиенту отклик 403 "Запрещено". Следует записать ошибку в консоли или журнале.
</details>
<br>
<details>
<summary>3. Ошибка: недопустимая аудитория в маркере доступа для Microsoft Graph.</summary>
<br>
Серверный код должен отправить клиенту отклик 403 "Запрещено" для отображения сообщения пользователю. Рекомендуется также записать ошибку в консоли или журнале.
</details>
<br>
<details>
<summary>4. Ошибка: имя узла не должно быть основано на уже приобретенных доменах.</summary>
<br>
Эту ошибку можно получить в одном из двух сценариев:

1. Личный домен не добавлен в Azure AD. Чтобы добавить личный домен в Azure AD и зарегистрировать его, выполните процедуру по [добавлению имени личного домена в Azure AD](/azure/active-directory/fundamentals/add-custom-domain) и снова выполните действия по [настройке области для маркера доступа](tab-sso-register-aad.md#configure-scope-for-access-token).
1. Вы не вошли с учетными данными администратора в клиент Microsoft 365. Войдите в Microsoft 365 в качестве администратора.

</details>
<br>
<details>
<summary>5. Ошибка: имя субъекта-пользователя (UPN) не получено в возвращенном маркере доступа.</summary>
<br>
Имя участника-пользователя можно добавить в качестве необязательного утверждения в Azure AD.

Дополнительные сведения см. в разделе [Предоставление необязательных утверждений для приложения](/azure/active-directory/develop/active-directory-optional-claims) и [Маркеры доступа](/azure/active-directory/develop/access-tokens).
</details>
<br>
<details>
<summary>6. Ошибка: ошибка SDK Teams — resourceDisabled.</summary>
<br>
Чтобы избежать этой ошибки, убедитесь, что URI идентификатора приложения правильно настроен в регистрации приложения Azure AD и в клиенте Teams.

Дополнительные сведения об URI идентификатора приложения см. в разделе [Предоставление API](tab-sso-register-aad.md#to-expose-an-api).

</details>
<br>

<details>
<summary>7. Ошибка: общая ошибка при запуске приложения вкладки.</summary>
<br>
Общая ошибка может отображаться, если неверна одна или несколько конфигураций приложения, созданных в Azure AD. Чтобы устранить эту ошибку, проверьте, соответствуют ли значениям в Azure AD сведения о приложении, настроенные в вашем коде и манифесте Teams.

На следующем изображении показан пример сведений о приложении, настроенных в Azure AD.

:::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-app-details.png" alt-text="Значения конфигурации приложения в Azure AD":::

Проверьте совпадение следующих значений в Azure AD, клиентском коде и манифесте приложения Teams.

- **Идентификатор приложения**: идентификатор приложения, созданный в Azure AD, должен быть аналогичным в коде и файле манифеста Teams. Проверьте, совпадает ли идентификатор приложения в манифесте Teams с **идентификатором приложения (клиент)** в Azure AD.

- **Секрет приложения**: секрет приложения, настроенный в серверной части вашего приложения, должен совпадать с **учетными данными клиента** в Azure AD.
    Также проверьте, истек ли срок действия секрета клиента.

- **URI идентификатора приложения**: URI идентификатора приложения в коде и файле манифеста приложения Teams должен совпадать с **URI идентификатора приложения** в Azure AD.

- **Разрешения приложения**: проверьте, соответствуют ли разрешения, определенные в области, требованиям вашего приложения. Если да, проверьте, были ли они предоставлены пользователю в маркере доступа.

- **Согласие администратора**: если для какой-либо области требуется согласие администратора, проверьте, предоставлено ли пользователю согласие для конкретной области.

Кроме того, проверьте маркер доступа, отправленный приложению вкладки, чтобы убедиться в правильности следующих значений.

- **Аудитория (aud)**: проверьте в маркере правильность идентификатора приложения, указанного в Azure AD.
- **Идентификатор клиента (tid)**: проверьте правильность клиента, указанного в маркере.
- **Удостоверение пользователя (preferred_username)**: проверьте, совпадает ли удостоверение пользователя с именем пользователя в запросе маркера доступа для области, к которой текущий пользователь хочет получить доступ.
- **Области (scp)**: проверьте, верна ли область, для которой запрашивается маркер доступа, и соответствует ли она определению в Azure AD.
- **Azure AD версии 1.0 или 2.0 (ver)**: проверьте, верна ли версия Azure AD.

Для проверки маркера вы можете использовать [JWT](https://jwt.ms).

</details>
