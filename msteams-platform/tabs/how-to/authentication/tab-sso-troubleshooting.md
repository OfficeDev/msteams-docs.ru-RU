---
title: Устранение неполадок проверки подлинности для вкладок с помощью единого входа в Teams
description: Устранение неполадок проверки подлинности единого входа в Teams и ее использование на вкладке
ms.topic: how-to
ms.localizationpriority: medium
keywords: Вкладки проверки подлинности teams Microsoft Azure Active Directory (Azure AD) вопросы об ошибках единого входа
ms.openlocfilehash: 74246dce24869bb4645045950de01c179ba129d8
ms.sourcegitcommit: 12510f34b00bfdd0b0e92d35c8dbe6ea1f6f0be2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2022
ms.locfileid: "66032811"
---
# <a name="troubleshooting-sso-authentication-in-teams"></a>Устранение неполадок проверки подлинности единого входа в Teams

Ниже приведен список проблем и вопросов по единому входу и способам их устранения.
<br>

## <a name="support-for-microsoft-graph"></a>Поддержка microsoft Graph

<br>
<details>
<summary>1. Работает ли API Graph Postman?</summary>
<br>
Вы можете использовать коллекцию Microsoft Graph Postman с microsoft Graph API.

Дополнительные сведения см. в статье [Использование Postman с API Microsoft Graph](/graph/use-postman).
</details>
<br>
<details>
<summary>2. Работает ли API Graph Microsoft Graph Explorer?</summary>
<br>
Да, API Graph работает в Microsoft Graph Explorer.

Дополнительные сведения см[. в Graph explorer](https://developer.microsoft.com/graph/graph-explorer).

</details>
<br>

## <a name="error-messages-and-how-to-handle-them"></a>Сообщения об ошибках и способы их обработки

<br>
<details>
<summary>1. Ошибка: отсутствует согласие.</summary>
<br>
Когда Azure AD получает запрос на доступ к ресурсу Microsoft Graph, он проверяет, предоставил ли пользователь (или администратор клиента) согласие на этот ресурс. Если нет записи согласия от пользователя или администратора, Azure AD отправляет сообщение об ошибке в веб-службу.

Код должен сообщить клиенту (например, в тексте ответа 403 Forbidden) о том, как обрабатывать ошибку:

- Если приложению табуляции требуется microsoft Graph области, для которых только администратор может дать согласие, код должен создать ошибку.
- Если пользователь может дать согласие только на те области, которые ему нужны, ваш код должен инициировать возврат к альтернативной системе проверки подлинности пользователя.

</details>
<br>
<details>
<summary>2. Ошибка: отсутствует область (разрешение).</summary>
<br>
Эта ошибка возникает только во время разработки.

Для обработки этой ошибки код на стороне сервера должен отправить клиенту ответ 403 Forbidden. Она должна записать ошибку в консоль или записать ее в журнал.
</details>
<br>
<details>
<summary>3. Ошибка: недопустимая аудитория в маркере доступа для Microsoft Graph.</summary>
<br>
Серверный код должен отправить клиенту ответ 403 Forbidden для отображения сообщения пользователю. Рекомендуется также записать ошибку в консоль или записать ее в журнал.
</details>
<br>
<details>
<summary>4. Ошибка: имя узла не должно быть основано на уже принадлежащих доменах.</summary>
<br>
Эту ошибку можно получить в одном из двух сценариев:

1. Личный домен не добавляется в Azure AD. Чтобы добавить личный домен Azure AD и зарегистрировать его, выполните инструкции по [](/azure/active-directory/fundamentals/add-custom-domain) добавлению имени личного домена в Azure AD процедуре, а затем выполните действия по настройке области для маркера [доступа еще](tab-sso-register-aad.md#configure-scope-for-access-token) раз.
1. Вы не вошли с учетными данными администратора в клиенте Microsoft 365 клиента. Войдите в Microsoft 365 с правами администратора.

</details>
<br>
<details>
<summary>5. Ошибка: имя участника-пользователя (UPN) не получено в возвращенном маркере доступа.</summary>
<br>
Имя участника-пользователя можно добавить в качестве необязательного утверждения в Azure AD.

Дополнительные сведения см. в [разделе "Предоставление необязательных утверждений для приложения и](/azure/active-directory/develop/active-directory-optional-claims) [маркеров доступа"](/azure/active-directory/develop/access-tokens).
</details>
<br>
<details>
<summary>6. Ошибка: Teams пакета SDK: resourceDisabled.</summary>
<br>
Чтобы избежать этой ошибки, убедитесь, что URI идентификатора приложения правильно настроен Azure AD регистрации приложения и в Teams клиенте.

Дополнительные сведения о URI идентификатора приложения см. в [разделе "Предоставление API"](tab-sso-register-aad.md#to-expose-an-api).

</details>
<br>

<details>
<summary>7. Ошибка: общая ошибка при запуске приложения вкладки.</summary>
<br>
Общая ошибка может отображаться, если одна или несколько конфигураций приложений, выполненных в Azure AD неверны. Чтобы устранить эту ошибку, проверьте, соответствуют ли сведения о приложении, настроенные в коде Teams манифесту, значениям в Azure AD.

На следующем рисунке показан пример сведений о приложении, настроенных в Azure AD.

:::image type="content" source="../../../assets/images/authentication/teams-sso-tabs/azure-app-details.png" alt-text="Значения конфигурации приложения в Azure AD" border="false":::

Убедитесь, что следующие значения совпадают между Azure AD, клиентским кодом и Teams приложения:

- **Идентификатор приложения**: идентификатор приложения, созданный в Azure AD должен совпадать в коде и Teams файле манифеста. Проверьте идентификатор приложения в Teams совпадает с идентификатором приложения **(клиента)** в Azure AD.

- **Секрет приложения**: секрет приложения, настроенный в серверной части приложения, должен соответствовать учетным данным клиента **в Azure AD.**
    Также следует проверить, истек ли срок действия секрета клиента.

- **URI идентификатора** приложения: URI идентификатора приложения в коде и Teams файле манифеста приложения должен соответствовать **URI** идентификатора приложения в Azure AD.

- **Разрешения приложения**. Проверьте, соответствует ли разрешения, определенные в области, требованиям вашего приложения. Если да, проверьте, были ли они предоставлены пользователю в маркере доступа.

- **Согласие администратора**. Если для какой-либо области требуется согласие администратора, проверьте, предоставлено ли согласие для конкретной области пользователю.

Кроме того, проверьте маркер доступа, который был отправлен в приложение вкладки, чтобы проверить правильность следующих значений:

- **Аудитория (aud)**: проверьте правильность идентификатора приложения в маркере, указанного в Azure AD.
- **Идентификатор клиента (tid)**: проверьте правильность клиента, указанного в маркере.
- **Удостоверение пользователя (preferred_username)**: проверьте, совпадает ли удостоверение пользователя с именем пользователя в запросе маркера доступа для области, к которому текущий пользователь хочет получить доступ.
- **Области (scp)**: проверьте, является ли область, для которой запрашивается маркер доступа, правильной и как определено в Azure AD.
- **Azure AD версии 1.0 или 2.0 (ver)**: проверьте, Azure AD правильная версия.

Для [проверки маркера можно использовать JWT](https://jwt.ms) .

</details>
