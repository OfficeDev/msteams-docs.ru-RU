---
title: Поддержка единого входного знака для вкладок
description: Описывает один вход (SSO)
ms.topic: how-to
keywords: группы проверки подлинности SSO AAD единого api для входов
ms.openlocfilehash: 7b8406473b8356b9c26948641b49f7e1239e697a
ms.sourcegitcommit: 5cb3453e918bec1173899e7591b48a48113cf8f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "50449264"
---
# <a name="single-sign-on-sso-support-for-tabs"></a><span data-ttu-id="6d928-104">Поддержка единого входного знака (SSO) для вкладок</span><span class="sxs-lookup"><span data-stu-id="6d928-104">Single sign-on (SSO) support for tabs</span></span>

<span data-ttu-id="6d928-105">Пользователи во входе в Microsoft Teams через свои учетные записи в работе, школе или Microsoft (Office 365, Outlook и т.д.).</span><span class="sxs-lookup"><span data-stu-id="6d928-105">Users sign in to Microsoft Teams via their work, school, or Microsoft accounts (Office 365, Outlook, etc).</span></span> <span data-ttu-id="6d928-106">Вы можете воспользоваться этим, разрешив одному входу авторизировать вкладку Microsoft Teams (или модуль задач) на настольных компьютерах или мобильных клиентах.</span><span class="sxs-lookup"><span data-stu-id="6d928-106">You can take advantage of this by allowing a single sign-on to authorize your Microsoft Teams tab (or task module) on desktop or mobile clients.</span></span> <span data-ttu-id="6d928-107">Таким образом, если пользователь соглашается использовать ваше приложение, он не должен будет снова соглашаться на другое устройство — они будут подписаны автоматически.</span><span class="sxs-lookup"><span data-stu-id="6d928-107">Thus, if a user consents to use your app, they won’t have to consent again on another device — they will be signed in automatically.</span></span> <span data-ttu-id="6d928-108">Кроме того, мы предоформим маркер доступа, чтобы повысить производительность и время загрузки.</span><span class="sxs-lookup"><span data-stu-id="6d928-108">In addition, we prefetch your access token to improve performance and load times.</span></span>

> [!NOTE]
> <span data-ttu-id="6d928-109">**Команды мобильных клиентских версий, поддерживающих SSO**</span><span class="sxs-lookup"><span data-stu-id="6d928-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="6d928-110">✔Teams для Android (1416/1.0.0.2020073101 и более поздней версии)</span><span class="sxs-lookup"><span data-stu-id="6d928-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="6d928-111">✔Teams для iOS _(Версия_: 2.0.18 и более поздней версии)</span><span class="sxs-lookup"><span data-stu-id="6d928-111">✔Teams for iOS (_Version_: 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="6d928-112">Чтобы лучше работать с Teams, используйте последнюю версию iOS и Android.</span><span class="sxs-lookup"><span data-stu-id="6d928-112">For the best experience with Teams, please use the latest version of iOS and Android.</span></span>

> [!NOTE]
> <span data-ttu-id="6d928-113">**Быстрый запуск**</span><span class="sxs-lookup"><span data-stu-id="6d928-113">**Quickstart**</span></span>  
>
> <span data-ttu-id="6d928-114">Самый простой путь к началу работы с SSO вкладки — это с помощью microsoft Teams набор средств для Visual Studio code.</span><span class="sxs-lookup"><span data-stu-id="6d928-114">The simplest path to getting started with tab SSO is with the Microsoft Teams Toolkit for Visual Studio Code.</span></span> [<span data-ttu-id="6d928-115">Подробнее</span><span class="sxs-lookup"><span data-stu-id="6d928-115">Learn more</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="6d928-116">Принцип работы единого входа во время выполнения</span><span class="sxs-lookup"><span data-stu-id="6d928-116">How SSO works at runtime</span></span>

<span data-ttu-id="6d928-117">На следующей схеме показано, как работает процесс SSO:</span><span class="sxs-lookup"><span data-stu-id="6d928-117">The following diagram shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="6d928-118">На вкладке выполнен вызов JavaScript для `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="6d928-118">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="6d928-119">Это указывает Teams на получение маркера проверки подлинности для приложения вкладки.</span><span class="sxs-lookup"><span data-stu-id="6d928-119">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="6d928-120">Если текущий пользователь впервые использовал приложение вкладки, будет предложен запрос на согласие (если требуется согласие) или обработку этапной проверки подлинности (например, двух факторов проверки подлинности).</span><span class="sxs-lookup"><span data-stu-id="6d928-120">If this is the first time the current user has used your tab application, there will be a request prompt to consent (if consent is required) or to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="6d928-121">Teams запрашивает маркер приложения вкладок из конечной точки Azure AD для текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="6d928-121">Teams requests the tab application token from the Azure AD endpoint for the current user.</span></span>
4. <span data-ttu-id="6d928-122">Azure AD отправляет маркер приложения-вкладки в приложение Teams.</span><span class="sxs-lookup"><span data-stu-id="6d928-122">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="6d928-123">Teams отправляет маркер приложения вкладок на вкладку как часть объекта результатов, возвращаемого `getAuthToken()` вызовом.</span><span class="sxs-lookup"><span data-stu-id="6d928-123">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="6d928-124">Маркер будет разбором в приложении вкладки с помощью JavaScript, чтобы извлечь необходимую информацию, например адрес электронной почты пользователя.</span><span class="sxs-lookup"><span data-stu-id="6d928-124">The token will be parsed in the tab application, via JavaScript, to extract the needed information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="6d928-125">Это допустимо только для согласия на ограниченный набор API уровня пользователя — электронной почты, профиля, offline_access и OpenId , а не для дополнительных областей Microsoft Graph, таких как `getAuthToken()` `User.Read` или `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="6d928-125">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs — email, profile, offline_access and OpenId — and not for further Microsoft Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="6d928-126">Дополнительные области Graph см. в нашем разделе в конце этого документа для предлагаемых обходных [обходных обходов.](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="6d928-126">See our section at the end of this document for suggested workarounds if you require [additional Graph scopes](#apps-that-require-additional-microsoft-graph-scopes).</span></span>

<span data-ttu-id="6d928-127">API SSO также будет работать в модулях [задач,](../../../task-modules-and-cards/what-are-task-modules.md) встраив веб-контент.</span><span class="sxs-lookup"><span data-stu-id="6d928-127">The SSO API will also work in [Task Modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="6d928-128">Разработка вкладки SSO Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="6d928-128">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="6d928-129">В этом разделе описываются задачи, связанные с созданием вкладки Teams, использующей SSO.</span><span class="sxs-lookup"><span data-stu-id="6d928-129">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="6d928-130">Эти задачи описаны здесь языком и framework-agnostic.</span><span class="sxs-lookup"><span data-stu-id="6d928-130">These tasks are described here are language- and framework-agnostic.</span></span>

### <a name="1-create-your-azure-active-directory-azure-ad-application"></a><span data-ttu-id="6d928-131">1. Создайте приложение Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="6d928-131">1. Create your Azure Active Directory (Azure AD) application</span></span>

#### <a name="registering-your-application-in-theazure-ad-portal-overview"></a><span data-ttu-id="6d928-132">Регистрация приложения в обзоре[портала Azure AD:](https://azure.microsoft.com/features/azure-portal/)</span><span class="sxs-lookup"><span data-stu-id="6d928-132">Registering your application in the[Azure AD portal](https://azure.microsoft.com/features/azure-portal/) overview:</span></span>

1. <span data-ttu-id="6d928-133">Получите [свой ID приложения Azure AD.](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in)</span><span class="sxs-lookup"><span data-stu-id="6d928-133">Get your [Azure AD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="6d928-134">Укажите разрешения, необходимые приложению для конечной точки Azure AD и, необязательно, Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="6d928-134">Specify the permissions that your application needs for the Azure AD endpoint and, optionally, Microsoft Graph.</span></span>
3. <span data-ttu-id="6d928-135">[Предоставление разрешений](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) для настольных, веб-приложений и мобильных приложений Teams.</span><span class="sxs-lookup"><span data-stu-id="6d928-135">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="6d928-136">Предварительно авторизуйте Teams, выбрав кнопку **Добавить** область и открываемую панель, введите в качестве `access_as_user` имени **Область.**</span><span class="sxs-lookup"><span data-stu-id="6d928-136">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="6d928-137">Существует ряд важных ограничений, которые необходимо иметь в виду:</span><span class="sxs-lookup"><span data-stu-id="6d928-137">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="6d928-138">Мы поддерживаем только разрешения API Microsoft Graph на уровне пользователей, например электронную почту, профиль, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="6d928-138">We only support user-level Microsoft Graph API permissions, i.e., email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="6d928-139">Если вам необходим доступ к другим областьм Microsoft Graph (например, или), см. в нашем рекомендуемом обходе в `User.Read` `Mail.Read` конце этой документации. [](#apps-that-require-additional-microsoft-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="6d928-139">If you need access to other Microsoft Graph scopes (such as `User.Read` or `Mail.Read`), see our [recommended workaround](#apps-that-require-additional-microsoft-graph-scopes) at the end of this documentation.</span></span>
> * <span data-ttu-id="6d928-140">Важно, чтобы доменное имя вашего приложения было таким же, как доменное имя, которое вы зарегистрировали для приложения Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6d928-140">It's important that your application's domain name is the same as the domain name you've registering for your Azure AD application.</span></span>
> * <span data-ttu-id="6d928-141">В настоящее время мы не поддерживаем несколько доменов в приложении.</span><span class="sxs-lookup"><span data-stu-id="6d928-141">We don't currently support multiple domains per app.</span></span>
> * <span data-ttu-id="6d928-142">Мы не поддерживаем приложения, которые используют домен, так как он является слишком распространенным и может `azurewebsites.net` быть угрозой безопасности.</span><span class="sxs-lookup"><span data-stu-id="6d928-142">We don't support applications that use the `azurewebsites.net` domain because it is too common and may be a security risk.</span></span> <span data-ttu-id="6d928-143">Тем не менее, мы активно стремимся удалить это ограничение.</span><span class="sxs-lookup"><span data-stu-id="6d928-143">However, we're actively seeking to remove this restriction.</span></span>

#### <a name="registering-your-app-through-the-azure-active-directory-portal-in-depth"></a><span data-ttu-id="6d928-144">Подробное регистрация приложения на портале Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="6d928-144">Registering your app through the Azure Active Directory portal in-depth:</span></span>

1. <span data-ttu-id="6d928-145">Регистрация нового приложения на [портале Регистрации приложений Azure Active Directory.](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="6d928-145">Register a new application in the [Azure Active Directory – App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="6d928-146">Выберите **новую регистрацию** и на странице *регистрации приложения* установите следующие значения:</span><span class="sxs-lookup"><span data-stu-id="6d928-146">Select **New Registration** and on the *register an application page*, set following values:</span></span>
    * <span data-ttu-id="6d928-147">**Задайте** имя имени приложения.</span><span class="sxs-lookup"><span data-stu-id="6d928-147">Set **name** to your app name.</span></span>
    * <span data-ttu-id="6d928-148">Выберите **поддерживаемые типы учетных** записей (любой тип учетной записи будет работать) ¹</span><span class="sxs-lookup"><span data-stu-id="6d928-148">Choose the **supported account types** (any account type will work) ¹</span></span>
    * <span data-ttu-id="6d928-149">Оставьте поле **URI перенаправления** пустым.</span><span class="sxs-lookup"><span data-stu-id="6d928-149">Leave **Redirect URI** empty.</span></span>
    * <span data-ttu-id="6d928-150">Нажмите кнопку **Зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="6d928-150">Choose **Register**.</span></span>
3. <span data-ttu-id="6d928-151">На странице обзор скопируйте и сохраните ID приложения **(клиента).**</span><span class="sxs-lookup"><span data-stu-id="6d928-151">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="6d928-152">Он понадобится позже при обновлении манифеста приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="6d928-152">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="6d928-153">В разделе **Управление** выберите **Предоставление API**.</span><span class="sxs-lookup"><span data-stu-id="6d928-153">Under **Manage**, select **Expose an API**.</span></span> 
5. <span data-ttu-id="6d928-154">Выберите **ссылку Set** для создания URI ID приложения в виде `api://{AppID}` .</span><span class="sxs-lookup"><span data-stu-id="6d928-154">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="6d928-155">Вставьте полностью квалифицированное доменное имя (с переназначенной чертой "/" в конце) между двумя полосами вперед и GUID.</span><span class="sxs-lookup"><span data-stu-id="6d928-155">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="6d928-156">Весь ID должен иметь форму: `api://fully-qualified-domain-name.com/{AppID}` ²</span><span class="sxs-lookup"><span data-stu-id="6d928-156">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}` ²</span></span>
    * <span data-ttu-id="6d928-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="6d928-157">ex: `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span>
    
    <span data-ttu-id="6d928-158">Полностью квалифицированное доменное имя — это доступное для чтения имя домена, из которого обслуживается ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="6d928-158">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="6d928-159">Если вы используете службу тоннелей, например ngrok, вам потребуется обновить это значение всякий раз, когда изменяется поддомен ngrok.</span><span class="sxs-lookup"><span data-stu-id="6d928-159">If you are using a tunneling service such as ngrok, you will need to update     this value whenever your ngrok subdomain changes.</span></span> 
6. <span data-ttu-id="6d928-160">Нажмите кнопку **Добавить область**.</span><span class="sxs-lookup"><span data-stu-id="6d928-160">Select the **Add a scope** button.</span></span> <span data-ttu-id="6d928-161">В открывшейся панели введите `access_as_user` в качестве параметра **Имя области**.</span><span class="sxs-lookup"><span data-stu-id="6d928-161">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
7. <span data-ttu-id="6d928-162">Set **Who can consent?** to `Admins and users`</span><span class="sxs-lookup"><span data-stu-id="6d928-162">Set **Who can consent?** to `Admins and users`</span></span>
8. <span data-ttu-id="6d928-163">Заполните поля для настройки подсказок согласия администратора и пользователя со значениями, подходящими для `access_as_user` области:</span><span class="sxs-lookup"><span data-stu-id="6d928-163">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="6d928-164">**Название согласия администратора:** Команды могут получить доступ к профилю пользователя.</span><span class="sxs-lookup"><span data-stu-id="6d928-164">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="6d928-165">**Описание согласия администратора.** Позволяет Teams вызывать веб-API приложения в качестве текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="6d928-165">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="6d928-166">**Название согласия пользователя.** Команды могут получать доступ к профиле пользователя и делать запросы от имени пользователя.</span><span class="sxs-lookup"><span data-stu-id="6d928-166">**User consent title**: Teams can access the user profile and make requests on the user's behalf.</span></span>
    * <span data-ttu-id="6d928-167">**Описание согласия пользователя:** Включить Teams для вызова API этого приложения с тем же правам, что и пользователь.</span><span class="sxs-lookup"><span data-stu-id="6d928-167">**User consent description:** Enable Teams to call this app’s APIs with the same rights as the user.</span></span>
9. <span data-ttu-id="6d928-168">**Убедитесь, что состояние** **включено**</span><span class="sxs-lookup"><span data-stu-id="6d928-168">Ensure that **State** is set to **Enabled**</span></span>
10. <span data-ttu-id="6d928-169">Выберите **кнопку Добавить область,** чтобы сохранить</span><span class="sxs-lookup"><span data-stu-id="6d928-169">Select the **Add scope** button to save</span></span> 
    * <span data-ttu-id="6d928-170">Доменная часть имени **Scope,** отображаемая чуть ниже текстового поля, должна автоматически соответствовать набору URI **ID** приложения на предыдущем шаге с приложением до `/access_as_user` конца:</span><span class="sxs-lookup"><span data-stu-id="6d928-170">The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end:</span></span>
        * `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`
11. <span data-ttu-id="6d928-171">В разделе **Авторизованные клиентские приложения** определите приложения, которые необходимо авторизировать для веб-приложения вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="6d928-171">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="6d928-172">Выберите *Добавление клиентского приложения.*</span><span class="sxs-lookup"><span data-stu-id="6d928-172">Select *Add a client application*.</span></span> <span data-ttu-id="6d928-173">Введите каждый из следующих клиентских ИД и выберите авторизованную область, созданную на предыдущем шаге:</span><span class="sxs-lookup"><span data-stu-id="6d928-173">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="6d928-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span><span class="sxs-lookup"><span data-stu-id="6d928-174">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="6d928-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Веб-приложение Teams)</span><span class="sxs-lookup"><span data-stu-id="6d928-175">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
12. <span data-ttu-id="6d928-176">Перейдите **к разрешениям API.**</span><span class="sxs-lookup"><span data-stu-id="6d928-176">Navigate to **API Permissions**.</span></span> <span data-ttu-id="6d928-177">Выберите *Добавить разрешения,* делегированные Microsoft Graph, а затем добавьте следующие разрешения из  >    >  API Microsoft Graph:</span><span class="sxs-lookup"><span data-stu-id="6d928-177">Select *Add a permission* > *Microsoft Graph* > *Delegated permissions*, then add the following permissions from Microsoft Graph API:</span></span>
    * <span data-ttu-id="6d928-178">User.Read (включен по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="6d928-178">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="6d928-179">рассылка</span><span class="sxs-lookup"><span data-stu-id="6d928-179">email</span></span>
    * <span data-ttu-id="6d928-180">offline_access</span><span class="sxs-lookup"><span data-stu-id="6d928-180">offline_access</span></span>
    * <span data-ttu-id="6d928-181">OpenId</span><span class="sxs-lookup"><span data-stu-id="6d928-181">OpenId</span></span>
    * <span data-ttu-id="6d928-182">profile</span><span class="sxs-lookup"><span data-stu-id="6d928-182">profile</span></span>

13. <span data-ttu-id="6d928-183">Переход к **проверке подлинности**</span><span class="sxs-lookup"><span data-stu-id="6d928-183">Navigate to **Authentication**</span></span>

    <span data-ttu-id="6d928-184">Если приложению не было предоставлено согласие ИТ-администратора, пользователи должны будут предоставить согласие при первом использовании приложения.</span><span class="sxs-lookup"><span data-stu-id="6d928-184">If an app hasn't been granted IT admin consent, users will have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="6d928-185">Установите URI перенаправления:</span><span class="sxs-lookup"><span data-stu-id="6d928-185">Set a redirect URI:</span></span>
    * <span data-ttu-id="6d928-186">Выберите **Добавить платформу.**</span><span class="sxs-lookup"><span data-stu-id="6d928-186">Select **Add a platform**.</span></span>
    * <span data-ttu-id="6d928-187">Выберите **веб.**</span><span class="sxs-lookup"><span data-stu-id="6d928-187">Select **web**.</span></span>
    * <span data-ttu-id="6d928-188">Введите **URI перенаправления** для приложения.</span><span class="sxs-lookup"><span data-stu-id="6d928-188">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="6d928-189">Это будет страница, на которой успешный неявный поток грантов будет перенаправлять пользователя.</span><span class="sxs-lookup"><span data-stu-id="6d928-189">This will be the page where a successful implicit grant flow will redirect the user.</span></span> <span data-ttu-id="6d928-190">Это будет то же полное доменное имя, которое вы ввели на шаге 5, а затем маршрут API, куда должен быть отправлен ответ на проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="6d928-190">This will be same fully qualified domain name that you entered in step 5 followed by the API route where a authentication response should be sent.</span></span> <span data-ttu-id="6d928-191">Если вы следуете за любыми примерами Teams, это будет: `https://subdomain.example.com/auth-end`</span><span class="sxs-lookup"><span data-stu-id="6d928-191">If you are following any of the Teams samples, this will be: `https://subdomain.example.com/auth-end`</span></span>

    <span data-ttu-id="6d928-192">Далее включить неявный грант, проверив следующие поля:</span><span class="sxs-lookup"><span data-stu-id="6d928-192">Next, enable implicit grant by checking the following boxes:</span></span>  
    <span data-ttu-id="6d928-193">✔ ID Token</span><span class="sxs-lookup"><span data-stu-id="6d928-193">✔ ID Token</span></span>  
    <span data-ttu-id="6d928-194">✔ маркер доступа</span><span class="sxs-lookup"><span data-stu-id="6d928-194">✔ Access Token</span></span>  
    
<span data-ttu-id="6d928-195">Поздравляем!</span><span class="sxs-lookup"><span data-stu-id="6d928-195">Congratulations!</span></span> <span data-ttu-id="6d928-196">Вы выполнили необходимые условия регистрации приложений для работы с приложением SSO вкладки.</span><span class="sxs-lookup"><span data-stu-id="6d928-196">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>     

> [!NOTE]
>
> * <span data-ttu-id="6d928-197">¹ Если приложение Azure AD зарегистрировано в том же клиенте, где вы делаете запрос на проверку подлинности в Teams, пользователю не будет предложено дать согласие и ему сразу же будет предоставлен маркер доступа. </span><span class="sxs-lookup"><span data-stu-id="6d928-197">¹ If your Azure AD app is registered in the _same_ tenant where you're making an authentication request in Teams, the user won't be asked to consent and will be granted an access token right away.</span></span> <span data-ttu-id="6d928-198">Пользователи должны согласиться на эти разрешения только в том случае, если приложение Azure AD зарегистрировано в другом клиенте.</span><span class="sxs-lookup"><span data-stu-id="6d928-198">Users only need to consent to these permissions if the Azure AD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="6d928-199">² Если вы получаете ошибку, указывав, что домен уже принадлежит и вы владелец, выполните процедуру в [Quickstart:](/azure/active-directory/fundamentals/add-custom-domain) Добавьте настраиваемую доменную фамилию в Azure Active Directory для регистрации домена, а затем повторите шаг 5 выше.</span><span class="sxs-lookup"><span data-stu-id="6d928-199">² If you get an error stating that the domain is already owned and you are the owner, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register the domain, and then repeat step 5, above.</span></span> <span data-ttu-id="6d928-200">(Эта ошибка также может возникнуть, если вы не подписаны с учетными данными администратора в аренде Office 365).</span><span class="sxs-lookup"><span data-stu-id="6d928-200">(This error can also occur if you aren't signed in with Admin credentials in the Office 365 tenancy).</span></span>
> * <span data-ttu-id="6d928-201">Если вы не получаете upN (имя пользователя) в возвращенном маркере доступа, вы можете добавить его в качестве необязательных утверждений [в](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6d928-201">If you are not receiving the UPN (User Principal Name) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="6d928-202">2. Обновление манифеста приложения Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="6d928-202">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="6d928-203">Добавьте новые свойства в манифест Microsoft Teams:</span><span class="sxs-lookup"><span data-stu-id="6d928-203">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="6d928-204">**WebApplicationInfo** — родитель следующих элементов:</span><span class="sxs-lookup"><span data-stu-id="6d928-204">**WebApplicationInfo** - The parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="6d928-205">**id** — ID клиента приложения.</span><span class="sxs-lookup"><span data-stu-id="6d928-205">**id** - The client ID of the application.</span></span> <span data-ttu-id="6d928-206">Это ИД приложения, полученный в рамках регистрации приложения в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6d928-206">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="6d928-207">**ресурс** — домен и поддомен приложения.</span><span class="sxs-lookup"><span data-stu-id="6d928-207">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="6d928-208">Это тот же URI (включая протокол), который вы зарегистрировали при создании на `api://` `scope` шаге 6 выше.</span><span class="sxs-lookup"><span data-stu-id="6d928-208">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6 above.</span></span> <span data-ttu-id="6d928-209">Не следует включать путь `access_as_user` в ресурс.</span><span class="sxs-lookup"><span data-stu-id="6d928-209">You shouldn't include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="6d928-210">Доменная часть этого URI должна соответствовать домену, в том числе любым поддоменам, используемым в URL-адресах манифеста приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="6d928-210">The domain part of this URI should match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

> [!NOTE]
>
>* <span data-ttu-id="6d928-211">Ресурс приложения AAD обычно является корнем URL-адреса сайта и приложения `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` (например).</span><span class="sxs-lookup"><span data-stu-id="6d928-211">The resource for an AAD app will usually be the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="6d928-212">Это значение также используется для обеспечения того, чтобы ваш запрос был исходя из того же домена.</span><span class="sxs-lookup"><span data-stu-id="6d928-212">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="6d928-213">Поэтому убедитесь, что вкладка использует те же домены, что `contentURL` и свойство ресурса.</span><span class="sxs-lookup"><span data-stu-id="6d928-213">Therefore, make sure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="6d928-214">Для реализации поля необходимо использовать манифестную версию 1.5 или `webApplicationInfo` более.</span><span class="sxs-lookup"><span data-stu-id="6d928-214">You need to use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="6d928-215">3. Получите маркер проверки подлинности из клиентского кода</span><span class="sxs-lookup"><span data-stu-id="6d928-215">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="6d928-216">Вот как выглядит API проверки подлинности:</span><span class="sxs-lookup"><span data-stu-id="6d928-216">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); }
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="6d928-217">Когда вы звоните , и требуется дополнительное согласие пользователя (для разрешений на уровне пользователя), мы покажем диалоговое окно пользователю, поощряя его предоставить `getAuthToken` дополнительное согласие.</span><span class="sxs-lookup"><span data-stu-id="6d928-217">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<span data-ttu-id="6d928-218">После получения маркера доступа в вызове успешного вызова можно расшифровать маркер доступа для просмотра утверждений, связанных с этим маркером.</span><span class="sxs-lookup"><span data-stu-id="6d928-218">After you receive the access token in the success callback, you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="6d928-219">Необязательно можно вручную скопировать и вклеить маркер доступа [](https://jwt.ms/) в средство, например jwt.ms для проверки его содержимого.</span><span class="sxs-lookup"><span data-stu-id="6d928-219">Optionally, you can manually copy and paste the access token into a tool, such as [jwt.ms](https://jwt.ms/) to inspect its contents.</span></span> <span data-ttu-id="6d928-220">Если вы не получаете основное имя пользователя (UPN) в возвращенном маркере доступа, вы можете добавить его в качестве необязательных утверждений [в](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6d928-220">If you are not receiving the User Principal Name (UPN) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in Azure AD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="code-sample"></a><span data-ttu-id="6d928-221">Пример кода</span><span class="sxs-lookup"><span data-stu-id="6d928-221">Code sample</span></span>

|<span data-ttu-id="6d928-222">**Пример имени**</span><span class="sxs-lookup"><span data-stu-id="6d928-222">**Sample name**</span></span>|<span data-ttu-id="6d928-223">**Описание**</span><span class="sxs-lookup"><span data-stu-id="6d928-223">**Description**</span></span>|<span data-ttu-id="6d928-224">**C#**</span><span class="sxs-lookup"><span data-stu-id="6d928-224">**C#**</span></span>|<span data-ttu-id="6d928-225">**TypeScript**</span><span class="sxs-lookup"><span data-stu-id="6d928-225">**TypeScript**</span></span>|
|---------------|---------------|------|--------------|
| <span data-ttu-id="6d928-226">Tab SSO</span><span class="sxs-lookup"><span data-stu-id="6d928-226">Tab SSO</span></span> |<span data-ttu-id="6d928-227">Пример приложения Microsoft Teams для вкладок Azure AD SSO</span><span class="sxs-lookup"><span data-stu-id="6d928-227">Microsoft Teams sample app for tabs Azure AD SSO</span></span>| [<span data-ttu-id="6d928-228">View</span><span class="sxs-lookup"><span data-stu-id="6d928-228">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/tab-sso/csharp)|<span data-ttu-id="6d928-229">[Просмотр](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span><span class="sxs-lookup"><span data-stu-id="6d928-229">[View](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span></span> </br>[<span data-ttu-id="6d928-230">Teams набор средств</span><span class="sxs-lookup"><span data-stu-id="6d928-230">Teams Toolkit</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)|

## <a name="known-limitations"></a><span data-ttu-id="6d928-231">Известные ограничения</span><span class="sxs-lookup"><span data-stu-id="6d928-231">Known Limitations</span></span>

### <a name="apps-that-require-additional-microsoft-graph-scopes"></a><span data-ttu-id="6d928-232">Приложения, которые требуют дополнительных областей Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="6d928-232">Apps that require additional Microsoft Graph Scopes</span></span>

<span data-ttu-id="6d928-233">Наша текущая реализация для SSO предоставляет согласие только для разрешений на уровне пользователей — электронной почты, профиля, offline_access, OpenId — не для других API (например, User.Read или Mail.Read).</span><span class="sxs-lookup"><span data-stu-id="6d928-233">Our current implementation for SSO only grants consent for user-level permissions — email, profile, offline_access, OpenId — not for other APIs (such as User.Read or Mail.Read).</span></span> <span data-ttu-id="6d928-234">Если вашему приложению необходимы дополнительные области Microsoft Graph, ниже приведен ряд разрешающих обходных действий:</span><span class="sxs-lookup"><span data-stu-id="6d928-234">If your app needs further Microsoft Graph scopes, here are some enabling workarounds:</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="6d928-235">Согласие администратора клиента</span><span class="sxs-lookup"><span data-stu-id="6d928-235">Tenant Admin Consent</span></span>

<span data-ttu-id="6d928-236">Самый простой подход — получить предварительное согласие администратора клиента от имени организации.</span><span class="sxs-lookup"><span data-stu-id="6d928-236">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="6d928-237">Это означает, что пользователям не придется соглашаться на эти области, и вы можете свободно обмениваться стороной сервера маркеров с помощью потока Azure AD от [имени.](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)</span><span class="sxs-lookup"><span data-stu-id="6d928-237">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using Azure AD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="6d928-238">Это обходное решение приемлемо для внутренних бизнес-приложений, но может оказаться недостаточно для сторонних разработчиков, которые могут не полагаться на утверждение администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="6d928-238">This workaround is acceptable for internal line-of-business applications but may not be enough for third-party developers who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="6d928-239">Простой способ согласия от имени организации (в качестве администратора клиента) — посетить:</span><span class="sxs-lookup"><span data-stu-id="6d928-239">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="6d928-240">Запрос дополнительного согласия с помощью API Auth</span><span class="sxs-lookup"><span data-stu-id="6d928-240">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="6d928-241">Другой подход для получения дополнительных областей Microsoft Graph заключается в том, чтобы представить диалоговое окно согласия с помощью нашего существующего веб-подхода к проверке подлинности [Azure AD,](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) который включает в себя создание диалогового диалога согласия Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6d928-241">Another approach for getting additional Microsoft Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog.</span></span> <span data-ttu-id="6d928-242">Есть несколько заметных дополнений:</span><span class="sxs-lookup"><span data-stu-id="6d928-242">There are some notable additions:</span></span>

1. <span data-ttu-id="6d928-243">Маркер, полученный с помощью сервера, должен быть обменяно с помощью потока Azure AD от имени, чтобы получить доступ к дополнительным `getAuthToken()` API Microsoft [](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) Graph.</span><span class="sxs-lookup"><span data-stu-id="6d928-243">The token retrieved using `getAuthToken()` needs to be exchanged server-side using Azure AD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Microsoft Graph APIs.</span></span>
    * <span data-ttu-id="6d928-244">Обязательно используйте конечную точку v2 Microsoft Graph для этого обмена</span><span class="sxs-lookup"><span data-stu-id="6d928-244">Be sure to use the v2 Microsoft Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="6d928-245">В случае сбой обмена Azure AD возвращает недействительное исключение гранта.</span><span class="sxs-lookup"><span data-stu-id="6d928-245">If the exchange fails, Azure AD will return an invalid grant exception.</span></span> <span data-ttu-id="6d928-246">Обычно существует одно из двух сообщений об ошибке: `invalid_grant` или `interaction_required`</span><span class="sxs-lookup"><span data-stu-id="6d928-246">There are usually one of two error messages: `invalid_grant` or `interaction_required`</span></span>
3. <span data-ttu-id="6d928-247">При сбойе обмена необходимо попросить дополнительное согласие.</span><span class="sxs-lookup"><span data-stu-id="6d928-247">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="6d928-248">Рекомендуется показывать пользовательский интерфейс, запрашивая у пользователя дополнительное согласие.</span><span class="sxs-lookup"><span data-stu-id="6d928-248">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="6d928-249">Этот пользовательский интерфейс должен включать кнопку, которая запускает диалоговое окно согласия Azure AD с помощью API проверки [подлинности Azure AD.](~/concepts/authentication/auth-silent-aad.md)</span><span class="sxs-lookup"><span data-stu-id="6d928-249">This UI should include a button that triggers an Azure AD consent dialog using our [Azure AD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="6d928-250">При запросе дополнительного согласия от Azure AD необходимо включить в параметры строки запроса в Azure AD, в противном случае Azure AD не будет запрашивать `prompt=consent` дополнительные области. [](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context)</span><span class="sxs-lookup"><span data-stu-id="6d928-250">When asking for additional consent from Azure AD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to Azure AD otherwise Azure AD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="6d928-251">Вместо: `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="6d928-251">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="6d928-252">Используйте это: `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="6d928-252">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="6d928-253">Убедитесь, что в него включены все области, для которые вы подсказываете пользователю `{scopes}` (например: Mail.Read или User.Read).</span><span class="sxs-lookup"><span data-stu-id="6d928-253">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="6d928-254">После предоставления пользователем дополнительных разрешений повторно обнажь поток от имени, чтобы получить доступ к этим дополнительным API.</span><span class="sxs-lookup"><span data-stu-id="6d928-254">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-azure-ad-authentication"></a><span data-ttu-id="6d928-255">Проверка подлинности без Azure AD</span><span class="sxs-lookup"><span data-stu-id="6d928-255">Non-Azure AD Authentication</span></span>

<span data-ttu-id="6d928-256">Вышеуказанное решение проверки подлинности работает только для приложений и служб, поддерживаюющих Azure AD в качестве поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="6d928-256">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="6d928-257">Приложения, которые хотят проверить подлинность с помощью служб, не использующих Azure AD, должны продолжать использовать поток веб-проверки подлинности на основе всплывающих [данных.](~/concepts/authentication.md)</span><span class="sxs-lookup"><span data-stu-id="6d928-257">Apps that want to authenticate using non-Azure AD based services need to continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>

> [!NOTE] 
> <span data-ttu-id="6d928-258">SSO поддерживается для приложений, которые принадлежат клиентам в клиентах Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="6d928-258">SSO is supported for customer owned apps within the Azure AD B2C tenants.</span></span>
