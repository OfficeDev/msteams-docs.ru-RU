---
title: Единый вход
description: Описание единого входа (SSO)
keywords: единый вход для проверки подлинности Teams AAD
ms.openlocfilehash: 1857651aecd902f04bd57f5b4e2fb0fda88eb348
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "41675178"
---
# <a name="single-sign-on"></a><span data-ttu-id="526ca-104">Единый вход</span><span class="sxs-lookup"><span data-stu-id="526ca-104">Single Sign-On</span></span>

> [!NOTE]
> <span data-ttu-id="526ca-105">API единого входа в настоящее время поддерживается только в _режиме предварительного просмотра разработчика_ .</span><span class="sxs-lookup"><span data-stu-id="526ca-105">The "single sign-on" API is currently supported in _Developer Preview_ only.</span></span>

<span data-ttu-id="526ca-106">Пользователи могут войти в Microsoft Teams, используя свою рабочую или учебную учетную запись (Office 365), и использовать единый вход (SSO), чтобы авторизовать пользователя на вкладке Microsoft Teams. Это означает, что если пользователь будет использовать ваше приложение на настольном компьютере, ему не нужно будет согласиться на мобильные устройства и он будет автоматически входить в систему.</span><span class="sxs-lookup"><span data-stu-id="526ca-106">Users sign-in to Microsoft Teams using their work or school (Office 365) account and you can take advantage of this by using single sign-on (SSO) to authorize the user to your Microsoft Teams tab. That means if a user consents to use your app on desktop, they won’t have to consent again on mobile and will be automatically logged in.</span></span> 

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="526ca-107">Принцип работы единого входа во время выполнения</span><span class="sxs-lookup"><span data-stu-id="526ca-107">How SSO works at runtime</span></span>

<span data-ttu-id="526ca-108">На следующей схеме показано, как работает процесс единого входа.</span><span class="sxs-lookup"><span data-stu-id="526ca-108">The following diagram shows how the SSO process works:</span></span>

<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="526ca-109">На вкладке JavaScript вызывает Жетаустокен ().</span><span class="sxs-lookup"><span data-stu-id="526ca-109">In the tab, JavaScript calls getAuthToken().</span></span> <span data-ttu-id="526ca-110">Это означает, что приложение Teams будет получать маркер проверки подлинности для приложения вкладки.</span><span class="sxs-lookup"><span data-stu-id="526ca-110">This tells the Teams application to obtain an authentication token to the tab application.</span></span>
2. <span data-ttu-id="526ca-111">Если в первый раз текущий пользователь использовал вкладку приложения, ему будет предложено согласие (если требуется согласие) или требуется обработать поэтапную проверку подлинности (например, двухфакторная проверка подлинности).</span><span class="sxs-lookup"><span data-stu-id="526ca-111">If this is the first time the current user has used your tab application, they will be prompted to consent (if consent is required) or asked to handle step-up authentication (such as two-factor authentication).</span></span>
3. <span data-ttu-id="526ca-112">Приложение Microsoft Teams запрашивает маркер приложения вкладки из конечной точки Azure AD версии 1.0 для текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="526ca-112">The Microsoft Teams application requests the tab application token from the Azure AD v1.0 endpoint for the current user.</span></span>
4. <span data-ttu-id="526ca-113">Azure AD отправляет маркер приложения "Вкладка" приложению Teams.</span><span class="sxs-lookup"><span data-stu-id="526ca-113">Azure AD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="526ca-114">Приложение Microsoft Teams отправляет маркер приложения на вкладку в составе результирующего объекта, возвращаемого вызовом Жетаустокен ().</span><span class="sxs-lookup"><span data-stu-id="526ca-114">The Microsoft Teams application sends the tab application token to the tab as part of the result object returned by the getAuthToken() call.</span></span>
6. <span data-ttu-id="526ca-115">JavaScript в приложении TAB может проанализировать маркер и извлечь необходимые сведения, например адрес электронной почты пользователя.</span><span class="sxs-lookup"><span data-stu-id="526ca-115">JavaScript in the tab application can parse the token and extract the information it needs, such as the user's email address.</span></span>
    * <span data-ttu-id="526ca-116">Note: этот маркер действителен только для того, чтобы быть отправлен в ограниченный набор API уровня пользователя (например, электронная почта, профиль и т. д.), а не для последующих областей диаграммы (например, mail. Read).</span><span class="sxs-lookup"><span data-stu-id="526ca-116">Note: this token is only valid for consenting to a limited set of user-level APIs (ex: email, profile, etc)  and not for further Graph scopes (such as Mail.Read).</span></span> <span data-ttu-id="526ca-117">Предлагаемые решения можно найти в конце этого документа, если вам нужны дополнительные области диаграммы.</span><span class="sxs-lookup"><span data-stu-id="526ca-117">See our section at the end of this document for suggested workarounds if you require additional Graph scopes.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="526ca-118">Разработка вкладки Microsoft Teams единого входа</span><span class="sxs-lookup"><span data-stu-id="526ca-118">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="526ca-119">В этом разделе описываются задачи, связанные с созданием вкладки Microsoft Teams, использующей единый вход.</span><span class="sxs-lookup"><span data-stu-id="526ca-119">This section describes the tasks involved in creating an Microsoft Teams tab that use SSO.</span></span> <span data-ttu-id="526ca-120">Эти задачи описываются независимо от языка и платформы.</span><span class="sxs-lookup"><span data-stu-id="526ca-120">These tasks are described here in a language- and framework-agnostic way.</span></span>

### <a name="1-create-your-aad-application-in-azure"></a><span data-ttu-id="526ca-121">1. Создание приложения AAD в Azure</span><span class="sxs-lookup"><span data-stu-id="526ca-121">1. Create your AAD application in Azure</span></span>

<span data-ttu-id="526ca-122">Зарегистрируйте приложение на портале регистрации для конечной точки Azure AD версии 1.0.</span><span class="sxs-lookup"><span data-stu-id="526ca-122">Register you application at the registration portal for the Azure AD v1.0 endpoint.</span></span> <span data-ttu-id="526ca-123">Этот процесс занимает 5–10 минут и включает следующие задачи:</span><span class="sxs-lookup"><span data-stu-id="526ca-123">This is a 5–10 minute process that includes the following tasks:</span></span>

* <span data-ttu-id="526ca-124">Извлечение идентификатора приложения AAD</span><span class="sxs-lookup"><span data-stu-id="526ca-124">Getting your AAD application ID</span></span>
* <span data-ttu-id="526ca-125">Укажите разрешения, необходимые вашему приложению для конечной точки AAD (и при необходимости Microsoft Graph).</span><span class="sxs-lookup"><span data-stu-id="526ca-125">Specify the permissions that your application needs for the AAD endpoint (and optionally to Microsoft Graph).</span></span> 
* <span data-ttu-id="526ca-126">Предоставление доступа к вашему приложению для настольных систем, веб-приложений и мобильных приложений Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="526ca-126">Grant the Microsoft Teams desktop, web and mobile application to trust to your application</span></span>
* <span data-ttu-id="526ca-127">Предавторизация приложения Microsoft Teams для приложения с именем области по умолчанию `access_as_user`.</span><span class="sxs-lookup"><span data-stu-id="526ca-127">Preauthorize the Microsoft Teams application to your app with the default scope name of `access_as_user`.</span></span>

> [!NOTE]
> <span data-ttu-id="526ca-128">Вы должны знать о некоторых важных ограничениях:</span><span class="sxs-lookup"><span data-stu-id="526ca-128">There are some important restrictions you should be aware of:</span></span>
>
> * <span data-ttu-id="526ca-129">Поддерживаются только разрешения API графа уровня пользователя (IE: Электронная почта, профиль, offline_access, OpenID.</span><span class="sxs-lookup"><span data-stu-id="526ca-129">We only support user-level Graph API permissions (ie: email, profile, offline_access, openid.</span></span> <span data-ttu-id="526ca-130">Если вам требуется доступ к другим областям диаграммы, ознакомьтесь с рекомендуемым обходным способом в конце этой документации.</span><span class="sxs-lookup"><span data-stu-id="526ca-130">If you need access to other Graph scopes, read our recommended workaround at the end of this documentation.</span></span>
> * <span data-ttu-id="526ca-131">Важно, чтобы доменное имя вашего приложения было зарегистрировано в приложении Azure AD.</span><span class="sxs-lookup"><span data-stu-id="526ca-131">It's important that your application's domain name be registered with your Azure AD application.</span></span> <span data-ttu-id="526ca-132">Это должно быть то же доменное имя, которое приложение выполняет при запросе маркера проверки подлинности в Teams, а также при указании свойства ресурса в манифесте Teams (Дополнительные сведения см. в следующем разделе).</span><span class="sxs-lookup"><span data-stu-id="526ca-132">This must be the same domain name that your application runs on when requesting an authentication token in Teams and also when specifying the resource property in your Teams manifest (more details in the next section).</span></span>
> * <span data-ttu-id="526ca-133">В настоящее время не поддерживается несколько доменов для каждого приложения</span><span class="sxs-lookup"><span data-stu-id="526ca-133">We do not currently support multiple domains per app</span></span>
> * <span data-ttu-id="526ca-134">Кроме того, мы не поддерживаем приложения, использующие `azurewebsites.net` домен, так как этот домен слишком распространен и может представлять угрозу безопасности</span><span class="sxs-lookup"><span data-stu-id="526ca-134">We also do not support applications that use the `azurewebsites.net` domain since this domain is too common and may be a security risk</span></span>

#### <a name="steps"></a><span data-ttu-id="526ca-135">Шаги</span><span class="sxs-lookup"><span data-stu-id="526ca-135">Steps</span></span>

1. <span data-ttu-id="526ca-136">Регистрация нового приложения в портале [регистрации приложений Azure Active Directory —](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="526ca-136">Register a new application in the [Azure Active Directory – App Registration](https://go.microsoft.com/fwlink/?linkid=2083908) portal</span></span>
2. <span data-ttu-id="526ca-137">Выберите пункт "Новая регистрация".</span><span class="sxs-lookup"><span data-stu-id="526ca-137">Select “New Registration”.</span></span> <span data-ttu-id="526ca-138">На странице Регистрация приложения задайте следующие значения:</span><span class="sxs-lookup"><span data-stu-id="526ca-138">On the register an application page, set the values as follows:</span></span>
    * <span data-ttu-id="526ca-139">Задайте **имя** для имени приложения.</span><span class="sxs-lookup"><span data-stu-id="526ca-139">Set **name** to your app name</span></span>
    * <span data-ttu-id="526ca-140">Установка **поддерживаемых типов учетных** записей для **учетных записей в любых организациях и личных учетных записях Майкрософт**</span><span class="sxs-lookup"><span data-stu-id="526ca-140">Set **supported account types** to **Accounts in any organizational directory and personal Microsoft accounts**</span></span>
    * <span data-ttu-id="526ca-141">Оставить **URI перенаправления** пустым</span><span class="sxs-lookup"><span data-stu-id="526ca-141">Leave **Redirect URI** empty</span></span>
    * <span data-ttu-id="526ca-142">Выбор **регистра**</span><span class="sxs-lookup"><span data-stu-id="526ca-142">Choose **Register**</span></span>
3. <span data-ttu-id="526ca-143">На странице Обзор скопируйте и сохраните **идентификатор приложения (клиента)**.</span><span class="sxs-lookup"><span data-stu-id="526ca-143">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="526ca-144">Он понадобится позже при обновлении манифеста приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="526ca-144">You’ll need it later when updating your Teams application manifest.</span></span>
4. <span data-ttu-id="526ca-145">Выберите пункт **Предоставление API** в разделе **Управление**.</span><span class="sxs-lookup"><span data-stu-id="526ca-145">Select **Expose an API** under **Manage**.</span></span> <span data-ttu-id="526ca-146">Выберите ссылку **задать** , чтобы создать URI идентификатора приложения в виде `api://{AppID}`.</span><span class="sxs-lookup"><span data-stu-id="526ca-146">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="526ca-147">Вставьте полное доменное имя (с символом косой черты "/") между двумя косыми чертами и GUID.</span><span class="sxs-lookup"><span data-stu-id="526ca-147">Insert your fully qualified domain name (with a forward slash "/" appended to the end) between the double forward slashes and the GUID.</span></span> <span data-ttu-id="526ca-148">Весь идентификатор должен иметь вид:`api://fully-qualified-domain-name.com/{AppID}`</span><span class="sxs-lookup"><span data-stu-id="526ca-148">The entire ID should have the form of: `api://fully-qualified-domain-name.com/{AppID}`</span></span>
    * <span data-ttu-id="526ca-149">Пример: `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span><span class="sxs-lookup"><span data-stu-id="526ca-149">ex: `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`.</span></span>

> [!NOTE]
> <span data-ttu-id="526ca-150">Если возникает ошибка с сообщением о том, что домен уже занят, но при этом вы являетесь его владельцем, следуйте процедуре в статье [Краткое руководство. Добавление имени личного домена в Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain), чтобы зарегистрировать его, а затем повторите этот шаг.</span><span class="sxs-lookup"><span data-stu-id="526ca-150">If you get an error saying that the domain is already owned but you own it, follow the procedure at [Quickstart: Add a custom domain name to Azure Active Directory](/azure/active-directory/fundamentals/add-custom-domain) to register it, and then repeat this step.</span></span> <span data-ttu-id="526ca-151">(Эта ошибка также может возникать, если вы не вошли в систему с учетными данными администратора в клиенте Office 365.</span><span class="sxs-lookup"><span data-stu-id="526ca-151">(This error can also occur if you are not signed in with credentials of an admin in the Office 365 tenancy).</span></span>

5. <span data-ttu-id="526ca-152">Нажмите кнопку **Добавить область**.</span><span class="sxs-lookup"><span data-stu-id="526ca-152">Select the **Add a scope** button.</span></span> <span data-ttu-id="526ca-153">В открывшейся панели введите `access_as_user` в качестве параметра **Имя области**.</span><span class="sxs-lookup"><span data-stu-id="526ca-153">In the panel that opens, enter `access_as_user` as the **Scope name**.</span></span>
6. <span data-ttu-id="526ca-154">Как определить, кому разрешено согласие? для администраторов и пользователей</span><span class="sxs-lookup"><span data-stu-id="526ca-154">Set Who can consent? to Admins and users</span></span>
7. <span data-ttu-id="526ca-155">Заполните поля для настройки запросов администратора и согласия пользователя со значениями, подходящими для `access_as_user` области.</span><span class="sxs-lookup"><span data-stu-id="526ca-155">Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope.</span></span> <span data-ttu-id="526ca-156">Возможные варианты:</span><span class="sxs-lookup"><span data-stu-id="526ca-156">Suggestions:</span></span>
    * <span data-ttu-id="526ca-157">**Заголовок согласия администратора:** Teams может получить доступ к профилю пользователя</span><span class="sxs-lookup"><span data-stu-id="526ca-157">**Admin consent title:** Teams can access the user’s profile</span></span>
    * <span data-ttu-id="526ca-158">**Описание согласия администратора**: позволяет Teams вызывать API приложения в качестве текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="526ca-158">**Admin consent description**: Allows Teams to call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="526ca-159">**Заголовок согласия пользователя**: teams могут получать доступ к профилю пользователя и делать запросы от вашего имени.</span><span class="sxs-lookup"><span data-stu-id="526ca-159">**User consent title**: Teams can access your user profile and make requests on your behalf</span></span>
    * <span data-ttu-id="526ca-160">**Описание согласия пользователя:** Разрешить Teams вызывать API этого приложения с теми же правами, что и у вас</span><span class="sxs-lookup"><span data-stu-id="526ca-160">**User consent description:** Enable Teams to call this app’s APIs with the same rights that you have</span></span>
8. <span data-ttu-id="526ca-161">Убедитесь, \*\*\*\* что для параметра состояние **Включено значение включено** .</span><span class="sxs-lookup"><span data-stu-id="526ca-161">Ensure that **State** is set to **Enabled**</span></span>
9. <span data-ttu-id="526ca-162">Выберите команду " **Добавить область** "</span><span class="sxs-lookup"><span data-stu-id="526ca-162">Select **Add scope**</span></span>
    * <span data-ttu-id="526ca-163">Note: Доменная часть **имени области** , отображаемая непосредственно под текстовым полем, должна автоматически СОПОСТАВЛЯТЬ URI **идентификатора приложения** , заданный на предыдущем шаге, `/access_as_user` с добавлением в конец; Например:</span><span class="sxs-lookup"><span data-stu-id="526ca-163">Note: The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end; for example:</span></span> 
        * `api://subdomain.example.com:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user`
10. <span data-ttu-id="526ca-164">В разделе **Авторизованные клиентские приложения** определяются приложения, которые вы хотите авторизовать для веб-приложения приложения.</span><span class="sxs-lookup"><span data-stu-id="526ca-164">In the **Authorized client applications** section, you identify the applications that you want to authorize to your app’s web application.</span></span> <span data-ttu-id="526ca-165">Необходимо ввести каждый из следующих идентификаторов:</span><span class="sxs-lookup"><span data-stu-id="526ca-165">Each of the following IDs needs to be entered:</span></span>
    * <span data-ttu-id="526ca-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264`(Приложение Teams для мобильных устройств и настольных приложений)</span><span class="sxs-lookup"><span data-stu-id="526ca-166">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` (Teams mobile/desktop application)</span></span>
    * <span data-ttu-id="526ca-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346`(Веб-приложение Teams)</span><span class="sxs-lookup"><span data-stu-id="526ca-167">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` (Teams web application)</span></span>
11. <span data-ttu-id="526ca-168">Перейдите к разделу **разрешения API**и убедитесь, что добавлены следующие разрешения.</span><span class="sxs-lookup"><span data-stu-id="526ca-168">Navigate to **API Permissions**, and make sure to add the follow permissions:</span></span>
    * <span data-ttu-id="526ca-169">User. Read (включено по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="526ca-169">User.Read (enabled by default)</span></span>
    * <span data-ttu-id="526ca-170">email</span><span class="sxs-lookup"><span data-stu-id="526ca-170">email</span></span>
    * <span data-ttu-id="526ca-171">offline_access</span><span class="sxs-lookup"><span data-stu-id="526ca-171">offline_access</span></span>
    * <span data-ttu-id="526ca-172">openid</span><span class="sxs-lookup"><span data-stu-id="526ca-172">openid</span></span>
    * <span data-ttu-id="526ca-173">profile</span><span class="sxs-lookup"><span data-stu-id="526ca-173">profile</span></span>

### <a name="2-update-your-microsoft-teams-application-manifest"></a><span data-ttu-id="526ca-174">2. Обновление манифеста приложения Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="526ca-174">2. Update your Microsoft Teams application manifest</span></span>

<span data-ttu-id="526ca-175">Добавьте новые свойства в манифест Microsoft teams:</span><span class="sxs-lookup"><span data-stu-id="526ca-175">Add new properties to your Microsoft Teams manifest:</span></span>

* <span data-ttu-id="526ca-176">**WebApplicationInfo** — родительский элемент для указанных ниже элементов.</span><span class="sxs-lookup"><span data-stu-id="526ca-176">**WebApplicationInfo** - The parent of the following elements.</span></span>
* <span data-ttu-id="526ca-177">**ID** — идентификатор клиента приложения.</span><span class="sxs-lookup"><span data-stu-id="526ca-177">**Id** - The client ID of the application.</span></span> <span data-ttu-id="526ca-178">Это идентификатор приложения, который вы получаете в процессе регистрации приложения с конечной точкой Azure AD 1,0.</span><span class="sxs-lookup"><span data-stu-id="526ca-178">This is an application ID that you obtain as part of registering the application with Azure AD 1.0 endpoint.</span></span>
* <span data-ttu-id="526ca-179">**Resource** — домен и поддомен приложения.</span><span class="sxs-lookup"><span data-stu-id="526ca-179">**Resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="526ca-180">Это тот же URI (включая `api://` протокол), который вы использовали при регистрации приложения в AAD.</span><span class="sxs-lookup"><span data-stu-id="526ca-180">This is the same URI (including the `api://` protocol) that you used when registering the app in AAD.</span></span> <span data-ttu-id="526ca-181">Доменная часть этого URI должна быть соотнесена с доменом, включая все поддомены, используемые в URL-адресах в разделе манифеста приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="526ca-181">The domain part of this URI should match the domain, including any subdomains, used in the URLs in the section of your Teams application manifest.</span></span>

```json
"webApplicationInfo": {
  "id": "<application_GUID here>",
  "resource": "<web_API resource here>"
}
```

<span data-ttu-id="526ca-182">Примечания:</span><span class="sxs-lookup"><span data-stu-id="526ca-182">Notes:</span></span>

* <span data-ttu-id="526ca-183">Ресурс для приложения AAD обычно просто является корнем URL-адреса сайта и appID (например, `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`).</span><span class="sxs-lookup"><span data-stu-id="526ca-183">The resource for an AAD app will usually just be the root of its site URL and the appID (e.g. `api://subdomain.example.com/6789/c6c1f32b-5e55-4997-881a-753cc1d563b7`).</span></span> <span data-ttu-id="526ca-184">Кроме того, мы используем это значение, чтобы убедиться, что ваш запрос поступает из того же домена.</span><span class="sxs-lookup"><span data-stu-id="526ca-184">We also use this value to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="526ca-185">Серефор убедитесь, что `contentURL` на вкладке используются те же домены, что и в свойстве ресурса.</span><span class="sxs-lookup"><span data-stu-id="526ca-185">Therefor make sure that your `contentURL` for your tab uses the same domains as your resource property.</span></span>
* <span data-ttu-id="526ca-186">Для использования этих полей необходимо использовать манифест версии 1,5 или более поздней.</span><span class="sxs-lookup"><span data-stu-id="526ca-186">You need to be using manifest version 1.5 or higher for these fields to be used.</span></span>
* <span data-ttu-id="526ca-187">Области не поддерживаются в манифесте, а вместо этого должны быть указаны в разделе "разрешения API" на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="526ca-187">Scopes aren’t supported in the manifest and instead should be specified in the API Permissions section in the Azure portal</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="526ca-188">3. получение маркера проверки подлинности из клиентского кода</span><span class="sxs-lookup"><span data-stu-id="526ca-188">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="526ca-189">Вот как выглядит API проверки подлинности:</span><span class="sxs-lookup"><span data-stu-id="526ca-189">Here's what the authentication API looks like:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); },
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="526ca-190">Если требуется согласие `getAuthToken` пользователя на вызовы (для разрешений на уровне пользователей), будет отображаться диалоговое окно, позволяющее пользователю предоставить дополнительное согласие.</span><span class="sxs-lookup"><span data-stu-id="526ca-190">When you call `getAuthToken` - and additional user consent is required (for user-level permissions) - we will show a dialog to the user encouraging them to grant additional consent.</span></span> 

<img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>

## <a name="demo-code"></a><span data-ttu-id="526ca-191">Демонстрационный код</span><span class="sxs-lookup"><span data-stu-id="526ca-191">Demo code</span></span>

<span data-ttu-id="526ca-192">Теперь вы можете посетить наш тестовый процесс приложения [меов](https://github.com/ydogandjiev/taskmeow) и использовать манифест единого входа и извлечь `teams.auth.service.js` `sso.auth.service.js` файл, чтобы увидеть, как мы обработаем рабочий процесс проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="526ca-192">For now you can visit our test application [Task Meow](https://github.com/ydogandjiev/taskmeow) and use the SSO manifest and checkout the `teams.auth.service.js` and `sso.auth.service.js` file to see how we handle the authentication workflow.</span></span>

## <a name="known-limitations"></a><span data-ttu-id="526ca-193">Известные ограничения</span><span class="sxs-lookup"><span data-stu-id="526ca-193">Known Limitations</span></span>

### <a name="apps-that-require-additional-graph-scopes"></a><span data-ttu-id="526ca-194">Приложения, для которых требуются дополнительные области диаграммы</span><span class="sxs-lookup"><span data-stu-id="526ca-194">Apps that require additional Graph Scopes</span></span>

<span data-ttu-id="526ca-195">Наша текущая реализация единого входа предоставляет согласие для разрешений на уровне пользователя (электронная почта, профиль, offline_access, OpenID), но не для других интерфейсов API (например, mail. Read).</span><span class="sxs-lookup"><span data-stu-id="526ca-195">Our current implementation for SSO only grants consent for user-level permissions (email, profile, offline_access, openid) but not for other APIs (such as Mail.Read).</span></span> <span data-ttu-id="526ca-196">Если вашему приложению требуются дополнительные области диаграммы, это можно сделать несколькими способами.</span><span class="sxs-lookup"><span data-stu-id="526ca-196">If your app needs further Graph scopes, there are some workarounds to enable this.</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="526ca-197">Согласие администратора клиента</span><span class="sxs-lookup"><span data-stu-id="526ca-197">Tenant Admin Consent</span></span>

<span data-ttu-id="526ca-198">Самым простым подходом является получение администратором клиента предварительного согласия от имени Организации.</span><span class="sxs-lookup"><span data-stu-id="526ca-198">The simplest approach would be to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="526ca-199">Это означает, что пользователям не нужно будет согласиться с этими областями, и вы сможете бесплатно обмениваться данными на стороне сервера маркеров с помощью функции "от [имени](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)пользователя AAD".</span><span class="sxs-lookup"><span data-stu-id="526ca-199">This means users won’t have to consent to these scopes and you can then be free to exchange the token server side using AAD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="526ca-200">Это решение приемлемо для внутренних бизнес-приложений, но может быть недостаточно для независимых поставщиков программного обеспечения, которые могут не полагаться на утверждение администратором клиента.</span><span class="sxs-lookup"><span data-stu-id="526ca-200">This workaround is acceptable for internal line-of-business applications but may not be enough for ISVs who may not be able to rely on tenant admin approval.</span></span>

<span data-ttu-id="526ca-201">Простой способ отправки от имени Организации (в качестве администратора клиента):</span><span class="sxs-lookup"><span data-stu-id="526ca-201">A simple way of consenting on behalf of an organization (as a tenant admin) is to visit:</span></span>

* `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`

#### <a name="asking-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="526ca-202">Запрос дополнительного согласия с помощью API проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="526ca-202">Asking for additional consent using the Auth API</span></span>

<span data-ttu-id="526ca-203">Еще один подход к получению дополнительных областей диаграммы — Показать диалоговое окно согласия, используя существующий [подход проверки подлинности AAD на основе веб-сайта](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) , который включает диалоговое окно согласия AAD.</span><span class="sxs-lookup"><span data-stu-id="526ca-203">Another approach for getting additional Graph scopes would be to present a consent dialog using our existing [web-based AAD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an AAD consent dialog.</span></span> <span data-ttu-id="526ca-204">Вот некоторые важные дополнения:</span><span class="sxs-lookup"><span data-stu-id="526ca-204">There are some notable additions:</span></span>

1. <span data-ttu-id="526ca-205">Маркер, полученный с помощью Жетаустокен, должен быть серверной стороны Exchange с помощью ААДС [от имени](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) для получения доступа к этим дополнительным API Graph.</span><span class="sxs-lookup"><span data-stu-id="526ca-205">The token retrieved using getAuthToken would need to be exchanged server side using AADs [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow) to get access to those additional Graph APIs.</span></span>
    * <span data-ttu-id="526ca-206">Обязательно используйте конечную точку V2 Graph для этого Exchange</span><span class="sxs-lookup"><span data-stu-id="526ca-206">Be sure to use the v2 Graph endpoint for this exchange</span></span>
2. <span data-ttu-id="526ca-207">В случае сбоя Exchange в AAD возвращается недопустимое исключение granting.</span><span class="sxs-lookup"><span data-stu-id="526ca-207">If the exchange fails, AAD will return an invalid grant exception.</span></span> <span data-ttu-id="526ca-208">Как правило, существует одно из двух сообщений об `ConsentRequired` ошибках.`InteractionRequired`</span><span class="sxs-lookup"><span data-stu-id="526ca-208">There are usually one of two error messages: `ConsentRequired` or `InteractionRequired`</span></span>
3. <span data-ttu-id="526ca-209">При сбое Exchange необходимо запросить дополнительное разрешение.</span><span class="sxs-lookup"><span data-stu-id="526ca-209">When the exchange fails, then you need to ask for additional consent.</span></span> <span data-ttu-id="526ca-210">Мы рекомендуем отобразить пользовательский интерфейс, который просит пользователя предоставить дополнительное согласие.</span><span class="sxs-lookup"><span data-stu-id="526ca-210">We recommend showing some UI asking the user to grant additional consent.</span></span> <span data-ttu-id="526ca-211">Этот пользовательский интерфейс должен включать кнопку, которая запускает диалоговое окно согласия AAD с помощью [API проверки подлинности AAD](~/concepts/authentication/auth-silent-aad.md).</span><span class="sxs-lookup"><span data-stu-id="526ca-211">This UI should include a button that triggers an AAD consent dialog using our [AAD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="526ca-212">При запросе дополнительного согласия от AAD необходимо включить `prompt=consent` [параметр запроса с параметром строки запроса](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) в AAD, иначе AAD не запрашивает дополнительные области.</span><span class="sxs-lookup"><span data-stu-id="526ca-212">When asking for additional consent from AAD, you need to include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to AAD otherwise AAD will not ask for the additional scopes.</span></span>
    * <span data-ttu-id="526ca-213">Вместо:`?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="526ca-213">Instead of: `?scope={scopes}`</span></span>
    * <span data-ttu-id="526ca-214">Используйте следующую команду:`?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="526ca-214">Use this: `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="526ca-215">Убедитесь, что `{scopes}` включены все области, на которые вы запрашиваете пользователя (пример: mail. Read или User. Read).</span><span class="sxs-lookup"><span data-stu-id="526ca-215">Be sure that `{scopes}` includes all the scopes you are prompting the user for (ex: Mail.Read or User.Read).</span></span>
5. <span data-ttu-id="526ca-216">После того как пользователь выдает дополнительное разрешение, повторите запрос от имени "от имени", чтобы получить доступ к этим дополнительным API.</span><span class="sxs-lookup"><span data-stu-id="526ca-216">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-aad-authentication"></a><span data-ttu-id="526ca-217">Проверка подлинности без AAD</span><span class="sxs-lookup"><span data-stu-id="526ca-217">Non-AAD Authentication</span></span>

<span data-ttu-id="526ca-218">Описанное выше решение для проверки подлинности работает только для приложений и служб, поддерживающих Azure AD в качестве поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="526ca-218">The above-described authentication solution only works for apps and services that support Azure AD as an identity provider.</span></span> <span data-ttu-id="526ca-219">Приложения, которые хотят пройти проверку подлинности с помощью служб на основе AAD, должны продолжать использовать [веб-процесс проверки подлинности](~/concepts/authentication.md)на основе всплывающих окон.</span><span class="sxs-lookup"><span data-stu-id="526ca-219">Apps that want to authenticate using non-AAD based services need to continue using the popup-based [web authentication flow](~/concepts/authentication.md).</span></span>
