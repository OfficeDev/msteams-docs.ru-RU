---
title: Поддержка единого входного знака для вкладок
description: Описывает один вход (SSO)
ms.topic: how-to
keywords: группы проверки подлинности SSO AAD единого api для входов
ms.openlocfilehash: e6bf278e446861556da8362905916cc030df723e
ms.sourcegitcommit: 82bda0599ba2676ab9348c2f4284f73c7dad0838
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2021
ms.locfileid: "51596683"
---
# <a name="single-sign-on-sso-support-for-tabs"></a><span data-ttu-id="36fab-104">Поддержка единого входного знака (SSO) для вкладок</span><span class="sxs-lookup"><span data-stu-id="36fab-104">Single sign-on (SSO) support for tabs</span></span>

<span data-ttu-id="36fab-105">Пользователи впишутся в Microsoft Teams через свои учетные записи, в том числе Office 365, Outlook и так далее.</span><span class="sxs-lookup"><span data-stu-id="36fab-105">Users sign in to Microsoft Teams through their work, school, or Microsoft accounts that is Office 365, Outlook, and so on.</span></span> <span data-ttu-id="36fab-106">Вы можете воспользоваться этим, разрешив одному входу авторизировать вкладку Teams или модуль задач на настольных компьютерах или мобильных клиентах.</span><span class="sxs-lookup"><span data-stu-id="36fab-106">You can take advantage of this by allowing a single sign-on to authorize your Teams tab or task module on desktop or mobile clients.</span></span> <span data-ttu-id="36fab-107">Если пользователь соглашается использовать ваше приложение, он не должен снова соглашаться на другое устройство, так как он подписан автоматически.</span><span class="sxs-lookup"><span data-stu-id="36fab-107">If a user consents to use your app, they do not have to consent again on another device as they are signed in automatically.</span></span> <span data-ttu-id="36fab-108">Кроме того, маркер доступа предварительно загружен для повышения производительности и времени загрузки.</span><span class="sxs-lookup"><span data-stu-id="36fab-108">In addition, your access token is prefetched to improve performance and load times.</span></span>

> [!NOTE]
> <span data-ttu-id="36fab-109">**Команды мобильных клиентских версий, поддерживающих SSO**</span><span class="sxs-lookup"><span data-stu-id="36fab-109">**Teams mobile client versions supporting SSO**</span></span>  
>
> <span data-ttu-id="36fab-110">✔Teams для Android (1416/1.0.0.2020073101 и более поздней версии)</span><span class="sxs-lookup"><span data-stu-id="36fab-110">✔Teams for Android (1416/1.0.0.2020073101 and later)</span></span>
>
> <span data-ttu-id="36fab-111">✔Teams для iOS _(Версия_: 2.0.18 и более поздней версии)</span><span class="sxs-lookup"><span data-stu-id="36fab-111">✔Teams for iOS (_Version_: 2.0.18 and later)</span></span>  
>
> <span data-ttu-id="36fab-112">Чтобы лучше работать с Teams, используйте последнюю версию iOS и Android.</span><span class="sxs-lookup"><span data-stu-id="36fab-112">For the best experience with Teams, use the latest version of iOS and Android.</span></span>

> [!NOTE]
> <span data-ttu-id="36fab-113">**Быстрый запуск**</span><span class="sxs-lookup"><span data-stu-id="36fab-113">**Quickstart**</span></span>  
>
> <span data-ttu-id="36fab-114">Самый простой путь к началу работы с SSO вкладки — это набор средств Teams для Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="36fab-114">The simplest path to getting started with tab SSO is with the Teams toolkit for Visual Studio Code.</span></span> <span data-ttu-id="36fab-115">Дополнительные сведения см. в [тексте SSO с набором](../../../toolkit/visual-studio-code-tab-sso.md) инструментов Teams и Visual Studio кода для вкладок</span><span class="sxs-lookup"><span data-stu-id="36fab-115">For more information, see [SSO with Teams toolkit and Visual Studio Code for tabs](../../../toolkit/visual-studio-code-tab-sso.md)</span></span>

## <a name="how-sso-works-at-runtime"></a><span data-ttu-id="36fab-116">Принцип работы единого входа во время выполнения</span><span class="sxs-lookup"><span data-stu-id="36fab-116">How SSO works at runtime</span></span>

<span data-ttu-id="36fab-117">На следующем изображении показано, как работает процесс SSO:</span><span class="sxs-lookup"><span data-stu-id="36fab-117">The following image shows how the SSO process works:</span></span>

<!-- markdownlint-disable MD033 -->
<img src="~/assets/images/tabs/tabs-sso-diagram.png" alt="Tab single sign-on SSO diagram" width="75%"/>

1. <span data-ttu-id="36fab-118">На вкладке выполнен вызов JavaScript для `getAuthToken()` .</span><span class="sxs-lookup"><span data-stu-id="36fab-118">In the tab, a JavaScript call is made to `getAuthToken()`.</span></span> <span data-ttu-id="36fab-119">Это указывает Teams на получение маркера проверки подлинности для приложения вкладки.</span><span class="sxs-lookup"><span data-stu-id="36fab-119">This tells Teams to obtain an authentication token for the tab application.</span></span>
2. <span data-ttu-id="36fab-120">Если это первый раз, когда текущий пользователь использовал приложение вкладки, есть запрос на согласие, если требуется согласие или обработка этапной проверки подлинности, например двух факторов проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="36fab-120">If this is the first time the current user has used your tab application, there is a request prompt to consent if consent is required or to handle step-up authentication such as two-factor authentication.</span></span>
3. <span data-ttu-id="36fab-121">Teams запрашивает маркер приложения вкладок из конечной точки Azure Active Directory (AAD) для текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="36fab-121">Teams requests the tab application token from the Azure Active Directory (AAD) endpoint for the current user.</span></span>
4. <span data-ttu-id="36fab-122">AAD отправляет маркер приложения вкладок в приложение Teams.</span><span class="sxs-lookup"><span data-stu-id="36fab-122">AAD sends the tab application token to the Teams application.</span></span>
5. <span data-ttu-id="36fab-123">Teams отправляет маркер приложения вкладок на вкладку как часть объекта результатов, возвращаемого `getAuthToken()` вызовом.</span><span class="sxs-lookup"><span data-stu-id="36fab-123">Teams sends the tab application token to the tab as part of the result object returned by the `getAuthToken()` call.</span></span>
6. <span data-ttu-id="36fab-124">Маркер разборается в приложении вкладок с помощью JavaScript для извлечения необходимых сведений, например адреса электронной почты пользователя.</span><span class="sxs-lookup"><span data-stu-id="36fab-124">The token is parsed in the tab application using JavaScript, to extract required information, such as the user's email address.</span></span>

> [!NOTE]
> <span data-ttu-id="36fab-125">Допустимо только для согласия на ограниченный набор API на уровне пользователя, который является электронной почтой, профилем, offline_access `getAuthToken()` и OpenId.</span><span class="sxs-lookup"><span data-stu-id="36fab-125">The `getAuthToken()` is only valid for consenting to a limited set of user-level APIs that is email, profile, offline_access and OpenId.</span></span> <span data-ttu-id="36fab-126">Он не используется для дополнительных областей Graph, таких как `User.Read` или `Mail.Read` .</span><span class="sxs-lookup"><span data-stu-id="36fab-126">It is not used for further Graph scopes such as `User.Read` or `Mail.Read`.</span></span> <span data-ttu-id="36fab-127">Дополнительные области Graph см. в предлагаемых [обходных решениях.](#apps-that-require-additional-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="36fab-127">For suggested workarounds, see [additional Graph scopes](#apps-that-require-additional-graph-scopes).</span></span>

<span data-ttu-id="36fab-128">API SSO также работает в [модулях задач,](../../../task-modules-and-cards/what-are-task-modules.md) встраив веб-контент.</span><span class="sxs-lookup"><span data-stu-id="36fab-128">The SSO API also works in [task modules](../../../task-modules-and-cards/what-are-task-modules.md) that embed web content.</span></span>

## <a name="develop-an-sso-microsoft-teams-tab"></a><span data-ttu-id="36fab-129">Разработка вкладки SSO Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="36fab-129">Develop an SSO Microsoft Teams tab</span></span>

<span data-ttu-id="36fab-130">В этом разделе описываются задачи, связанные с созданием вкладки Teams, использующей SSO.</span><span class="sxs-lookup"><span data-stu-id="36fab-130">This section describes the tasks involved in creating a Teams tab that uses SSO.</span></span> <span data-ttu-id="36fab-131">Эти задачи являются языковыми и framework-agnostic.</span><span class="sxs-lookup"><span data-stu-id="36fab-131">These tasks are language- and framework-agnostic.</span></span>

### <a name="1-create-your-aad-application"></a><span data-ttu-id="36fab-132">1. Создание приложения AAD</span><span class="sxs-lookup"><span data-stu-id="36fab-132">1. Create your AAD application</span></span>

<span data-ttu-id="36fab-133">**Регистрация приложения в обзоре [портала AAD](https://azure.microsoft.com/features/azure-portal/)**</span><span class="sxs-lookup"><span data-stu-id="36fab-133">**To register your application in the [AAD portal](https://azure.microsoft.com/features/azure-portal/) overview**</span></span>

1. <span data-ttu-id="36fab-134">Получите [AAD-ID приложения.](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in)</span><span class="sxs-lookup"><span data-stu-id="36fab-134">Get your [AAD Application ID](/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in).</span></span>
2. <span data-ttu-id="36fab-135">Укажите разрешения, необходимые приложению для конечной точки AAD и, необязательно, Graph.</span><span class="sxs-lookup"><span data-stu-id="36fab-135">Specify the permissions that your application needs for the AAD endpoint and, optionally, Graph.</span></span>
3. <span data-ttu-id="36fab-136">[Предоставление разрешений](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) для настольных, веб-приложений и мобильных приложений Teams.</span><span class="sxs-lookup"><span data-stu-id="36fab-136">[Grant permissions](/azure/active-directory/develop/howto-create-service-principal-portal#configure-access-policies-on-resources) for Teams desktop, web, and mobile applications.</span></span>
4. <span data-ttu-id="36fab-137">Предварительно уполномозить Teams, выбрав кнопку **Добавить** область и в открываемой **панели** введите access_as_user в качестве **имени Scope.**</span><span class="sxs-lookup"><span data-stu-id="36fab-137">Pre-authorize Teams by selecting the **Add a scope** button and in the panel that opens, enter **access_as_user** as the **Scope name**.</span></span>

> [!NOTE]
> <span data-ttu-id="36fab-138">Необходимо знать несколько важных ограничений:</span><span class="sxs-lookup"><span data-stu-id="36fab-138">There are some important restrictions that you must know:</span></span>
>
> * <span data-ttu-id="36fab-139">Поддерживаются только разрешения API графа на уровне пользователей, то есть электронная почта, профиль, offline_access, OpenId.</span><span class="sxs-lookup"><span data-stu-id="36fab-139">Only user-level Graph API permissions are supported that is, email, profile, offline_access, OpenId.</span></span> <span data-ttu-id="36fab-140">Если вы должны иметь доступ к другим сферам Graph, таким как или `User.Read` `Mail.Read` , см. [рекомендуемое обходное решение.](#apps-that-require-additional-graph-scopes)</span><span class="sxs-lookup"><span data-stu-id="36fab-140">If you must have access to other Graph scopes such as `User.Read` or `Mail.Read`, see [recommended workaround](#apps-that-require-additional-graph-scopes).</span></span>
> * <span data-ttu-id="36fab-141">Важно, чтобы доменное имя вашего приложения было таким же, как и доменное имя, которое вы зарегистрировали для приложения AAD.</span><span class="sxs-lookup"><span data-stu-id="36fab-141">It is important that your application's domain name is the same as the domain name you have registered for your AAD application.</span></span>
> * <span data-ttu-id="36fab-142">В настоящее время несколько доменов в приложении не поддерживаются.</span><span class="sxs-lookup"><span data-stu-id="36fab-142">Currently multiple domains per app are not supported.</span></span>
> * <span data-ttu-id="36fab-143">Приложения, которые используют домен, не поддерживаются, так как он является слишком распространенным и `azurewebsites.net` может быть угрозой безопасности.</span><span class="sxs-lookup"><span data-stu-id="36fab-143">Applications that use the `azurewebsites.net` domain are not supported as it is too common and can be a security risk.</span></span>

<span data-ttu-id="36fab-144">**Регистрация приложения на портале AAD**</span><span class="sxs-lookup"><span data-stu-id="36fab-144">**To register your app through the AAD portal**</span></span>

1. <span data-ttu-id="36fab-145">Регистрация нового приложения на портале регистрации приложений [AAD.](https://go.microsoft.com/fwlink/?linkid=2083908)</span><span class="sxs-lookup"><span data-stu-id="36fab-145">Register a new application in the [AAD App Registrations](https://go.microsoft.com/fwlink/?linkid=2083908) portal.</span></span>
2. <span data-ttu-id="36fab-146">Выберите **новую регистрацию.**</span><span class="sxs-lookup"><span data-stu-id="36fab-146">Select **New Registration**.</span></span> <span data-ttu-id="36fab-147">Появится **страница "Регистрация** приложения".</span><span class="sxs-lookup"><span data-stu-id="36fab-147">The **Register an application** page appears.</span></span>
3. <span data-ttu-id="36fab-148">На странице **Регистрация приложения** введите следующие значения:</span><span class="sxs-lookup"><span data-stu-id="36fab-148">In the **Register an application** page, enter the following values:</span></span>
    1. <span data-ttu-id="36fab-149">Введите **имя** приложения.</span><span class="sxs-lookup"><span data-stu-id="36fab-149">Enter a **Name** for your app.</span></span>
    2. <span data-ttu-id="36fab-150">Выберите **поддерживаемые типы учетных записей,** выберите один клиент или многотенантный тип учетной записи.</span><span class="sxs-lookup"><span data-stu-id="36fab-150">Choose the **Supported account types**, select single tenant or multitenant account type.</span></span> <span data-ttu-id="36fab-151">¹</span><span class="sxs-lookup"><span data-stu-id="36fab-151">¹</span></span>
    * <span data-ttu-id="36fab-152">Оставьте поле **URI перенаправления** пустым.</span><span class="sxs-lookup"><span data-stu-id="36fab-152">Leave **Redirect URI** empty.</span></span>
    3. <span data-ttu-id="36fab-153">Нажмите кнопку **Зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="36fab-153">Choose **Register**.</span></span>
4. <span data-ttu-id="36fab-154">На странице обзор скопируйте и сохраните ID приложения **(клиента).**</span><span class="sxs-lookup"><span data-stu-id="36fab-154">On the overview page, copy and save the **Application (client) ID**.</span></span> <span data-ttu-id="36fab-155">Она должна быть позднее при обновлении манифеста приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="36fab-155">You must have it later when updating your Teams application manifest.</span></span>
5. <span data-ttu-id="36fab-156">В разделе **Управление** выберите **Предоставление API**.</span><span class="sxs-lookup"><span data-stu-id="36fab-156">Under **Manage**, select **Expose an API**.</span></span>
6. <span data-ttu-id="36fab-157">Выберите **ссылку Set** для создания URI ID приложения в виде `api://{AppID}` .</span><span class="sxs-lookup"><span data-stu-id="36fab-157">Select the **Set** link to generate the Application ID URI in the form of `api://{AppID}`.</span></span> <span data-ttu-id="36fab-158">Вставьте полностью квалифицированное доменное имя с переназначенной чертой "/" с добавлением до конца между двойными полосами вперед и GUID.</span><span class="sxs-lookup"><span data-stu-id="36fab-158">Insert your fully qualified domain name with a forward slash "/" appended to the end, between the double forward slashes and the GUID.</span></span> <span data-ttu-id="36fab-159">Весь ID должен иметь форму `api://fully-qualified-domain-name.com/{AppID}` .</span><span class="sxs-lookup"><span data-stu-id="36fab-159">The entire ID must have the form of `api://fully-qualified-domain-name.com/{AppID}`.</span></span> <span data-ttu-id="36fab-160">² Например, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` .</span><span class="sxs-lookup"><span data-stu-id="36fab-160">² For example, `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`.</span></span> <span data-ttu-id="36fab-161">Полностью квалифицированное доменное имя — это доступное для чтения имя домена, из которого обслуживается ваше приложение.</span><span class="sxs-lookup"><span data-stu-id="36fab-161">The fully qualified domain name is the human readable domain name from which your app is served.</span></span> <span data-ttu-id="36fab-162">Если вы используете службу тоннелей, например ngrok, необходимо обновить это значение всякий раз, когда изменяется поддомен ngrok.</span><span class="sxs-lookup"><span data-stu-id="36fab-162">If you are using a tunneling service such as ngrok, you must update this value whenever your ngrok subdomain changes.</span></span>
7. <span data-ttu-id="36fab-163">Выберите **Добавить область**.</span><span class="sxs-lookup"><span data-stu-id="36fab-163">Select **Add a scope**.</span></span> <span data-ttu-id="36fab-164">На открываемой панели **введите access_as_user** имя **Scope**.</span><span class="sxs-lookup"><span data-stu-id="36fab-164">In the panel that opens, enter **access_as_user** as the **Scope name**.</span></span>
8. <span data-ttu-id="36fab-165">В поле **Кто может дать согласие?** введите **администраторов и пользователей**.</span><span class="sxs-lookup"><span data-stu-id="36fab-165">In the **Who can consent?** box, enter **Admins and users**.</span></span>
9. <span data-ttu-id="36fab-166">Введите сведения в полях для настройки подсказок согласия администратора и пользователя со значениями, подходящими для `access_as_user` области:</span><span class="sxs-lookup"><span data-stu-id="36fab-166">Enter the details in the boxes for configuring the admin and user consent prompts with values that are appropriate for the `access_as_user` scope:</span></span>
    * <span data-ttu-id="36fab-167">**Название согласия администратора:** Команды могут получить доступ к профилю пользователя.</span><span class="sxs-lookup"><span data-stu-id="36fab-167">**Admin consent title:** Teams can access the user’s profile.</span></span>
    * <span data-ttu-id="36fab-168">**Описание согласия администратора.** Команды могут вызывать веб-API приложения в качестве текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="36fab-168">**Admin consent description**: Teams can call the app’s web APIs as the current user.</span></span>
    * <span data-ttu-id="36fab-169">**Название согласия пользователя.** Команды могут получать доступ к вашему профилю и делать запросы от вашего имени.</span><span class="sxs-lookup"><span data-stu-id="36fab-169">**User consent title**: Teams can access your profile and make requests on your behalf.</span></span>
    * <span data-ttu-id="36fab-170">**Описание согласия пользователя:** Команды могут вызывать API этого приложения с тем же правами, что и у вас.</span><span class="sxs-lookup"><span data-stu-id="36fab-170">**User consent description:** Teams can call this app’s APIs with the same rights as you have.</span></span>
10. <span data-ttu-id="36fab-171">Убедитесь, что параметру **Состояние** присвоено значение **Включено**.</span><span class="sxs-lookup"><span data-stu-id="36fab-171">Ensure that **State** is set to **Enabled**.</span></span>
11. <span data-ttu-id="36fab-172">Выберите **Добавить область,** чтобы сохранить сведения.</span><span class="sxs-lookup"><span data-stu-id="36fab-172">Select **Add scope** to save the details.</span></span> <span data-ttu-id="36fab-173">Доменная часть имени **Scope,** отображаемая ниже текстового поля, должна автоматически соответствовать набору URI **ID** приложения на предыдущем шаге с приложением до `/access_as_user` `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user` конца.</span><span class="sxs-lookup"><span data-stu-id="36fab-173">The domain part of the **Scope name** displayed below the text field must automatically match the **Application ID** URI set in the previous step, with `/access_as_user` appended to the end `api://subdomain.example.com/00000000-0000-0000-0000-000000000000/access_as_user`.</span></span>
12. <span data-ttu-id="36fab-174">В разделе **Авторизованные клиентские приложения** определите приложения, которые необходимо авторизировать для веб-приложения вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="36fab-174">In the **Authorized client applications** section, identify the applications that you want to authorize for your app’s web application.</span></span> <span data-ttu-id="36fab-175">Выберите **Добавление клиентского приложения.**</span><span class="sxs-lookup"><span data-stu-id="36fab-175">Select **Add a client application**.</span></span> <span data-ttu-id="36fab-176">Введите каждый из следующих клиентских ИД и выберите авторизованную область, созданную на предыдущем шаге:</span><span class="sxs-lookup"><span data-stu-id="36fab-176">Enter each of the following client IDs and select the authorized scope you created in the previous step:</span></span>
    * <span data-ttu-id="36fab-177">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` для мобильного или настольного приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="36fab-177">`1fec8e78-bce4-4aaf-ab1b-5451cc387264` for Teams mobile or desktop application.</span></span>
    * <span data-ttu-id="36fab-178">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` для веб-приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="36fab-178">`5e3ce6c0-2b1f-4285-8d4b-75ee78787346` for Teams web application.</span></span>
13. <span data-ttu-id="36fab-179">Перейдите **к разрешениям API.**</span><span class="sxs-lookup"><span data-stu-id="36fab-179">Navigate to **API Permissions**.</span></span> <span data-ttu-id="36fab-180">Выберите **Добавить**  >  **разрешения, делегированные Microsoft Graph,** а затем добавьте следующие разрешения  >  из API Graph:</span><span class="sxs-lookup"><span data-stu-id="36fab-180">Select **Add a permission** > **Microsoft Graph** > **Delegated permissions**, then add the following permissions from Graph API:</span></span>
    * <span data-ttu-id="36fab-181">User.Read включен по умолчанию</span><span class="sxs-lookup"><span data-stu-id="36fab-181">User.Read enabled by default</span></span>
    * <span data-ttu-id="36fab-182">email</span><span class="sxs-lookup"><span data-stu-id="36fab-182">email</span></span>
    * <span data-ttu-id="36fab-183">offline_access</span><span class="sxs-lookup"><span data-stu-id="36fab-183">offline_access</span></span>
    * <span data-ttu-id="36fab-184">OpenId</span><span class="sxs-lookup"><span data-stu-id="36fab-184">OpenId</span></span>
    * <span data-ttu-id="36fab-185">profile</span><span class="sxs-lookup"><span data-stu-id="36fab-185">profile</span></span>

14. <span data-ttu-id="36fab-186">Переход к **проверке подлинности.**</span><span class="sxs-lookup"><span data-stu-id="36fab-186">Navigate to **Authentication**.</span></span>

    <span data-ttu-id="36fab-187">Если приложению не было предоставлено согласие ИТ-администратора, пользователи должны предоставить согласие при первом использовании приложения.</span><span class="sxs-lookup"><span data-stu-id="36fab-187">If an app has not been granted IT admin consent, users have to provide consent the first time they use an app.</span></span>

    <span data-ttu-id="36fab-188">Чтобы ввести URI перенаправления:</span><span class="sxs-lookup"><span data-stu-id="36fab-188">To enter a redirect URI:</span></span>
    * <span data-ttu-id="36fab-189">Выберите **Добавить платформу.**</span><span class="sxs-lookup"><span data-stu-id="36fab-189">Select **Add a platform**.</span></span>
    * <span data-ttu-id="36fab-190">Выберите **веб.**</span><span class="sxs-lookup"><span data-stu-id="36fab-190">Select **web**.</span></span>
    * <span data-ttu-id="36fab-191">Введите **URI перенаправления** для приложения.</span><span class="sxs-lookup"><span data-stu-id="36fab-191">Enter the **redirect URI** for your app.</span></span> <span data-ttu-id="36fab-192">Это страница, на которой успешный неявный поток грантов перенаправляет пользователя.</span><span class="sxs-lookup"><span data-stu-id="36fab-192">This is the page where a successful implicit grant flow redirects the user.</span></span> <span data-ttu-id="36fab-193">Это то же полное доменное имя, которое вы ввели на шаге 5, а затем маршрут API, куда отправляется ответ на проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="36fab-193">This is the same fully qualified domain name that you entered in step 5 followed by the API route where an authentication response is sent.</span></span> <span data-ttu-id="36fab-194">Если вы следуете примеру Teams, это `https://subdomain.example.com/auth-end` .</span><span class="sxs-lookup"><span data-stu-id="36fab-194">If you are following any of the Teams samples, this is `https://subdomain.example.com/auth-end`.</span></span>

    <span data-ttu-id="36fab-195">Включить неявный грант, проверив следующие поля: ✔ маркера ID ✔ Access Token</span><span class="sxs-lookup"><span data-stu-id="36fab-195">Enable implicit grant by checking the following boxes: ✔ ID Token ✔ Access Token</span></span>

<span data-ttu-id="36fab-196">Поздравляем!</span><span class="sxs-lookup"><span data-stu-id="36fab-196">Congratulations!</span></span> <span data-ttu-id="36fab-197">Вы выполнили необходимые условия регистрации приложений для работы с приложением SSO вкладки.</span><span class="sxs-lookup"><span data-stu-id="36fab-197">You have completed the app registration prerequisites to proceed with your tab SSO app.</span></span>

> [!NOTE]
>
> * <span data-ttu-id="36fab-198">¹ Если ваше приложение AAD зарегистрировано в том же клиенте, где вы делаете запрос на проверку подлинности в Teams, пользователю не может быть предложено дать согласие и ему сразу же будет предоставлен маркер доступа.</span><span class="sxs-lookup"><span data-stu-id="36fab-198">¹ If your AAD app is registered in the same tenant where you are making an authentication request in Teams, the user cannot be asked to consent and is granted an access token right away.</span></span> <span data-ttu-id="36fab-199">Пользователи соглашаются на эти разрешения только в том случае, если приложение AAD зарегистрировано в другом клиенте.</span><span class="sxs-lookup"><span data-stu-id="36fab-199">Users only consent to these permissions if the AAD app is registered in a different tenant.</span></span>
> * <span data-ttu-id="36fab-200">² Если настраиваемый домен не добавлен в AAD, вы получите ошибку, указывав, что имя хост не должно основываться на уже собственном домене.</span><span class="sxs-lookup"><span data-stu-id="36fab-200">² If the custom domain is not added to AAD, you get an error stating that the host name must not be based on an already owned domain.</span></span> <span data-ttu-id="36fab-201">Чтобы добавить настраиваемый домен в AAD и зарегистрировать его, выполните добавление пользовательского доменного имени в процедуру [AAD,](/azure/active-directory/fundamentals/add-custom-domain) а затем повторите шаг 5.</span><span class="sxs-lookup"><span data-stu-id="36fab-201">To add custom domain to AAD and register it, follow the [add a custom domain name to AAD](/azure/active-directory/fundamentals/add-custom-domain) procedure, and then repeat step 5.</span></span> <span data-ttu-id="36fab-202">Вы также можете получить эту ошибку, если вы не подписаны с учетными данными администратора в аренде Office 365.</span><span class="sxs-lookup"><span data-stu-id="36fab-202">You can also get this error if you are not signed in with Admin credentials in the Office 365 tenancy.</span></span>
> * <span data-ttu-id="36fab-203">Если вы не получаете основное имя пользователя (UPN)) в маркере возвращенного доступа, вы можете добавить его в качестве необязательных утверждений [в](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) AAD.</span><span class="sxs-lookup"><span data-stu-id="36fab-203">If you are not receiving the user principal name (UPN)) in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in AAD.</span></span>

### <a name="2-update-your-teams-application-manifest"></a><span data-ttu-id="36fab-204">2. Обновление манифеста приложения Teams</span><span class="sxs-lookup"><span data-stu-id="36fab-204">2. Update your Teams application manifest</span></span>

<span data-ttu-id="36fab-205">Чтобы добавить новые свойства в манифест Teams, используйте следующий код:</span><span class="sxs-lookup"><span data-stu-id="36fab-205">Use the following code to add new properties to your Teams manifest:</span></span>

```json
"webApplicationInfo": {
  "id": "00000000-0000-0000-0000-000000000000",
  "resource": "api://subdomain.example.com/00000000-0000-0000-0000-000000000000"
}
```

* <span data-ttu-id="36fab-206">**WebApplicationInfo** является родителем следующих элементов:</span><span class="sxs-lookup"><span data-stu-id="36fab-206">**WebApplicationInfo** is the parent of the following elements:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="36fab-207">**id** — ID клиента приложения.</span><span class="sxs-lookup"><span data-stu-id="36fab-207">**id** - The client ID of the application.</span></span> <span data-ttu-id="36fab-208">Это ИД приложения, полученный в рамках регистрации приложения в Azure AD.</span><span class="sxs-lookup"><span data-stu-id="36fab-208">This is the application ID that you obtained as part of registering the application with Azure AD.</span></span>
>* <span data-ttu-id="36fab-209">**ресурс** — домен и поддомен приложения.</span><span class="sxs-lookup"><span data-stu-id="36fab-209">**resource** - The domain and subdomain of your application.</span></span> <span data-ttu-id="36fab-210">Это тот же URI (включая протокол), который вы зарегистрировали при создании вашего шага `api://` `scope` 6.</span><span class="sxs-lookup"><span data-stu-id="36fab-210">This is the same URI (including the `api://` protocol) that you registered when creating your `scope` in step 6.</span></span> <span data-ttu-id="36fab-211">Не следует включать путь `access_as_user` в ресурс.</span><span class="sxs-lookup"><span data-stu-id="36fab-211">You must not include the `access_as_user` path in your resource.</span></span> <span data-ttu-id="36fab-212">Доменная часть этого URI должна соответствовать домену, в том числе любым поддоменам, используемым в URL-адресах манифеста приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="36fab-212">The domain part of this URI must match the domain, including any subdomains, used in the URLs of your Teams application manifest.</span></span>

> [!NOTE]
>
>* <span data-ttu-id="36fab-213">Ресурс приложения AAD обычно является корнем URL-адреса сайта и приложения `api://subdomain.example.com/00000000-0000-0000-0000-000000000000` (например).</span><span class="sxs-lookup"><span data-stu-id="36fab-213">The resource for an AAD app is usually the root of its site URL and the appID (e.g. `api://subdomain.example.com/00000000-0000-0000-0000-000000000000`).</span></span> <span data-ttu-id="36fab-214">Это значение также используется для обеспечения того, чтобы ваш запрос был исходя из того же домена.</span><span class="sxs-lookup"><span data-stu-id="36fab-214">This value is also used to ensure your request is coming from the same domain.</span></span> <span data-ttu-id="36fab-215">Убедитесь, `contentURL` что вкладка использует те же домены, что и свойство ресурса.</span><span class="sxs-lookup"><span data-stu-id="36fab-215">Ensure that the `contentURL` for your tab uses the same domains as your resource property.</span></span>
>* <span data-ttu-id="36fab-216">Для реализации поля необходимо использовать манифестную версию 1.5 или `webApplicationInfo` более.</span><span class="sxs-lookup"><span data-stu-id="36fab-216">You must use manifest version 1.5 or higher to implement the `webApplicationInfo` field.</span></span>

### <a name="3-get-an-authentication-token-from-your-client-side-code"></a><span data-ttu-id="36fab-217">3. Получите маркер проверки подлинности из клиентского кода</span><span class="sxs-lookup"><span data-stu-id="36fab-217">3. Get an authentication token from your client-side code</span></span>

<span data-ttu-id="36fab-218">Используйте следующий API проверки подлинности:</span><span class="sxs-lookup"><span data-stu-id="36fab-218">Use the following authentication API:</span></span>

```javascript
var authTokenRequest = {
  successCallback: function(result) { console.log("Success: " + result); },
  failureCallback: function(error) { console.log("Failure: " + error); }
};
microsoftTeams.authentication.getAuthToken(authTokenRequest);
```

<span data-ttu-id="36fab-219">Когда вы звоните , и для получения разрешений на уровне пользователя требуется дополнительное согласие пользователя, пользователю отображается диалоговое окно для `getAuthToken` предоставления дополнительного согласия.</span><span class="sxs-lookup"><span data-stu-id="36fab-219">When you call `getAuthToken` - and additional user consent is required for user-level permissions, a dialog is shown to the user to grant additional consent.</span></span>

<span data-ttu-id="36fab-220">После получения маркера доступа в вызове успешного вызова можно расшифровать маркер доступа для просмотра утверждений, связанных с этим маркером.</span><span class="sxs-lookup"><span data-stu-id="36fab-220">After you receive the access token in the success callback, you can decode the access token to view the claims associated with that token.</span></span> <span data-ttu-id="36fab-221">Необязательно можно вручную скопировать и вклеить маркер доступа [](https://jwt.ms/) в средство, например jwt.ms для проверки его содержимого.</span><span class="sxs-lookup"><span data-stu-id="36fab-221">Optionally, you can manually copy and paste the access token into a tool, such as [jwt.ms](https://jwt.ms/) to inspect its contents.</span></span> <span data-ttu-id="36fab-222">Если вы не получаете upN в маркере возвращенного доступа, вы можете добавить его в качестве необязательных [утверждений](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) в AAD.</span><span class="sxs-lookup"><span data-stu-id="36fab-222">If you are not receiving the UPN in the returned access token, you can add it as an [optional claim](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims) in AAD.</span></span>

<p>
    <img src="~/assets/images/tabs/tabs-sso-prompt.png" alt="Tab single sign-on SSO dialog prompt" width="75%"/>
</p>

## <a name="code-sample"></a><span data-ttu-id="36fab-223">Пример кода</span><span class="sxs-lookup"><span data-stu-id="36fab-223">Code sample</span></span>

|<span data-ttu-id="36fab-224">**Пример имени**</span><span class="sxs-lookup"><span data-stu-id="36fab-224">**Sample name**</span></span>|<span data-ttu-id="36fab-225">**Description**</span><span class="sxs-lookup"><span data-stu-id="36fab-225">**Description**</span></span>|<span data-ttu-id="36fab-226">**C#**</span><span class="sxs-lookup"><span data-stu-id="36fab-226">**C#**</span></span>|<span data-ttu-id="36fab-227">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="36fab-227">**Node.js**</span></span>|
|---------------|---------------|------|--------------|
| <span data-ttu-id="36fab-228">Tab SSO</span><span class="sxs-lookup"><span data-stu-id="36fab-228">Tab SSO</span></span> |<span data-ttu-id="36fab-229">Пример приложения Microsoft Teams для вкладок Azure AD SSO</span><span class="sxs-lookup"><span data-stu-id="36fab-229">Microsoft Teams sample app for tabs Azure AD SSO</span></span>| [<span data-ttu-id="36fab-230">View</span><span class="sxs-lookup"><span data-stu-id="36fab-230">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/tab-sso/csharp)|<span data-ttu-id="36fab-231">[Просмотр](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span><span class="sxs-lookup"><span data-stu-id="36fab-231">[View](https://github.com/OfficeDev/Microsoft-Teams-Samples/blob/main/samples/tab-sso/nodejs),</span></span> </br>[<span data-ttu-id="36fab-232">Teams набор средств</span><span class="sxs-lookup"><span data-stu-id="36fab-232">Teams Toolkit</span></span>](../../../toolkit/visual-studio-code-tab-sso.md)|

## <a name="known-limitations"></a><span data-ttu-id="36fab-233">Известные ограничения</span><span class="sxs-lookup"><span data-stu-id="36fab-233">Known limitations</span></span>

### <a name="apps-that-require-additional-graph-scopes"></a><span data-ttu-id="36fab-234">Приложения, которые требуют дополнительных областей Graph</span><span class="sxs-lookup"><span data-stu-id="36fab-234">Apps that require additional Graph scopes</span></span>

<span data-ttu-id="36fab-235">Наша текущая реализация для SSO предоставляет согласие только для разрешений на уровне пользователей, таких как электронная почта, профиль, offline_access, OpenId, а не для других API, таких как User.Read или Mail.Read.</span><span class="sxs-lookup"><span data-stu-id="36fab-235">Our current implementation for SSO only grants consent for user-level permissions that is email, profile, offline_access, OpenId and not for other APIs such as User.Read or Mail.Read.</span></span> <span data-ttu-id="36fab-236">Если вашему приложению необходимы дополнительные области Graph, в следующем разделе предусмотрены некоторые разрешимые обходные пути.</span><span class="sxs-lookup"><span data-stu-id="36fab-236">If your app needs further Graph scopes, the next section provides some enabling workarounds.</span></span>

#### <a name="tenant-admin-consent"></a><span data-ttu-id="36fab-237">Согласие администратора клиента</span><span class="sxs-lookup"><span data-stu-id="36fab-237">Tenant Admin Consent</span></span>

<span data-ttu-id="36fab-238">Самый простой подход — получить предварительное согласие администратора клиента от имени организации.</span><span class="sxs-lookup"><span data-stu-id="36fab-238">The simplest approach is to get a tenant admin to pre-consent on behalf of the organization.</span></span> <span data-ttu-id="36fab-239">Это означает, что пользователям не нужно соглашаться на эти области, и вы можете [](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow)свободно обмениваться стороной сервера маркеров с помощью потока от имени AAD.</span><span class="sxs-lookup"><span data-stu-id="36fab-239">This means users do not have to consent to these scopes and you can then be free to exchange the token server side using AAD’s [on-behalf-of flow](/azure/active-directory/develop/v1-oauth2-on-behalf-of-flow).</span></span> <span data-ttu-id="36fab-240">Это решение приемлемо для внутренних бизнес-приложений, но недостаточно для сторонних разработчиков, которые не могут полагаться на утверждение администратора клиента.</span><span class="sxs-lookup"><span data-stu-id="36fab-240">This workaround is acceptable for internal line-of-business applications but is not enough for third-party developers who are not able to rely on tenant admin approval.</span></span>

<span data-ttu-id="36fab-241">Простой способ согласия от имени организации в качестве администратора клиента — обратиться к `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>` .</span><span class="sxs-lookup"><span data-stu-id="36fab-241">A simple way of consenting on behalf of an organization as a tenant admin is to refer to `https://login.microsoftonline.com/common/adminconsent?client_id=<AAD_App_ID>`.</span></span>

#### <a name="ask-for-additional-consent-using-the-auth-api"></a><span data-ttu-id="36fab-242">Запрос дополнительного согласия с помощью API Auth</span><span class="sxs-lookup"><span data-stu-id="36fab-242">Ask for additional consent using the Auth API</span></span>

<span data-ttu-id="36fab-243">Другой подход для получения дополнительных областей Graph заключается в том, чтобы представить диалоговое окно согласия с помощью существующего веб-подхода проверки подлинности [Azure AD,](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) который включает в себя создание диалогового окна согласия Azure AD.</span><span class="sxs-lookup"><span data-stu-id="36fab-243">Another approach for getting additional Graph scopes is to present a consent dialog using our existing [web-based Azure AD authentication approach](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page) which involves popping up an Azure AD consent dialog box.</span></span> 

<span data-ttu-id="36fab-244">**Запрос дополнительного согласия с помощью API Auth**</span><span class="sxs-lookup"><span data-stu-id="36fab-244">**To ask for additional consent using the Auth API**</span></span>

1. <span data-ttu-id="36fab-245">Полученный с помощью маркера маркер должен быть обменяно на стороне сервера с помощью AAD от имени потока, чтобы получить доступ к этим дополнительным `getAuthToken()` API Graph. [](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow)</span><span class="sxs-lookup"><span data-stu-id="36fab-245">The token retrieved using `getAuthToken()` needs to be exchanged server-side using AAD [on-behalf-of flow](/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to get access to those additional Graph APIs.</span></span> <span data-ttu-id="36fab-246">Убедитесь, что для этого обмена используется конечная точка v2 Graph.</span><span class="sxs-lookup"><span data-stu-id="36fab-246">Ensure you use the v2 Graph endpoint for this exchange.</span></span>
2. <span data-ttu-id="36fab-247">В случае сбой обмена AAD возвращает недействительные исключения гранта.</span><span class="sxs-lookup"><span data-stu-id="36fab-247">If the exchange fails, AAD returns an invalid grant exception.</span></span> <span data-ttu-id="36fab-248">Обычно существует одно из двух сообщений об ошибке или `invalid_grant` `interaction_required` .</span><span class="sxs-lookup"><span data-stu-id="36fab-248">There are usually one of two error messages, `invalid_grant` or `interaction_required`.</span></span>
3. <span data-ttu-id="36fab-249">В случае сбой обмена необходимо получить дополнительное согласие.</span><span class="sxs-lookup"><span data-stu-id="36fab-249">When the exchange fails, you must ask for additional consent.</span></span> <span data-ttu-id="36fab-250">Покажите какой-либо пользовательский интерфейс (пользовательский интерфейс) с просьбой предоставить дополнительное согласие.</span><span class="sxs-lookup"><span data-stu-id="36fab-250">Show some user interface (UI) asking the user to grant additional consent.</span></span> <span data-ttu-id="36fab-251">Этот пользовательский интерфейс должен включать кнопку, которая запускает диалоговое окно согласия AAD с помощью [AAD API проверки подлинности.](~/concepts/authentication/auth-silent-aad.md)</span><span class="sxs-lookup"><span data-stu-id="36fab-251">This UI must include a button that triggers an AAD consent dialog box using our [AAD authentication API](~/concepts/authentication/auth-silent-aad.md).</span></span>
4. <span data-ttu-id="36fab-252">При запросе дополнительного согласия от AAD необходимо включить в AAD параметр `prompt=consent` [query-string-parameter,](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) в противном случае AAD не запрашивает дополнительные области.</span><span class="sxs-lookup"><span data-stu-id="36fab-252">When asking for additional consent from AAD, you must include `prompt=consent` in your [query-string-parameter](~/tabs/how-to/authentication/auth-silent-aad.md#get-the-user-context) to AAD, otherwise AAD does not ask for the additional scopes.</span></span>
    * <span data-ttu-id="36fab-253">Вместо `?scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="36fab-253">Instead of `?scope={scopes}`</span></span>
    * <span data-ttu-id="36fab-254">Используйте это `?prompt=consent&scope={scopes}`</span><span class="sxs-lookup"><span data-stu-id="36fab-254">Use this `?prompt=consent&scope={scopes}`</span></span>
    * <span data-ttu-id="36fab-255">Убедитесь, что включает все области, которые вы подсказывая `{scopes}` пользователю, например, Mail.Read или User.Read.</span><span class="sxs-lookup"><span data-stu-id="36fab-255">Ensure that `{scopes}` includes all the scopes you are prompting the user for, for example, Mail.Read or User.Read.</span></span>
5. <span data-ttu-id="36fab-256">После предоставления пользователем дополнительных разрешений повторно обнажь поток от имени, чтобы получить доступ к этим дополнительным API.</span><span class="sxs-lookup"><span data-stu-id="36fab-256">Once the user has granted additional permission, retry the on-behalf-of-flow to get access to these additional APIs.</span></span>

### <a name="non-aad-authentication"></a><span data-ttu-id="36fab-257">Проверка подлинности без AAD</span><span class="sxs-lookup"><span data-stu-id="36fab-257">Non-AAD authentication</span></span>

<span data-ttu-id="36fab-258">Вышеуказанное решение проверки подлинности работает только для приложений и служб, поддерживаюющих AAD в качестве поставщика удостоверений.</span><span class="sxs-lookup"><span data-stu-id="36fab-258">The above-described authentication solution only works for apps and services that support AAD as an identity provider.</span></span> <span data-ttu-id="36fab-259">Приложения, которые хотят проверить подлинность с помощью служб, не использующих AAD, должны продолжать использовать поток веб-проверки подлинности на основе всплывающих [данных.](~/concepts/authentication.md)</span><span class="sxs-lookup"><span data-stu-id="36fab-259">Apps that want to authenticate using non-AAD based services must continue using the pop-up-based [web authentication flow](~/concepts/authentication.md).</span></span>

> [!NOTE]
> <span data-ttu-id="36fab-260">SSO поддерживается для приложений, которые принадлежат клиентам в клиентах AAD B2C.</span><span class="sxs-lookup"><span data-stu-id="36fab-260">SSO is supported for customer owned apps within the AAD B2C tenants.</span></span>
