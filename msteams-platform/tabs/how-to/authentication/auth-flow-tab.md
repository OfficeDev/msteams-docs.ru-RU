---
title: Поток аутентификации для вкладок
description: Описывает поток аутентификации во вкладок
ms.topic: conceptual
localization_priority: Normal
keywords: вкладки потока проверки подлинности групп
ms.openlocfilehash: 1282c149beba0ff5b424585f566a703f48234fa2
ms.sourcegitcommit: 51e4a1464ea58c254ad6bd0317aca03ebf6bf1f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "52566693"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a>Microsoft Teams проверки подлинности для вкладок

> [!NOTE]
> Для того чтобы аутентификация работала для вашей вкладки на мобильных клиентах, вы должны убедиться, что вы используете по крайней мере 1.4.1 версия Microsoft Teams JavaScript SDK.
> Teams SDK запускает отдельное окно для потока аутентификации. Установите `SameSite` атрибут **Лакса**. Teams или более старые версии Chrome или Safari не поддерживают `SameSite` «Нет».

OAuth 2.0 является открытым стандартом для проверки подлинности и авторизации, используемым Azure Active Directory (AAD) и многими другими поставщиками идентификации. Базовое понимание OAuth 2.0 является необходимым условием для работы с аутентификацией в Teams. Для получения дополнительной информации [см. OAuth 2 упрощен,](https://aaronparecki.com/oauth-2-simplified/) что легче следовать, чем [официальная спецификация.](https://oauth.net/2/) Поток аутентификации для вкладок и ботов отличается тем, что вкладки похожи на веб-сайты, поэтому они могут использовать OAuth 2.0 напрямую. Боты делают несколько вещей по-разному, но основные понятия идентичны.

Для примера потока аутентификации для вкладок и ботов с помощью узла [и неявного типа гранта OAuth 2.0 см.](https://oauth.net/2/grant-types/implicit/) [](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow)

> [!NOTE]
> Прежде чем показывать **пользователю** кнопку входа и `microsoftTeams.authentication.authenticate` вызывать API в ответ на выбор кнопки, необходимо подождать завершения инициализации SDK. Вы можете передать обратный вызов `microsoftTeams.initialize` API, который вызывается по завершения инициализации.

![Диаграмма последовательности проверки подлинности вкладок](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. Пользователь взаимодействует с содержимым на конфигурации вкладки или странице содержимого, обычно **кнопкой входа** или **входа в систему.**
2. Вкладка строит URL для своей первой страницы. По желанию, он использует информацию от владельцев `microsoftTeams.getContext()` URL-адресов Teams для метода SDK клиента, чтобы упростить работу с аутентификацией для пользователя. Например, при аутентификации с AAD, `login_hint` если параметр установлен на адрес электронной почты пользователя, пользователь не должен войти в него, если он сделал это в последнее время. Это связано с тем, что AAD использует кэшированные учетные данные пользователя. Всплывающее окно отображается кратко, а затем исчезает.
3. Затем вкладка вызывает метод `microsoftTeams.authentication.authenticate()` и регистрирует функции `successCallback` и `failureCallback`.
4. Teams открывает начало страницы в iframe во всплывающем окне. На старте страница генерирует случайные `state` данные, сохраняет их для будущей проверки и перенаправляет в конечную точку поставщика `/authorize` идентификационных данных, например `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` для Azure AD. Замените `<tenant id>` свой собственный идентификатор арендатора, который context.tid.
Как и другие потоки auth приложения в Teams году, начало страницы должно быть на домене, который находится в его `validDomains` списке, и на том же домене, как почтовый знак в перенаправить страницу.

    > [!NOTE]
    > OAuth 2.0 неявное поток грантов требует параметра в `state` запросе проверки подлинности, который содержит уникальные данные сеанса для предотвращения атаки [подделки запроса на кросс-сайт.](https://en.wikipedia.org/wiki/Cross-site_request_forgery) В примерах для данных используется случайно сгенерированный `state` GUID.

5. На сайте провайдера пользователь власякомит и предоставляет доступ к вкладке.
6. Поставщик отвеляет пользователя на страницу перенаправления вкладки OAuth 2.0 с токеном доступа.
7. Вкладка проверяет, соответствует ли возвращенное `state` значение тому, что было сохранено ранее, и `microsoftTeams.authentication.notifySuccess()` вызывает, что, в свою очередь, вызывает `successCallback` функцию, зарегистрированную в шаге 3.
8. Teams закрывает всплывающее окно.
9. Вкладка либо отображает пользовательский интерфейс конфигурации, обновляет или перезаряжает содержимое вкладок, в зависимости от того, скуда пользователь начал работу.

## <a name="treat-tab-context-as-hints"></a>Относитесь к контексту вкладок как к подсказкам

Хотя контекст вкладки предоставляет полезную информацию о пользователе, не используйте эту информацию для проверки подлинности пользователя. У проверки подлинности пользователя, даже если вы получаете информацию в качестве параметров URL на URL-адрес содержимого `microsoftTeams.getContext()` вкладки или позвонив функции в Microsoft Teams SDK. Злоумышленник может вызвать URL-адрес содержимого вкладки со своими параметрами. Актер также может вызвать веб-страницу, Microsoft Teams, чтобы загрузить URL-адрес содержимого вкладки в iframe и вернуть свои собственные данные `getContext()` функции. Перед использованием необходимо рассматривать информацию, связанную с идентификацией, в контексте вкладки просто как подсказки и проверять их. Обратитесь к примечаниям [в навигации на страницу авторизации с вашей всплывающей страницы.](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page)

## <a name="code-sample"></a>Пример кода

Пример кода, показывающий процесс проверки подлинности вкладок:

| **Название образца** | **Описание** | **C#** | **Node.js** |
|-----------------|-----------------|-------------|------------|
| Teams проверки подлинности вкладок | Процесс аутентификации для вкладок с помощью AAD. | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/csharp) | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/nodejs) |

## <a name="more-details"></a>Дополнительные сведения

Для детальной реализации для проверки подлинности вкладок с помощью AAD см.:

* [Проверка подлинности пользователя во вкладке Teams данных](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [Тихая аутентификация](~/tabs/how-to/authentication/auth-silent-AAD.md)
