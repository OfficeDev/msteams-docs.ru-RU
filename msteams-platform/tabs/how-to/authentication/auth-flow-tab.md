---
title: Процесс проверки подлинности для вкладок
description: Описание процесса проверки подлинности на вкладках
keywords: вкладки последовательности проверки подлинности Teams
ms.openlocfilehash: 6c669162f407924f0844b89625f5c5791e96b6f7
ms.sourcegitcommit: 4329a94918263c85d6c65ff401f571556b80307b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/01/2020
ms.locfileid: "41675419"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a>Процесс проверки подлинности для вкладок в Microsoft Teams

> [!Note]
> Чтобы проверка подлинности работала для вкладки на мобильных клиентах, необходимо убедиться, что используется по крайней мере версия 1.4.1 SDK Teams SDK для Teams.

OAuth 2,0 это открытый стандарт для проверки подлинности и авторизации, используемый Azure AD и многими другими поставщиками удостоверений. Основное понимание OAuth 2,0 является необходимым условием для работы с проверкой подлинности в Teams; [Вот хороший обзор](https://aaronparecki.com/oauth-2-simplified/) , который легче следовать, чем [формальное описание](https://oauth.net/2/). Процесс проверки подлинности для вкладок и боты немного отличается, так как вкладки очень похожи на веб-сайты, поэтому они могут использовать OAuth 2,0 напрямую; Боты не так и должны выполнять несколько действий по-разному, но основные понятия идентичны.

пример, демонстрирующий поток проверки подлинности для вкладок и боты с использованием узла с [неявным типом предоставления OAuth 2,0](https://oauth.net/2/grant-types/implicit/).

![Схема последовательности проверки подлинности для вкладки](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. Пользователь взаимодействует с контентом на странице настройки вкладки или содержимого, обычно это кнопка с надписью "вход" или "вход".
2. Вкладка создает URL-адрес для начальной страницы проверки подлинности, при необходимости используя сведения из заполнителей URL-адресов `microsoftTeams.getContext()` или вызывая метод пакет SDK клиента для упрощения проверки подлинности для пользователя. Например, при проверке подлинности с помощью Azure AD, `login_hint` если параметру присвоено значение электронного адреса пользователя, пользователь может даже не входить в систему, если это было сделано недавно, так как Azure AD будет использовать кэшированные учетные данные пользователя, если это возможно: всплывающее окно будет слишком коротким, а затем исчезнет.
3. Затем вкладка вызывает `microsoftTeams.authentication.authenticate()` метод и регистрирует функции `successCallback` и. `failureCallback`
4. С помощью Teams во всплывающем окне открывается страница "начало" во фрейме IFRAME. Начальная страница создает случайные `state` данные, сохраняет их для последующего подтверждения и перенаправляет на `/authorize` конечную точку поставщика удостоверений, например `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` для Azure AD. Замените `<tenant id>` идентификатором клиента (context. TID).
    * Как и в случае с другими потоками проверки подлинности приложений в Teams, начальная страница `validDomains` должна находиться в домене, который находится в списке, и в том же домене, что и страница перенаправления после входа.
    * **Важно!** протокол неявного предоставления OAuth 2,0 для `state` параметра в запросе на проверку подлинности, который содержит уникальные данные сеанса для предотвращения атаки на [межсайтовые запросы на межсайтовую подделку](https://en.wikipedia.org/wiki/Cross-site_request_forgery). В приведенных ниже примерах используется созданный случайным образом `state` идентификатор GUID для данных.
5. На сайте поставщика пользователь входит в систему и предоставляет доступ к вкладке.
6. Поставщик переходит на страницу переадресации OAuth 2,0 на вкладке с маркером доступа.
7. На вкладке проверяется соответствие возвращенному `state` значению, которое было сохранено ранее, `microsoftTeams.authentication.notifySuccess()`и вызовы, которые, в `successCallback` свою очередь, вызывают функцию, зарегистрированную на шаге 3.
8. В Teams всплывающее окно закрывается.
9. На вкладке либо отображается пользовательский интерфейс Configuration, либо обновляется или перезагружается содержимое вкладок в зависимости от того, откуда запущен пользователь.

## <a name="treat-tab-context-as-hints"></a>Рассматривать контекст вкладки в качестве подсказок

Несмотря на то, что контекст вкладки предоставляет полезную информацию для пользователя, не используйте эти сведения для проверки подлинности пользователя о том, является ли он параметрами URL-адреса для контента `microsoftTeams.getContext()` вкладки, или вызывая функцию в клиенте SDK Microsoft Teams. Вредоносный субъект может вызывать URL-адрес содержимого вкладки с собственными параметрами, а веб-страница, олицетворяющая Microsoft Teams, может загрузить URL-адрес содержимого вкладки в IFRAME и вернуть собственные данные `getContext()` в функцию. Информация, связанная с удостоверением, должна рассматриваться в контексте вкладки просто как подсказки и проверять их перед использованием.

## <a name="samples"></a>Примеры

Пример кода, иллюстрирующий процесс проверки подлинности на вкладках, см.

* [Пример проверки подлинности с помощью вкладки Microsoft Teams (узел)](https://github.com/OfficeDev/microsoft-teams-sample-complete-node)
* [Пример проверки подлинности с помощью вкладки Microsoft Teams (C#)](https://github.com/OfficeDev/microsoft-teams-sample-complete-csharp)

## <a name="more-details"></a>Дополнительные сведения

Подробное пошаговое руководство по реализации проверки подлинности на вкладке Azure Active Directory можно найти в следующих статьях:

* [Проверка подлинности пользователя на вкладке Microsoft Teams](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [Автоматическая проверка подлинности](~/tabs/how-to/authentication/auth-silent-AAD.md)
