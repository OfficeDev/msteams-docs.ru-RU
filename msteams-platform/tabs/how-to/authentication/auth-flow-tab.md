---
title: Поток проверки подлинности для вкладок
description: Описывает поток проверки подлинности на вкладке
ms.topic: conceptual
localization_priority: Normal
keywords: Вкладки потока проверки подлинности команд
ms.openlocfilehash: 012e38b0fa689527999237ccc07b7352fc00ae71
ms.sourcegitcommit: 825abed2f8784d2bab7407ba7a4455ae17bbd28f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/26/2021
ms.locfileid: "52020396"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="0d8c0-104">Поток проверки подлинности Microsoft Teams для вкладок</span><span class="sxs-lookup"><span data-stu-id="0d8c0-104">Microsoft Teams authentication flow for tabs</span></span>

> [!NOTE]
> <span data-ttu-id="0d8c0-105">Для проверки подлинности для работы вкладки на мобильных клиентах необходимо убедиться, что вы используете по крайней мере 1.4.1 версию SDK JavaScript Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-105">For authentication to work for your tab on mobile clients, you must ensure you are using at least 1.4.1 version of the Microsoft Teams JavaScript SDK.</span></span>
> <span data-ttu-id="0d8c0-106">Teams SDK запускает отдельное окно для потока проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-106">Teams SDK launches separate window for authentication flow.</span></span> <span data-ttu-id="0d8c0-107">Установите `SameSite` атрибут **Lax**.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-107">Set the `SameSite` attribute to **Lax**.</span></span> <span data-ttu-id="0d8c0-108">Teams desktop client или older versions of Chrome or Safari do not support `SameSite` =None.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-108">Teams desktop client or older versions of Chrome or Safari do not support `SameSite`=None.</span></span>

<span data-ttu-id="0d8c0-109">OAuth 2.0 — это открытый стандарт проверки подлинности и авторизации, используемый Azure Active Directory (AAD) и многими другими поставщиками удостоверений.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-109">OAuth 2.0 is an open standard for authentication and authorization used by Azure Active Directory (AAD) and many other identity providers.</span></span> <span data-ttu-id="0d8c0-110">Базовое понимание OAuth 2.0 является обязательным условием для работы с проверкой подлинности в Teams.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-110">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams.</span></span> <span data-ttu-id="0d8c0-111">Дополнительные сведения см. в упрощенной спецификации [OAuth 2,](https://aaronparecki.com/oauth-2-simplified/) которую проще выполнять, чем [формальные спецификации.](https://oauth.net/2/)</span><span class="sxs-lookup"><span data-stu-id="0d8c0-111">For more information, see [OAuth 2 simplified](https://aaronparecki.com/oauth-2-simplified/) that is easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="0d8c0-112">Поток проверки подлинности для вкладок и ботов отличается тем, что вкладки похожи на веб-сайты, поэтому они могут напрямую использовать OAuth 2.0.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-112">Authentication flow for tabs and bots are different because tabs are similar to websites so they can use OAuth 2.0 directly.</span></span> <span data-ttu-id="0d8c0-113">Боты делают несколько вещей по-другому, но основные понятия идентичны.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-113">Bots do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="0d8c0-114">Пример потока проверки подлинности для вкладок и ботов с использованием Node и неявного типа гранта [OAuth 2.0](https://oauth.net/2/grant-types/implicit/)см. в инициализации потока проверки подлинности для [вкладок](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).</span><span class="sxs-lookup"><span data-stu-id="0d8c0-114">For an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/), see [initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).</span></span>

> [!NOTE]
> <span data-ttu-id="0d8c0-115">Прежде чем **показывать** пользователю кнопку Входа и вызывать API в ответ на выбор кнопки, необходимо дождаться завершения инициализации `microsoftTeams.authentication.authenticate` SDK.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-115">Before showing a **Login** button to the user and calling the `microsoftTeams.authentication.authenticate` API in response to selecting the button, you must wait for the SDK initialization to complete.</span></span> <span data-ttu-id="0d8c0-116">Вы можете передать вызов в `microsoftTeams.initialize` API, который называется после завершения инициализации.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-116">You can pass a callback to the `microsoftTeams.initialize` API that is called when initialization completes.</span></span>

![Схема последовательности проверки подлинности вкладок](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="0d8c0-118">Пользователь взаимодействует с содержимым на странице конфигурации вкладки или контента, обычно с помощью кнопки **Вход** или **Вход.**</span><span class="sxs-lookup"><span data-stu-id="0d8c0-118">The user interacts with the content on the tab configuration or content page, commonly a **Sign in** or **Log in** button.</span></span>
2. <span data-ttu-id="0d8c0-119">Вкладка строит URL-адрес для своей страницы запуска auth.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-119">The tab constructs the URL for its auth start page.</span></span> <span data-ttu-id="0d8c0-120">Кроме того, для оптимизации работы с проверкой подлинности для пользователя используется информация из переоформителей URL-адресов или `microsoftTeams.getContext()` клиентского SDK-метода Teams.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-120">Optionally, it uses information from URL placeholders or calls `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="0d8c0-121">Например, при проверке подлинности с помощью AAD, если параметр задан на адрес электронной почты пользователя, пользователю не нужно войдывать, если он сделал это `login_hint` в последнее время.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-121">For example, when authenticating with AAD, if the `login_hint` parameter is set to the user's email address, the user does not have to sign in if they have done so recently.</span></span> <span data-ttu-id="0d8c0-122">Это потому, что AAD использует кэшные учетные данные пользователя.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-122">This is because AAD uses the user's cached credentials.</span></span> <span data-ttu-id="0d8c0-123">Всплывающее окно отображается кратко, а затем исчезает.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-123">The pop-up window is shown briefly and then disappears.</span></span>
3. <span data-ttu-id="0d8c0-124">Затем вкладка вызывает метод `microsoftTeams.authentication.authenticate()` и регистрирует функции `successCallback` и `failureCallback`.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-124">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="0d8c0-125">Teams открывает стартовую страницу в iframe в всплывающее окно.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-125">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="0d8c0-126">Стартовая страница создает случайные данные, сохраняет их для будущей проверки и перенаправляет в конечную точку поставщика удостоверений, например `state` `/authorize` в Azure `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` AD.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-126">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint, such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="0d8c0-127">Замените `<tenant id>` собственный id клиента, который является context.tid.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-127">Replace `<tenant id>` with your own tenant id that is context.tid.</span></span>
<span data-ttu-id="0d8c0-128">Как и другие потоки auth приложения в Teams, стартовая страница должна быть на домене, который находится в его списке, и в том же домене, что и после знака на странице `validDomains` перенаправления.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-128">Similar to other application auth flows in Teams, the start page must be on a domain that is in its `validDomains` list, and on the same domain as the post sign in redirect page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="0d8c0-129">Неявный поток грантов OAuth 2.0 вызывает параметр в запросе на проверку подлинности, который содержит уникальные данные сеанса для предотвращения атаки подделки запросов на межсайтовые `state` [запросы.](https://en.wikipedia.org/wiki/Cross-site_request_forgery)</span><span class="sxs-lookup"><span data-stu-id="0d8c0-129">The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request, which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="0d8c0-130">В примерах для данных используется случайно созданный `state` GUID.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-130">The examples use a randomly-generated GUID for the `state` data.</span></span>

5. <span data-ttu-id="0d8c0-131">На сайте поставщика пользователь в записи и предоставляет доступ к вкладке.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-131">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="0d8c0-132">Поставщик принимает пользователя на страницу перенаправления OAuth 2.0 вкладки с маркером доступа.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-132">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="0d8c0-133">Вкладка проверяет, соответствует ли возвращенные значения сохраненным ранее значениям, и вызывает, что в свою очередь вызывает функцию, зарегистрированную `state` `microsoftTeams.authentication.notifySuccess()` на `successCallback` шаге 3.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-133">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="0d8c0-134">Teams закрывает всплывающее окно.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-134">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="0d8c0-135">Вкладка отображает пользовательский интерфейс конфигурации, обновляет или перезагружает содержимое вкладок в зависимости от того, с чего начал пользователь.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-135">The tab either displays configuration UI, refreshes, or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="0d8c0-136">Обработать контекст вкладки в качестве подсказок</span><span class="sxs-lookup"><span data-stu-id="0d8c0-136">Treat tab context as hints</span></span>

<span data-ttu-id="0d8c0-137">Хотя контекст вкладки предоставляет полезную информацию о пользователе, не используйте эту информацию для проверки подлинности пользователя.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-137">Although the tab context provides helpful information regarding the user, do not use this information to authenticate the user.</span></span> <span data-ttu-id="0d8c0-138">У проверки подлинности пользователя, даже если вы получаете информацию в качестве параметров URL-адреса на URL-адрес контента вкладки или путем вызова функции в `microsoftTeams.getContext()` клиентской SDK Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-138">Do authenticate the user even if you get the information as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="0d8c0-139">Злоумышленник может вызывать URL-адрес контента вкладок со своими параметрами.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-139">A malicious actor can invoke your tab content URL with its own parameters.</span></span> <span data-ttu-id="0d8c0-140">Актер также может вызвать веб-страницу, на которую выдвигается microsoft Teams, чтобы загрузить URL-адрес контента вкладок в iframe и вернуть собственные данные в `getContext()` функцию.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-140">The actor can also invoke a web page impersonating Microsoft Teams to load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="0d8c0-141">Необходимо рассматривать сведения, связанные с удостоверениями, в контексте вкладок просто как подсказки и проверять их перед использованием.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-141">You must treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="0d8c0-142">Обратитесь к заметкам в [переходе на страницу авторизации со всплываемой страницы](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span><span class="sxs-lookup"><span data-stu-id="0d8c0-142">Refer to the notes in [navigate to the authorization page from your pop-up page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="code-sample"></a><span data-ttu-id="0d8c0-143">Пример кода</span><span class="sxs-lookup"><span data-stu-id="0d8c0-143">Code sample</span></span>

<span data-ttu-id="0d8c0-144">Пример кода, показывающий процесс проверки подлинности вкладок.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-144">Sample code showing the tab authentication process.</span></span>

| <span data-ttu-id="0d8c0-145">**Пример имени**</span><span class="sxs-lookup"><span data-stu-id="0d8c0-145">**Sample name**</span></span> | <span data-ttu-id="0d8c0-146">**Описание**</span><span class="sxs-lookup"><span data-stu-id="0d8c0-146">**Description**</span></span> | <span data-ttu-id="0d8c0-147">**C#**</span><span class="sxs-lookup"><span data-stu-id="0d8c0-147">**C#**</span></span> | <span data-ttu-id="0d8c0-148">**Node.js**</span><span class="sxs-lookup"><span data-stu-id="0d8c0-148">**Node.js**</span></span> |
|-----------------|-----------------|-------------|------------|
| <span data-ttu-id="0d8c0-149">Проверка подлинности вкладок Teams</span><span class="sxs-lookup"><span data-stu-id="0d8c0-149">Teams tab authentication</span></span> | <span data-ttu-id="0d8c0-150">Процесс проверки подлинности для вкладок с помощью AAD.</span><span class="sxs-lookup"><span data-stu-id="0d8c0-150">Authentication process for tabs using AAD.</span></span> | [<span data-ttu-id="0d8c0-151">View</span><span class="sxs-lookup"><span data-stu-id="0d8c0-151">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/csharp) | [<span data-ttu-id="0d8c0-152">View</span><span class="sxs-lookup"><span data-stu-id="0d8c0-152">View</span></span>](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/nodejs) |

## <a name="more-details"></a><span data-ttu-id="0d8c0-153">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="0d8c0-153">More details</span></span>

<span data-ttu-id="0d8c0-154">Подробные сведения о реализации проверки подлинности вкладок с помощью AAD см. в</span><span class="sxs-lookup"><span data-stu-id="0d8c0-154">For a detailed implementation for tab authentication using AAD, see:</span></span>

* [<span data-ttu-id="0d8c0-155">Проверка подлинности пользователя на вкладке Teams</span><span class="sxs-lookup"><span data-stu-id="0d8c0-155">Authenticate a user in a Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="0d8c0-156">Бесшумная проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="0d8c0-156">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
