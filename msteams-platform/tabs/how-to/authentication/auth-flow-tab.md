---
title: Поток проверки подлинности для вкладок
description: Описывает поток проверки подлинности на вкладке
ms.topic: conceptual
keywords: вкладки потока проверки подлинности teams
ms.openlocfilehash: 9505419a6594529bcf8d19a90d029705e573c67b
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014588"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a>Поток проверки подлинности Microsoft Teams для вкладок

> [!Note]
> Чтобы проверка подлинности работала для вашей вкладки на мобильных клиентах, необходимо убедиться, что вы используете по крайней мере версию 1.4.1 SDK JavaScript для Teams.
> SDK Teams запускает отдельное окно для потока проверки подлинности, поэтому атрибуту samesite можно установить "Lax". В настоящее время sameSite=None не поддерживается классическим клиентом Teams или более старыми версиями Chrome или Safari.

OAuth 2.0 — это открытый стандарт проверки подлинности и авторизации, используемый Azure AD и многими другими поставщиками удостоверений. Базовое понимание OAuth 2.0 является необходимым условием для работы с проверкой подлинности в Teams; [Вот хороший обзор,](https://aaronparecki.com/oauth-2-simplified/) который проще выполнять, чем [формальный спецификации.](https://oauth.net/2/) Поток проверки подлинности для вкладок и ботов немного отличается, так как вкладки очень похожи на веб-сайты, поэтому они могут использовать OAuth 2.0 напрямую; боты не являются и должны по-разному делать несколько вещей, но основные понятия идентичны.

*См.* [статью](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) "Инициация потока проверки подлинности для вкладок и ботов, использующих Node и неявный тип предоставления [OAuth 2.0".](https://oauth.net/2/grant-types/implicit/)

![Схема последовательности проверки подлинности с вкладками](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. Пользователь взаимодействует с содержимым на странице конфигурации вкладок или контента, обычно с кнопкой "Вход" или "Вход".
2. Вкладка соберет URL-адрес для своей страницы проверки подлинности, при желании используя информацию из заметивов URL-адресов или вызывая метод SDK клиента Teams, чтобы упростить проверку подлинности `microsoftTeams.getContext()` для пользователя. Например, при проверке подлинности с помощью Azure AD, если параметр задан для адреса электронной почты пользователя, пользователь может даже не вошел в учетную запись, если это было сделано недавно, так как Azure AD будет использовать кэшные учетные данные пользователя, если это возможно: всплывающее сообщение прогремеет кратковременно, а затем `login_hint` исчезнет.
3. Затем вкладка вызывает `microsoftTeams.authentication.authenticate()` метод и регистрирует `successCallback` `failureCallback` функции и функции.
4. Teams открывает начните страницу в iframe во всплывающее окно. Начальная страница создает случайные данные, сохраняет их для дальнейшей проверки и перенаправляет на конечную точку поставщика удостоверений, например `state` `/authorize` azure `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` AD. Замените `<tenant id>` на собственный ид клиента (context.tid).
    * Как и другие потоки авторизации приложений в Teams, началая страница должна быть в домене, который есть в списке, и в том же домене, что и страница перенаправления после `validDomains` входа.
    * **ВАЖНО!** Неявный поток предоставления OAuth 2.0 вызывает параметр в запросе проверки подлинности, который содержит уникальные данные сеанса для предотвращения атаки подделки межсайтового `state` [запроса.](https://en.wikipedia.org/wiki/Cross-site_request_forgery) В примерах ниже для данных используется генерируемый случайным образом `state` GUID.
5. На сайте поставщика пользователь войт и предоставляет доступ к вкладке.
6. Поставщик перенаправляет пользователя на страницу перенаправления OAuth 2.0 вкладки с маркером доступа.
7. Вкладка проверяет, соответствует ли возвращенный значение ранее сохраненным, и вызывает функцию, зарегистрированную на шаге `state` `microsoftTeams.authentication.notifySuccess()` `successCallback` 3.
8. Teams закрывает всплывающее окно.
9. На вкладке отображается пользовательский интерфейс конфигурации, обновляется или перезагружается содержимое вкладок в зависимости от того, откуда пользователь начал работу.

## <a name="treat-tab-context-as-hints"></a>Рассматривать контекст вкладки как подсказки

Хотя контекст вкладки предоставляет полезную информацию о пользователе, не используйте эти сведения для проверки подлинности пользователя независимо от того, получаете ли вы его в качестве параметров URL-адреса URL-адреса содержимого вкладки или путем вызова функции в клиентском `microsoftTeams.getContext()` SDK Microsoft Teams. Злоумышленник может вызвать URL-адрес содержимого вкладки с собственными параметрами, а веб-страница, под названием Microsoft Teams, загрузит URL-адрес содержимого вкладки в iframe и возвратит свои данные в `getContext()` функцию. Данные, связанные с удостоверениями, следует рассматривать в контексте вкладки просто как подсказки и проверять их перед использованием. Обратитесь к заметкам на [странице авторизации на всплываемой странице.](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page)

## <a name="samples"></a>Примеры

Пример кода, в котором показан процесс проверки подлинности вкладок, см. в:

* [Пример проверки подлинности на вкладке Microsoft Teams (узел)](https://github.com/OfficeDev/microsoft-teams-sample-complete-node)
* [Пример проверки подлинности на вкладке Microsoft Teams (C#)](https://github.com/OfficeDev/microsoft-teams-sample-complete-csharp)

## <a name="more-details"></a>Дополнительные сведения

Подробное руководство по реализации проверки подлинности с использованием вкладок, нацеленное на Azure Active Directory, см. в:

* [Проверка подлинности пользователя на вкладке Microsoft Teams](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [Проверка подлинности без проверки подлинности](~/tabs/how-to/authentication/auth-silent-AAD.md)
