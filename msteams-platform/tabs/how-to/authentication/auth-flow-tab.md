---
title: Поток проверки подлинности для вкладок
description: Описывает поток проверки подлинности на вкладке
ms.topic: conceptual
keywords: вкладки потока проверки подлинности teams
ms.openlocfilehash: 9505419a6594529bcf8d19a90d029705e573c67b
ms.sourcegitcommit: 976e870cc925f61b76c3830ec04ba6e4bdfde32f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/27/2021
ms.locfileid: "50014588"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a><span data-ttu-id="3be18-104">Поток проверки подлинности Microsoft Teams для вкладок</span><span class="sxs-lookup"><span data-stu-id="3be18-104">Microsoft Teams authentication flow for tabs</span></span>

> [!Note]
> <span data-ttu-id="3be18-105">Чтобы проверка подлинности работала для вашей вкладки на мобильных клиентах, необходимо убедиться, что вы используете по крайней мере версию 1.4.1 SDK JavaScript для Teams.</span><span class="sxs-lookup"><span data-stu-id="3be18-105">For authentication to work for your tab on mobile clients, you need to ensure you're using at least the 1.4.1 version of the Teams JavaScript SDK.</span></span>
> <span data-ttu-id="3be18-106">SDK Teams запускает отдельное окно для потока проверки подлинности, поэтому атрибуту samesite можно установить "Lax".</span><span class="sxs-lookup"><span data-stu-id="3be18-106">Teams SDK launches separate window for authentication flow and hence samesite attribute can be set to 'Lax'.</span></span> <span data-ttu-id="3be18-107">В настоящее время sameSite=None не поддерживается классическим клиентом Teams или более старыми версиями Chrome или Safari.</span><span class="sxs-lookup"><span data-stu-id="3be18-107">Currently, SameSite=None is not supported by the Teams desktop client or older versions of Chrome or Safari.</span></span>

<span data-ttu-id="3be18-108">OAuth 2.0 — это открытый стандарт проверки подлинности и авторизации, используемый Azure AD и многими другими поставщиками удостоверений.</span><span class="sxs-lookup"><span data-stu-id="3be18-108">OAuth 2.0 is an open standard for authentication and authorization used by Azure AD and many other identity providers.</span></span> <span data-ttu-id="3be18-109">Базовое понимание OAuth 2.0 является необходимым условием для работы с проверкой подлинности в Teams; [Вот хороший обзор,](https://aaronparecki.com/oauth-2-simplified/) который проще выполнять, чем [формальный спецификации.](https://oauth.net/2/)</span><span class="sxs-lookup"><span data-stu-id="3be18-109">A basic understanding of OAuth 2.0 is a prerequisite for working with authentication in Teams; [here's a good overview](https://aaronparecki.com/oauth-2-simplified/) that's easier to follow than the [formal specification](https://oauth.net/2/).</span></span> <span data-ttu-id="3be18-110">Поток проверки подлинности для вкладок и ботов немного отличается, так как вкладки очень похожи на веб-сайты, поэтому они могут использовать OAuth 2.0 напрямую; боты не являются и должны по-разному делать несколько вещей, но основные понятия идентичны.</span><span class="sxs-lookup"><span data-stu-id="3be18-110">Authentication flow for tabs and bots are a little different because tabs are very similar to websites so they can use OAuth 2.0 directly; bots are not and must do a few things differently, but the core concepts are identical.</span></span>

<span data-ttu-id="3be18-111">*См.* [статью](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) "Инициация потока проверки подлинности для вкладок и ботов, использующих Node и неявный тип предоставления [OAuth 2.0".](https://oauth.net/2/grant-types/implicit/)</span><span class="sxs-lookup"><span data-stu-id="3be18-111">*See*, [Initiate authentication flow for tabs](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow) for an example of authentication flow for tabs and bots using Node and the [OAuth 2.0 implicit grant type](https://oauth.net/2/grant-types/implicit/).</span></span>

![Схема последовательности проверки подлинности с вкладками](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. <span data-ttu-id="3be18-113">Пользователь взаимодействует с содержимым на странице конфигурации вкладок или контента, обычно с кнопкой "Вход" или "Вход".</span><span class="sxs-lookup"><span data-stu-id="3be18-113">The user interacts with the content on the tab configuration or content page, commonly a button labeled "Sign in" or "Log in".</span></span>
2. <span data-ttu-id="3be18-114">Вкладка соберет URL-адрес для своей страницы проверки подлинности, при желании используя информацию из заметивов URL-адресов или вызывая метод SDK клиента Teams, чтобы упростить проверку подлинности `microsoftTeams.getContext()` для пользователя.</span><span class="sxs-lookup"><span data-stu-id="3be18-114">The tab constructs the URL for its auth start page, optionally using information from URL placeholders or by calling `microsoftTeams.getContext()` Teams client SDK method to streamline the authentication experience for the user.</span></span> <span data-ttu-id="3be18-115">Например, при проверке подлинности с помощью Azure AD, если параметр задан для адреса электронной почты пользователя, пользователь может даже не вошел в учетную запись, если это было сделано недавно, так как Azure AD будет использовать кэшные учетные данные пользователя, если это возможно: всплывающее сообщение прогремеет кратковременно, а затем `login_hint` исчезнет.</span><span class="sxs-lookup"><span data-stu-id="3be18-115">For example, when authenticating with Azure AD, if the `login_hint` parameter is set to the user's email address, the user may not even have to sign in if they have done so recently, because Azure AD will use the user's cached credentials if possible: the popup will flash briefly and then disappear.</span></span>
3. <span data-ttu-id="3be18-116">Затем вкладка вызывает `microsoftTeams.authentication.authenticate()` метод и регистрирует `successCallback` `failureCallback` функции и функции.</span><span class="sxs-lookup"><span data-stu-id="3be18-116">The tab then calls the `microsoftTeams.authentication.authenticate()` method and registers the `successCallback` and `failureCallback` functions.</span></span>
4. <span data-ttu-id="3be18-117">Teams открывает начните страницу в iframe во всплывающее окно.</span><span class="sxs-lookup"><span data-stu-id="3be18-117">Teams opens the start page in an iframe in a pop-up window.</span></span> <span data-ttu-id="3be18-118">Начальная страница создает случайные данные, сохраняет их для дальнейшей проверки и перенаправляет на конечную точку поставщика удостоверений, например `state` `/authorize` azure `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` AD.</span><span class="sxs-lookup"><span data-stu-id="3be18-118">The start page generates random `state` data, saves it for future validation, and redirects to the identity provider's `/authorize` endpoint such as `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` for Azure AD.</span></span> <span data-ttu-id="3be18-119">Замените `<tenant id>` на собственный ид клиента (context.tid).</span><span class="sxs-lookup"><span data-stu-id="3be18-119">Replace `<tenant id>` with your own tenant id (context.tid).</span></span>
    * <span data-ttu-id="3be18-120">Как и другие потоки авторизации приложений в Teams, началая страница должна быть в домене, который есть в списке, и в том же домене, что и страница перенаправления после `validDomains` входа.</span><span class="sxs-lookup"><span data-stu-id="3be18-120">Like other application auth flows in Teams, the start page must be on a domain that's in its `validDomains` list, and on the same domain as the post-login redirect page.</span></span>
    * <span data-ttu-id="3be18-121">**ВАЖНО!** Неявный поток предоставления OAuth 2.0 вызывает параметр в запросе проверки подлинности, который содержит уникальные данные сеанса для предотвращения атаки подделки межсайтового `state` [запроса.](https://en.wikipedia.org/wiki/Cross-site_request_forgery)</span><span class="sxs-lookup"><span data-stu-id="3be18-121">**IMPORTANT**: The OAuth 2.0 implicit grant flow calls for a `state` parameter in the authentication request which contains unique session data to prevent a [cross-site request forgery attack](https://en.wikipedia.org/wiki/Cross-site_request_forgery).</span></span> <span data-ttu-id="3be18-122">В примерах ниже для данных используется генерируемый случайным образом `state` GUID.</span><span class="sxs-lookup"><span data-stu-id="3be18-122">The examples below use a randomly-generated GUID for the `state` data.</span></span>
5. <span data-ttu-id="3be18-123">На сайте поставщика пользователь войт и предоставляет доступ к вкладке.</span><span class="sxs-lookup"><span data-stu-id="3be18-123">On the provider's site, the user signs in and grants access to the tab.</span></span>
6. <span data-ttu-id="3be18-124">Поставщик перенаправляет пользователя на страницу перенаправления OAuth 2.0 вкладки с маркером доступа.</span><span class="sxs-lookup"><span data-stu-id="3be18-124">The provider takes the user to the tab's OAuth 2.0 redirect page with an access token.</span></span>
7. <span data-ttu-id="3be18-125">Вкладка проверяет, соответствует ли возвращенный значение ранее сохраненным, и вызывает функцию, зарегистрированную на шаге `state` `microsoftTeams.authentication.notifySuccess()` `successCallback` 3.</span><span class="sxs-lookup"><span data-stu-id="3be18-125">The tab checks that the returned `state` value matches what was saved earlier, and calls `microsoftTeams.authentication.notifySuccess()`, which in turn calls the `successCallback` function registered in step 3.</span></span>
8. <span data-ttu-id="3be18-126">Teams закрывает всплывающее окно.</span><span class="sxs-lookup"><span data-stu-id="3be18-126">Teams closes the pop-up window.</span></span>
9. <span data-ttu-id="3be18-127">На вкладке отображается пользовательский интерфейс конфигурации, обновляется или перезагружается содержимое вкладок в зависимости от того, откуда пользователь начал работу.</span><span class="sxs-lookup"><span data-stu-id="3be18-127">The tab either displays configuration UI or refreshes or reloads the tabs content, depending on where the user started from.</span></span>

## <a name="treat-tab-context-as-hints"></a><span data-ttu-id="3be18-128">Рассматривать контекст вкладки как подсказки</span><span class="sxs-lookup"><span data-stu-id="3be18-128">Treat tab context as hints</span></span>

<span data-ttu-id="3be18-129">Хотя контекст вкладки предоставляет полезную информацию о пользователе, не используйте эти сведения для проверки подлинности пользователя независимо от того, получаете ли вы его в качестве параметров URL-адреса URL-адреса содержимого вкладки или путем вызова функции в клиентском `microsoftTeams.getContext()` SDK Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="3be18-129">Although the tab context provides helpful information regarding the user, don't use this information to authenticate the user whether you get it as URL parameters to your tab content URL or by calling the `microsoftTeams.getContext()` function in the Microsoft Teams client SDK.</span></span> <span data-ttu-id="3be18-130">Злоумышленник может вызвать URL-адрес содержимого вкладки с собственными параметрами, а веб-страница, под названием Microsoft Teams, загрузит URL-адрес содержимого вкладки в iframe и возвратит свои данные в `getContext()` функцию.</span><span class="sxs-lookup"><span data-stu-id="3be18-130">A malicious actor could invoke your tab content URL with its own parameters, and a web page impersonating Microsoft Teams could load your tab content URL in an iframe and return its own data to the `getContext()` function.</span></span> <span data-ttu-id="3be18-131">Данные, связанные с удостоверениями, следует рассматривать в контексте вкладки просто как подсказки и проверять их перед использованием.</span><span class="sxs-lookup"><span data-stu-id="3be18-131">You should treat the identity-related information in the tab context simply as hints and validate them before use.</span></span> <span data-ttu-id="3be18-132">Обратитесь к заметкам на [странице авторизации на всплываемой странице.](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page)</span><span class="sxs-lookup"><span data-stu-id="3be18-132">Refer to the notes in [Navigate to the authorization page from your popup page](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).</span></span>

## <a name="samples"></a><span data-ttu-id="3be18-133">Примеры</span><span class="sxs-lookup"><span data-stu-id="3be18-133">Samples</span></span>

<span data-ttu-id="3be18-134">Пример кода, в котором показан процесс проверки подлинности вкладок, см. в:</span><span class="sxs-lookup"><span data-stu-id="3be18-134">For sample code showing the tab authentication process see:</span></span>

* [<span data-ttu-id="3be18-135">Пример проверки подлинности на вкладке Microsoft Teams (узел)</span><span class="sxs-lookup"><span data-stu-id="3be18-135">Microsoft Teams tab authentication sample (Node)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-node)
* [<span data-ttu-id="3be18-136">Пример проверки подлинности на вкладке Microsoft Teams (C#)</span><span class="sxs-lookup"><span data-stu-id="3be18-136">Microsoft Teams tab authentication sample (C#)</span></span>](https://github.com/OfficeDev/microsoft-teams-sample-complete-csharp)

## <a name="more-details"></a><span data-ttu-id="3be18-137">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="3be18-137">More details</span></span>

<span data-ttu-id="3be18-138">Подробное руководство по реализации проверки подлинности с использованием вкладок, нацеленное на Azure Active Directory, см. в:</span><span class="sxs-lookup"><span data-stu-id="3be18-138">For a detailed implementation walkthrough for tab authentication targeting Azure Active Directory see:</span></span>

* [<span data-ttu-id="3be18-139">Проверка подлинности пользователя на вкладке Microsoft Teams</span><span class="sxs-lookup"><span data-stu-id="3be18-139">Authenticate a user in a Microsoft Teams tab</span></span>](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [<span data-ttu-id="3be18-140">Проверка подлинности без проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="3be18-140">Silent authentication</span></span>](~/tabs/how-to/authentication/auth-silent-AAD.md)
