---
title: Включение проверки подлинности с помощью стороннего поставщика OAuth
description: В этой статье вы узнаете о потоке проверки подлинности Teams на вкладках, стороннем поставщике OAuth, OAuth от Azure AD и примерах кода проверки подлинности.
ms.topic: conceptual
ms.localizationpriority: high
ms.openlocfilehash: 2edd52d80428e47a8586ec27de4b1595d872df8c
ms.sourcegitcommit: ca84b5fe5d3b97f377ce5cca41c48afa95496e28
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2022
ms.locfileid: "66144252"
---
# <a name="enable-authentication-using-third-party-oauth-provider"></a>Включение проверки подлинности с помощью стороннего поставщика OAuth

Вы можете включить проверку подлинности в своем приложении вкладки с помощью сторонних поставщиков удостоверений (IdP) OAuth. В этом методе проверка удостоверения пользователя приложения и предоставление доступа выполняется поставщиком удостоверений OAuth, таким как Azure AD, Google, Facebook, GitHub или любым другим поставщиком. Необходимо настроить отношение доверия с поставщиком удостоверения, а пользователи вашего приложения также должны быть зарегистрированы в нем.

> [!NOTE]
> Чтобы проверка подлинности работала для вашей вкладки в мобильных клиентах, необходимо убедиться, что вы используете версию Microsoft Teams JavaScript SDK не ниже 1.4.1.  
> Teams SDK запускает отдельное окно для потока проверки подлинности. Установите для атрибута `SameSite` значение **Lax** Клиент Teams для настольных компьютеров или более ранние версии Chrome или Safari не поддерживают`SameSite`= Нет

## <a name="use-oauth-idp-to-enable-authentication"></a>Использование поставщика удостоверений OAuth для включения проверки подлинности

OAuth 2.0 — это открытый стандарт проверки подлинности и авторизации, используемый Microsoft Azure Active Directory (Azure AD) и многими другими поставщиками удостоверений. Базовое понимание OAuth 2.0 является необходимым условием для работы с проверкой подлинности в Teams. Дополнительные сведения см. в разделе [Упрощенная версия OAuth 2](https://aaronparecki.com/oauth-2-simplified/), которой легче следовать, чем [формальной спецификации](https://oauth.net/2/). Процесс проверки подлинности для вкладок и ботов отличается, поскольку вкладки похожи на веб-сайты, поэтому они могут напрямую использовать OAuth 2.0. Боты делают некоторые вещи иначе, но основные концепции идентичны.

Например, поток проверки подлинности для вкладок и ботов, использующий Node и [неявный тип предоставления OAuth 2.0](https://oauth.net/2/grant-types/implicit/), см. в разделе [инициация потока проверки подлинности для вкладок](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).

В этом разделе Azure AD используется в качестве примера стороннего поставщика OAuth для включения проверки подлинности в приложении вкладки.

> [!NOTE]
> Прежде чем показывать пользователю кнопку **входа** и вызывать `microsoftTeams.authentication.authenticate` API в ответ на выбор кнопки, необходимо дождаться завершения инициализации SDK. Вы можете передать обратный вызов `microsoftTeams.initialize` API, который вызывается после завершения инициализации.

![Диаграмма последовательности проверки подлинности с помощью вкладок](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. Пользователь взаимодействует с содержимым на вкладке конфигурации или странице содержимого, обычно с помощью кнопки **Войти** с помощью имени пользователя и пароля или **Войти** автоматически.
2. Вкладка создает URL-адрес своей начальной страницы проверки подлинности. При необходимости он использует информацию из заполнителей URL-адресов или вызывает метод SDK `microsoftTeams.getContext()` клиента Teams, чтобы упростить процесс проверки подлинности для пользователя. Например, при проверке подлинности с помощью Azure AD, если для параметра `login_hint` задан адрес почты пользователя, ему не нужно входить в систему, если он недавно сделал это. Это связано с тем, что Azure AD использует кэшированные учетные данные пользователя. Всплывающее окно появляется на короткое время, а затем исчезает.
3. Затем вкладка вызывает метод `microsoftTeams.authentication.authenticate()` и регистрирует функции `successCallback` и `failureCallback`.
4. Teams открывает начальную страницу в iframe во всплывающем окне. Начальная страница создает случайные данные `state`, сохраняет их для будущей проверки и перенаправляет на конечную точку поставщика удостоверений `/authorize`, например `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` для Azure AD. Замените `<tenant id>` своим собственным идентификатором арендатора, который называется context.tid.
Как и в случае с другими потоками проверки подлинности приложений в Teams, начальная страница должна находиться в домене, который находится в ее списке `validDomains`, и в том же домене, что и страница перенаправления после входа.

    > [!NOTE]
    > Поток неявного предоставления разрешения OAuth 2.0 вызывает параметр `state` в запросе проверки подлинности, который содержит уникальные данные сеанса для предотвращения [атаки подделки межсайтового запроса](https://en.wikipedia.org/wiki/Cross-site_request_forgery). В примерах используется случайно сгенерированный GUID для данных `state`.

5. На сайте провайдера пользователь входит в систему и предоставляет доступ к вкладке.
6. Поставщик направляет пользователя на страницу перенаправления OAuth 2.0 на вкладке с токеном доступа.
7. Вкладка проверяет, соответствует ли возвращенное значение `state` тому, что было сохранено ранее, и вызывает `microsoftTeams.authentication.notifySuccess()`, который, в свою очередь, вызывает функцию `successCallback`, зарегистрированную на шаге 3.
8. Teams закрывает всплывающее окно.
9. На вкладке отображается пользовательский интерфейс конфигурации, обновляется или перезагружается содержимое вкладок, в зависимости от того, откуда пользователь начал.

> [!NOTE]
> Если приложение поддерживает единый вход SAML, то токен JWT, сгенерированный единым входом на вкладке, нельзя использовать, поскольку он не поддерживается.

## <a name="treat-tab-context-as-hints"></a>Рассматривайте контекст вкладки как подсказки

Хотя контекст вкладки предоставляет полезную информацию о пользователе, не используйте эту информацию для проверки подлинности пользователя. Выполняйте проверку подлинности пользователя, даже если вы получаете информацию в виде параметров URL-адреса для URL-адреса содержимого вкладки или путем вызова функции `microsoftTeams.getContext()` в клиентском пакете SDK Microsoft Teams. Злоумышленник может вызвать URL содержимого вашей вкладки со своими параметрами. Субъект также может вызывать веб-страницу, выдающую себя за Microsoft Teams, для загрузки URL-адреса содержимого вкладки в iframe и возврата собственных данных в функцию `getContext()`. Вы должны относиться к идентификационной информации в контексте вкладки как к подсказке и проверять ее перед использованием. Обратитесь к примечаниям при [переходе на страницу авторизации со всплывающей страницы](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-pop-up-page).

## <a name="code-sample"></a>Пример кода

Образец кода, показывающий процесс проверки подлинности на вкладке:

| **Название примера** | **Описание** | **C#** | **Node.js** |
|-----------------|-----------------|-------------|------------|
| Проверка подлинности на вкладке Teams | Процесс проверки подлинности для вкладок с помощью Azure AD. | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/csharp) | [Просмотр](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/nodejs) |

## <a name="see-also"></a>Дополнительные ресурсы

Подробные сведения о реализации проверки подлинности на вкладке с помощью Azure AD см. в:

* [Проверка подлинности пользователя на вкладке Teams](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [Автоматическая проверка подлинности](~/tabs/how-to/authentication/auth-silent-AAD.md)
