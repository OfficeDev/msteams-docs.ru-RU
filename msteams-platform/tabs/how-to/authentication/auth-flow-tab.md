---
title: Поток проверки подлинности для вкладок
description: Описывает поток проверки подлинности на вкладке
ms.topic: conceptual
localization_priority: Normal
keywords: Вкладки потока проверки подлинности команд
ms.openlocfilehash: 1282c149beba0ff5b424585f566a703f48234fa2
ms.sourcegitcommit: 51e4a1464ea58c254ad6bd0317aca03ebf6bf1f6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "52566693"
---
# <a name="microsoft-teams-authentication-flow-for-tabs"></a>Microsoft Teams потока проверки подлинности для вкладок

> [!NOTE]
> Для проверки подлинности для работы вкладки на мобильных клиентах необходимо убедиться, что вы используете по крайней мере 1.4.1 версию Microsoft Teams JavaScript SDK.
> Teams SDK запускает отдельное окно для потока проверки подлинности. Установите `SameSite` атрибут **Lax**. Teams или более старые версии Chrome или Safari не поддерживают `SameSite` =None.

OAuth 2.0 — это открытый стандарт проверки подлинности и авторизации, используемый Azure Active Directory (AAD) и многими другими поставщиками удостоверений. Базовое понимание OAuth 2.0 является обязательным условием для работы с проверкой подлинности в Teams. Дополнительные сведения см. в упрощенной спецификации [OAuth 2,](https://aaronparecki.com/oauth-2-simplified/) которую проще выполнять, чем [формальные спецификации.](https://oauth.net/2/) Поток проверки подлинности для вкладок и ботов отличается тем, что вкладки похожи на веб-сайты, поэтому они могут напрямую использовать OAuth 2.0. Боты делают несколько вещей по-другому, но основные понятия идентичны.

Пример потока проверки подлинности для вкладок и ботов с использованием Node и неявного типа гранта [OAuth 2.0](https://oauth.net/2/grant-types/implicit/)см. в инициализации потока проверки подлинности для [вкладок](~/tabs/how-to/authentication/auth-tab-aad.md#initiate-authentication-flow).

> [!NOTE]
> Прежде чем **показывать** пользователю кнопку Входа и вызывать API в ответ на выбор кнопки, необходимо дождаться завершения инициализации `microsoftTeams.authentication.authenticate` SDK. Вы можете передать вызов в `microsoftTeams.initialize` API, который называется после завершения инициализации.

![Схема последовательности проверки подлинности вкладок](~/assets/images/authentication/tab_auth_sequence_diagram.png)

1. Пользователь взаимодействует с содержимым на странице конфигурации вкладки или контента, обычно с помощью кнопки **Вход** или **Вход.**
2. Вкладка строит URL-адрес для своей страницы запуска auth. Кроме того, для оптимизации работы с проверкой подлинности для пользователя используются сведения из url-адресов или Teams клиентского `microsoftTeams.getContext()` SDK-метода. Например, при проверке подлинности с помощью AAD, если параметр задан на адрес электронной почты пользователя, пользователю не нужно войдывать, если он сделал это `login_hint` в последнее время. Это потому, что AAD использует кэшные учетные данные пользователя. Всплывающее окно отображается кратко, а затем исчезает.
3. Затем вкладка вызывает метод `microsoftTeams.authentication.authenticate()` и регистрирует функции `successCallback` и `failureCallback`.
4. Teams откроет начните страницу в iframe в всплывающее окно. Стартовая страница создает случайные данные, сохраняет их для будущей проверки и перенаправляет в конечную точку поставщика удостоверений, например `state` `/authorize` в Azure `https://login.microsoftonline.com/<tenant ID>/oauth2/authorize` AD. Замените `<tenant id>` собственный id клиента, который является context.tid.
Как и другие потоки auth приложения в Teams, стартовая страница должна быть на домене, который находится в его списке, и в том же домене, что и после подписания на странице `validDomains` перенаправления.

    > [!NOTE]
    > Неявный поток грантов OAuth 2.0 вызывает параметр в запросе на проверку подлинности, который содержит уникальные данные сеанса для предотвращения атаки подделки запросов на межсайтовые `state` [запросы.](https://en.wikipedia.org/wiki/Cross-site_request_forgery) В примерах для данных используется случайно созданный `state` GUID.

5. На сайте поставщика пользователь в записи и предоставляет доступ к вкладке.
6. Поставщик принимает пользователя на страницу перенаправления OAuth 2.0 вкладки с маркером доступа.
7. Вкладка проверяет, соответствует ли возвращенные значения сохраненным ранее значениям, и вызывает, что в свою очередь вызывает функцию, зарегистрированную `state` `microsoftTeams.authentication.notifySuccess()` на `successCallback` шаге 3.
8. Teams закрывает всплывающее окно.
9. Вкладка отображает пользовательский интерфейс конфигурации, обновляет или перезагружает содержимое вкладок в зависимости от того, с чего начал пользователь.

## <a name="treat-tab-context-as-hints"></a>Обработать контекст вкладки в качестве подсказок

Хотя контекст вкладки предоставляет полезную информацию о пользователе, не используйте эту информацию для проверки подлинности пользователя. У проверки подлинности пользователя, даже если вы получаете информацию в качестве параметров URL-адреса на URL-адрес контента вкладки или путем вызова функции в Microsoft Teams `microsoftTeams.getContext()` клиента SDK. Злоумышленник может вызывать URL-адрес контента вкладок со своими параметрами. Актер также может вызвать веб-страницу, Microsoft Teams для загрузки URL-адреса контента вкладок в iframe и возврата собственных данных в `getContext()` функцию. Необходимо рассматривать сведения, связанные с удостоверениями, в контексте вкладок просто как подсказки и проверять их перед использованием. Обратитесь к заметкам в [переходе на страницу авторизации со всплываемой страницы](~/tabs/how-to/authentication/auth-tab-aad.md#navigate-to-the-authorization-page-from-your-popup-page).

## <a name="code-sample"></a>Пример кода

Пример кода, показывающий процесс проверки подлинности вкладок:

| **Пример имени** | **Описание** | **C#** | **Node.js** |
|-----------------|-----------------|-------------|------------|
| Teams проверки подлинности вкладок | Процесс проверки подлинности для вкладок с помощью AAD. | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/csharp) | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/app-complete-sample/nodejs) |

## <a name="more-details"></a>Дополнительные сведения

Подробные сведения о реализации проверки подлинности вкладок с помощью AAD см. в

* [Проверка подлинности пользователя на вкладке Teams](~/tabs/how-to/authentication/auth-tab-AAD.md)
* [Бесшумная проверка подлинности](~/tabs/how-to/authentication/auth-silent-AAD.md)
