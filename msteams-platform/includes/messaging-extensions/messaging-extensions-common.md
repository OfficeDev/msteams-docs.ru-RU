## <a name="add-a-messaging-extension-to-your-app"></a>Добавление расширения обмена сообщениями в приложение

Расширение обмена сообщениями — это облачная служба, которая прослушивает запросы пользователей и отвечает структурированными данными, такими как [карточка.](~/task-modules-and-cards/what-are-cards.md) Вы интегрируете свою службу с Microsoft Teams с помощью объектов Bot `Activity` Framework. Наши расширения .NET и Node.js для SDK bot Builder помогут вам добавить в приложение функциональность расширения обмена сообщениями.

![Схема потока сообщений для расширений обмена сообщениями](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a>Регистрация в bot Framework

Если вы еще этого не сделали, сначала необходимо зарегистрировать бота в Microsoft Bot Framework. Для получения и ответа на запросы пользователей в расширении обмена сообщениями будут использоваться ID приложения Майкрософт и конечные точки вызова для вашего бота, как определено там. Не забудьте включить канал Microsoft Teams для бота.

Записыв свой код приложения-бота и пароль приложения, вам потребуется предоставить код приложения в манифесте приложения.

### <a name="update-your-app-manifest"></a>Обновление манифеста приложения

Как и в ботах и [](~/resources/schema/manifest-schema.md#composeextensions) вкладок, вы обновляете манифест приложения, чтобы включить свойства расширения обмена сообщениями. Эти свойства регулируют, как отображается и ведет себя расширение обмена сообщениями в Microsoft Teams клиенте. Расширения обмена сообщениями поддерживаются начиная с v1.0 манифеста.

#### <a name="declare-your-messaging-extension"></a>Объявление расширения обмена сообщениями

Чтобы добавить расширение обмена сообщениями, включите новую структуру JSON верхнего уровня в манифест с `composeExtensions` свойством. В настоящее время вы ограничены созданием единого расширения обмена сообщениями для приложения.

> [!NOTE]
> Манифест относится к расширениям обмена сообщениями как `composeExtensions` . Это необходимо для поддержания обратной совместимости.

Определение расширения — это объект, который имеет следующую структуру:

| Имя свойства | Назначение | Обязательный? |
|---|---|---|
| `botId` | Уникальный идентификатор приложения Майкрософт для бота, зарегистрированный в Bot Framework. Это обычно должно быть таким же, как ИД для общего Teams приложения. | Да |
| `scopes` | Массив, объявляющий, можно ли добавить это расширение или области `personal` `team` (или оба). | Да |
| `canUpdateConfiguration` | Включает **Параметры** меню. | Нет |
| `commands` | Массив команд, поддерживаемых этим расширением обмена сообщениями. Вы ограничены 10 командами. | Да |

#### <a name="define-commands"></a>Определение команд

Расширение обмена сообщениями должно объявить одну команду, которая появляется,  когда пользователь выбирает ваше приложение из кнопки More **(&#8943;) в** окне составить.

![Снимок экрана списка расширений обмена сообщениями в Teams](~/assets/images/compose-extensions/compose-extension-list.png)

В манифесте приложения элемент команды — это объект со следующей структурой:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Уникальный ID, который вы назначаете этой команде. Запрос пользователя будет включать этот ID. | Да | 1.0 |
| `title` | Имя команды. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `description` | Справка текста, указывающее, что делает эта команда. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Установите тип команды. Возможные значения: `query` и `action`. Если не представлено значение по умолчанию, установлено `query` значение . | Нет | 1.4 |
| `initialRun` | Необязательный параметр, используемый `query` с командами. Если заданной **для true,** указывает, что эта команда должна быть выполнена, как только пользователь выберет эту команду в пользовательском интерфейсе. | Нет | 1.0 |
| `fetchTask` | Необязательный параметр, используемый `action` с командами. Установите для **true,** чтобы получить адаптивную карту или веб-URL-адрес для отображения в [модуле задач.](~/task-modules-and-cards/what-are-task-modules.md) Это используется, когда входные данные в команду динамически, а не статический `action` набор параметров. Обратите внимание, что если задан **истинный** список статических параметров для команды, игнорируется. | Нет | 1.4 |
| `parameters` | Статический список параметров для команды. | Да | 1.0 |
| `parameter.name` | Имя параметра. Это отправляется в службу в запросе пользователя. | Да | 1.0 |
| `parameter.description` | Описывает цели этого параметра или пример значения, которое должно быть предоставлено. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Краткое удобное название параметра или метка. | Да | 1.0 |
| `parameter.inputType` | Задай тип необходимого ввода. Возможные `text` значения: `textarea` , , , , `number` `date` `time` `toggle` . По умолчанию `text` установлено значение . | Нет | 1.4 |
| `context` | Необязательный массив значений, определяя контекст, в котором доступно действие сообщения. Возможные значения `message` , `compose` или `commandBox` . Значение по умолчанию: `["compose", "commandBox"]`. | Нет | 1.5 |
