## <a name="add-a-message-extension-to-your-app"></a>Добавление расширения сообщения в приложение

Расширение сообщения — это облачная служба, которая прослушивает запросы пользователей и отвечает структурированными данными, такими как [карточка](~/task-modules-and-cards/what-are-cards.md). Вы интегрируете службу с Microsoft Teams через объекты Bot Framework `Activity` . Наши расширения .NET и Node.js для пакета SDK Bot Builder помогут вам добавить в приложение функции расширения сообщений.

![Схема потока сообщений для расширений сообщений](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a>Регистрация в Bot Framework

Если вы еще не сделали этого, сначала необходимо зарегистрировать бот в Microsoft Bot Framework. Идентификатор приложения Майкрософт и конечные точки обратного вызова для бота, как определено там, будут использоваться в расширении сообщения для получения запросов пользователей и реагирования на них. Не забудьте включить канал Microsoft Teams для бота.

Запишите идентификатор приложения бота и пароль приложения. Вам потребуется указать идентификатор приложения в манифесте приложения.

### <a name="update-your-app-manifest"></a>Обновите манифест вашего приложения

Как и в случае с ботами и вкладками, [](~/resources/schema/manifest-schema.md#composeextensions) вы обновляете манифест приложения, чтобы включить свойства расширения сообщения. Эти свойства определяют, как расширение сообщения отображается и ведет себя в клиенте Microsoft Teams. Расширения сообщений поддерживаются начиная с версии 1.0 манифеста.

#### <a name="declare-your-message-extension"></a>Объявление расширения сообщения

Чтобы добавить расширение сообщения, добавьте новую структуру JSON верхнего уровня в манифест со свойством `composeExtensions` . В настоящее время вы можете создать только одно расширение сообщения для приложения.

> [!NOTE]
> Манифест ссылается на расширения сообщений как `composeExtensions`. Это необходимо для обеспечения обратной совместимости.

Определение расширения — это объект со следующей структурой:

| Имя свойства | Назначение | Обязательный? |
|---|---|---|
| `botId` | Уникальный идентификатор приложения Майкрософт для бота, зарегистрированный в Bot Framework. Обычно он должен совпадать с идентификатором для всего приложения Teams. | Да |
| `scopes` | Массив, объявляющий, можно ли добавить это расширение в `personal` `team` области (или в обе области). | Да |
| `canUpdateConfiguration` | Включает пункт **меню "Параметры** ". | Нет |
| `commands` | Массив команд, поддерживаемых этим расширением сообщения. Количество команд ограничено 10. | Да |

#### <a name="define-commands"></a>Определение команд

Расширение сообщения должно объявить одну команду, которая появляется, когда пользователь нажмет кнопку "Дополнительные параметры **" (****&#8943;**) в поле создания.

![Снимок экрана: список расширений сообщений в Teams](~/assets/images/compose-extensions/compose-extension-list.png)

В манифесте приложения элемент команды является объектом со следующей структурой:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Уникальный идентификатор, присвоенный этой команде. Запрос пользователя будет содержать этот идентификатор. | Да | 1.0 |
| `title` | Имя команды. Это значение выводится в пользовательском интерфейсе. | Да | 1.0 |
| `description` | Текст справки, указывающий, что делает эта команда. Это значение выводится в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Задайте тип команды. Возможные значения: `query` и `action`. В противном случае укажите значение по умолчанию `query`. | Нет | 1.4 |
| `initialRun` | Необязательный параметр, используемый с `query` командами. Если задано **значение true**, указывает, что эта команда должна выполняться, как только пользователь выберет эту команду в пользовательском интерфейсе. | Нет | 1.0 |
| `fetchTask` | Необязательный параметр, используемый с `action` командами. **Задайте значение true**, чтобы получить адаптивную карточку или URL-адрес веб-сайта для отображения в [модуле задачи](~/task-modules-and-cards/what-are-task-modules.md). Это используется, когда входные данные в команду `action` динамически, а не статический набор параметров. Обратите внимание, что если задано **значение true** , список статических параметров для команды игнорируется. | Нет | 1.4 |
| `parameters` | Статический список параметров для команды. | Да | 1.0 |
| `parameter.name` | Имя параметра. Оно отправляется в службу в составе запроса пользователя. | Да | 1.0 |
| `parameter.description` | Описывает цели этого параметра или пример значения, которое должно быть предоставлено. Это значение выводится в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Короткое понятное название параметра или метка. | Да | 1.0 |
| `parameter.inputType` | Задайте требуемый тип входных данных. Возможные значения: `text`, `textarea`, `number`, , `date`, `toggle``time`. По умолчанию задано значение `text`. | Нет | 1.4 |
| `context` | Необязательный массив значений, определяющие контекст, в котором доступно действие сообщения. Возможные значения: `message`, `compose`или `commandBox`. Значение по умолчанию: `["compose", "commandBox"]`. | Нет | 1.5 |
