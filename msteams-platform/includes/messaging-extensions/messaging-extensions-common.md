## <a name="add-a-messaging-extension-to-your-app"></a><span data-ttu-id="fe9c3-101">Добавление расширения обмена сообщениями в приложение</span><span class="sxs-lookup"><span data-stu-id="fe9c3-101">Add a messaging extension to your app</span></span>

<span data-ttu-id="fe9c3-102">Расширение системы обмена сообщениями — это размещенная в облаке служба, которая прослушивает запросы пользователей и отвечает на структурированные данные, такие как [карточка](~/task-modules-and-cards/what-are-cards.md).</span><span class="sxs-lookup"><span data-stu-id="fe9c3-102">A messaging extension is a cloud-hosted service that listens to user requests and responds with structured data, such as a [card](~/task-modules-and-cards/what-are-cards.md).</span></span> <span data-ttu-id="fe9c3-103">Вы интегрируете службу с Microsoft Teams с помощью `Activity` объектов Bot Framework.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-103">You integrate your service with Microsoft Teams via Bot Framework `Activity` objects.</span></span> <span data-ttu-id="fe9c3-104">Наши расширения .NET и Node. js для пакета SDK построителя построителя могут помочь добавить функциональность расширения обмена сообщениями в приложение.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-104">Our .NET and Node.js extensions for the Bot Builder SDK can help you add messaging extension functionality to your app.</span></span>

![Схема процесса обработки сообщений для расширений обмена сообщениями](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a><span data-ttu-id="fe9c3-106">Регистрация в Bot Framework</span><span class="sxs-lookup"><span data-stu-id="fe9c3-106">Register in the Bot Framework</span></span>

<span data-ttu-id="fe9c3-107">Если вы еще не сделали этого, сначала необходимо зарегистрировать Bot с помощью Microsoft Bot Framework.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-107">If you haven’t done so already, you must first register a bot with the Microsoft Bot Framework.</span></span> <span data-ttu-id="fe9c3-108">Идентификатор приложения Microsoft и конечные точки обратного вызова для ленты, как определено, будут использоваться в вашем расширении обмена сообщениями для получения запросов пользователей и реагирования на них.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-108">The Microsoft app ID and callback endpoints for your bot, as defined there, will be used in your messaging extension to receive and respond to user requests.</span></span> <span data-ttu-id="fe9c3-109">Не забудьте включить канал Microsoft Teams для ленты.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-109">Remember to enable the Microsoft Teams channel for your bot.</span></span>

<span data-ttu-id="fe9c3-110">Запишите идентификатор приложения Bot и пароль приложения, вам потребуется указать идентификатор приложения в манифесте приложения.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-110">Record your bot app ID and app password, you will need to supply the app ID in your app manifest.</span></span>

### <a name="update-your-app-manifest"></a><span data-ttu-id="fe9c3-111">Обновление манифеста приложения</span><span class="sxs-lookup"><span data-stu-id="fe9c3-111">Update your app manifest</span></span>

<span data-ttu-id="fe9c3-112">Как и в случае с Боты и вкладками, [Манифест](~/resources/schema/manifest-schema.md#composeextensions) приложения можно изменить, добавив в него свойства расширения Messaging.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-112">As with bots and tabs, you update the [manifest](~/resources/schema/manifest-schema.md#composeextensions) of your app to include the messaging extension properties.</span></span> <span data-ttu-id="fe9c3-113">Эти свойства определяют, как ваше расширение обмена сообщениями отображается и работает в клиенте Microsoft Teams.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-113">These properties govern how your messaging extension appears and behaves in the Microsoft Teams client.</span></span> <span data-ttu-id="fe9c3-114">Расширения обмена сообщениями поддерживаются начиная с версии 1.0 манифеста.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-114">Messaging extensions are supported beginning with v1.0 of the manifest.</span></span>

#### <a name="declare-your-messaging-extension"></a><span data-ttu-id="fe9c3-115">Объявление расширения обмена сообщениями</span><span class="sxs-lookup"><span data-stu-id="fe9c3-115">Declare your messaging extension</span></span>

<span data-ttu-id="fe9c3-116">Чтобы добавить расширение обмена сообщениями, включите новую структуру JSON верхнего уровня в манифест со `composeExtensions` свойством.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-116">To add a messaging extension, include a new top-level JSON structure in your manifest with the `composeExtensions` property.</span></span> <span data-ttu-id="fe9c3-117">В настоящее время вы можете создать только один добавочный номер для обмена сообщениями для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-117">Currently, you are limited to creating a single messaging extension for your app.</span></span>

> [!NOTE]
> <span data-ttu-id="fe9c3-118">Манифест содержит ссылки на расширения обмена сообщениями `composeExtensions`.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-118">The manifest refers to messaging extensions as `composeExtensions`.</span></span> <span data-ttu-id="fe9c3-119">Это необходимо для обеспечения обратной совместимости.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-119">This is to maintain backward compatibility.</span></span>

<span data-ttu-id="fe9c3-120">Определение расширения — это объект, имеющий следующую структуру:</span><span class="sxs-lookup"><span data-stu-id="fe9c3-120">The extension definition is an object that has the following structure:</span></span>

| <span data-ttu-id="fe9c3-121">Имя свойства</span><span class="sxs-lookup"><span data-stu-id="fe9c3-121">Property name</span></span> | <span data-ttu-id="fe9c3-122">Назначение</span><span class="sxs-lookup"><span data-stu-id="fe9c3-122">Purpose</span></span> | <span data-ttu-id="fe9c3-123">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="fe9c3-123">Required?</span></span> |
|---|---|---|
| `botId` | <span data-ttu-id="fe9c3-124">Уникальный идентификатор приложения для ленты, зарегистрированный с помощью Bot Framework.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-124">The unique Microsoft app ID for the bot as registered with the Bot Framework.</span></span> <span data-ttu-id="fe9c3-125">Как правило, это должен быть тот же идентификатор, что и для всего приложения Teams.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-125">This should typically be the same as the ID for your overall Teams app.</span></span> | <span data-ttu-id="fe9c3-126">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-126">Yes</span></span> |
| `scopes` | <span data-ttu-id="fe9c3-127">Массив, объявляющий, можно ли добавлять это расширение `personal` в `team` области или в области (или и то, и другое).</span><span class="sxs-lookup"><span data-stu-id="fe9c3-127">Array declaring whether this extension can be added to `personal` or `team` scopes (or both).</span></span> | <span data-ttu-id="fe9c3-128">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-128">Yes</span></span> |
| `canUpdateConfiguration` | <span data-ttu-id="fe9c3-129">Включает пункт меню **параметров** .</span><span class="sxs-lookup"><span data-stu-id="fe9c3-129">Enables **Settings** menu item.</span></span> | <span data-ttu-id="fe9c3-130">Нет</span><span class="sxs-lookup"><span data-stu-id="fe9c3-130">No</span></span> |
| `commands` | <span data-ttu-id="fe9c3-131">Массив команд, поддерживаемых этим расширением обмена сообщениями.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-131">Array of commands that this messaging extension supports.</span></span> <span data-ttu-id="fe9c3-132">Можно выполнить не более 10 команд.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-132">You are limited to 10 commands.</span></span> | <span data-ttu-id="fe9c3-133">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-133">Yes</span></span> |

#### <a name="define-commands"></a><span data-ttu-id="fe9c3-134">Определение команд</span><span class="sxs-lookup"><span data-stu-id="fe9c3-134">Define commands</span></span>

<span data-ttu-id="fe9c3-135">Ваш модуль обмена сообщениями должен объявить одну команду, которая появляется, когда пользователь выбирает приложение из кнопки **Дополнительные параметры** (**&#8943;**) в поле Создать.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-135">Your messaging extension should declare one command, which appears when the user selects your app from the **More options** (**&#8943;**) button in the compose box.</span></span>

![Снимок экрана: список расширений обмена сообщениями в Teams](~/assets/images/compose-extensions/compose-extension-list.png)

<span data-ttu-id="fe9c3-137">В манифесте приложения командный элемент представляет собой объект со следующей структурой:</span><span class="sxs-lookup"><span data-stu-id="fe9c3-137">In the app manifest, your command item is an object with the following structure:</span></span>

| <span data-ttu-id="fe9c3-138">Имя свойства</span><span class="sxs-lookup"><span data-stu-id="fe9c3-138">Property name</span></span> | <span data-ttu-id="fe9c3-139">Назначение</span><span class="sxs-lookup"><span data-stu-id="fe9c3-139">Purpose</span></span> | <span data-ttu-id="fe9c3-140">Обязательный?</span><span class="sxs-lookup"><span data-stu-id="fe9c3-140">Required?</span></span> | <span data-ttu-id="fe9c3-141">Минимальная версия манифеста</span><span class="sxs-lookup"><span data-stu-id="fe9c3-141">Minimum manifest version</span></span> |
|---|---|---|---|
| `id` | <span data-ttu-id="fe9c3-142">Уникальный идентификатор, назначенный этой команде.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-142">Unique ID that you assign to this command.</span></span> <span data-ttu-id="fe9c3-143">Запрос пользователя будет включать этот идентификатор.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-143">The user request will include this ID.</span></span> | <span data-ttu-id="fe9c3-144">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-144">Yes</span></span> | <span data-ttu-id="fe9c3-145">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-145">1.0</span></span> |
| `title` | <span data-ttu-id="fe9c3-146">Имя команды.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-146">Command name.</span></span> <span data-ttu-id="fe9c3-147">Это значение отображается в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-147">This value appears in the UI.</span></span> | <span data-ttu-id="fe9c3-148">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-148">Yes</span></span> | <span data-ttu-id="fe9c3-149">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-149">1.0</span></span> |
| `description` | <span data-ttu-id="fe9c3-150">Текст справки, указывающий, что делает эта команда.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-150">Help text indicating what this command does.</span></span> <span data-ttu-id="fe9c3-151">Это значение отображается в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-151">This value appears in the UI.</span></span> | <span data-ttu-id="fe9c3-152">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-152">Yes</span></span> | <span data-ttu-id="fe9c3-153">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-153">1.0</span></span> |
| `type` | <span data-ttu-id="fe9c3-154">Задайте тип команды.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-154">Set the type of command.</span></span> <span data-ttu-id="fe9c3-155">Возможные значения: `query` и `action`.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-155">Possible values include `query` and `action`.</span></span> <span data-ttu-id="fe9c3-156">Если не указано, по умолчанию установлено значение`query`</span><span class="sxs-lookup"><span data-stu-id="fe9c3-156">If not present the default value is set to `query`</span></span> | <span data-ttu-id="fe9c3-157">Нет</span><span class="sxs-lookup"><span data-stu-id="fe9c3-157">No</span></span> | <span data-ttu-id="fe9c3-158">1.4</span><span class="sxs-lookup"><span data-stu-id="fe9c3-158">1.4</span></span> |
| `initialRun` | <span data-ttu-id="fe9c3-159">Необязательный параметр, `query` используемый с командами.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-159">Optional parameter, used with `query` commands.</span></span> <span data-ttu-id="fe9c3-160">Если задано значение **true**, то эта команда должна выполняться сразу после того, как пользователь выберет эту команду в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-160">If set to **true**, indicates this command should be executed as soon as the user chooses this command in the UI.</span></span> | <span data-ttu-id="fe9c3-161">Нет</span><span class="sxs-lookup"><span data-stu-id="fe9c3-161">No</span></span> | <span data-ttu-id="fe9c3-162">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-162">1.0</span></span> |
| `fetchTask` | <span data-ttu-id="fe9c3-163">Необязательный параметр, `action` используемый с командами.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-163">Optional parameter, used with `action` commands.</span></span> <span data-ttu-id="fe9c3-164">Установите значение **true** для получения URL-адреса адаптивной карты или веб-сайта для отображения в [модуле задачи](~/task-modules-and-cards/what-are-task-modules.md).</span><span class="sxs-lookup"><span data-stu-id="fe9c3-164">Set to **true** to fetch the adaptive card or web url to display within the [task module](~/task-modules-and-cards/what-are-task-modules.md).</span></span> <span data-ttu-id="fe9c3-165">Используется, когда входные данные `action` команды динамически, а не статический набор параметров.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-165">This is used when the inputs to the `action` command is dynamic as opposed to a static set of parameters.</span></span> <span data-ttu-id="fe9c3-166">Обратите внимание, что если задано значение **true** , то список статических параметров для команды игнорируется</span><span class="sxs-lookup"><span data-stu-id="fe9c3-166">Note that the if set to **true** the static parameter list for the command is ignored</span></span> | <span data-ttu-id="fe9c3-167">Нет</span><span class="sxs-lookup"><span data-stu-id="fe9c3-167">No</span></span> | <span data-ttu-id="fe9c3-168">1.4</span><span class="sxs-lookup"><span data-stu-id="fe9c3-168">1.4</span></span> |
| `parameters` | <span data-ttu-id="fe9c3-169">Статический список параметров для команды.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-169">Static list of parameters for the command.</span></span> | <span data-ttu-id="fe9c3-170">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-170">Yes</span></span> | <span data-ttu-id="fe9c3-171">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-171">1.0</span></span> |
| `parameter.name` | <span data-ttu-id="fe9c3-172">Имя параметра.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-172">The name of the parameter.</span></span> <span data-ttu-id="fe9c3-173">Он отправляется службе по запросу пользователя.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-173">This is sent to your service in the user request.</span></span> | <span data-ttu-id="fe9c3-174">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-174">Yes</span></span> | <span data-ttu-id="fe9c3-175">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-175">1.0</span></span> |
| `parameter.description` | <span data-ttu-id="fe9c3-176">Описывает назначение этого параметра или пример значения, которое следует предоставить.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-176">Describes this parameter’s purposes or example of the value that should be provided.</span></span> <span data-ttu-id="fe9c3-177">Это значение отображается в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-177">This value appears in the UI.</span></span> | <span data-ttu-id="fe9c3-178">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-178">Yes</span></span> | <span data-ttu-id="fe9c3-179">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-179">1.0</span></span> |
| `parameter.title` | <span data-ttu-id="fe9c3-180">Краткий заголовком или меткой с понятным пользователем параметром.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-180">Short user-friendly parameter title or label.</span></span> | <span data-ttu-id="fe9c3-181">Да</span><span class="sxs-lookup"><span data-stu-id="fe9c3-181">Yes</span></span> | <span data-ttu-id="fe9c3-182">1.0</span><span class="sxs-lookup"><span data-stu-id="fe9c3-182">1.0</span></span> |
| `parameter.inputType` | <span data-ttu-id="fe9c3-183">Укажите требуемый тип ввода.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-183">Set to the type of input required.</span></span> <span data-ttu-id="fe9c3-184">Возможные значения: `text`, `textarea`, `number`, `date`, `time`, `toggle`.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-184">Possible values include `text`, `textarea`, `number`, `date`, `time`, `toggle`.</span></span> <span data-ttu-id="fe9c3-185">Значение по умолчанию:`text`</span><span class="sxs-lookup"><span data-stu-id="fe9c3-185">Default is set to `text`</span></span> | <span data-ttu-id="fe9c3-186">Нет</span><span class="sxs-lookup"><span data-stu-id="fe9c3-186">No</span></span> | <span data-ttu-id="fe9c3-187">1.4</span><span class="sxs-lookup"><span data-stu-id="fe9c3-187">1.4</span></span> |
| `context` | <span data-ttu-id="fe9c3-188">Необязательный массив значений, определяющий контекст, в котором доступно действие с сообщением.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-188">Optional array of values that defines the context the message action is available in.</span></span> <span data-ttu-id="fe9c3-189">Возможные значения: `message`, `compose`, или `commandBox`.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-189">Possible values are `message`, `compose`, or `commandBox`.</span></span> <span data-ttu-id="fe9c3-190">Значение по умолчанию: `["compose", "commandBox"]`.</span><span class="sxs-lookup"><span data-stu-id="fe9c3-190">Default is `["compose", "commandBox"]`.</span></span> | <span data-ttu-id="fe9c3-191">Нет</span><span class="sxs-lookup"><span data-stu-id="fe9c3-191">No</span></span> | <span data-ttu-id="fe9c3-192">1.5</span><span class="sxs-lookup"><span data-stu-id="fe9c3-192">1.5</span></span> |
