## <a name="add-a-messaging-extension-to-your-app"></a>Добавление расширения обмена сообщениями в приложение

Расширение системы обмена сообщениями — это размещенная в облаке служба, которая прослушивает запросы пользователей и отвечает на структурированные данные, такие как [карточка](~/task-modules-and-cards/what-are-cards.md). Вы интегрируете службу с Microsoft Teams с помощью `Activity` объектов Bot Framework. Наши расширения .NET и Node. js для пакета SDK построителя построителя могут помочь добавить функциональность расширения обмена сообщениями в приложение.

![Схема процесса обработки сообщений для расширений обмена сообщениями](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a>Регистрация в Bot Framework

Если вы еще не сделали этого, сначала необходимо зарегистрировать Bot с помощью Microsoft Bot Framework. Идентификатор приложения Microsoft и конечные точки обратного вызова для ленты, как определено, будут использоваться в вашем расширении обмена сообщениями для получения запросов пользователей и реагирования на них. Не забудьте включить канал Microsoft Teams для ленты.

Запишите идентификатор приложения Bot и пароль приложения, вам потребуется указать идентификатор приложения в манифесте приложения.

### <a name="update-your-app-manifest"></a>Обновление манифеста приложения

Как и в случае с Боты и вкладками, [Манифест](~/resources/schema/manifest-schema.md#composeextensions) приложения можно изменить, добавив в него свойства расширения Messaging. Эти свойства определяют, как ваше расширение обмена сообщениями отображается и работает в клиенте Microsoft Teams. Расширения обмена сообщениями поддерживаются начиная с версии 1.0 манифеста.

#### <a name="declare-your-messaging-extension"></a>Объявление расширения обмена сообщениями

Чтобы добавить расширение обмена сообщениями, включите новую структуру JSON верхнего уровня в манифест со `composeExtensions` свойством. В настоящее время вы можете создать только один добавочный номер для обмена сообщениями для вашего приложения.

> [!NOTE]
> Манифест содержит ссылки на расширения обмена сообщениями `composeExtensions`. Это необходимо для обеспечения обратной совместимости.

Определение расширения — это объект, имеющий следующую структуру:

| Имя свойства | Назначение | Обязательный? |
|---|---|---|
| `botId` | Уникальный идентификатор приложения для ленты, зарегистрированный с помощью Bot Framework. Как правило, это должен быть тот же идентификатор, что и для всего приложения Teams. | Да |
| `scopes` | Массив, объявляющий, можно ли добавлять это расширение `personal` в `team` области или в области (или и то, и другое). | Да |
| `canUpdateConfiguration` | Включает пункт меню **параметров** . | Нет |
| `commands` | Массив команд, поддерживаемых этим расширением обмена сообщениями. Можно выполнить не более 10 команд. | Да |

#### <a name="define-commands"></a>Определение команд

Ваш модуль обмена сообщениями должен объявить одну команду, которая появляется, когда пользователь выбирает приложение из кнопки **Дополнительные параметры** (**&#8943;**) в поле Создать.

![Снимок экрана: список расширений обмена сообщениями в Teams](~/assets/images/compose-extensions/compose-extension-list.png)

В манифесте приложения командный элемент представляет собой объект со следующей структурой:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Уникальный идентификатор, назначенный этой команде. Запрос пользователя будет включать этот идентификатор. | Да | 1.0 |
| `title` | Имя команды. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `description` | Текст справки, указывающий, что делает эта команда. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Задайте тип команды. Возможные значения: `query` и `action`. Если не указано, по умолчанию установлено значение`query` | Нет | 1.4 |
| `initialRun` | Необязательный параметр, `query` используемый с командами. Если задано значение **true**, то эта команда должна выполняться сразу после того, как пользователь выберет эту команду в пользовательском интерфейсе. | Нет | 1.0 |
| `fetchTask` | Необязательный параметр, `action` используемый с командами. Установите значение **true** для получения URL-адреса адаптивной карты или веб-сайта для отображения в [модуле задачи](~/task-modules-and-cards/what-are-task-modules.md). Используется, когда входные данные `action` команды динамически, а не статический набор параметров. Обратите внимание, что если задано значение **true** , то список статических параметров для команды игнорируется | Нет | 1.4 |
| `parameters` | Статический список параметров для команды. | Да | 1.0 |
| `parameter.name` | Имя параметра. Он отправляется службе по запросу пользователя. | Да | 1.0 |
| `parameter.description` | Описывает назначение этого параметра или пример значения, которое следует предоставить. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Краткий заголовком или меткой с понятным пользователем параметром. | Да | 1.0 |
| `parameter.inputType` | Укажите требуемый тип ввода. Возможные значения: `text`, `textarea`, `number`, `date`, `time`, `toggle`. Значение по умолчанию:`text` | Нет | 1.4 |
| `context` | Необязательный массив значений, определяющий контекст, в котором доступно действие с сообщением. Возможные значения: `message`, `compose`, или `commandBox`. Значение по умолчанию: `["compose", "commandBox"]`. | Нет | 1.5 |
