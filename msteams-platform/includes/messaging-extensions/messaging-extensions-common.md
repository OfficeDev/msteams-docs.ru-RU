## <a name="add-a-messaging-extension-to-your-app"></a>Добавление расширения обмена сообщениями в приложение

Расширение обмена сообщениями — это облачная служба, которая слушает запросы пользователей и отвечает структурированными данными, такими как [карта.](~/task-modules-and-cards/what-are-cards.md) Вы интегрируете свой сервис с Microsoft Teams через объекты Bot `Activity` Framework. Наши расширения .NET Node.js для Bot Builder SDK помогут вам добавить функциональность расширения обмена сообщениями в ваше приложение.

![Диаграмма потока сообщений для расширений сообщений](~/assets/images/compose-extensions/ceflow.png)

### <a name="register-in-the-bot-framework"></a>Зарегистрируйтесь в Bot Framework

Если вы еще этого не сделали, вы должны сначала зарегистрировать бота с Microsoft Bot Framework. Идентификатор приложения Майкрософт и конечные точки обратного вызова для вашего бота, как это определено там, будут использоваться в вашем расширении обмена сообщениями для получения и ответа на запросы пользователей. Не забудьте включить Microsoft Teams для вашего бота.

Завехайте идентификатор приложения бота и пароль приложения, вам нужно будет предоставить идентификатор приложения в манифесте приложения.

### <a name="update-your-app-manifest"></a>Обновление манифеста приложения

Как и в случае с ботами и вкладками, вы [обновляете манифест](~/resources/schema/manifest-schema.md#composeextensions) приложения, чтобы включить свойства расширения обмена сообщениями. Эти свойства регулируют, как ваше расширение обмена сообщениями отображается и ведет себя Microsoft Teams клиента. Расширения сообщений поддерживаются начиная с v1.0 манифеста.

#### <a name="declare-your-messaging-extension"></a>Объявить о расширении обмена сообщениями

Чтобы добавить расширение обмена сообщениями, включите новую структуру JSON верхнего уровня в манифест с `composeExtensions` свойством. В настоящее время вы ограничены созданием единого расширения обмена сообщениями для вашего приложения.

> [!NOTE]
> Манифест относится к расширениям обмена сообщениями как `composeExtensions` . Это делается для поддержания обратной совместимости.

Определение расширения является объектом, который имеет следующую структуру:

| Имя свойства | Назначение | Обязательный? |
|---|---|---|
| `botId` | Уникальный идентификатор приложения Майкрософт для бота, зарегистрированный в Bot Framework. Обычно это должно быть так же, как идентификатор для общего Teams приложения. | Да |
| `scopes` | Array объявляет, можно ли добавить это расширение или `personal` области `team` (или оба). | Да |
| `canUpdateConfiguration` | Включает **Параметры меню.** | Нет |
| `commands` | Множество команд, которые поддерживает это расширение обмена сообщениями. Вы ограничены 10 командами. | Да |

#### <a name="define-commands"></a>Определение команд

Расширение обмена сообщениями должно объявить одну команду, которая появляется, когда пользователь выбирает ваше приложение **из опций Больше** **(&#8943;)** кнопку в поле compose.

![Скриншот списка расширений обмена сообщениями в Teams](~/assets/images/compose-extensions/compose-extension-list.png)

В манифесте приложения элемент команды является объектом со следующей структурой:

| Имя свойства | Назначение | Обязательный? | Минимальная версия манифеста |
|---|---|---|---|
| `id` | Уникальный идентификатор, который вы назначаете этой команде. Запрос пользователя будет включать этот идентификатор. | Да | 1.0 |
| `title` | Название командования. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `description` | Справка текст с указанием того, что эта команда делает. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `type` | Установите тип команды. Возможные значения: `query` и `action`. Если нет, то значение по умолчанию `query` установлено. | Нет | 1.4 |
| `initialRun` | Дополнительный параметр, используемый с `query` командами. Если **настроено на** истинное, указывается, что эта команда должна быть выполнена, как только пользователь выберет эту команду в пользовательском интерфейсе. | Нет | 1.0 |
| `fetchTask` | Дополнительный параметр, используемый с `action` командами. Установите **на верно,** чтобы получить адаптивную карту или веб-адрес для отображения в [модуле задачи.](~/task-modules-and-cards/what-are-task-modules.md) Это используется, когда входные данные в `action` команду динамичны, в отличие от статического набора параметров. Обратите внимание, что если **установить, чтобы** верно статический список параметров для команды игнорируется. | Нет | 1.4 |
| `parameters` | Статический список параметров для команды. | Да | 1.0 |
| `parameter.name` | Имя параметра. Это отправляется в службу в запросе пользователя. | Да | 1.0 |
| `parameter.description` | Описывает цели этого параметра или пример значения, которое должно быть предоставлено. Это значение отображается в пользовательском интерфейсе. | Да | 1.0 |
| `parameter.title` | Короткое удобное для пользователя название параметра или этикетка. | Да | 1.0 |
| `parameter.inputType` | Установите требуемый тип ввода. Возможные значения включают `text` , , , , `textarea` `number` `date` `time` `toggle` . По умолчанию установлен на `text` . | Нет | 1.4 |
| `context` | Дополнительный массив значений, определяющий контекст действия сообщения. Возможные `message` значения, `compose` или `commandBox` . Значение по умолчанию: `["compose", "commandBox"]`. | Нет | 1.5 |
