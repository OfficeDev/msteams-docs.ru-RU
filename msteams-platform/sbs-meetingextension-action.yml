### YamlMime:Tutorial
title: Расширение сообщения на основе действий сборки
metadata:
  title: Расширение сообщения на основе действий сборки
  description: В этом учебном модуле вы узнаете, как настроить расширение сообщения о действии для Teams, чтобы инициировать действия из области создания сообщения и сообщения.
  audience: Developer
  level: Beginner
  ms.date: 24/02/2022
  ms.topic: interactive-tutorial
  nextTutorialHref: messaging-extensions/how-to/action-commands/define-action-command.md
  nextTutorialTitle: Дополнительные сведения о включении команд действий расширения сообщений
  ms.custom: mvc
  ms.localizationpriority: high
  ms.openlocfilehash: 8b0b4ea1780d1157db9f496933619fccecd20552
  ms.sourcegitcommit: edfe85e312c73e34aa795922c4b7eb0647528d48
  ms.translationtype: MT
  ms.contentlocale: ru-RU
  ms.lasthandoff: 09/30/2022
  ms.locfileid: "68243313"
items:
- durationInMinutes: 1
  content: "Расширения сообщений позволяют пользователям взаимодействовать с веб-службами в клиенте Microsoft Teams. Они помогают инициировать действия во внешней системе из области создания сообщения, командного поля или непосредственно из сообщения.\n\n**Основные функции расширения сообщений на основе действий**\n\n* Предоставляет пользователю модальное всплывающее окно для сбора или отображения информации.\n* Активирует команды действий из области создания сообщения, командного поля или сообщения. \n\nЭто пошаговое руководство поможет вам создать расширение сообщений на основе действий Teams, чтобы инициировать действия из области создания сообщений и сообщений. Вы увидите следующие выходные данные:\n   \n  ![Выход](~/assets/images/sbs-messagingextension-action/sharemessageoutput1.png)\n"
- title: Предварительные требования
  durationInMinutes: 1
  content: "Установите следующие средства и настройте среду разработки:  \n\n* [Microsoft Teams с](https://teams.microsoft.com/) действительной учетной записью\n* [Пакет SDK для .NET Core](https://dotnet.microsoft.com/download) версии 3.1\n* [Последняя версия Visual Studio](https://visualstudio.microsoft.com/downloads/)\n* [ngrok](https://ngrok.com/download) latest version (only for devbox testing) or any equivalent tunneling solution\n\n  > [!NOTE]\n  > После скачивания ngrok зарегистрируйтесь и установите [authtoken](https://ngrok.com/download).\n"
- title: Настройка локальной среды
  durationInMinutes: 1
  content: "Клонируйте `BotBuilder-Samples` репозиторий в локальный репозиторий GitHub:  \n\n 1. Откройте [BotBuilder-Samples](https://github.com/Microsoft/BotBuilder-Samples).\n 1. Выберите **\"Код\"**.\n 1. В раскрывающемся меню выберите \" **Открыть с помощью GitHub Desktop\"**.\n\n    ![Клонирование репозитория](~/assets/images/sbs-messagingextension-action/botbuilder-sample.png)\n\n 1. Выберите **\"Клонировать\"**. \n"
- title: Создание и регистрация бота на Azure AD портале
  durationInMinutes: 5
  content: "Чтобы создать и зарегистрировать бот в Microsoft Azure Active Directory (Azure AD), создайте туннель с помощью ngrok, добавьте конечную точку обмена сообщениями и выполните следующие действия:\n\n* Создайте ресурс Azure Bot для регистрации бота в Azure Служба Bot.\n* Создайте секрет клиента, чтобы включить проверку подлинности единого входа бота.\n* Добавьте канал Teams для развертывания бота в канале Teams.\n* Используйте ngrok для создания туннеля к конечным точкам веб-сервера.\n* Добавьте конечную точку обмена сообщениями в созданный туннель ngrok.\n\n**Создание ресурса Azure Bot**\n\n1. Перейдите в [microsoft портал Azure](https://portal.azure.com/).\n1. Выберите **Создать ресурс**.\n1. В поле поиска введите **Azure Bot**.\n1. Выберите **ВВОД**.\n1. Выберите **Azure Bot**.\n\n     :::image type=\"content\" source=\"./assets/images/azure-bot.png\" alt-text=\"Azure Bot.\":::\n\n1. Нажмите **Создать**.\n1. Введите необходимое имя дескриптора бота в **дескрипторах бота**.\n1. Выберите свою **подписку** в раскрывающемся списке.\n1. Выберите свою **группу ресурсов** в раскрывающемся списке. \n\n    ![Выбор ресурса azure bot](~/assets/images/sbs-messagingextension-action/create-azurebot.png) \n\n   Чтобы создать группу ресурсов (выберите **\"Создать новый** > введите имя ресурса> нажмите кнопку \"ОК **\"**). Выберите необходимое расположение в раскрывающемся списке **\"** Новое расположение группы ресурсов\".\n   Дополнительные сведения см. в [разделе \"Создание группы ресурсов\"](/azure/azure-resource-manager/management/manage-resource-groups-portal#create-resource-groups).\n   \n1. В разделе **\"Идентификатор приложения Майкрософт** \" по умолчанию выбран параметр **\"Создать новый** идентификатор приложения Майкрософт\". \n \n   Можно либо выбрать \"Использовать существующую регистрацию **приложения**\", ввести существующий идентификатор приложения и пароль существующего **приложения, либо** выбрать \"Создать  **новый идентификатор приложения Майкрософт\"**.\n\n   > [!NOTE]\n   > Вы не можете создать несколько ботов с одинаковым **идентификатором приложения Майкрософт**.\n\n1. Выберите **\"Мультитенантный\" в** **разделе \"Тип бота\"**.\n\n    ![Тип бота](~/assets/images/Teams-Messaging-Extensions-Search/bot-type.png) \n\n1. Выберите **Проверить и создать**.\n\n    ![Создание идентификатора приложения Майкрософт](~/assets/images/sbs-messagingextension-action/review-create.png)\n\n1. Если проверка пройдена, нажмите **Создать**. \n\n    Подготовка службы бота займет несколько секунд. \n\n1. Выберите пункт **Перейти к ресурсу**. \n\n    ![Развертывание приложения](~/assets/images/sbs-messagingextension-action/resource-file.png)\n\n    Ваш бот Azure создан.\n\n    ![Созданный ресурс бота Azure](assets/images/sbs-messagingextension-action/created-azure-bot.png)\n\n**Создание секрета клиента**\n\n  Если вы создали новый идентификатор приложения Майкрософт, выполните **следующие действия**:\n\n1. На левой панели выберите \" **Конфигурация\"**. \n\n   > [!TIP]\n   > Сохраните **идентификатор приложения Майкрософт или** **идентификатор клиента для** дальнейшей справки.\n\n1. Рядом с **идентификатором приложения Майкрософт** выберите \" **Управление\"**.\n\n   :::image type=\"content\" source=\"~/assets/images/manage-bot-label.png\" alt-text=\"Управляющим\":::\n\n1. В разделе **\"Секреты клиента** \" выберите \" **Новый секрет клиента\"**. \n\n    ![Новый секрет клиента](~/assets/images/sbs-messagingextension-action/adding-client-secret.png)\n\n   **Появится окно \"Добавление секрета** клиента\".  \n\n1. **Введите описание**.\n\n1. Нажмите **Добавить**.\n\n    ![Добавление секрета клиента в приложение](~/assets/images/sbs-messagingextension-action/add-a-clientsecret.png)\n\n1. В **столбце \"Значение** \" выберите \" **Копировать в буфер обмена\"**.\n\n     ![Значение секрета клиента](~/assets/images/sbs-messagingextension-action/client-secret.png)\n   \n   > [!TIP]\n   > Сохраните значение **секретов клиента** или пароль приложения для дальнейшей ссылки.\n\n**Добавление канала Teams**\n\n1. Нажмите **Главная**.\n\n    ![Домашняя страница](~/assets/images/sbs-messagingextension-action/select-home.png)\n\n1. Выберите бот из списка **последних ресурсов**.\n\n1. Выберите **\"Каналы\"** в левой области и выберите **Microsoft Teams** <img src=\"~/assets/images/bots/teamsicon.png\" alt=\"Teams icon\" width=\"20\"/>.\n\n   :::image type=\"content\" source=\"./assets/images/adaptive-cards/channel-teams.png\" alt-text=\"Выберите Teams.\":::\n\n1. Установите флажок, чтобы принять **условия обслуживания**.\n\n1. Выберите **\"Принять**\".\n\n      ![Условия обслуживания](~/assets/images/sbs-messagingextension-action/agree.png)\n\n1. Нажмите кнопку **Сохранить**.\n\n      ![Выбор Teams](~/assets/images/sbs-messagingextension-action/configure-msteams.png)   \n\n**Создание туннеля для локального веб-сервера**\n\nИспользуйте ngrok для создания туннеля к общедоступным конечным точкам HTTPS локального веб-сервера. Выполните следующую команду в ngrok:\n\n ```bash\n ngrok http --host-header=localhost 3978\n ```\n\n> [!TIP]\n> Если вы **столкнулись ERR_NGROK_4018**, выполните действия, описанные в командной строке, чтобы зарегистрироваться и проверить подлинность ngrok. Затем выполните команду `ngrok http --host-header=localhost 3978` .\n\n**Добавление конечной точки обмена сообщениями**\n\n1. Из ngrok скопируйте URL-адрес HTTPS (https to io).\n\n   :::image type=\"content\" source=\"../msteams-platform/assets/images/ngrok-url.png\" alt-text=\"URL-адрес HTTPS ngrok\":::\n\n    > [!NOTE]\n    > URL-адрес HTTPS в ngrok — это полное доменное имя.\n    > Это `WebAppDomain` полное доменное имя, которое не включается `https://` в него.\n\n1. В **разделе \"Параметры** \" для созданного бота Azure выберите \" **Конфигурация\"**.\n\n1. В **конечной точке обмена** сообщениями используйте URL-адрес HTTPS, доступный в ngrok, и в конце URL-адреса добавьте **/api/messages**.\n\n    ![Универсальный код ресурса (URI) приложения](~/assets/images/sbs-messagingextension-action/appuri.png)\n\n1. Нажмите **Применить**.\n\n    Вы успешно настроили бот в Azure Служба Bot.\n"
- title: Обновление регистрации Azure AD приложения
  durationInMinutes: 1
  content: "1. Перейдите на [портал Azure](https://portal.azure.com/).\n\n1. Выберите **Azure Active Directory**.\n\n1. На панели навигации слева выберите \" **Регистрация приложений\"**.\n\n1. Выберите бота.\n\n   ![Регистрация приложения](~/assets/images/sbs-messagingextension-action/app.-registerations.png)\n\n1. В разделе **Управление** выберите **Предоставление API**.\n\n1. Выберите **\"Задать\"**.\n\n   ![Предоставление API](~/assets/images/sbs-messagingextension-action/set-exposeanapi.png)\n\n1. **Задайте URI идентификатора** приложения в виде `api://{AppID}`.\n\n   ![Установка ссылки](~/assets/images/sbs-messagingextension-action/set-link.png)\n\n1. Вставьте значение `WebAppDomain` между и `/{AppID}``api://` .</br>\n    `api://2bb1****.ngrok.io/{AppID}`</br>\n    \n   На следующем рисунке показано доменное имя:\n    \n    ![Предоставлять](~/assets/images/sbs-messagingextension-action/exposeanapi.png)\n\n    > [!NOTE]\n    > Если вы используете службу туннелирования, например ngrok, обязательно обновляйте значение при каждом изменении поддомена ngrok.\n    > `For example: api://f631****.ngrok.io/92c11075-c629-4a1e-ab58-02b4fd4204c2`, где `f631****.ngrok.io` новое имя поддомена ngrok.\n\n1. Нажмите **Добавить область**. \n\n   ![Выберите область](~/assets/images/sbs-messagingextension-action/addascope.png)\n\n1. На отображаемой панели введите `access_as_user` имя **области**.\n\n1. **Указать, кто может дать согласие?** `Admins and users`\n\n1. Чтобы настроить запросы согласия `access_as_user` администратора и пользователя с соответствующими значениями для области, укажите следующие сведения в полях:</br>\n\n     * Введите `Teams can access the user’s profile` **Администратор отображаемое имя согласия**.\n\n     * Введите `Allows Teams to call the app’s web APIs as the current user` **Администратор согласия**.\n\n     * Введите `Teams can access the user profile and make requests on the user’s behalf` **отображаемое имя согласия пользователя**.\n\n     * Введите `Enable Teams to call this app’s APIs with the same rights as the user` описание **согласия пользователя**.\n\n1. Убедитесь, что параметру **Состояние** присвоено значение **Включено**.\n\n1. Выберите **\"Добавить область** для сохранения\".\n\n    ![Добавление области](~/assets/images/sbs-messagingextension-action/addascopeuser.png)\n\n    > [!NOTE]\n    > Имя **области должно совпадать** с универсальным кодом ресурса (URI) **идентификатора** приложения, `/access_as_user` добавленным в конце.</br>\n       `api://2bb1****.ngrok.io/00000000-0000-0000-0000-000000000000/access_as_user`\n\n    ![Scopes](~/assets/images/sbs-messagingextension-action/scopes.png) \n\n1. В разделе **Авторизованные клиентские приложения** укажите приложения, которые необходимо авторизовать для веб-приложения вашего приложения. \n\n1. Выберите **Добавить клиентское приложение**. \n\n    ![Выбор клиентского приложения](~/assets/images/sbs-messagingextension-action/clientapps.png) \n\n1. **Введите идентификатор клиента** для мобильного `1fec8e78-bce4-4aaf-ab1b-5451cc387264` или настольного приложения Teams. \n\n    ![Добавление клиентского приложения 1](~/assets/images/sbs-messagingextension-action/addclientapplication1.png) \n\n   Вы можете **ввести идентификатор клиента**: `5e3ce6c0-2b1f-4285-8d4b-75ee78787346` для веб-приложения Teams.\n\n    ![Добавление клиентского приложения 2](~/assets/images/sbs-messagingextension-action/addclientapplication2.png) \n\n1. Выберите **авторизованные области**.\n\n    ![Добавление клиентского приложения 2](~/assets/images/sbs-messagingextension-action/authorizedscope.png) \n\n   На следующем рисунке отображаются идентификаторы клиентов:\n\n    ![Клиентские приложения](~/assets/images/sbs-messagingextension-action/clientapp.png) \n\n1. На панели слева выберите **разрешения API**. \n\n   > [!NOTE]\n   > Пользователи должны дать согласие на эти разрешения, только если Azure AD зарегистрирован в другом клиенте.\n\n1. Выберите **Добавить разрешение**.\n\n    ![Добавление разрешения](~/assets/images/meetings-side-panel/addpermission.png)\n\n\n1. Выберите **Microsoft Graph**.\n\n1. Выберите **Делегированные разрешения**.\n\n1. Добавьте указанные ниже разрешения.</br>\n     * **email**\n     * **offline_access**\n     * **Openid**\n     * **profile**\n     * **User.Read**\n\n1. Выберите **Добавить разрешения**.\n\n     ![Другие разрешения](~/assets/images/sbs-messagingextension-action/other-permissions.png)\n\n1. На панели слева выберите \" **Проверка подлинности\"** , чтобы задать URI перенаправления. \n\n   > [!NOTE]\n   > Если приложению не предоставлено согласие ИТ-администратора, пользователи должны предоставить согласие при первом использовании приложения.\n           \n     1. Выберите **Добавить платформу**.\n     1. Выберите платформу **Веб**.\n\n        ![Веб](~/assets/images/sbs-messagingextension-action/web.png)\n\n     1. Введите URI перенаправления для приложения, `auth-end` введя полное доменное имя:</br> \n       `https://2bb1****.ngrok.io/auth-end`. </br>\n\n     1. **Включите неявное предоставление и гибридные** потоки, установите следующие флажки:\n         * **Маркеры идентификаторов**\n         * **Маркеры доступа**\n\n     1. Нажмите **Настроить**.\n\n        ![Окончание проверки подлинности](~/assets/images/sbs-messagingextension-action/authend.png)\n"
- title: Настройка параметров приложения и файлов манифеста
  durationInMinutes: 1
  content: "1. Перейдите **к файлу appsettings.json** в клонированном репозитории.\n\n    ![Расположение параметров приложения](~/assets/images/sbs-messagingextension-action/appsettingslocation.png)\n\n1. Откройте **файл appsettings.json** в последней версии Visual Studio и обновите следующие сведения:  \n\n     * Задайте `\"MicrosoftAppType\"` **значение MultiTenant**.\n     * Задайте `\"MicrosoftAppId\"` идентификатор приложения **Майкрософт для бота**.\n     * Задайте `\"MicrosoftAppPassword\"` для бота **значение** идентификатора **секрета клиента**.\n     * Оставьте `\"MicrosoftAppTenantId\"` пустым для мультитенантного бота.\n     * Задайте `\"BaseUrl\"` полное доменное имя.\n\n    ![Параметры приложения](~/assets/images/sbs-messagingextension-action/json-file.png)\n\n1. Перейдите в `manifest.json` клонированный репозиторий.\n\n    ![Расположение файла манифеста](~/assets/images/sbs-messagingextension-action/manifestlocation.png)\n\n1. Откройте `manifest.json` последнюю версию Visual Studio и внесите следующие изменения:\n\n     * Замените `<<validDomains>>` его полным доменным именем.\n     * Замените все вхождения `<<Microsoft-App-ID>>` идентификатором **приложения Майкрософт бота**.\n\n    ![Изображение манифеста2](~/assets/images/sbs-messagingextension-action/botid1.png)\n"
- title: Сборка и запуск службы
  durationInMinutes: 1
  content: "**Создание и запуск службы с помощью последней версии Visual Studio или командной строки**\n\n# <a name=\"latest-version-of-visual-studio\"></a>[Последняя версия Visual Studio](#tab/latestversionofvisualstudio)\n\n   1. Запустите последнюю версию Visual Studio.\n   1. Перейдите **к файлу \"** > **Открыть проект** > **или решение\"**.\n\n      ![Открытие файла](~/assets/images/sbs-messagingextension-action/VSopenfile.png)\n\n   1. Выберите **файл TeamsMessagingExtensionsAction.csproj** из **csharp_dotnet папки** .\n\n      ![Файл решения](~/assets/images/sbs-messagingextension-action/openproject.png)\n\n   1. Нажмите **клавишу F5** , чтобы запустить проект.\n\n   1. Выберите **Да**, если появится следующий диалог:\n\n      ![Сертификат доверия](~/assets/images/sbs-messagingextension-action/certificate.png)\n\n      Откроется веб-страница с сообщением о том, что **ваш бот готов!**.\n\n      ![Приложение готово](~/assets/images/sbs-messagingextension-action/appisready.png) \n\n    \n# <a name=\"command-line\"></a>[Командная строка](#tab/cli)\n\nПерейдите **к примерам > csharp_dotnetcore > 51.teams-messaging-extensions-action** в окне командной строки и введите следующую команду:\n\n```bash\ndotnet run\n```\n\n![Dotnet](~/assets/images/sbs-messagingextension-action/dotnetruncmd.png)\n  \n"
- title: Добавление приложения расширения сообщения о действии в Teams
  durationInMinutes: 1
  content: "1. В клонированном репозитории перейдите csharp_dotnetcore > **51.teams-messaging-extensions-action > TeamsAppManifest**.\n\n1. Создайте .zip со следующими файлами, которые находятся в **папке манифеста** : \n   * manifest.json\n   * icon-outline.png\n   * icon-color.png\n\n   ![ZIP-файл](~/assets/images/sbs-messagingextension-action/zipfile.png) \n\n1. Перейдите в **Microsoft Teams**.\n\n1. Выберите **Приложения**.\n\n1. Выберите **Управление приложениями**\n\n1. Выберите **Отправить пользовательское приложение**.\n\n   ![Отправить](~/assets/images/sbs-messagingextension-action/uploadacustomapp1.png)\n\n1. Нажмите **кнопку \"** Открыть\", чтобы .zip файл, созданный в **папке манифеста** .\n\n   ![Выбор ZIP-файла](~/assets/images/sbs-messagingextension-action/openzipfile.png)\n\n1. Нажмите **Добавить**.\n\n   ![Добавление приложения](~/assets/images/sbs-messagingextension-action/add.png)\n\n                \n"
- title: Взаимодействие с приложением в Teams
  durationInMinutes: 1
  content: "1. Выберите **команду \"Создать карточку** \" в списке команд окна создания.\n\n   ![Карте](~/assets/images/sbs-messagingextension-action/create-card.png)\n\n1. Введите сведения во всплывающем модальном окне.\n\n   ![Информация](~/assets/images/sbs-messagingextension-action/output-card.png)\n\n1. Выберите **Отправить**.\n\n   ![submit](~/assets/images/sbs-messagingextension-action/submit.png)\n\n1. Выберите (...) в меню переполнения.\n   \n1. Перейдите к **дополнительным действиям**.\n\n1. Выберите \" **Поделиться сообщением\"**.\n\n   ![Общий доступ к карточке](~/assets/images/sbs-messagingextension-action/sharemessage.png)\n\n1. Установите флажок, если необходимо включить изображение и отправить его.\n\n   ![Выход](~/assets/images/sbs-messagingextension-action/sharemessageoutput.png)\n"
- title: Полный запрос
  durationInMinutes: 1
  content: >
    У вас возникла такая проблема?

       ![Выходные данные](~/assets/images/sbs-messagingextension-action/sharemessageoutput1.png)
- content: Вы завершили работу с руководством по началу работы с приложением **расширения сообщений о действии** !
