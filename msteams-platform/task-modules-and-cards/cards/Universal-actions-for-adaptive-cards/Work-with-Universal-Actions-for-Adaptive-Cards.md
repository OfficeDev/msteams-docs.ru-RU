---
title: Работа с универсальными действиями для адаптивных карточек
description: Узнайте, как работать с универсальными действиями для адаптивных карт, в том числе схемой универсального доступа к адаптивным картам, моделью обновления и обратной совместимостью с помощью образцов кода.
ms.topic: conceptual
ms.localizationpriority: medium
ms.openlocfilehash: 488385d560f3f372be8149631eb1a04a3642f65f
ms.sourcegitcommit: af1d0a4041ce215e7863ac12c71b6f1fa3e3ba81
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2021
ms.locfileid: "60888365"
---
# <a name="work-with-universal-actions-for-adaptive-cards"></a>Работа с универсальными действиями для адаптивных карточек

Универсальные действия для адаптивных карт предоставляют способ реализации сценариев на основе адаптивных карт как для Teams, так и для Outlook. Этот документ охватывает следующие темы:

* [Схема, используемая для универсальных действий для адаптивных карточек](#schema-for-universal-actions-for-adaptive-cards)
* [Модель обновления](#refresh-model)
* [Действие вызова `adaptiveCard/action`](#adaptivecardaction-invoke-activity)
* [Обратная совместимость](#backward-compatibility)

## <a name="quick-start-guide-to-use-universal-actions-for-adaptive-cards-in-teams"></a>Руководство по быстрому началу использования универсальных действий для адаптивных карт в Teams

1. Замените все экземпляры `Action.Submit` на `Action.Execute`, чтобы обновить существующий сценарий в Teams.
2. Добавьте пункт в адаптивную карту, если вы хотите использовать модель автоматического обновления или если для сценария `refresh` требуются пользовательские представления.

    >[!NOTE]
    > Укажите свойство `userIds`, чтобы определить, какие пользователи получают автоматические обновления.

3. Обрабатывайте запросы на запуск `adaptiveCard/action` в своем боте.
4. Используйте контекст запроса на вызов, чтобы отреагировать с помощью карт, созданных для пользователя.

    > [!NOTE]
    > Каждый раз, когда бот возвращает новую карточку в результате обработки `Action.Execute`, отклик должен соответствовать формату отклика.

## <a name="schema-for-universal-actions-for-adaptive-cards"></a>Схема для универсальных действий для адаптивных карточек

Универсальные действия для адаптивных карт представлены в схеме адаптивных карт версии 1.4. Для эффективного использования адаптивной карточки свойство `version` адаптивной карточки должно быть установлено на 1.4.

> [!NOTE]
> При установке свойства `version` на 1.4 адаптивная карточка становится несовместима с более старыми клиентами платформ или приложений, например с Outlook и Teams, так как они не поддерживают универсальные действия для адаптивных карточек.

Если установить версию карточки меньше 1.4 и использовать одно свойство или оба, `refresh` и `Action.Execute`, происходит следующее:

| Клиент | Поведение |
| :-- | :-- |
| Teams | Карточка перестает работать. Карточка не обновляется и `Action.Execute` не обрабатывается в зависимости от версии клиента Teams. Чтобы обеспечить максимальную совместимость в Teams, определите `Action.Execute` с `Action.Submit` в свойстве отката. |

Дополнительные сведения о поддержке клиентов более старых версий см. в разделе [обратная совместимость](#backward-compatibility).

### <a name="actionexecute"></a>Action.Execute

При разработке адаптивных карточек замените `Action.Submit` и `Action.Http` на `Action.Execute`. Схема для `Action.Execute` аналогична схеме `Action.Submit`.

Дополнительные сведения см. в разделе [Схема и свойства Action.Execute](/adaptive-cards/authoring-cards/universal-action-model#actionexecute).

Теперь вы можете использовать модель обновления, чтобы разрешить автоматическое обновление адаптивных карточек.

## <a name="refresh-model"></a>Модель обновления

Чтобы автоматически обновить адаптивную карточку, определите ее свойство `refresh`, которое внедряет действие типа `Action.Execute` и массив `userIds`.

Дополнительные сведения см. в разделе [схема и свойства обновления](/adaptive-cards/authoring-cards/universal-action-model#refresh-mechanism).

## <a name="user-ids-in-refresh"></a>Идентификаторы пользователей в процессе обновления

Ниже описаны особенности UserIds в процессе обновления.

* UserIds — это массив пользовательских МРИС, который является частью `refresh` свойства в адаптивных картах.

* Если свойство списка `userIds` указано как `userIds: []` в разделе обновления карточки, карточка не обновляется автоматически. Вместо этого пользователь видит параметр **Обновить карточку** в меню с тремя точками в классическом или веб-приложении и в контекстном меню при длительном нажатии на мобильном устройстве, то есть на Android или iOS, чтобы обновить карточку вручную.

* Добавлено свойство UserIds, так как каналы в Teams могут включать множество участников. Если все участники одновременно просматривают канал, безусловное автоматическое обновление приводит к множеству одновременных вызовов бота. Свойство всегда должно быть включено, чтобы определить, какие пользователи должны получать автоматическое обновление с максимальным `userIds` *количеством 60 (шестидесяти) пользовательских МРИС.*

* Вы можете Teams пользовательские МРИС участника беседы. Дополнительные сведения о добавлении в список userIds в разделе обновление адаптивной карты см. в статье [Fetch roster or user profile.](/microsoftteams/platform/bots/how-to/get-teams-context?tabs=dotnet#fetch-the-roster-or-user-profile)

* Пример MRI пользователя Teams: `29:1bSnHZ7Js2STWrgk6ScEErLk1Lp2zQuD5H2qQ960rtvstKp8tKLl-3r8b6DoW0QxZimuTxk_kupZ1DBMpvIQQUAZL-PNj0EORDvRZXy8kvWk`

> [!NOTE]
> Свойство `userIds` игнорируется в Outlook, а свойство `refresh` всегда активируется автоматически. Для Outlook проблемы масштабирования не существует, так как пользователи просматривают карточку в разное время.

Следующий шаг — использование запуска действия `adaptiveCard/action`, чтобы понять, какой должен быть сделан запрос после выполнения `Action.Execute`.

## <a name="adaptivecardaction-invoke-activity"></a>`adaptiveCard/action` запуск действия

Когда в клиенте выполняется `Action.Execute`, для вашего бота создается новый тип запуска действия `adaptiveCard/action`.

Дополнительные сведения см. в разделе: [формат запроса и свойства обычного действия вызова `adaptiveCard/action`](/adaptive-cards/authoring-cards/universal-action-model#request-format).

Дополнительные сведения см. в разделе: [формат отклика и свойства обычного действия вызова `adaptiveCard/action` с поддерживаемыми типами отклика](/adaptive-cards/authoring-cards/universal-action-model#response-format).

Затем к старым клиентам на разных платформах можно применить обратную совместимость и сделать адаптивную карточку совместимой.

## <a name="backward-compatibility"></a>Обратная совместимость

Универсальные действия для адаптивных карт позволяют устанавливать свойства, которые позволяют обратной совместимости со старыми версиями Outlook и Teams.

### <a name="teams"></a>Teams

Чтобы обеспечить обратную совместимость адаптивных карточек с более старыми версиями Teams, необходимо включить свойство `fallback` и установить для него значение `Action.Submit`. Кроме того, код бота должен обрабатывать как `Action.Execute`, так и `Action.Submit`.

Дополнительные сведения см. в разделе [обратная совместимость в Teams](/adaptive-cards/authoring-cards/universal-action-model#teams).

## <a name="code-samples"></a>Примеры кода

|Название примера | Описание | .NETCore | Node.js |
|----------------|-----------------|--------------|--------------|
| Бот организации питания Teams | Создайте бот, который принимает порядок питания с помощью адаптивных карт. |[View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/bot-teams-catering/csharp)| Эта функция пока недоступна |
| Адаптивные карточки последовательного рабочего процесса | Демонстрация того, как реализовать последовательное рабочий процесс, пользовательские представления и адаптивные карты в ботах. | [View](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/bot-sequential-flow-adaptive-cards/csharp) | [Просмотр](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/bot-sequential-flow-adaptive-cards/nodejs) |

## <a name="see-also"></a>Дополнительные ресурсы

* [Действия адаптивной карточки в Teams](~/task-modules-and-cards/cards/cards-actions.md#adaptive-cards-actions)
* [Как работают боты](/azure/bot-service/bot-builder-basics?view=azure-bot-service-4.0&preserve-view=true)
* [Последовательные рабочие процессы](~/task-modules-and-cards/cards/universal-actions-for-adaptive-cards/sequential-workflows.md)
* [Актуальные карточки](~/task-modules-and-cards/cards/universal-actions-for-adaptive-cards/up-to-date-views.md)
