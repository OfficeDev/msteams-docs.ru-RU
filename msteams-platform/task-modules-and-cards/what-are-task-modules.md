---
title: Что такое модули задач?
author: clearab
description: Добавление модальных контекстных окон для сбора и отображения информации для пользователей из приложений Microsoft Teams.
ms.topic: overview
ms.author: anclear
ms.openlocfilehash: 44d4e308614763b9da36c2abb7dd150778484c56
ms.sourcegitcommit: 50571f5c6afc86177c4fe1032fe13366a7b706dd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2020
ms.locfileid: "49576857"
---
# <a name="what-are-task-modules"></a>Что такое модули задач?

Модули задач позволяют создавать Модальные всплывающие окна в приложении Teams. Во всплывающем окне можно запустить собственный код HTML/JavaScript, Показать `<iframe>` мини-приложение, такое как YouTube или Microsoft Stream, или отобразить [адаптивную карту](/adaptive-cards/). Они особенно удобны для инициализации и выполнения задач, а также для отображения обширных сведений, таких как видео или панели мониторинга Power BI. Часто всплывающие окна часто более естественны для пользователей, инициирующих и завершающих задачи по сравнению с вкладкой или интерфейсом робота на основе бесед.

Модули задач строится на основах вкладок Microsoft Teams; по сути, это вкладка в всплывающем окне. Они используют один и тот же пакет SDK, поэтому если вы создали вкладку, вы уже 90% от способа создания модуля задачи.

Модули задач можно вызывать тремя способами:

* **Вкладки "маркетинг" и "личные".** С помощью пакета SDK для вкладок Microsoft Teams вы можете вызывать модули задач с помощью кнопок, ссылок или меню на вкладке. [здесь рассказывается подробно.](~/task-modules-and-cards/task-modules/task-modules-tabs.md)
* **Боты.** Кнопки на [карточках](~/task-modules-and-cards/cards/cards-reference.md) , отправленных с ленты. Это особенно полезно, если вы не хотите, чтобы все участники в канале видели, что происходит с Bot. Например, когда пользователи отвечают на опрос в канале, он не очень полезен для просмотра записи создаваемого опроса. [Это подробно описано в этой статье.](~/task-modules-and-cards/task-modules/task-modules-bots.md)
* **В Microsoft Teams из глубокой ссылки.** Кроме того, можно создавать URL-адреса для вызова модуля задач из любого места. [Это подробно описано в этой статье.](#task-module-deep-link-syntax)

## <a name="what-a-task-module-looks-like"></a>Как выглядит модуль задачи

Ниже показано, как выглядит модуль задачи при вызове из Bot (без использования цветных прямоугольников и пронумерованных кругов):

![Пример модуля задачи](~/assets/images/task-module/task-module-example.png)

Давайте проанализируем его:

1. [ `color` Значок](~/resources/schema/manifest-schema.md#icons)приложения.
2. [ `short` Имя](~/resources/schema/manifest-schema.md#name)своего приложения.
3. Заголовок модуля задачи, указанный в `title` свойстве [объекта таскинфо](#the-taskinfo-object).
4. Кнопка закрытия и отмены модуля задачи. Если пользователь нажмет это, ваше приложение получит событие, `err` как описано [здесь](~/task-modules-and-cards/task-modules/task-modules-tabs.md#example-submitting-the-result-of-a-task-module). (**Примечание:** в настоящее время это событие невозможно определить при вызове модуля задачи из Bot.)
5. Синий прямоугольник — это место, где отображается веб-страница при загрузке собственной веб-страницы с помощью `url` свойства [объекта таскинфо](#the-taskinfo-object). Дополнительные сведения находятся в разделе " [изменение размера модуля задачи](#task-module-sizing) " ниже.
6. При отображении адаптивной карточки с помощью `card` свойства [объекта таскинфо](#the-taskinfo-object) дополнение добавляется для пользователя, в противном случае вам потребуется [самостоятельно справиться](#task-module-css-for-htmljavascript-task-modules).
7. Кнопки адаптивной карточки отображаются здесь. Если вы используете собственную страницу, необходимо создать собственные кнопки.

## <a name="overview-of-invoking-and-dismissing-task-modules"></a>Обзор модулей задач вызова и закрытия

Модули задач можно вызывать из вкладок, боты или глубокими ссылками, а также в одной из них могут быть HTML или адаптивной картой, поэтому существует множество гибкости с точки зрения того, как они вызываются, и как работать с результатом взаимодействия с пользователем. В таблице ниже показано, как это работает.

| **Вызывается с помощью...** | **Модуль задачи — HTML/JavaScript** | **Модуль задачи является адаптивной картой** |
| --- | --- | --- |
| **JavaScript на вкладке** | 1. Использование функции клиентского пакета SDK Teams `tasks.startTask()` с необязательной `submitHandler(err, result)` функцией обратного вызова <br/><br/> 2. в коде модуля задачи после завершения работы пользователя вызовите функцию пакета SDK Teams `tasks.submitTask()` с `result` объектом в качестве параметра. Если `submitHandler` был указан обратный вызов `tasks.startTask()` , Teams вызывает его в `result` качестве параметра.<br/><br/> 3. Если при вызове возникла ошибка `tasks.startTask()` , `submitHandler` функция вызывается с использованием `err` строки. <br/><br/> 4. Вы также можете указать, `completionBotId` когда вы `teams.startTask()` `result` направляете вызов, если вместо этого он отправляется в Bot. | 1. вызовите клиентский пакет SDK Teams `tasks.startTask()` с [объектом таскинфо](#the-taskinfo-object) и `TaskInfo.card` содержащим JSON для адаптивной карточки, которая будет отображаться в всплывающем окне модуля задачи. <br/><br/> 2. Если `submitHandler` был указан обратный вызов `tasks.startTask()` , Teams вызывает его с помощью `err` строки, если при вызове возникла ошибка, `tasks.startTask()` или если пользователь закрыл всплывающее окно модуля задач с помощью X в правом верхнем углу. <br/><br/> 3. Если пользователь нажмет кнопку Action. оправить, `data` объект возвращается в виде значения `result` . |
| **Кнопка "почтовые карточки"** | 1. кнопки открыткной карточки, в зависимости от типа кнопки, могут вызывать модули задач двумя способами: URL-адрес глубокой ссылки или отправка `task/fetch` сообщения. Ниже показано, как работают URL-адреса глубокой связи. <br/><br/> 2. Если `type` для кнопки задано значение `task/fetch` ( `Action.Submit` тип кнопки для адаптивных карточек), то `task/fetch invoke` событие (POST HTTP) отправляется в Bot, а Bot реагирует на POST с помощью HTTP 200 и текст отклика, содержащий обертку для [объекта таскинфо](#the-taskinfo-object). Это подробно объясняется в [вызове модуля задачи с помощью задачи/извлечения](~/task-modules-and-cards/task-modules/task-modules-bots.md#invoking-a-task-module-via-taskfetch).<br/><br/> 3. Teams отображает модуль задач; по завершении работы пользователя вызовите функцию пакета SDK Teams `tasks.submitTask()` с `result` объектом в качестве параметра. <br/><br/> 4. Bot получает `task/submit invoke` сообщение, содержащее `result` объект. Ответ на сообщение можно получить тремя разными способами `task/submit` :, не выполнив ничего (задача выполнена успешно), отображая сообщение пользователю во всплывающем окне или вызывая другое окно модуля задачи (например, создавая интерфейс, подобный мастеру). Эти три варианта подробно обсуждаются в [подробном рассказе о задачах и отправляйте](~/task-modules-and-cards/task-modules/task-modules-bots.md#the-flexibility-of-tasksubmit). | 1. кнопки на адаптивных карточках, например, поддерживают два способа вызова модулей задач: URL-адреса с глубокими ссылками с `Action.openUrl` кнопками и `task/fetch` с помощью `Action.Submit` кнопок. <br/><br/> 2. модули задач со адаптивными картами работают точно так же, как и в случае сценария HTML/JavaScript (см. слева). Основное отличие заключается в том, что при использовании адаптивных карт нет JavaScript, но не существует способа позвонить `tasks.submitTask()` . Вместо этого Teams берет `data` объект из `Action.Submit` и возвращает его в качестве полезных данных `task/submit` события, как описано [ниже](~/task-modules-and-cards/task-modules/task-modules-bots.md#the-flexibility-of-tasksubmit). |
| **URL-адрес глубокой ссылки** <br/>[синтаксис URL-адреса](#task-module-deep-link-syntax) | 1. Teams вызывает модуль задач; URL-адрес, который отображается в `<iframe>` указанном `url` параметре глубокой ссылки. `submitHandler`Обратный вызов отсутствует. <br/><br/> 2. в коде JavaScript страницы в модуле задач вызовите `tasks.submitTask()` его, чтобы закрыть с помощью `result` объекта в качестве параметра, то же, что при вызове этого метода из вкладки или кнопки "применяет". Тем не менее, логика выполнения немного отличается. Если логика выполнения находится на клиенте (например, если отсутствует Bot) `submitHandler` , обратный вызов отсутствует, поэтому любая логика завершения должна находиться в коде, предшествующем вызову `tasks.submitTask()` . Ошибки вызовов выводятся только с помощью консоли. Если у вас есть Bot, вы можете указать `completionBotId` параметр в ссылке Deep, чтобы отправить `result` объект через `task/submit` событие. | 1. Teams вызывает модуль задач; текст карты JSON адаптивной карточки указывается как значение параметра глубокой ссылки, закодированное как URL-адрес `card` . <br/><br/> 2. пользователь закрывает модуль задач, щелкнув X в правом верхнем углу модуля задач или нажав `Action.Submit` кнопку на карточке. Так как нет `submitHandler` необходимости в вызове, вам необходим робот, чтобы отправить значение поля адаптивной карточки в. Используйте `completionBotId` параметр в ссылке Deep, чтобы указать Bot для отправки данных с помощью `task/submit invoke` события. |

> [!NOTE]
> Вызов модуля задачи из JavaScript не поддерживается на мобильных устройствах.

## <a name="the-taskinfo-object"></a>Объект Таскинфо

`TaskInfo`Объект содержит метаданные для модуля задачи. Ниже указано определение объекта. **Необходимо** определить либо `url` (для встроенного IFRAME), либо `card` (для адаптивной карты).

| Атрибут | Тип | Описание |
| --- | --- | --- |
| `title` | string | Отображается под именем приложения и справа от значка приложения. |
| `height` | number или string | Это может быть число, представляющее высоту модуля задачи в пикселях, или `small` , `medium` или `large` . [Ниже показано, как обрабатываются высота и ширина](#task-module-sizing). |
| `width` | number или string | Это может быть число, представляющее ширину модуля задачи в пикселях, или `small` , `medium` или `large` . [Ниже показано, как обрабатываются высота и ширина](#task-module-sizing). |
| `url` | string | URL-адрес страницы, загруженной в `<iframe>` модуль задачи. Домен URL-адреса должен находиться в [массиве валиддомаинс](~/resources/schema/manifest-schema.md#validdomains) приложения в манифесте приложения. |
| `card` | Вложенная карта или вложенная карта с подплатой | JSON для адаптивной карточки, отображаемой в модуле задачи. Если вы вызываете из Bot, вам потребуется использовать формат JSON для адаптивной карточки в объекте Bot Framework `attachment` . На вкладке вы будете использовать только адаптивную карточку. [Ниже приведен пример.](#adaptive-card-or-adaptive-card-bot-card-attachment) |
| `fallbackUrl` | string | Если клиент не поддерживает функцию модуля задач, этот URL-адрес открывается на вкладке браузера. |
| `completionBotId` | string | Указывает идентификатор приложения с идентификатором почтовых роботов, который отправляет результат взаимодействия пользователя с модулем задачи. Если этот параметр указан, Bot получит `task/submit invoke` событие с объектом JSON в полезных данных события. |

> [!NOTE]
> Функция модуля задач требует, чтобы домены всех URL-адресов, которые требуется загрузить, были включены в `validDomains` массив манифеста приложения.

## <a name="task-module-sizing"></a>Изменение размера модуля задачи

С помощью целых чисел `TaskInfo.width` `TaskInfo.height` в пикселях задается высота и ширина. Однако в зависимости от размера окна команды и разрешения экрана они будут уменьшены пропорционально, сохраняя пропорции (ширину и высоту).

Если `TaskInfo.width` `TaskInfo.height` вы и есть `"small"` , `"medium"` или `"large"` Размер красного прямоугольника на рисунке выше, пропорции доступного места: 20%, 50%, 60% для `width` и 20%, 50%, 66% для `height` .

Можно динамически изменить размер модулей задач, вызываемых из вкладки. После вызова `tasks.startTask()` можно вызвать, `tasks.updateTask(newSize)` где свойства Height и Width объекта невсизе соответствуют спецификации таскинфо (ex. `{ height: 'medium', width: 'medium' }`).

## <a name="task-module-css-for-htmljavascript-task-modules"></a>CSS модуля задач для модулей задач HTML/JavaScript

Модули задач на основе HTML/JavaScript имеют доступ ко всей области модуля задач под заголовком. Несмотря на то, что в этом случае необходимо, чтобы заполнение вокруг краев было выровнено с элементами заголовка и не излишними полосами прокрутки, необходимо предоставить правильный CSS. Ниже приведено несколько примеров для нескольких вариантов использования.

### <a name="example-1---youtube-video"></a>Пример 1 – YouTube Video

YouTube позволяет внедрять видеоролики на веб-страницы. С помощью простой веб-страницы-заглушки это легко отобразить в модуле задач:

![Видео YouTube](~/assets/images/task-module/youtube-example.png)

Вот HTML-код для этой страницы без CSS:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  ⋮
</head>
<body>
  <div id="embed-container">
    <iframe width="1000" height="700" src="https://www.youtube.com/embed/rd0Rd8w3FZ0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>
  </div>
</body>
</html>
```

CSS выглядит следующим образом:

```css
#embed-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 95%;
    height: 95%;
    padding-left: 20px;
    padding-right: 20px;
    padding-top: 10px;
    padding-bottom: 10px;
    border-style: none;
}
```

### <a name="example-2---powerapp"></a>Пример 2 — Поверапп

Вы также можете использовать такой же подход для встраивания Поверапп. Так как ширина и ширина любого отдельного Поверапп настраивается, может потребоваться изменить высоту и ширину для достижения необходимой презентации.

![Поверапп управления активами](~/assets/images/task-module/powerapp-example.png)

```html
<iframe width="720" height="520" src="https://web.powerapps.com/webplayer/iframeapp?source=iframe&screenColor=rgba(104,101,171,1)&appId=/providers/Microsoft.PowerApps/apps/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"></iframe>
```

CSS:

```css
#embed-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 94%;
    height: 95%;
    padding-left: 20px;
    padding-right: 20px;
    padding-top: 10px;
    padding-bottom: 10px;
    border-style: none;
}
```

## <a name="adaptive-card-or-adaptive-card-bot-card-attachment"></a>Вложение карты с адаптивной картой или адаптивной карты

Как было сказано выше, в зависимости от того, как вы выдаете вам, вам `card` потребуется использовать адаптивную карту или вложенную карту с нежелательной картой, которая является только адаптивной картой, упакованной в объект вложения.

При вызове со вкладки вам потребуется использовать адаптивную карточку. Вот очень простой пример:

```json
{
    "type": "AdaptiveCard",
    "body": [
        {
            "type": "TextBlock",
            "text": "Here is a ninja cat:"
        },
        {
            "type": "Image",
            "url": "http://adaptivecards.io/content/cats/1.png",
            "size": "Medium"
        }
    ],
    "version": "1.0"
}
```

При вызове из Bot необходимо использовать вложение с адаптивной картой с картой, как показано ниже:

```json
{
    "contentType": "application/vnd.microsoft.card.adaptive",
    "content": {
        "type": "AdaptiveCard",
        "body": [
            {
                "type": "TextBlock",
                "text": "Here is a ninja cat:"
            },
            {
                "type": "Image",
                "url": "http://adaptivecards.io/content/cats/1.png",
                "size": "Medium"
            }
        ],
        "version": "1.0"
    }
}
```

Необходимо помнить, будет ли вызываться модуль задачи, содержащий адаптивную карточку, из ленты или с вкладки.

## <a name="task-module-deep-link-syntax"></a>Синтаксис глубокой ссылки для модуля задачи

Глубокая ссылка модуля задачи — это просто сериализация [объекта таскинфо](#the-taskinfo-object) с двумя другими сведениями, `APP_ID` а также при необходимости `BOT_APP_ID` :

`https://teams.microsoft.com/l/task/APP_ID?url=<TaskInfo.url>&height=<TaskInfo.height>&width=<TaskInfo.width>&title=<TaskInfo.title>&completionBotId=BOT_APP_ID`

`https://teams.microsoft.com/l/task/APP_ID?card=<TaskInfo.card>&height=<TaskInfo.height>&width=<TaskInfo.width>&title=<TaskInfo.title>&completionBotId=BOT_APP_ID`

Просмотрите [объект таскинфо](#the-taskinfo-object) для типов данных и допустимых значений для `<TaskInfo.url>` , `<TaskInfo.card>` , `<TaskInfo.height>` , `<TaskInfo.width>` и `<TaskInfo.title>` .

> [!TIP]
> Убедитесь, что URL-адрес кодирует глубокую ссылку, особенно при использовании `card` параметра (например, [ `encodeURI()` функция](https://www.w3schools.com/jsref/jsref_encodeURI.asp)JavaScript).

Ниже приведены сведения о следующих возможностях `APP_ID` и `BOT_APP_ID` :

| Значение | Type | Обязательный? | Описание |
| --- | --- | --- | --- |
| `APP_ID` | string | Да | [Идентификатор](~/resources/schema/manifest-schema.md#id) приложения, вызывающего модуль задачи. [Массив валиддомаинс](~/resources/schema/manifest-schema.md#validdomains) в манифесте `APP_ID` должен содержать домен для `url` if `url` в URL-адресе. (Идентификатор приложения уже известен, когда модуль задач вызывается с вкладки или с ленты, поэтому он не включен в `TaskInfo` .) |
| `BOT_APP_ID` | string | Нет | Если указано значение для `completionBotId` , `result` объект отправляется через `task/submit invoke` сообщение для указанного элемента Bot. `BOT_APP_ID` должен быть указан в манифесте приложения в качестве Bot, то есть невозможно просто отправить его на любой робот. |

Обратите внимание на то, что оно является допустимым `APP_ID` и `BOT_APP_ID` должно быть одинаковым, а во многих случаях — в том случае, если приложение использует Bot, поэтому рекомендуется использовать его в качестве идентификатора приложения, если таковой имеется.

## <a name="keyboard-and-accessibility-guidelines"></a>Рекомендации по использованию клавиатуры и специальных возможностей

С помощью модулей задач на основе HTML/JavaScript вы отвечаете за обеспечение возможности использования модуля задач приложения с клавиатурой. Программы чтения с экрана также зависят от возможности навигации с помощью клавиатуры. В частности, это означает две вещи:

1. Использование [атрибута TabIndex](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/tabindex) в HTML-тегах для управления элементами, которые могут быть отсортированы, а также если он участвует в последовательной навигации с клавиатуры (как правило, с помощью клавиш <kbd>Tab</kbd> и <kbd>SHIFT-TAB</kbd> ).
2. Обработка клавиши <kbd>ESC</kbd> в коде JavaScript для модуля задачи. Ниже приведен пример кода, демонстрирующий выполнение этого действия.

  ```javascript
  // Handle the Esc key
  document.onkeyup = function(event) {
  if ((event.key === 27) || (event.key === "Escape")) {
    microsoftTeams.submitTask(null); // this will return an err object to the completionHandler()
    }
  }
  ```

Microsoft Teams обеспечит правильную работу клавиатурных переходов из заголовка модуля задач в HTML-коде и наоборот.

## <a name="task-module-samples"></a>Примеры модулей задач

* [ ПримерNode.js/Типескрипт](https://github.com/OfficeDev/microsoft-teams-sample-task-module-nodejs)
* [Пример кода на языке C#/.нет](https://github.com/OfficeDev/microsoft-teams-sample-task-module-csharp)

> [!div class="nextstepaction"]
> [Дополнительные сведения: запрос разрешений для устройства](/concepts/device-capabilities/native-device-permissions.md)

> [!div class="nextstepaction"]
>[Дополнительные сведения: разрешения в коллекции камер и изображений](/concepts/device-capabilities/mobile-camera-image-permissions.md)
